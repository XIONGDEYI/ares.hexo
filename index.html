<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ARESXIONG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="ARESXIONG">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="ARESXIONG">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ARESXIONG">
  
    <link rel="alternate" href="/atom.xml" title="ARESXIONG" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ARESXIONG</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-study_my_website_collection" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/11/study_my_website_collection/" class="article-date">
  <time datetime="2016-11-11T03:11:29.000Z" itemprop="datePublished">2016-11-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/coding/">coding</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/11/study_my_website_collection/">常用网站收集</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="CODING"><a href="#CODING" class="headerlink" title="CODING"></a>CODING</h2><table><tr><td><a href="https://github.com/" target="_blank" rel="external">GitHub</a></td><td><a href="http://my.oschina.net/u/2288529/blog" target="_blank" rel="external">OsChina</a></td><td><a href="https://git.oschina.net/" target="_blank" rel="external">OsChina Git</a></td><td><a href="http://blog.csdn.net/" target="_blank" rel="external">CSDN</a></td></tr><tr><td><a href="http://stackoverflow.com" target="_blank" rel="external">StackOverFlow</a></td><td><a href="http://mxdxm.iteye.com/" target="_blank" rel="external">ITeye</a></td><td><a href="http://www.chinaunix.net/" target="_blank" rel="external">ChinaUnix</a></td><td><a href="https://sourceforge.net/" target="_blank" rel="external">SourceForge</a></td></tr><tr><td><a href="https://www.v2ex.com/go/android" target="_blank" rel="external">V2EX</a></td><td><a href="http://www.javaapk.com/" target="_blank" rel="external">JavaApk</a></td><td><a href="http://developer.android.com/index.html" target="_blank" rel="external">Android Developers</a></td><td><a href="https://www.facebook.com/Engineering/" target="_blank" rel="external">FaceBook-Enginerring</a></td></tr></table>

<h2 id="STUDY"><a href="#STUDY" class="headerlink" title="STUDY"></a>STUDY</h2><table><tr><td><a href="http://www.imooc.com/" target="_blank" rel="external">慕课网</a></td><td><a href="http://www.jikexueyuan.com/" target="_blank" rel="external">极客学院</a></td><td><a href="http://www.maiziedu.com/user/student/" target="_blank" rel="external">麦子学院</a></td><td><a href="http://study.163.com/u/ykt1432831019914" target="_blank" rel="external">网易云课堂</a></td></tr><tr><td><a href="http://open.163.com/?username=aresxdy" target="_blank" rel="external">网易公开课</a></td><td><a href="http://www.zentao.net/" target="_blank" rel="external">ZenTao</a></td><td><a href="http://bbs.jeecms.com/" target="_blank" rel="external">JEECMS</a></td><td><a href="http://greendao-orm.com/documentation/how-to-get-started/" target="_blank" rel="external">greenDAO</a></td></tr><tr><td><a href="http://www.uisdc.com/" target="_blank" rel="external">优设官网</a></td><td><a href="http://www.ituring.com.cn/article/775#link" target="_blank" rel="external">图灵社区</a></td><td><a href="http://ocw.lib.ntnu.edu.tw/" target="_blank" rel="external">国立台湾师大公开课</a></td><td></td></tr></table>

<h2 id="LINKING"><a href="#LINKING" class="headerlink" title="LINKING"></a>LINKING</h2><table><tr><td><a href="http://xiongdeyi.lofter.com/" target="_blank" rel="external">LOFTER</a></td><td><a href="http://www.zhihu.com/people/jiuduxueshe" target="_blank" rel="external">知乎</a></td><td><a href="https://theinitium.com/" target="_blank" rel="external">端传媒</a></td><td><a href="http://c39.yunpan.360.cn/my/index/" target="_blank" rel="external">360云盘</a></td></tr><tr><td><a href="http://yun.baidu.com/?ref=PPZQ" target="_blank" rel="external">百度云盘</a></td><td><a href="https://portal.qiniu.com/" target="_blank" rel="external">七牛云盘</a></td><td><a href="https://zh.wikipedia.org/wiki/Wikipedia:%E9%A6%96%E9%A1%B5" target="_blank" rel="external">维基百科</a></td><td><a href="http://note.youdao.com/web/list?notebook=%2F&amp;sortMode=0&amp;note=%2F94C2F41F9B3C4662B7E6B733CFC8E1E0%2FDCF3D1B21595445BAEA3F75E7D950EEC" target="_blank" rel="external">有道云笔记</a></td></tr></table>

<h2 id="SOURCE"><a href="#SOURCE" class="headerlink" title="SOURCE"></a>SOURCE</h2><table><tr><td><a href="http://www.jiumodiary.com/" target="_blank" rel="external">Jiumo</a></td><td><a href="http://www.zoudupai.com/" target="_blank" rel="external">走读派</a></td><td><a href="http://www.kgbook.com/" target="_blank" rel="external">苦瓜书盘</a></td><td><a href="http://www.forfrigg.com/" target="_blank" rel="external">ForFrigg</a></td></tr><tr><td><a href="http://www.xuexi111.com/" target="_blank" rel="external">学习资源网</a></td><td></td><td></td><td></td></tr></table>

<h2 id="TOOLS"><a href="#TOOLS" class="headerlink" title="TOOLS"></a>TOOLS</h2><table><tr><td><a href="http://json.cn/" target="_blank" rel="external">Json.cn</a></td><td><a href="http://tool.oschina.net/jscompress?type=2" target="_blank" rel="external">CodeCompress</a></td><td><a href="http://pressbin.com/tools/excel_to_html_table/index.html" target="_blank" rel="external">Table Converter</a></td><td><a href="http://fazero.tk/" target="_blank" rel="external">番茄工作法</a></td></tr><tr><td><a href="http://tool.oschina.net/codeformat/" target="_blank" rel="external">CodeFormat</a></td><td></td><td></td><td></td></tr></table>

<h2 id="LINUX"><a href="#LINUX" class="headerlink" title="LINUX"></a>LINUX</h2><table><tr><td><a href="http://www.study-area.org/menu1.htm" target="_blank" rel="external">Study-Area</a></td><td><a href="http://vbird.dic.ksu.edu.tw/linux_basic/linux_basic.php" target="_blank" rel="external">鸟哥的Linux私房菜</a></td><td><a href="http://ubuntuguide.org/wiki/Ubuntu:Hardy_tw" target="_blank" rel="external">Ubuntu 中文指南</a></td><td><a href="http://www.linuxde.net/" target="_blank" rel="external">LinuxDE</a></td></tr><tr><td><a href="http://linuxtools-rst.readthedocs.org/zh_CN/latest/" target="_blank" rel="external">linuxtools-rst</a></td><td></td><td></td><td></td></tr></table>

<h2 id="WEB-amp-H5"><a href="#WEB-amp-H5" class="headerlink" title="WEB&amp;H5"></a>WEB&amp;H5</h2><table><tr><td><a href="http://www.xuanfengge.com/" target="_blank" rel="external">轩枫阁</a></td><td></td><td></td><td></td></tr></table>


<h2 id="BLOGS"><a href="#BLOGS" class="headerlink" title="BLOGS"></a>BLOGS</h2><table><tr><td><a href="http://fazero.cc/archives/182" target="_blank" rel="external">FAZERO</a></td><td><a href="http://blog.fazero.cc/" target="_blank" rel="external">fazero</a></td><td><a href="http://ibruce.info/2013/11/22/hexo-your-blog/" target="_blank" rel="external">ibruce</a></td><td><a href="http://www.aswifter.com/" target="_blank" rel="external">a swifter</a></td></tr><td><a href="http://www.paulgraham.com/" target="_blank" rel="external">Paul Graham</a></td><td><a href="http://www.linux2me.com/" target="_blank" rel="external">LP’S BLOG</a></td><td><a href="http://www.jerryfu.net/" target="_blank" rel="external">JerryFu</a></td><td><a href=""></a></td></table>

<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>后续会不断更新好的学习网站。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/11/study_my_website_collection/" data-id="cj4zxoppq005xq4nhgcstt0ut" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/website/">website</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-web_develop_config" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/04/web_develop_config/" class="article-date">
  <time datetime="2016-05-04T08:54:29.000Z" itemprop="datePublished">2016-05-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/web/">web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/04/web_develop_config/">WEB开发之环境配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="ECLIPSE配置Maven"><a href="#ECLIPSE配置Maven" class="headerlink" title="ECLIPSE配置Maven"></a>ECLIPSE配置Maven</h2><p>下面是在Eclipse中配置Maven插件，同时安装maven应用，配置Maven环境变量，建立Maven管理的工程的基本步骤。<br>1.首先到Eclipse Marketplace中下载Maven Integration for Eclipse WTP。<br>2.然后查看是否成功下载，Window -&gt; ShowView -&gt; Maven，有显示Maven Repositories表示安装成功。<br>3.下载安装maven环境并配置环境变量。<br><a href="http://maven.apache.org/download.cgi" target="_blank" rel="external">maven官方下载地址</a><br>环境变量配置完成后再cmd中输入mvn -v有输出版本号表面安装配置成功。<br>4.重新定位eclipse中的maven：Window -&gt; Preference -&gt; Maven -&gt; Installation -&gt; Add，然后输入maven在本地硬盘的路径。<br>5.然后就可以新建maven工程或者导入已有的maven工程。</p>
<p>说明：通过pom.xml的配置， 会自动管理包的导入。<br>打开pom.xml 试着添加MySQL的JDBC驱动，添加如下配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;  </div><div class="line">    &lt;groupId&gt;mysql&lt;/groupId&gt;  </div><div class="line">    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;  </div><div class="line">    &lt;version&gt;5.1.10&lt;/version&gt;  </div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure></p>
<p>保存之后，在repository的子目录中 出现了mysql文件夹.<br>用Maven导入Gson的包,右击项目， Maven -&gt; add dependency.出现窗口,敲入gson,于是会自动搜索,出现符合的列表,双击com.google.code.gson.<br>在pom.xml 中就自动加入了Gson的导入依赖,同时， 在repository中导入了Gson的包.</p>
<h2 id="TOMCAT连接MYSQL"><a href="#TOMCAT连接MYSQL" class="headerlink" title="TOMCAT连接MYSQL"></a>TOMCAT连接MYSQL</h2><p>1.首先，要安装JDK,Tomcat,mysql等,此处略过.<br>2.eclipse下布署运行Tomcat的，在eclipse的window–&gt;preference—&gt;Server里，右面的里面添加tomcat的路径，指定jdk,然后在下面的servers选项卡里新建一个服务器，这时候就会在eclipse的project explore中生成一个Servers项目.<br>3.在context.xml的<code>&lt;context&gt;&lt;/context&gt;</code>之间添加连接池<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;Resource name=&quot;jdbc/mysql&quot;</div><div class="line">    auth=&quot;Container&quot; </div><div class="line">    type=&quot;javax.sql.DataSource&quot; </div><div class="line">    maxActive=&quot;50&quot;</div><div class="line">    maxIdle=&quot;10&quot;</div><div class="line">    maxWait=&quot;5000&quot; </div><div class="line">    username=&quot;***&quot;</div><div class="line">    password=&quot;****&quot; </div><div class="line">    driverClassName=&quot;com.mysql.jdbc.Driver&quot;</div><div class="line">    url=&quot;jdbc:mysql://localhost/mysql?useUnicode=true&amp;amp;</div><div class="line">    characterEncoding=UTF-8&amp;amp;zeroDateTimeBehavior=convertToNull&quot;/&gt;</div><div class="line">    &lt;!-- XML里 &amp; 要用&amp;amp;替代,不然会被过滤掉 --&gt;</div></pre></td></tr></table></figure></p>
<p>配置文件中Resource标签中各属性的含义：</p>
<ul>
<li>driverClassName - JDBC 所用到的数据库驱动的类全名.</li>
<li>maxActive - 连接池在同一时刻内所提供的最大活动连接数。</li>
<li>maxIdle - 连接池在空闲时刻保持的最大连接数.</li>
<li>maxWait - 当发生异常时数据库等待的最大毫秒数 (当没有可用的连接时).</li>
<li>password - 连接数据库的密码.</li>
<li>url - 连接至驱动的URL. (为了向后兼容, DRIVERNAME也被允许.)</li>
<li>username - 数据库用户名</li>
</ul>
<p>4.将mysql 的jdbc驱动复制到配置tomcat下的lib目录和工程的lib目录下。<br><a href="https://dev.mysql.com/downloads/connector/j/" target="_blank" rel="external">mysql-connector-java驱动下载地址</a></p>
<p>5.配置项目工程WEB-INF下面的web.xml文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;resource-ref&gt; </div><div class="line">   &lt;description&gt;DB Connection&lt;/description&gt; </div><div class="line">   &lt;res-ref-name&gt;jdbc/balloon&lt;/res-ref-name&gt; </div><div class="line">   &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt; </div><div class="line">   &lt;res-auth&gt;Container&lt;/res-auth&gt; </div><div class="line">&lt;/resource-ref&gt;</div></pre></td></tr></table></figure></p>
<p>注意：context.xml文件中的<code>name=&quot;jdbc/mysql&quot;</code>要和web.xml中的<code>&lt;res-ref-name&gt;jdbc/mysql&lt;/res-ref-name&gt;</code>要一致.</p>
<p>6.测试连接是否成功,新建测试的JSP文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page language=&quot;java&quot; pageEncoding=&quot;UTF-8&quot;%&gt;</div><div class="line">&lt;%@ page import=&quot;java.sql.*&quot;%&gt; </div><div class="line">&lt;%@ page import=&quot;javax.sql.*&quot;%&gt; </div><div class="line">&lt;%@ page import=&quot;javax.naming.*&quot;%&gt;</div><div class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;&gt;</div><div class="line">&lt;html&gt;</div><div class="line">   &lt;head&gt;</div><div class="line">        &lt;title&gt;mysql连接池测试&lt;/title&gt;</div><div class="line">        &lt;meta http-equiv=&quot;pragma&quot; content=&quot;no-cache&quot;&gt;</div><div class="line">        &lt;meta http-equiv=&quot;cache-control&quot; content=&quot;no-cache&quot;&gt;</div><div class="line">        &lt;meta http-equiv=&quot;expires&quot; content=&quot;0&quot;&gt; </div><div class="line">        &lt;meta http-equiv=&quot;keywords&quot; content=&quot;keyword1,keyword2,keyword3&quot;&gt;</div><div class="line">        &lt;meta http-equiv=&quot;description&quot; content=&quot;This is my page&quot;&gt;</div><div class="line">   &lt;/head&gt;</div><div class="line">  </div><div class="line">   &lt;body&gt; </div><div class="line">        &lt;%  </div><div class="line">        out.print(&quot;测试开始&lt;br&gt;&quot;); </div><div class="line">        DataSource ds = null; </div><div class="line">        Connection conn=null;</div><div class="line">               try&#123; </div><div class="line">        InitialContext ctx=new InitialContext(); </div><div class="line">        ds=(DataSource)ctx.lookup(&quot;java:comp/env/jdbc/balloon&quot;); </div><div class="line">        conn = ds.getConnection();  </div><div class="line">        </div><div class="line">            &#125;catch(Exception ex)&#123;</div><div class="line">             ex.printStackTrace();</div><div class="line">            &#125; </div><div class="line">        %&gt;  </div><div class="line">        &lt;%   </div><div class="line">            if(conn!=null)&#123; </div><div class="line">        %&gt; </div><div class="line">             &lt;%= conn %&gt;;  </div><div class="line">        &lt;% </div><div class="line">            &#125; </div><div class="line">        %&gt; </div><div class="line">   &lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<p>运行项目在tomcat上，输入jsp所在路径，显示jdbc相关的信息表示连接成功。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="http://www.cnblogs.com/cxtczzy/archive/2013/03/25/Tomcat.html" target="_blank" rel="external">Tomcat+mysql连接池配置</a></li>
<li><a href="http://blog.csdn.net/anialy/article/details/8226887" target="_blank" rel="external">eclipse Maven配置 </a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/05/04/web_develop_config/" data-id="cj4zxopql006yq4nhrlqpdkor" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/maven/">maven</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tomcat/">tomcat</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-web_springmvc1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/04/web_springmvc1/" class="article-date">
  <time datetime="2016-05-04T03:54:29.000Z" itemprop="datePublished">2016-05-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/springmvc/">springmvc</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/04/web_springmvc1/">Spring MVC入门(一)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>Spring Web MVC是一种基于Java的实现了Web MVC设计模式的请求驱动类型的轻量级Web框架，即使用了MVC架构模式的思想，将web层进行职责解耦，基于请求驱动指的就是使用请求-响应模型，框架的目的就是帮助我们简化开发，Spring Web MVC也是要简化我们日常Web开发的。</p>
<p>另外还有一种基于组件的、事件驱动的Web框架在此就不介绍了，如Tapestry、JSF等。</p>
<p>Spring Web MVC也是服务到工作者模式的实现，但进行可优化。</p>
<ul>
<li>前端控制器是DispatcherServlet；</li>
<li>应用控制器其实拆为处理器映射器(Handler Mapping)进行处理器管理和视图解析器(View Resolver)进行视图管理；</li>
<li>页面控制器/动作/处理器为Controller接口（仅包含ModelAndView handleRequest(request, response) 方法）的实现（也可以是任何的POJO类）；<br>支持本地化（Locale）解析、主题（Theme）解析及文件上传等；提供了非常灵活的数据验证、格式化和数据绑定机制；提供了强大的约定大于配置（惯例优先原则）的契约式编程支持。</li>
</ul>
<h2 id="二、Spring-Web-MVC特性"><a href="#二、Spring-Web-MVC特性" class="headerlink" title="二、Spring Web MVC特性"></a>二、Spring Web MVC特性</h2><ul>
<li>让我们能非常简单的设计出干净的Web层和薄薄的Web层；</li>
<li>进行更简洁的Web层的开发；</li>
<li>天生与Spring框架集成（如IoC容器、AOP等）；</li>
<li>提供强大的约定大于配置的契约式编程支持；</li>
<li>能简单的进行Web层的单元测试；</li>
<li>支持灵活的URL到页面控制器的映射；</li>
<li>非常容易与其他视图技术集成，如Velocity、FreeMarker等等，因为模型数据不放在特定的API里，而是放在一个Model里（Map数据结构实现，因此很容易被其他框架使用）；</li>
<li>非常灵活的数据验证、格式化和数据绑定机制，能使用任何对象进行数据绑定，不必实现特定框架的API；</li>
<li>提供一套强大的JSP标签库，简化JSP开发；</li>
<li>支持灵活的本地化、主题等解析；</li>
<li>更加简单的异常处理；</li>
<li>对静态资源的支持；</li>
<li>支持Restful风格。</li>
</ul>
<h2 id="三、Spring-Web-MVC架构"><a href="#三、Spring-Web-MVC架构" class="headerlink" title="三、Spring Web MVC架构"></a>三、Spring Web MVC架构</h2><p>Spring Web MVC框架也是一个基于请求驱动的Web框架，并且也使用了前端控制器模式来进行设计，再根据请求映射规则分发给相应的页面控制器（动作/处理器）进行处理。首先让我们整体看一下Spring Web MVC处理请求的流程：<br><strong> Spring Web MVC处理请求的流程</strong><br><img src="http://sishuok.com/forum/upload/2012/7/14/529024df9d2b0d1e62d8054a86d866c9__1.JPG" alt=""></p>
<p>具体执行步骤如下：</p>
<p>1、首先用户发送请求————&gt;前端控制器，前端控制器根据请求信息（如URL）来决定选择哪一个页面控制器进行处理并把请求委托给它，即以前的控制器的控制逻辑部分；图2-1中的1、2步骤；</p>
<p>2、页面控制器接收到请求后，进行功能处理，首先需要收集和绑定请求参数到一个对象，这个对象在Spring Web MVC中叫命令对象，并进行验证，然后将命令对象委托给业务对象进行处理；处理完毕后返回一个ModelAndView（模型数据和逻辑视图名）；图中的3、4、5步骤；</p>
<p>3、前端控制器收回控制权，然后根据返回的逻辑视图名，选择相应的视图进行渲染，并把模型数据传入以便视图渲染；图中的步骤6、7；</p>
<p>4、前端控制器再次收回控制权，将响应返回给用户，图中的步骤8；至此整个结束。</p>
<p>问题：</p>
<p>1、请求如何给前端控制器？</p>
<p>2、前端控制器如何根据请求信息选择页面控制器进行功能处理？</p>
<p>3、如何支持多种页面控制器呢？</p>
<p>4、如何页面控制器如何使用业务对象？</p>
<p>5、页面控制器如何返回模型数据？</p>
<p>6、前端控制器如何根据页面控制器返回的逻辑视图名选择具体的视图进行渲染？</p>
<p>7、不同的视图技术如何使用相应的模型数据？</p>
<p>首先我们知道有如上问题，那这些问题如何解决呢？请让我们先继续，在后边依次回答。</p>
<p><strong> Spring Web MVC架构</strong></p>
<p>1、Spring Web MVC核心架构图，如图<br><img src="http://sishuok.com/forum/upload/2012/7/14/57ea9e7edeebd5ee2ec0cf27313c5fb6__2.JPG" alt=""></p>
<p>架构图对应的DispatcherServlet核心代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div></pre></td><td class="code"><pre><div class="line">//前端控制器分派方法  </div><div class="line">protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception &#123;  </div><div class="line">        HttpServletRequest processedRequest = request;  </div><div class="line">        HandlerExecutionChain mappedHandler = null;  </div><div class="line">        int interceptorIndex = -1;  </div><div class="line">  </div><div class="line">        try &#123;  </div><div class="line">            ModelAndView mv;  </div><div class="line">            boolean errorView = false;  </div><div class="line">  </div><div class="line">            try &#123;  </div><div class="line">                   //检查是否是请求是否是multipart（如文件上传），如果是将通过MultipartResolver解析  </div><div class="line">                processedRequest = checkMultipart(request);  </div><div class="line">                   //步骤2、请求到处理器（页面控制器）的映射，通过HandlerMapping进行映射  </div><div class="line">                mappedHandler = getHandler(processedRequest, false);  </div><div class="line">                if (mappedHandler == null || mappedHandler.getHandler() == null) &#123;  </div><div class="line">                    noHandlerFound(processedRequest, response);  </div><div class="line">                    return;  </div><div class="line">                &#125;  </div><div class="line">                   //步骤3、处理器适配，即将我们的处理器包装成相应的适配器（从而支持多种类型的处理器）  </div><div class="line">                HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());  </div><div class="line">  </div><div class="line">                  // 304 Not Modified缓存支持  </div><div class="line">                //此处省略具体代码  </div><div class="line">  </div><div class="line">                // 执行处理器相关的拦截器的预处理（HandlerInterceptor.preHandle）  </div><div class="line">                //此处省略具体代码  </div><div class="line">  </div><div class="line">                // 步骤4、由适配器执行处理器（调用处理器相应功能处理方法）  </div><div class="line">                mv = ha.handle(processedRequest, response, mappedHandler.getHandler());  </div><div class="line">  </div><div class="line">                // Do we need view name translation?  </div><div class="line">                if (mv != null &amp;&amp; !mv.hasView()) &#123;  </div><div class="line">                    mv.setViewName(getDefaultViewName(request));  </div><div class="line">                &#125;  </div><div class="line">  </div><div class="line">                // 执行处理器相关的拦截器的后处理（HandlerInterceptor.postHandle）  </div><div class="line">                //此处省略具体代码  </div><div class="line">            &#125;  </div><div class="line">            catch (ModelAndViewDefiningException ex) &#123;  </div><div class="line">                logger.debug(&quot;ModelAndViewDefiningException encountered&quot;, ex);  </div><div class="line">                mv = ex.getModelAndView();  </div><div class="line">            &#125;  </div><div class="line">            catch (Exception ex) &#123;  </div><div class="line">                Object handler = (mappedHandler != null ? mappedHandler.getHandler() : null);  </div><div class="line">                mv = processHandlerException(processedRequest, response, handler, ex);  </div><div class="line">                errorView = (mv != null);  </div><div class="line">            &#125;  </div><div class="line">  </div><div class="line">            //步骤5 步骤6、解析视图并进行视图的渲染  </div><div class="line">            //步骤5 由ViewResolver解析View（viewResolver.resolveViewName(viewName, locale)）  </div><div class="line">            //步骤6 视图在渲染时会把Model传入（view.render(mv.getModelInternal(), request, response);）  </div><div class="line">            if (mv != null &amp;&amp; !mv.wasCleared()) &#123;  </div><div class="line">                render(mv, processedRequest, response);  </div><div class="line">                if (errorView) &#123;  </div><div class="line">                    WebUtils.clearErrorRequestAttributes(request);  </div><div class="line">                &#125;  </div><div class="line">            &#125;  </div><div class="line">            else &#123;  </div><div class="line">                if (logger.isDebugEnabled()) &#123;  </div><div class="line">                    logger.debug(&quot;Null ModelAndView returned to DispatcherServlet with name &apos;&quot; + getServletName() +  </div><div class="line">                            &quot;&apos;: assuming HandlerAdapter completed request handling&quot;);  </div><div class="line">                &#125;  </div><div class="line">            &#125;  </div><div class="line">  </div><div class="line">            // 执行处理器相关的拦截器的完成后处理（HandlerInterceptor.afterCompletion）  </div><div class="line">            //此处省略具体代码  </div><div class="line">  </div><div class="line">  </div><div class="line">        catch (Exception ex) &#123;  </div><div class="line">            // Trigger after-completion for thrown exception.  </div><div class="line">            triggerAfterCompletion(mappedHandler, interceptorIndex, processedRequest, response, ex);  </div><div class="line">            throw ex;  </div><div class="line">        &#125;  </div><div class="line">        catch (Error err) &#123;  </div><div class="line">            ServletException ex = new NestedServletException(&quot;Handler processing failed&quot;, err);  </div><div class="line">            // Trigger after-completion for thrown exception.  </div><div class="line">            triggerAfterCompletion(mappedHandler, interceptorIndex, processedRequest, response, ex);  </div><div class="line">            throw ex;  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">        finally &#123;  </div><div class="line">            // Clean up any resources used by a multipart request.  </div><div class="line">            if (processedRequest != request) &#123;  </div><div class="line">                cleanupMultipart(processedRequest);  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>核心架构的具体流程步骤如下：</p>
<p>1、首先用户发送请求——&gt;DispatcherServlet，前端控制器收到请求后自己不进行处理，而是委托给其他的解析器进行处理，作为统一访问点，进行全局的流程控制；</p>
<p>2、DispatcherServlet——&gt;HandlerMapping， HandlerMapping将会把请求映射为HandlerExecutionChain对象（包含一个Handler处理器（页面控制器）对象、多个HandlerInterceptor拦截器）对象，通过这种策略模式，很容易添加新的映射策略；</p>
<p>3、DispatcherServlet——&gt;HandlerAdapter，HandlerAdapter将会把处理器包装为适配器，从而支持多种类型的处理器，即适配器设计模式的应用，从而很容易支持很多类型的处理器；</p>
<p>4、HandlerAdapter——&gt;处理器功能处理方法的调用，HandlerAdapter将会根据适配的结果调用真正的处理器的功能处理方法，完成功能处理；并返回一个ModelAndView对象（包含模型数据、逻辑视图名）；</p>
<p>5、ModelAndView的逻辑视图名——&gt; ViewResolver， ViewResolver将把逻辑视图名解析为具体的View，通过这种策略模式，很容易更换其他视图技术；</p>
<p>6、View——&gt;渲染，View会根据传进来的Model模型数据进行渲染，此处的Model实际是一个Map数据结构，因此很容易支持其他视图技术；</p>
<p>7、返回控制权给DispatcherServlet，由DispatcherServlet返回响应给用户，到此一个流程结束。</p>
<p>此处我们只是讲了核心流程，没有考虑拦截器、本地解析、文件上传解析等，后边再细述。</p>
<p>到此，再来看我们前边提出的问题：</p>
<p>1、请求如何给前端控制器？这个应该在web.xml中进行部署描述，在HelloWorld中详细讲解。</p>
<p>2、前端控制器如何根据请求信息选择页面控制器进行功能处理？ 我们需要配置HandlerMapping进行映射</p>
<p>3、如何支持多种页面控制器呢？配置HandlerAdapter从而支持多种类型的页面控制器</p>
<p>4、如何页面控制器如何使用业务对象？可以预料到，肯定利用Spring IoC容器的依赖注入功能</p>
<p>5、页面控制器如何返回模型数据？使用ModelAndView返回</p>
<p>6、前端控制器如何根据页面控制器返回的逻辑视图名选择具体的视图进行渲染？ 使用ViewResolver进行解析</p>
<p>7、不同的视图技术如何使用相应的模型数据？ 因为Model是一个Map数据结构，很容易支持其他视图技术</p>
<p>在此我们可以看出具体的核心开发步骤：</p>
<ul>
<li>DispatcherServlet在web.xml中的部署描述，从而拦截请求到Spring Web MVC</li>
<li>HandlerMapping的配置，从而将请求映射到处理器</li>
<li>HandlerAdapter的配置，从而支持多种类型的处理器</li>
<li>ViewResolver的配置，从而将逻辑视图名解析为具体视图技术</li>
<li>处理器（页面控制器）的配置，从而进行功能处理</li>
</ul>
<p>上边的开发步骤我们会在Hello World中详细验证。</p>
<h2 id="四、Spring-Web-MVC优势"><a href="#四、Spring-Web-MVC优势" class="headerlink" title="四、Spring Web MVC优势"></a>四、Spring Web MVC优势</h2><p>1、清晰的角色划分：前端控制器（DispatcherServlet）、请求到处理器映射（HandlerMapping）、处理器适配器（HandlerAdapter）、视图解析器（ViewResolver）、处理器或页面控制器（Controller）、验证器（   Validator）、命令对象（Command  请求参数绑定到的对象就叫命令对象）、表单对象（Form Object 提供给表单展示和提交到的对象就叫表单对象）。</p>
<p>2、分工明确，而且扩展点相当灵活，可以很容易扩展，虽然几乎不需要；</p>
<p>3、由于命令对象就是一个POJO，无需继承框架特定API，可以使用命令对象直接作为业务对象；</p>
<p>4、和Spring 其他框架无缝集成，是其它Web框架所不具备的；</p>
<p>5、可适配，通过HandlerAdapter可以支持任意的类作为处理器；</p>
<p>6、可定制性，HandlerMapping、ViewResolver等能够非常简单的定制；</p>
<p>7、功能强大的数据验证、格式化、绑定机制；</p>
<p>8、利用Spring提供的Mock对象能够非常简单的进行Web层单元测试；</p>
<p>9、本地化、主题的解析的支持，使我们更容易进行国际化和主题的切换。</p>
<p>10、强大的JSP标签库，使JSP编写更容易。</p>
<p>还有比如RESTful风格的支持、简单的文件上传、约定大于配置的契约式编程支持、基于注解的零配置支持等等。</p>
<p>到此我们已经简单的了解了Spring Web MVC，接下来让我们来个实例来具体使用下这个框架。</p>
<h2 id="五、Hello-World入门"><a href="#五、Hello-World入门" class="headerlink" title="五、Hello World入门"></a>五、Hello World入门</h2><p><strong> 准备开发环境和运行环境</strong></p>
<ul>
<li>开发工具：eclipse</li>
<li>运行环境：tomcat6.0.20</li>
<li>工程：动态web工程（springmvc-chapter2）</li>
<li>spring框架下载：spring-framework-3.1.1.RELEASE-with-docs.zip</li>
<li>依赖jar包：</li>
</ul>
<p>1、Spring框架jar包：<br>为了简单，将spring-framework-3.1.1.RELEASE-with-docs.zip/dist/下的所有jar包拷贝到项目的WEB-INF/lib目录下；</p>
<p>2、Spring框架依赖的jar包：<br>需要添加Apache commons logging日志，此处使用的是commons.logging-1.1.1.jar；<br>需要添加jstl标签库支持，此处使用的是jstl-1.1.2.jar和standard-1.1.2.jar；</p>
<p><strong> 前端控制器的配置</strong><br>在我们的web.xml中添加如下配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;servlet&gt;  </div><div class="line">    &lt;servlet-name&gt;chapter2&lt;/servlet-name&gt;  </div><div class="line">    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;  </div><div class="line">    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;  </div><div class="line">&lt;/servlet&gt;  </div><div class="line">&lt;servlet-mapping&gt;  </div><div class="line">    &lt;servlet-name&gt;chapter2&lt;/servlet-name&gt;  </div><div class="line">    &lt;url-pattern&gt;/&lt;/url-pattern&gt;  </div><div class="line">&lt;/servlet-mapping&gt;</div></pre></td></tr></table></figure></p>
<ul>
<li>load-on-startup：表示启动容器时初始化该Servlet；</li>
<li>url-pattern：表示哪些请求交给Spring Web MVC处理， “/” 是用来定义默认servlet映射的。也可以如“*.html”表示拦截所有以html为扩展名的请求。</li>
</ul>
<p>自此请求已交给Spring Web MVC框架处理，因此我们需要配置Spring的配置文件，默认DispatcherServlet会加载WEB-INF/[DispatcherServlet的Servlet名字]-servlet.xml配置文件。本示例为WEB-INF/ chapter2-servlet.xml。</p>
<p><strong> 在Spring配置文件中配置HandlerMapping、HandlerAdapter</strong></p>
<p>具体配置在WEB-INF/ chapter2-servlet.xml文件中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;!-- HandlerMapping --&gt;  </div><div class="line">&lt;bean class=&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;/&gt;  </div><div class="line">   </div><div class="line">&lt;!-- HandlerAdapter --&gt;  </div><div class="line">&lt;bean class=&quot;org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter&quot;/&gt;</div></pre></td></tr></table></figure></p>
<ul>
<li>BeanNameUrlHandlerMapping：表示将请求的URL和Bean名字映射，如URL为 “上下文/hello”，则Spring配置文件必须有一个名字为“/hello”的Bean，上下文默认忽略。</li>
<li>SimpleControllerHandlerAdapter：表示所有实现了org.springframework.web.servlet.mvc.Controller接口的Bean可以作为Spring Web MVC中的处理器。如果需要其他类型的处理器可以通过实现HadlerAdapter来解决。</li>
</ul>
<p><strong> 在Spring配置文件中配置ViewResolver</strong></p>
<p>具体配置在WEB-INF/ chapter2-servlet.xml文件中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;!-- ViewResolver --&gt;  </div><div class="line">&lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;  </div><div class="line">    &lt;property name=&quot;viewClass&quot; value=&quot;org.springframework.web.servlet.view.JstlView&quot;/&gt;  </div><div class="line">    &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt;  </div><div class="line">    &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;  </div><div class="line">&lt;/bean&gt;</div></pre></td></tr></table></figure></p>
<ul>
<li>InternalResourceViewResolver：用于支持Servlet、JSP视图解析；</li>
<li>viewClass：JstlView表示JSP模板页面需要使用JSTL标签库，classpath中必须包含jstl的相关jar包；</li>
<li>prefix和suffix：查找视图页面的前缀和后缀（前缀[逻辑视图名]后缀），比如传进来的逻辑视图名为hello，则该该jsp视图页面应该存放在“WEB-INF/jsp/hello.jsp”；</li>
</ul>
<p><strong> 开发处理器/页面控制器</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">package cn.javass.chapter2.web.controller;  </div><div class="line">import javax.servlet.http.HttpServletRequest;  </div><div class="line">import javax.servlet.http.HttpServletResponse;  </div><div class="line">import org.springframework.web.servlet.ModelAndView;  </div><div class="line">import org.springframework.web.servlet.mvc.Controller;  </div><div class="line">public class HelloWorldController implements Controller &#123;  </div><div class="line">    @Override  </div><div class="line">    public ModelAndView handleRequest(HttpServletRequest req, HttpServletResponse resp) throws Exception &#123;  </div><div class="line">       //1、收集参数、验证参数  </div><div class="line">       //2、绑定参数到命令对象  </div><div class="line">       //3、将命令对象传入业务对象进行业务处理  </div><div class="line">       //4、选择下一个页面  </div><div class="line">       ModelAndView mv = new ModelAndView();  </div><div class="line">       //添加模型数据 可以是任意的POJO对象  </div><div class="line">       mv.addObject(&quot;message&quot;, &quot;Hello World!&quot;);  </div><div class="line">       //设置逻辑视图名，视图解析器会根据该名字解析到具体的视图页面  </div><div class="line">       mv.setViewName(&quot;hello&quot;);  </div><div class="line">       return mv;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>org.springframework.web.servlet.mvc.Controller：页面控制器/处理器必须实现Controller接口，注意别选错了；后边我们会学习其他的处理器实现方式；</p>
<p>public ModelAndView handleRequest(HttpServletRequest req, HttpServletResponse resp) ：功能处理方法，实现相应的功能处理，比如收集参数、验证参数、绑定参数到命令对象、将命令对象传入业务对象进行业务处理、最后返回ModelAndView对象；</p>
<p>ModelAndView：包含了视图要实现的模型数据和逻辑视图名；“mv.addObject(“message”, “Hello World!”);</p>
<p>”表示添加模型数据，此处可以是任意POJO对象；“mv.setViewName(“hello”);”表示设置逻辑视图名为“hello”，视图解析器会将其解析为具体的视图，如前边的视图解析器InternalResourceVi。wResolver会将其解析为“WEB-INF/jsp/hello.jsp”。</p>
<p>我们需要将其添加到Spring配置文件(WEB-INF/chapter2-servlet.xml)，让其接受Spring IoC容器管理:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 处理器 --&gt;  </div><div class="line">&lt;bean name=&quot;/hello&quot; class=&quot;cn.javass.chapter2.web.controller.HelloWorldController&quot;/&gt;</div></pre></td></tr></table></figure>
<p>name=”/hello”：前边配置的BeanNameUrlHandlerMapping，表示如过请求的URL为 “上下文/hello”，则将会交给该Bean进行处理。<br>2.5.6、开发视图页面</p>
<p>创建 /WEB-INF/jsp/hello.jsp视图页面：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;  </div><div class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;  </div><div class="line">&lt;html&gt;  </div><div class="line">&lt;head&gt;  </div><div class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;  </div><div class="line">&lt;title&gt;Hello World&lt;/title&gt;  </div><div class="line">&lt;/head&gt;  </div><div class="line">&lt;body&gt;  </div><div class="line">$&#123;message&#125;  </div><div class="line">&lt;/body&gt;  </div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p>${message}：表示显示由HelloWorldController处理器传过来的模型数据。</p>
<p><strong> 启动服务器运行测试</strong></p>
<p>通过请求：<code>http://localhost:9080/springmvc-chapter2/hello</code>，如果页面输出“Hello World! ”就表明我们成功了！</p>
<p><strong> 运行流程分析</strong><br><img src="http://sishuok.com/forum/upload/2012/7/14/8b42eeaa9b2423b154944c651ed23667__3.JPG" alt=""></p>
<p>运行步骤：</p>
<p>1、首先用户发送请求<code>http://localhost:9080/springmvc-chapter2/hello</code>——&gt;web容器，web容器根据“/hello”路径映射到DispatcherServlet（url-pattern为/）进行处理；</p>
<p>2、DispatcherServlet——&gt;BeanNameUrlHandlerMapping进行请求到处理的映射，BeanNameUrlHandlerMapping将“/hello”路径直接映射到名字为“/hello”的Bean进行处理，即HelloWorldController，BeanNameUrlHandlerMapping将其包装为HandlerExecutionChain（只包括HelloWorldController处理器，没有拦截器）；</p>
<p>3、DispatcherServlet——&gt; SimpleControllerHandlerAdapter，SimpleControllerHandlerAdapter将HandlerExecutionChain中的处理器（HelloWorldController）适配为SimpleControllerHandlerAdapter；</p>
<p>4、SimpleControllerHandlerAdapter——&gt; HelloWorldController处理器功能处理方法的调用，SimpleControllerHandlerAdapter将会调用处理器的handleRequest方法进行功能处理，该处理方法返回一个ModelAndView给DispatcherServlet；</p>
<p>5、hello（ModelAndView的逻辑视图名）——&gt;InternalResourceViewResolver， InternalResourceViewResolver使用JstlView，具体视图页面在/WEB-INF/jsp/hello.jsp；</p>
<p>6、JstlView（/WEB-INF/jsp/hello.jsp）——&gt;渲染，将在处理器传入的模型数据(message=HelloWorld！)在视图中展示出来；</p>
<p>7、返回控制权给DispatcherServlet，由DispatcherServlet返回响应给用户，到此一个流程结束。</p>
<p>到此HelloWorld就完成了，步骤是不是有点多？而且回忆下我们主要进行了如下配置：</p>
<p>1、前端控制器DispatcherServlet；</p>
<p>2、HandlerMapping</p>
<p>3、HandlerAdapter</p>
<p>4、ViewResolver</p>
<p>5、处理器/页面控制器</p>
<p>6、视图</p>
<p>因此，接下来几章让我们详细看看这些配置，先从DispatcherServlet开始吧。</p>
<h2 id="六、POST中文乱码解决方案"><a href="#六、POST中文乱码解决方案" class="headerlink" title="六、POST中文乱码解决方案"></a>六、POST中文乱码解决方案</h2><p>spring Web MVC框架提供了org.springframework.web.filter.CharacterEncodingFilter用于解决POST方式造成的中文乱码问题，具体配置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;filter&gt;  </div><div class="line">    &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;  </div><div class="line">    &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;  </div><div class="line">    &lt;init-param&gt;  </div><div class="line">        &lt;param-name&gt;encoding&lt;/param-name&gt;  </div><div class="line">        &lt;param-value&gt;utf-8&lt;/param-value&gt;  </div><div class="line">    &lt;/init-param&gt;  </div><div class="line">&lt;/filter&gt;  </div><div class="line">&lt;filter-mapping&gt;  </div><div class="line">    &lt;filter-name&gt;CharacterEncodingFilter&lt;/filter-name&gt;  </div><div class="line">    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;  </div><div class="line">&lt;/filter-mapping&gt;</div></pre></td></tr></table></figure></p>
<p>以后我们项目及所有页面的编码均为UTF-8。</p>
<h2 id="七、Spring3-1新特性"><a href="#七、Spring3-1新特性" class="headerlink" title="七、Spring3.1新特性"></a>七、Spring3.1新特性</h2><p>1.Spring2.5之前，我们都是通过实现Controller接口或其实现来定义我们的处理器类。</p>
<p>2.Spring2.5引入注解式处理器支持，通过@Controller 和 @RequestMapping注解定义我们的处理器类。并且提供了一组强大的注解：</p>
<p>需要通过处理器映射DefaultAnnotationHandlerMapping和处理器适配器AnnotationMethodHandlerAdapter来开启支持@Controller 和 @RequestMapping注解的处理器。</p>
<ul>
<li>@Controller：用于标识是处理器类；</li>
<li>@RequestMapping：请求到处理器功能方法的映射规则；</li>
<li>@RequestParam：请求参数到处理器功能处理方法的方法参数上的绑定；</li>
<li>@ModelAttribute：请求参数到命令对象的绑定；</li>
<li>@SessionAttributes：用于声明session级别存储的属性，放置在处理器类上，通常列出模型属性（如@ModelAttribute）对应的名称，则这些属性会透明的保存到session中；</li>
<li>@InitBinder：自定义数据绑定注册支持，用于将请求参数转换到命令对象属性的对应类型；</li>
</ul>
<p>3.Spring3.0引入RESTful架构风格支持(通过@PathVariable注解和一些其他特性支持),且又引入了更多的注解支持：</p>
<ul>
<li>@CookieValue：cookie数据到处理器功能处理方法的方法参数上的绑定；</li>
<li>@RequestHeader：请求头（header）数据到处理器功能处理方法的方法参数上的绑定；</li>
<li>@RequestBody：请求的body体的绑定（通过HttpMessageConverter进行类型转换）；</li>
<li>@ResponseBody：处理器功能处理方法的返回值作为响应体（通过HttpMessageConverter进行类型转换）；</li>
<li>@ResponseStatus：定义处理器功能处理方法/异常处理器返回的状态码和原因；</li>
<li>@ExceptionHandler：注解式声明异常处理器；</li>
<li>@PathVariable：请求URI中的模板变量部分到处理器功能处理方法的方法参数上的绑定，从而支持RESTful架构风格的URI；</li>
</ul>
<p>4.还有比如：</p>
<p>JSR-303验证框架的无缝支持（通过@Valid注解定义验证元数据）；</p>
<p>使用Spring 3开始的ConversionService进行类型转换（PropertyEditor依然有效），支持使用@NumberFormat 和 @DateTimeFormat来进行数字和日期的格式化；</p>
<p>HttpMessageConverter（Http输入/输出转换器，比如JSON、XML等的数据输出转换器）；</p>
<p>ContentNegotiatingViewResolver，内容协商视图解析器，它还是视图解析器，只是它支持根据请求信息将同一模型数据以不同的视图方式展示（如json、xml、html等），RESTful架构风格中很重要的概念（同一资源，多种表现形式）；</p>
<p>Spring 3 引入 一个  mvc XML的命名空间用于支持mvc配置，包括如：</p>
<ul>
<li><code>&lt;mvc:annotation-driven&gt;</code>：<br>自动注册基于注解风格的处理器需要的DefaultAnnotationHandlerMapping、AnnotationMethodHandlerAdapter<br>支持Spring3的ConversionService自动注册<br>支持JSR-303验证框架的自动探测并注册（只需把JSR-303实现放置到classpath）<br>自动注册相应的HttpMessageConverter（用于支持@RequestBody  和 @ResponseBody）（如XML输入输出转换器（只需将JAXP实现放置到classpath）、JSON输入输出转换器（只需将Jackson实现放置到classpath））等。</li>
<li><code>&lt;mvc:interceptors&gt;</code>：注册自定义的处理器拦截器；</li>
<li><code>&lt;mvc:view-controller&gt;</code>：和ParameterizableViewController类似，收到相应请求后直接选择相应的视图；</li>
<li><code>&lt;mvc:resources&gt;</code>：逻辑静态资源路径到物理静态资源路径的支持；</li>
<li><code>&lt;mvc:default-servlet-handler&gt;</code>：当在web.xml 中DispatcherServlet使用<url-pattern>/</url-pattern> 映射时，能映射静态资源（当Spring Web MVC框架没有处理请求对应的控制器时（如一些静态资源），转交给默认的Servlet来响应静态文件，否则报404找不到资源错误，）。</li>
</ul>
<p>5.Spring3.1新特性：</p>
<p>对Servlet 3.0的全面支持。</p>
<p>@EnableWebMvc：用于在基于Java类定义Bean配置中开启MVC支持，和XML中的<code>&lt;mvc:annotation-driven&gt;</code>功能一样；</p>
<p>新的@Contoller和@RequestMapping注解支持类：处理器映射RequestMappingHandlerMapping 和 处理器适配器RequestMappingHandlerAdapter组合来代替Spring2.5开始的处理器映射DefaultAnnotationHandlerMapping和处理器适配器AnnotationMethodHandlerAdapter，提供更多的扩展点，它们之间的区别我们在处理器映射一章介绍。</p>
<p>新的@ExceptionHandler 注解支持类：ExceptionHandlerExceptionResolver来代替Spring3.0的AnnotationMethodHandlerExceptionResolver，在异常处理器一章我们再详细讲解它们的区别。</p>
<p>@RequestMapping的”consumes” 和 “produces” 条件支持：用于支持@RequestBody 和 @ResponseBody，<br>1.consumes指定请求的内容是什么类型的内容，即本处理方法消费什么类型的数据，如consumes=”application/json”表示JSON类型的内容，Spring会根据相应的HttpMessageConverter进行请求内容区数据到@RequestBody注解的命令对象的转换；</p>
<p>2.produces指定生产什么类型的内容，如produces=”application/json”表示JSON类型的内容，Spring的根据相应的HttpMessageConverter进行请求内容区数据到@RequestBody注解的命令对象的转换，Spring会根据相应的HttpMessageConverter进行模型数据（返回值）到JSON响应内容的转换</p>
<p>URI模板变量增强：URI模板变量可以直接绑定到@ModelAttribute指定的命令对象、@PathVariable方法参数在视图渲染之前被合并到模型数据中（除JSON序列化、XML混搭场景下）。</p>
<p>@Validated：JSR-303的javax.validation.Valid一种变体（非JSR-303规范定义的，而是Spring自定义的），用于提供对Spring的验证器（org.springframework.validation.Validator）支持，需要Hibernate Validator 4.2及更高版本支持；</p>
<p>@RequestPart：提供对“multipart/form-data”请求的全面支持，支持Servlet 3.0文件上传（javax.servlet.http.Part）、支持内容的HttpMessageConverter（即根据请求头的Content-Type，来判断内容区数据是什么类型，如JSON、XML，能自动转换为命令对象），比@RequestParam更强大（只能对请求参数数据绑定，key-alue格式），而@RequestPart支持如JSON、XML内容区数据的绑定；详见本章的第×××节；</p>
<p>Flash 属性 和 RedirectAttribute：通过FlashMap存储一个请求的输出，当进入另一个请求时作为该请求的输入，典型场景如重定向（POST-REDIRECT-GET模式，1、POST时将下一次需要的数据放在FlashMap；2、重定向；3、通过GET访问重定向的地址，此时FlashMap会把1放到FlashMap的数据取出放到请求中，并从FlashMap中删除；从而支持在两次请求之间保存数据并防止了重复表单提交）。</p>
<p>Spring Web MVC提供FlashMapManager用于管理FlashMap，默认使用SessionFlashMapManager，即数据默认存储在session中。</p>
<p>转载自<a href="http://sishuok.com/forum/blogPost/list/5160.html" target="_blank" rel="external">Spring MVC入门</a></p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="http://sishuok.com/forum/blogPost/list/5160.html" target="_blank" rel="external">Spring MVC入门</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/05/04/web_springmvc1/" data-id="cj4zxopql0071q4nhc558m7f6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/springmvc/">springmvc</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_network_ssl" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/07/android_network_ssl/" class="article-date">
  <time datetime="2016-04-07T02:36:29.000Z" itemprop="datePublished">2016-04-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/protocol/">protocol</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/07/android_network_ssl/">为你的Android App实现自签名的SSL证书</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>网络安全已成为大家最关心的问题. 如果你利用服务器存储客户资料, 那你应该考虑使用 SSL 加密客户跟服务器之间的通讯. 随着这几年手机应用迅速崛起. 黑客也开始向手机应用转移, 原因有下列3点:</p>
<ul>
<li>手机系统各式各样, 缺乏统一的标准.</li>
<li>许多程序员缺乏手机应用开发经验.</li>
<li>更严重的是, 通过手机应用, 黑客可以得到手机用户的隐私数据, 如:日程安排, 联系人信息, 网页浏览历史记录, 个人资料, 社交数据, 短信或者手机用户所在的地理位置.</li>
</ul>
<p>最为一个网络安全爱好者的我, 最近花了几个月的时间对50到60个安卓应用进行安全分析, 结果发现这些应用存在许多安全漏洞.</p>
<p>下面我主要讲一讲, 怎样才能写出比较安全的安卓代码.</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>从最基本的开始讲.阅读本文前, 最好先看下 Ranjan.D article 写的一篇跟安卓连接有关的文章<a href="http://www.codeproject.com/Articles/818734/Article-Android-Connectivity" target="_blank" rel="external">Android Connectivity</a>.</p>
<p>下列代码用来打开一个 http 连接.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">URL urlConnection = new URL(&quot;http://www.codeproject.com/&quot;);</div><div class="line">HttpURLConnection urlConnection = (HttpURLConnection) url.openConnection();</div></pre></td></tr></table></figure></p>
<p>不要在 http连接中打开:登陆页面, 或是传递用户名, 密码, 银行卡之类的重要个人资料. 这些重要个人数据应该通过 HTTPS 传输. (具体参看HTTPS).</p>
<h2 id="HTTPS是什么"><a href="#HTTPS是什么" class="headerlink" title="HTTPS是什么"></a>HTTPS是什么</h2><p>HTTPS 其实就是个安全版的 http. HTTPS 能保证电子商务的交易安全. 如:网上银行.<br>像 IE 或者火狐浏览器, 如果出现下面的挂锁图标.<br><img src="http://static.open-open.com/lib/uploadImg/20141012/20141012075333_837.jpg" alt=""></p>
<p>同时, 在浏览器的地址栏中以 https:// 开头, 这表示, 你的浏览器跟这个网站的数据往来都是安全的.</p>
<p>https 跟 http 的最大区别在于 https 多加了一个保障通讯安全的层.<br><img src="http://static.open-open.com/lib/uploadImg/20141012/20141012075333_89.png" alt=""></p>
<p>像下列代码这样打开一个 https 连接, 可以保障这个连接的数据通讯安全.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">URL urlConnection = new URL(&quot;https://www.codeproject.com/&quot;);</div><div class="line">HttpsURLConnection urlConnection = (HttpsURLConnection) url.openConnection();</div><div class="line">InputStream in = new BufferedInputStream(urlConnection.getInputStream());</div></pre></td></tr></table></figure></p>
<p>HTTPS 通过 SSL/TLS 传递数据.</p>
<h2 id="SSL-TLS"><a href="#SSL-TLS" class="headerlink" title="SSL/TLS"></a>SSL/TLS</h2><p>SSL (Secure Sockets Layer) 是一种在客户端跟服务器端建立一个加密连接的安全标准. 一般用来加密网络服务器跟浏览器, 或者是邮件服务器跟邮件客户端(如: Outlook)之间传输的数据.</p>
<p>SSL 能保障敏感信息(如:银行卡号, 社保卡号, 登陆凭证等)的传输安全. 一般情况下, 数据在浏览器跟服务器之间的传输使用的是明文格式, 这种方式存在资料被窃取的风险. 如果黑客能拦截浏览器跟服务器之间的通讯数据, 就能看到通讯的内容. </p>
<h2 id="SSL-HTTPS-and-X-509-证书概述"><a href="#SSL-HTTPS-and-X-509-证书概述" class="headerlink" title="SSL/HTTPS and X.509 证书概述"></a>SSL/HTTPS and X.509 证书概述</h2><p>你要是对 SSL 或 X.509 证书一无所知, 那我大概解释下. 对于那些打算用自签名证书(self-signed certificate)的人来说, 需要了解自签名证书跟花钱购买机构颁发的证书有什么区别. </p>
<p>首先我们需要了解下 SSL 证书究竟是个什么东东? 其实它就包含俩部分:<br> 1) 一个身份标识, 一个用来识别身份的东西, 有点类似警察叔叔通过护照或驾照查你的身份;<br> 2) 一个公共密钥, 这个用来给数据加密, 而且只有证书的持有者才能解密.<br> 简而言之, SSL 证书就俩个功能, 身份验证跟保障通讯过程中的数据安全.</p>
<p>另外还有一点很重要. 那就是一个证书可以给另外一个证书“签字”. 用 layman 的话说就是 Bob 用他自己的证书在别的证书上盖上 “同意” 两个红红的大字. 如果你信任 Bob (当然还有他的证书), 那么你也可以信任由他签发的证书. 在这个例子中, Bob 摇身一变, 成了证书颁发机构(Certificate Authority). 现在主流的浏览器都自带一大堆受信任证书颁发机构(trusted Certificate Authorities)(比如:Thawte, Verisign等).</p>
<p>最后我们讲一讲浏览器是怎么使用证书的. 笼统的讲, 当你打开下列连接的时候 “<a href="https://www.yoursite.com”" target="_blank" rel="external">https://www.yoursite.com”</a> :</p>
<ul>
<li>服务器会给浏览器发一个证书.</li>
<li>浏览器会对比证书中的“common name”(有时也叫 “subject”) 跟服务器的域名是否一样. 例如, 一个从“www.yoursite.com” 网站发过来的证书就应该有一个内容是 “www.yoursite.com” 的 common name, 否则浏览器就会提示该证书有问题.</li>
<li>浏览器验证证书真伪, 有点像门卫通过证件上的全息图辨别你的证件是不是真的.  既然在现实生活中有人伪造别人的身份. 那么在网络世界也就有人造假, 比如用你的域名“www.yoursite.com” 来伪造一个安全证书.  浏览器在验证的时候, 会检查这个证书是否是它信任机构颁发的, 如果不是, 那么浏览器就会提示这个证书可能有问题. 当然, 用户可以选择无视警告, 继续使用.</li>
</ul>
<p>一旦证书通过验证 (或是用户无视警告, 继续使用有问题的证书), 浏览器就开始利用证书中的公开密钥加密数据并传给服务器.</p>
<p>TLS (SSL)中的加密</p>
<p>一旦服务器发过来的证书通过验证, 浏览器就会利用证书中包含的公共密钥加密某个指定的共享密钥, 然后发给服务器. 这个加密过的共享密钥只能用服务器的私有密钥才能解密(非对称加密), 别人无法解密出其中的内容. 服务器把解密出来的共享密钥保存起来, 供本次连接会话专用. 从现在开始, 服务器跟浏览器之间的所有通讯信息都用这个共享密钥加密解密(对称加密).<br><img src="http://static.open-open.com/lib/uploadImg/20141012/20141012075333_282.gif" alt=""></p>
<p>理论部分就这么多, 下面我们来看几个例子.</p>
<p>在浏览器中打开网站 mail.live.com , 地址栏中会出现一个绿色图标, http 也会变成 https.</p>
<p>单击这个绿色图标, 然后点证书信息连接, 就能看到下列内容.<br><img src="http://static.open-open.com/lib/uploadImg/20141012/20141012075333_825.png" alt=""></p>
<p>这是个 SSL 证书, 该证书是 Verisign 给 mail.live.cm 颁发的.</p>
<p>Verisign 是一个证书颁发机构, 它提示你的浏览器正在连接的网站是: mail.live.com, 需要跟这个网站的服务器建立一条安全连接进行通讯, 避免他人拦截或篡改浏览器跟服务器之间传递的数据.</p>
<h2 id="MITM攻击-中间人攻击"><a href="#MITM攻击-中间人攻击" class="headerlink" title="MITM攻击(中间人攻击)"></a>MITM攻击(中间人攻击)</h2><p>MITM 攻击(MITMA)是指: 黑客拦截篡改网络中的通讯数据</p>
<p>被动 MITMA 是指黑客只能窃取通讯数据, 而在主动 MITMA 中, 黑客除了窃取数据, 还能篡改通讯数据. 黑客利用 MITMA 方式攻击手机要比攻击台式电脑容易的多. 这主要是因为使用手机的环境在不固定, 有些地方用手机连接上网并不安全, 尤其是那些对公众免费开放的无线网络热点.</p>
<p>证书颁发机构（CA）</p>
<ul>
<li>Symantec (which bought VeriSign’s SSL interests and owns Thawte and Geotrust) 38.1% 市场份额</li>
<li>Comodo SSL 29.1%</li>
<li>Go Daddy 13.4%</li>
<li>GlobalSign 10%</li>
</ul>
<p>Jelly bean 版本的安卓系统中, 你可以在下列路径中找到证书颁发机构:<br>设置 -&gt; 安全 -&gt; 受信任的凭证.</p>
<p><strong> Https 连接</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">URL url = new URL(&quot;https://www.example.com/&quot;);   </div><div class="line">HttpsURLConnection urlConnection = (HttpsURLConnection)url.openConnection();   </div><div class="line">InputStream in = urlConnection.getInputStream();</div></pre></td></tr></table></figure></p>
<p>如果你连接的服务器(www.example.com)传过来的证书是由机构颁发的, 这段代码就能正常运行.</p>
<p>但是如果你连的服务器用的是自己颁发的证书(self-singed certificate), 那就会出现错误.</p>
<h2 id="自签名证书-self-signed-certicates"><a href="#自签名证书-self-signed-certicates" class="headerlink" title="自签名证书( self-signed certicates)"></a>自签名证书( self-signed certicates)</h2><p>自签名证书就是没有通过受信任的证书颁发机构, 自己给自己颁发的证书.</p>
<p>SSL 证书大致分三类:</p>
<ul>
<li>由安卓认可的证书颁发机构(如: VeriSign), 或这些机构的下属机构颁发的证书.</li>
<li>没有得到安卓认可的证书颁发机构颁发的证书.</li>
<li>自己颁发的证书, 分临时性的(在开发阶段使用)或在发布的产品中永久性使用的两种.</li>
</ul>
<p>只有第一种, 也就是那些被安卓系统认可的机构颁发的证书, 在使用过程中不会出现安全提示.<br>为什么有人喜欢用自签名证书 </p>
<ul>
<li>免费. 购买受信任机构颁发的证书每年要交 100 到 500 美元不等的费用. 自签名证书不花一分钱.</li>
<li>自签名证书在手机应用中的普及率较高 (跟用电脑浏览网页不同, 手机的应用一般就固定连一台服务器.).</li>
<li>在开发阶段写的代码,  测试跟发布的时候也可以用.</li>
</ul>
<p>最近一项调查表明, 810万个证书中, 只有 320万个是由受信任机构颁发的. 剩余490万证书中, 自签名的占48%, 未知机构颁发的占33%, 而不被信任的机构颁发的证书占19%.</p>
<p>无独有偶, 我的分析结果也表明, 起码有 60% 安卓应用使用自签证书.</p>
<p>个人以为, 在手机应用中使用自签名证书没什么不好, 既不需要花钱, 也不需要修改代码.(注:如果你用的是机构颁发的证书, 在产品发布阶段, 需要修改代码).</p>
<p>但是下面的戏法的一般性的https代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">URL url = new URL(&quot;https://www.example.com/&quot;);   </div><div class="line">HttpsURLConnection urlConnection = (HttpsURLConnection)url.openConnection();   </div><div class="line">InputStream in = urlConnection.getInputStream();</div></pre></td></tr></table></figure></p>
<p>如果你使用上述的代码去验证你的自己签署的证书，由于在android操作系统中自己签署的不能通过验证的，所以安卓应用软件将会抛出错误。因此你需要书写你自己的代码来检查你的自己签署的证书。</p>
<p>但是在这个领域中，安卓开发者犯了一个很大的错误，自己签署的证书在web开发中不是常见的，同时大多数安卓开发者来自于web开发者，所以开发者缺失在密码学的概念的知识。</p>
<p>在我分析中，我发现开发者仅仅是简单的复制、粘贴Stack Overflow和其他博客中允许你的应用默认信任所以证书的答案。即使大多说的答案表述仅仅在测试模式下可以使用，但是开发者简单地复制代码，将会导致应用软件在遭到中间件攻击和session黑客攻击时，表现的非常的脆弱！</p>
<p>例子：</p>
<ul>
<li><a href="http://stackoverflow.com/questions/2703161/how-to-ignore-ssl-certificate-errors-in-apache-httpclient-4-0" target="_blank" rel="external">How to ignore SSL certificate errors in Apache HttpClient 4.0</a></li>
<li><a href="http://stackoverflow.com/questions/2012497/accepting-a-certificate-for-https-on-android?lq=1" target="_blank" rel="external">Accepting a certificate for HTTPs on Android</a></li>
<li><a href="http://www.caphal.com/android/using-self-signed-certificates-in-android/#toc_3" target="_blank" rel="external">Using self signed certificates with Android</a></li>
<li><a href="http://stackoverflow.com/questions/2642777/trusting-all-certificates-using-httpclient-over-https" target="_blank" rel="external">Trusting all certificates using HttpClient over HTTPS</a></li>
</ul>
<p>在使用自己签署的证书时一般性的错误</p>
<p><strong> 信任所有的证书</strong></p>
<p>TrustManager的主要责任是去决定提出的认证证书应该是可信任的。如果证书是不可信任的，那么连接将会被终止。去认证远程的安全套接字识别，你需要用一个或者多个TrustManager（s）初始化SSLContext对象。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">import org.apache.http.conn.ssl.SSLSocketFactory;</div><div class="line">public class MySSLSocketFactory extends SSLSocketFactory &#123;</div><div class="line">    SSLContext sslContext = SSLContext.getInstance(&quot;TLS&quot;);</div><div class="line"></div><div class="line">    public MySSLSocketFactory(KeyStore truststore) throws NoSuchAlgorithmException, KeyManagementException, KeyStoreException, UnrecoverableKeyException &#123;</div><div class="line">        super(truststore);</div><div class="line"></div><div class="line">        TrustManager tm = new X509TrustManager() &#123;</div><div class="line">            public void checkClientTrusted(X509Certificate[] chain, String authType) throws CertificateException &#123;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            public void checkServerTrusted(X509Certificate[] chain, String authType) throws CertificateException &#123;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            public X509Certificate[] getAcceptedIssuers() &#123;</div><div class="line">                return null;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        sslContext.init(null, new TrustManager[] &#123; tm &#125;, null);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Socket createSocket(Socket socket, String host, int port, boolean autoClose) throws IOException, UnknownHostException &#123;</div><div class="line">        return sslContext.getSocketFactory().createSocket(socket, host, port, autoClose);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public Socket createSocket() throws IOException &#123;</div><div class="line">        return sslContext.getSocketFactory().createSocket();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我发现，80到100个应用软件中，在20到25个应用中实现了上述的代码。</p>
<p>在上述的TrustManager接口中，可以实现信任所有的证书，不论是谁签署的或者即使他们发布的任何主题。这个接口将会允许接受ANY证书。接受任何的证书将会危害数据的完整性、安全性等等。</p>
<p>在上述的例子中，检查客户端可信任性，获得接受事件，检查服务器端可信任性是三点重要的功能。每一位开发者都应该留意这三点功能的实现上。但是却很少有开发者从不同的网站中搜索、负责上述的功能。</p>
<p><strong> 允许所有的主机名</strong></p>
<p>忘记检查证书是否在这个地址发布是有可能的。当证书接受了example.com的服务器，那么另外的一个域名也将被接受。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">HostnameVerifier hostnameVerifier = org.apache.http.conn.ssl.SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER;</div><div class="line"></div><div class="line">DefaultHttpClient client = new DefaultHttpClient();</div><div class="line"></div><div class="line">SchemeRegistry registry = new SchemeRegistry();</div><div class="line">SSLSocketFactory socketFactory = SSLSocketFactory.getSocketFactory();</div><div class="line">socketFactory.setHostnameVerifier((X509HostnameVerifier) hostnameVerifier);</div><div class="line">registry.register(new Scheme(&quot;https&quot;, socketFactory, 443));</div><div class="line">SingleClientConnManager mgr = new SingleClientConnManager(client.getParams(), registry);</div><div class="line">DefaultHttpClient httpClient = new DefaultHttpClient(mgr, client.getParams());</div><div class="line"></div><div class="line">// Set verifier     </div><div class="line">HttpsURLConnection.setDefaultHostnameVerifier(hostnameVerifier);</div><div class="line"></div><div class="line">// Example send http request</div><div class="line">final String url = &quot;https://www.paypal.com&quot;;</div><div class="line">HttpPost httpPost = new HttpPost(url);</div><div class="line">HttpResponse response = httpClient.execute(httpPost);</div><div class="line"></div><div class="line">HttpsURLConnection.setDefaultHostnameVerifier(hostnameVerifier);</div><div class="line"></div><div class="line">HostnameVerifier hostnameVerifier = org.apache.http.conn.ssl.SSLSocketFactory.ALLOW_ALL_HOSTNAME_VERIFIER;</div></pre></td></tr></table></figure></p>
<p>上述的代码中，即使是错误的实现，也将会接受对任何域名的任何CA证书声明。</p>
<h2 id="Mixed-Mode-No-SSL"><a href="#Mixed-Mode-No-SSL" class="headerlink" title="Mixed-Mode/No SSL"></a>Mixed-Mode/No SSL</h2><p>应用软件开发者在相同的应用中使用最大安全、不安全的连接，或者不使用SSL将是免费的。这不是直接的SSL声明，但是和提到的没有向外的签署个有关，同时对于一般软件的使用者，检查是否使用一个安全的连接是不可能的。这将会为例如SSL剥离，或者像FireSheep这样的攻击开后门。</p>
<p>SSL剥离是另外的一种可以使MITMA登陆并抵制SSL连接方式。利用使用最大HTTP和HTTPS应用。SSL剥离依赖大量建立在点击链接、或者来自于没有SSL重定向保护的网站SSL连接。在SSL剥离中，Mallory用HTTPS://取代了没有保护的网站中http:// 链接中。因此，除非使用者注意到了链接被篡改了，Mallory可以完全地规避SSL保护。这样的攻击主要与浏览器应用、或者原生使用安卓WebView应用有关。</p>
<p>更多关于SSL剥离的信息：<br><a href="http://security.stackexchange.com/questions/41988/how-does-sslstrip-work" target="_blank" rel="external">http://security.stackexchange.com/questions/41988/how-does-sslstrip-work</a><br><a href="http://www.thoughtcrime.org/software/sslstrip/" target="_blank" rel="external">http://www.thoughtcrime.org/software/sslstrip/</a></p>
<h2 id="证书锁定"><a href="#证书锁定" class="headerlink" title="证书锁定"></a>证书锁定</h2><p>直接在代码中固定写死使用某个服务器的证书. 然后在应用中使用自己定义的信任存储(trust store)代替手机系统自带的那个, 去连接指定的服务器.</p>
<p>这样做的好处是, 我们既能使用自签名证书, 又不需要额外安装其他证书.<br><strong> 优势</strong></p>
<ul>
<li>安全性提升 - 采用这种方式, 应用不再依赖系统自带的信任存储(trust store). 使得破解这种应用变得复杂: 首先你要反编译, 修改完后, 还要重新编译.  关键是你不可能使用应用作者原先用的那个 keystore 文件重新颁发证书.</li>
<li>成本降低 - 证书锁定方式让我们可以在自己的服务器上使用免费的自签名证书,  调用自己写的 API. 虽说复杂了点, 可是像这种既不花钱, 还能提高应用安全的好事上哪找去?</li>
</ul>
<p><strong> 缺点</strong></p>
<ul>
<li>适应性较差 - 一旦 SSL 证书出现变动, 应用也要跟着升级. 再发布到 Google Play. 然后祈祷用户能都升级到最新版本.</li>
</ul>
<p>安卓的 SSLContext 自带的 TrustManager 无法让本文示例中提到的自签名证书通过验证. 解决的办法是自己定义一个 TrustManager 类. 然后用这个类去验证自签名证书. </p>
<p>先把证书加载到 KeyStore, 然后用 KeyStore 生成一个 TrustManager 数组, 最后再用这个 TrustManager 数组创建 SSLContext.</p>
<p>本文的应用把服务器的证书直接存进应用的资源.(毕竟这个文件是所有用户都共用的, 而且也不会经常改动), 当然你可以把它存到别的地方.</p>
<h2 id="实现的步骤"><a href="#实现的步骤" class="headerlink" title="实现的步骤"></a>实现的步骤</h2><p><strong> 第1步: 创建自签名证书和.bks 文件</strong></p>
<p>1) 创建 BKS 或者 keystore, 需要用到下面这个文件,<a href="https://www.bouncycastle.org/latest_releases.html" target="_blank" rel="external">bcprov-jdk15on-146.jar</a>.下载后, 把文件存到 C:\codeproject.</p>
<p>然后用 Keytool 生成 keystore 文件.(keytool 是 Java SDK 自带的文件, 跟javac 放在同一个目录下)在命令提示符窗口中输入 keytool 就能看到这个工具的各种选项说明. 或者输入下列路径运行.</p>
<p>“C:\Program Files (x86)\Java\jre7\bin&gt;keytool”.</p>
<p>2)下面是用 keytool 生成 keysotre 文件的命令.  要是这个文件已经存在, 这一步可以忽略.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">keytool -genkey -alias codeproject -keystore C:\codeproject\codeprojectssl.keystore -validity 365</div></pre></td></tr></table></figure></p>
<p>这行命令创建一个别名为 code project 的密钥(key), 生成的文件名是 codeprojectssl.keystore. 执行文件生成过程中会要求输入密钥(key)跟keystore的密码诸如此类的东东. 这里需要注意下, 当要求你录入 Common name 的时候, 要填你的主机名. 本文例子用的是: codeproject.com</p>
<p>3)将密钥(key)从 .keystore 文件导入 .cer 文件.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">keytool -export -alias codeproject -keystore C:\codeproject\codeprojectssl.keystore -file C:\codeproject\codeprojectsslcert.cer</div></pre></td></tr></table></figure></p>
<p>4) 生成 bks 文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">keytool -import -alias codeproject -file C:\codeproject\codeprojectsslcert.cer -keystore C:\codeproject\codeprojectssl.bks -storetype BKS -providerClass org.bouncycastle.jce.provider.BouncyCastleProvider -providerpath C:\codeproject\bcprov-jdk15on-146.jar</div></pre></td></tr></table></figure></p>
<p>搞定! 现在, 全部 .bks 文件都生成了. 稍后将这些文件复制到安卓应用中. 连接那些使用自签名证书的服务器的时候会用到.</p>
<p><strong> 第2步 把 .keystore 文件复制到 /androidappdir/res/raw/</strong></p>
<p><strong> 第3步 创建一个新类: MyHttpClient,  继承 DefaultHttpClient 类. </strong></p>
<p>这个新类在验证SSL 证书的时候, 会自动加载我们自己创建的 keystore 文件, 而不是安卓自带的那个. 只要证书跟服务器匹配上了就没问题. 代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">import java.io.InputStream;</div><div class="line">import java.security.KeyStore;</div><div class="line"></div><div class="line">import android.content.Context;</div><div class="line"></div><div class="line">public class MyHttpClient extends DefaultHttpClient &#123;</div><div class="line">  </div><div class="line"> private static Context context;</div><div class="line"> </div><div class="line"> public static void setContext(Context context) &#123;</div><div class="line">  MyHttpClient.context = context;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> public MyHttpClient(HttpParams params) &#123;</div><div class="line">  super(params);</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> public MyHttpClient(ClientConnectionManager httpConnectionManager, HttpParams params) &#123;</div><div class="line">  super(httpConnectionManager, params);</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> @Override</div><div class="line">    protected ClientConnectionManager createClientConnectionManager() &#123;</div><div class="line">        SchemeRegistry registry = new SchemeRegistry();</div><div class="line">        registry.register(new Scheme(&quot;http&quot;, PlainSocketFactory.getSocketFactory(), 80));</div><div class="line">        </div><div class="line">        // 用我们自己定义的 SSLSocketFactory 在 ConnectionManager 中注册一个 443 端口  </div><div class="line">        registry.register(new Scheme(&quot;https&quot;, newSslSocketFactory(), 443));</div><div class="line">        return new SingleClientConnManager(getParams(), registry);</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    private SSLSocketFactory newSslSocketFactory() &#123;</div><div class="line">        try &#123;</div><div class="line">            // Get an instance of the Bouncy Castle KeyStore format</div><div class="line">            KeyStore trusted = KeyStore.getInstance(&quot;BKS&quot;);</div><div class="line">            // 从资源文件中读取你自己创建的那个包含证书的 keystore 文件</div><div class="line">            </div><div class="line">            InputStream in = MyHttpClient.context.getResources().openRawResource(R.raw.codeprojectssl); //这个参数改成你的 keystore 文件名</div><div class="line">            try &#123;</div><div class="line">                // 用 keystore 的密码跟证书初始化 trusted                            </div><div class="line">                trusted.load(in, &quot;这里是你的 keystore 密码&quot;.toCharArray());</div><div class="line">            &#125; finally &#123;</div><div class="line">                in.close();</div><div class="line">            &#125;</div><div class="line">            // Pass the keystore to the SSLSocketFactory. The factory is responsible</div><div class="line">            // for the verification of the server certificate.</div><div class="line">            SSLSocketFactory sf = new SSLSocketFactory(trusted);</div><div class="line">            // Hostname verification from certificate</div><div class="line">            // http://hc.apache.org/httpcomponents-client-ga/tutorial/html/connmgmt.html#d4e506</div><div class="line">            sf.setHostnameVerifier(SSLSocketFactory.STRICT_HOSTNAME_VERIFIER); // 这个参数可以根据需要调整, 如果对主机名的验证不需要那么严谨, 可以将这个严谨程度调低些.</div><div class="line">            return sf;</div><div class="line">        &#125; catch (Exception e) &#123;</div><div class="line">            throw new AssertionError(e);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>MyHttpClient 类的调用代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// Instantiate the custom HttpClient</div><div class="line">DefaultHttpClient client = new MyHttpClient(getApplicationContext());</div><div class="line">HttpGet get = new HttpGet(&quot;https://www.google.com&quot;);</div><div class="line">// 以 GET 方式读取服务器返回的数据</div><div class="line">HttpResponse getResponse = client.execute(get);</div><div class="line">HttpEntity responseEntity = getResponse.getEntity();</div></pre></td></tr></table></figure></p>
<p>这是我在 CodeProject 上的发布的处女作.</p>
<p>祝大家开心编程, 安全第一.为你的Android App实现自签名的 SSL 证书 .</p>
<p><a href="http://www.oschina.net/translate/android-security-implementation-of-self-signed-ssl" target="_blank" rel="external">本文地址</a><br><a href="http://www.codeproject.com/Articles/826045/Android-security-Implementation-of-Self-signed-SSL" target="_blank" rel="external">原文地址</a></p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="http://www.blogjava.net/lihao336/archive/2011/08/18/356763.html" target="_blank" rel="external">PKI常见证书格式和转换</a></li>
<li><a href="http://www.open-open.com/lib/view/open1413071600531.html" target="_blank" rel="external">为你的Android App实现自签名的 SSL 证书</a></li>
<li><a href="http://www.thoughtcrime.org/blog/authenticity-is-broken-in-ssl-but-your-app-ha/" target="_blank" rel="external">Your app shouldn’t suffer SSL’s problems</a></li>
<li><a href="http://security.stackexchange.com/questions/29988/what-is-certificate-pinning" target="_blank" rel="external">What is certificate pinning</a></li>
<li><a href="http://security.stackexchange.com/questions/41988/how-does-sslstrip-work" target="_blank" rel="external">How does SSLstrip work</a></li>
<li><a href="https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning" target="_blank" rel="external">Certificate and Public Key Pinning</a></li>
<li><a href="https://tools.ietf.org/html/draft-ietf-websec-key-pinning-20" target="_blank" rel="external">Public Key Pinning Extension for HTTP draft-ietf-websec-key-pinning-20</a></li>
<li><a href="http://docs.oracle.com/javase/6/docs/technotes/guides/security/jsse/JSSERefGuide.html#HowSSLWorks" target="_blank" rel="external">How SSL Works</a></li>
<li><a href="https://groups.google.com/forum/#!topic/android-developers/HCiHwBKOsrI" target="_blank" rel="external">p12 file’s certificates to x509</a></li>
<li><a href="http://developer.android.com/intl/zh-cn/training/articles/security-ssl.html" target="_blank" rel="external">Security with HTTPS and SSL</a></li>
<li><a href="https://github.com/google/nogotofail" target="_blank" rel="external">TESTTOOL-google/nogotofail</a></li>
<li><a href="http://www.openssl.org/docs/manmaster/apps/openssl.html" target="_blank" rel="external">OpenSSL</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/07/android_network_ssl/" data-id="cj4zxopnt002oq4nh1uyq8l1v" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ssl/">ssl</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_notification_push" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/28/android_notification_push/" class="article-date">
  <time datetime="2016-03-28T02:54:29.000Z" itemprop="datePublished">2016-03-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/message-push/">message_push</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/28/android_notification_push/">Android实现推送方式解决方案</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文介绍在Android中实现推送方式的基础知识及相关解决方案。推送功能在手机开发中应用的场景是越来起来了，不说别的，就我们手机上的新闻客户端就时不时的推送过来新的消息，很方便的阅读最新的新闻信息。这种推送功能是好的一面，但是也会经常看到很多推送过来的垃圾信息，这就让我们感到厌烦了，关于这个我们就不能多说什么了，毕竟很多商家要做广告。本文就是来探讨下Android中实现推送功能的一些解决方案，也希望能够起到抛砖引玉的作用。</p>
<h2 id="推送方式基础知识"><a href="#推送方式基础知识" class="headerlink" title="推送方式基础知识"></a>推送方式基础知识</h2><p>在移动互联网时代以前的手机，如果有事情发生需要通知用户，则会有一个窗口弹出，将告诉用户正在发生什么事情。可能是未接电话的提示，日历的提醒，或是一封新的彩信。推送功能最早是被用于Email中，用来提示我们新的信息。由于时代的发展和移动互联网的热潮，推送功能更加地普及，已经不再仅仅用在推送邮件了，更多地用在我们的APP中了。</p>
<p>当我们开发需要和服务器交互的应用程序时，基本上都需要获取服务器端的数据，比如《地震应急通》就需要及时获取服务器上最新的地震信息。要获取服务器上不定时更新的信息，一般来说有两种方法：</p>
<ul>
<li>第一种是客户端使用Pull（拉）的方式，就是隔一段时间就去服务器上获取一下信息，看是否有更新的信息出现。</li>
<li>第二种就是服务器使用Push（推送）的方式，当服务器端有新信息了，则把最新的信息Push到客户端上。这样，客户端就能自动的接收到消息。 </li>
</ul>
<p>虽然Pull和Push两种方式都能实现获取服务器端更新信息的功能，但是明显来说Push方式比Pull方式更优越。因为Pull方式更费客户端的网络流量，更主要的是费电量，还需要我们的程序不停地去监测服务端的变化。  </p>
<p>在开发Android和iPhone应用程序时，我们往往需要从服务器不定的向手机客户端即时推送各种通知消息。我们只需要在Android或IPhone的通知栏处向下一拉，就展开了Notification Panel，可以集中一览各种各样通知消息。目前IOS平台上已经有了比较简单的和完美的推送通知解决方案，可是Android平台上实现起来却相对比较麻烦。</p>
<p>最近利用几天的时间对Android的推送通知服务进行初步的研究，也希望能和大家共同探讨一下。</p>
<h2 id="几种常见的解决方案实现原理"><a href="#几种常见的解决方案实现原理" class="headerlink" title="几种常见的解决方案实现原理"></a>几种常见的解决方案实现原理</h2><p><strong> 轮询(Pull)方式</strong><br>应用程序应当阶段性的与服务器进行连接并查询是否有新的消息到达，你必须自己实现与服务器之间的通信，例如消息排队等。而且你还要考虑轮询的频率，如果太慢可能导致某些消息的延迟，如果太快，则会大量消耗网络带宽和电池。</p>
<p><strong> SMS(Push)方式</strong><br>在Android平台上，你可以通过拦截SMS消息并且解析消息内容来了解服务器的意图，并获取其显示内容进行处理。这是一个不错的想法，我就见过采用这个方案的应用程序。这个方案的好处是，可以实现完全的实时操作。但是问题是这个方案的成本相对比较高，我们需要向移动公司缴纳相应的费用。我们目前很难找到免费的短消息发送网关来实现这种方案。</p>
<p><strong> 持久连接(Push)方式</strong><br>这个方案可以解决由轮询带来的性能问题，但是还是会消耗手机的电池。IOS平台的推送服务之所以工作的很好，是因为每一台手机仅仅保持一个与服务器之间的连接，事实上C2DM也是这么工作的。不过刚才也讲了，这个方案存在着很多的不足之处，就是我们很难在手机上实现一个可靠的服务，目前也无法与IOS平台的推送功能相比。</p>
<p>Android操作系统允许在低内存情况下杀死系统服务，所以我们的推送通知服务很有可能就被操作系统Kill掉了。 轮询(Pull)方式和SMS(Push)方式这两个方案也存在明显的不足。至于持久连接(Push)方案也有不足，不过我们可以通过良好的设计来弥补，以便于让该方案可以有效的工作。毕竟，我们要知道GMail，GTalk以及GoogleVoice都可以实现实时更新的。</p>
<p>　　</p>
<h2 id="第一种解决方案：C2DM云端推送-不推荐"><a href="#第一种解决方案：C2DM云端推送-不推荐" class="headerlink" title="第一种解决方案：C2DM云端推送 [不推荐]"></a>第一种解决方案：C2DM云端推送 [不推荐]</h2><p>在Android手机平台上，Google提供了C2DM（Cloud to Device Messaging）服务，起初我就是准备采用这个服务来实现自己手机上的推送功能，并将其带入自己的项目中。 </p>
<p>Android Cloud to Device Messaging (C2DM)是一个用来帮助开发者从服务器向Android应用程序发送数据的服务。该服务提供了一个简单的、轻量级的机制，允许服务器可以通知移动应用程序直接与服务器进行通信，以便于从服务器获取应用程序更新和用户数据。C2DM服务负责处理诸如消息排队等事务并向运行于目标设备上的应用程序分发这些消息。关于C2DM具体使用过程，大家可以去查阅相关的资料，在这里先让我们了解下大致方案情况。</p>
<p>下面是C2DM操作过程示例图:<br><img src="http://images.cnblogs.com/cnblogs_com/hanyonglu/image001.png" alt=""></p>
<p>但是经过一番研究发现，这个服务存在很大的问题：<br>1）C2DM内置于Android的2.2系统上，无法兼容老的1.6到2.1系统;</p>
<p>2）C2DM需要依赖于Google官方提供的C2DM服务器，由于国内的网络环境，这个服务经常不可用，如果想要很好的使用，我们的App Server必须也在国外，这个恐怕不是每个开发者都能够实现的。</p>
<p>3) 不像在iPhone中，他们把硬件系统集成在一块了。所以对于我们开发者来说，如果要在我们的应用程序中使用C2DM的推送功能，因为对于不同的这种硬件厂商平台，比如摩托罗拉、华为、中兴做一个手机，他们可能会把Google的这种服务去掉，尤其像在国内就很多这种，把Google这种原生的服务去掉。买了一些像什么山寨机或者是华为这种国产机，可能Google的服务就没有了。而像在国外出的那些可能会内置。</p>
<p>有了上述几个方面的制约，导致我最终放弃了这个方案，不过可以了解一下C2DM的框架以及客户端和App Server的相应设置方法，可以作为学习作为参考的资料。 即然C2DM无法满足我们的要求，那么我们就需要自己来实现Android手机客户端与App Server之间的通信协议，保证在App Server想向指定的Android设备发送消息时，Android设备能够及时的收到。</p>
<h2 id="第二种解决方案：MQTT协议实现Android推送"><a href="#第二种解决方案：MQTT协议实现Android推送" class="headerlink" title="第二种解决方案：MQTT协议实现Android推送"></a>第二种解决方案：MQTT协议实现Android推送</h2><p>采用MQTT协议实现Android推送功能也是一种解决方案。MQTT是一个轻量级的消息发布/订阅协议，它是实现基于手机客户端的消息推送服务器的理想解决方案。</p>
<p>wmqtt.jar 是IBM提供的MQTT协议的实现。我们可以从<a href="https://github.com/tokudu/AndroidPushNotificationsDemo" target="_blank" rel="external">这里</a>下载该项目的实例代码，并且可以找到一个采用PHP书写的服务器端实现（<a href="https://github.com/tokudu/PhpMQTTClient）。" target="_blank" rel="external">https://github.com/tokudu/PhpMQTTClient）。</a></p>
<p>架构如下图所示：<br><img src="http://images.cnblogs.com/cnblogs_com/hanyonglu/0_130881365599DT.gif" alt=""><br>　　<br>wmqtt.jar 是IBM提供的MQTT协议的实现。我们可以从如下站点<a href="http://www-01.ibm.com/support/docview.wss?rs=171&amp;uid=swg24006006" target="_blank" rel="external">下载</a>它。我们可以将该jar包加入自己的Android应用程序中。</p>
<blockquote>
<p>说明: MQTT（Message Queuing Telemetry Transport，消息队列遥测传输）是IBM开发的一个即时通讯协议，有可能成为物联网的重要组成部分。该协议支持所有平台，几乎可以把所有联网物品和外部连接起来，被用来当做传感器和致动器（比如通过Twitter让房屋联网）的通信协议。</p>
</blockquote>
<h2 id="第三种解决方案：RSMB实现推送"><a href="#第三种解决方案：RSMB实现推送" class="headerlink" title="第三种解决方案：RSMB实现推送"></a>第三种解决方案：RSMB实现推送</h2><p>Really Small Message Broker (RSMB) ，他是一个简单的MQTT代理，同样由IBM提供，其查看地址是：<a href="http://www.alphaworks.ibm.com/tech/rsmb" target="_blank" rel="external">RSMB</a>。缺省打开1883端口，应用程序当中，它负责接收来自服务器的消息并将其转发给指定的移动设备。</p>
<p>SAM是一个针对MQTT写的PHP库。我们可以从<a href="http://pecl.php.net/package/sam/download/0.2.0" target="_blank" rel="external">这里</a>下载。<br>send_mqtt.php是一个通过POST接收消息并且通过SAM将消息发送给RSMB的PHP脚本。 </p>
<h2 id="第四种解决方案：XMPP协议实现推送"><a href="#第四种解决方案：XMPP协议实现推送" class="headerlink" title="第四种解决方案：XMPP协议实现推送"></a>第四种解决方案：XMPP协议实现推送</h2><p>这是我希望在项目中采用的方案，因为目前它是开源的，对于其简单的推送功能它还是能够实现的。我们可以修改其源代码来适应我们的应用程序。</p>
<p>事实上Google官方的C2DM服务器底层也是采用XMPP协议进行的封装。XMPP(可扩展通讯和表示协议)是基于可扩展标记语言（XML）的协议，它用于即时消息（IM）以及在线探测。这个协议可能最终允许因特网用户向因特网上的其他任何人发送即时消息。关于XMPP协议可以参考博文<a href="http://www.cnblogs.com/hanyonglu/archive/2012/03/04/2378956.html" target="_blank" rel="external">XMPP协议实现原理介绍</a>。</p>
<p>androidpn是一个基于XMPP协议的java开源Android push notification实现。它包含了完整的客户端和服务器端。经过源代码研究我发现，该服务器端基本是在另外一个开源工程openfire基础上修改实现的，不过比较郁闷的是androidpn的文档是由韩语写的，所以整个研究过程基本都是读源码。</p>
<p>这是androidpn的<a href="http://sourceforge.net/projects/androidpn/" target="_blank" rel="external">项目主页</a></p>
<p>androidpn实现意图如下图所示：<br><img src="http://images.cnblogs.com/cnblogs_com/hanyonglu/0_1308813761AY0r.gif" alt=""><br>　　<br>androidpn 客户端需要用到一个基于java的开源XMPP协议包asmack，这个包同样也是基于openfire下的另外一个开源项目smack，不过我们不需要自己编译，可以直接把androidpn客户端里面的asmack.jar拿来使用。客户端利用asmack中提供的XMPPConnection类与服务器建立持久连接，并通过该连接进行用户注册和登录认证，同样也是通过这条连接，接收服务器发送的通知。</p>
<p>androidpn服务器端也是java语言实现的，基于openfire开源工程，不过它的Web部分采用的是spring框架，这一点与openfire是不同的。Androidpn服务器包含两个部分，一个是侦听在5222端口上的XMPP服务，负责与客户端的 XMPPConnection类进行通信，作用是用户注册和身份认证，并发送推送通知消息。另外一部分是Web服务器，采用一个轻量级的HTTP服务器， 负责接收用户的Web请求。服务器架构如下：<br><img src="http://images.cnblogs.com/cnblogs_com/hanyonglu/0_1308813820y7CD.gif" alt=""></p>
<p>最上层包含四个组成部分，分别是SessionManager，Auth Manager，PresenceManager以及Notification Manager。SessionManager负责管理客户端与服务器之间的会话，Auth Manager负责客户端用户认证管理，Presence Manager负责管理客户端用户的登录状态，NotificationManager负责实现服务器向客户端推送消息功能。</p>
<p>这个解决方案的最大优势就是简单，我们不需要象C2DM那样依赖操作系统版本，也不会担心某一天Google服务器不可用。利用XMPP协议我们还可以进一步的对协议进行扩展，实现更为完善的功能。 采用这个方案，我们目前只能发送文字消息，不过对于推送来说一般足够了，因为我们不能指望通过推送得到所有的数据，一般情况下，利用推送只是告诉手机端服务器发生了某些改变，当客户端收到通知以后，应该主动到服务器获取最新的数据，这样才是推送服务的完整实现。 XMPP协议书相对来说还是比较简单的，值得我们进一步研究。</p>
<p>但是在经过一段时间的测试，我发现关于androidpn也存在一些不足之处：</p>
<ul>
<li>时间过长时，就再也收不到推送的信息了。</li>
<li>性能上也不够稳定。</li>
<li>如果将消息从服务器上推送出去，就不再管理了，不管消息是否成功到达客户端手机上。</li>
</ul>
<p>等等，总之，androidpn也有很多的缺点。如果我们要使用androidpn，则还需要做大量的工作。</p>
<blockquote>
<p>说明: XMPP（Extensible Messageing and Presence Protocol：可扩展消息与表现协议）是目前主流的四种IM（IM：instant messaging,即时消息）协议之一，其他三种分别为：即时信息和空间协议(IMPP)、空间和即时信息协议(PRIM)、针对即时通讯和空间平衡扩充的进程开始协议SIP(SIMPLE)。 </p>
</blockquote>
<h2 id="第五种解决方案：使用第三方平台"><a href="#第五种解决方案：使用第三方平台" class="headerlink" title="第五种解决方案：使用第三方平台"></a>第五种解决方案：使用第三方平台</h2><p>第三方平台有商用的也有免费的，我们可以根据实现情况使用。关于国内的第三方平台，我感觉目前比较不错的就是极光推送。关于极光推送目前是免费的，我们可以直接使用。关于详细情况，大家可以查看它的主页：<a href="http://www.jpush.cn/index.jsp" target="_blank" rel="external">Jpush</a>。</p>
<p>关于MQTT的方案，国内最近出现基于 mqtt 的第三方解决方案 <a href="http://yunba.io" target="_blank" rel="external">云巴</a>，据了解是原极光推送 CTO 创办的，有兴趣的朋友可以研究下。</p>
<p>关于国外的第三方平台我也见过几个：<a href="http://www.push-notification.org/" target="_blank" rel="external">push-notification</a>。有兴趣的朋友可以查阅相关信息。使用第三方平台就需要使用别人的服务器，关于这点，你懂的。</p>
<h2 id="第六种解决方案：自己搭建推送平台"><a href="#第六种解决方案：自己搭建推送平台" class="headerlink" title="第六种解决方案：自己搭建推送平台"></a>第六种解决方案：自己搭建推送平台</h2><p>这不是一件轻松的工作，当然可以根据各自的需要采取合适的方案。</p>
<p>好了，以上是关于在Android中实现推送方式的基础知识及相关解决方案。</p>
<p><a href="http://www.cnblogs.com/hanyonglu/archive/2012/03/04/2378971.html" target="_blank" rel="external">原文地址</a></p>
<h2 id="相关参考"><a href="#相关参考" class="headerlink" title="相关参考"></a>相关参考</h2><ul>
<li><a href="http://www.alphaworks.ibm.com/tech/rsmb" target="_blank" rel="external">RSMB</a></li>
<li><a href="http://sourceforge.net/projects/androidpn/" target="_blank" rel="external">androidnp</a></li>
<li><a href="http://www.jpush.cn/index.jsp" target="_blank" rel="external">极光推送</a></li>
<li><a href="http://yunba.io/" target="_blank" rel="external">云巴官网</a></li>
<li><a href="http://www.cnblogs.com/hanyonglu/archive/2012/03/04/2378956.html" target="_blank" rel="external">XMPP协议实现原理介绍</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/28/android_notification_push/" data-id="cj4zxopnt002rq4nhickhowbg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/notification/">notification</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_frame_animation" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/17/android_frame_animation/" class="article-date">
  <time datetime="2016-03-17T04:26:29.000Z" itemprop="datePublished">2016-03-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/android/">android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/17/android_frame_animation/">Android逐帧动画FrameAnimation</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>开门见山，本篇博客讲解一下如何在Android平台下播放一个逐帧动画。逐帧动画在Android下可以通过代码和XML文件两种方式定义，本篇博客都将讲到，最后将以一个简单的Demo来演示两种方式定义的逐帧动画的播放。</p>
<h2 id="Android中的逐帧动画"><a href="#Android中的逐帧动画" class="headerlink" title="Android中的逐帧动画"></a>Android中的逐帧动画</h2><p>先来说说什么是逐帧动画，逐帧动画是一种常见的动画形式（Frame By Frame），其原理是在“连续的关键帧”中分解动画动作，也就是在时间轴的每帧上逐帧绘制不同的内容，使其连续播放而成动画。 因为逐帧动画的帧序列内容不一样，不但给制作增加了负担而且最终输出的文件量也很大，但它的优势也很明显：逐帧动画具有非常大的灵活性，几乎可以表现任何想表现的内容，而它类似与电影的播放模式，很适合于表演细腻的动画。</p>
<p>在Android中逐帧动画需要得到AnimationDrawable类的支持，它位于”android.graphics.drawable.AnimationDrawable”包下，是Drawable的间接子类。它主要用来创建一个逐帧动画，并且可以对帧进行拉伸，把它设置为View的背景即可使用AnimationDrawable.start()方法播放。既然逐帧动画是需要播放一帧一帧的图像，所以需要为其添加帧。在Android中提供了两种方式为AnimationDrawable添加帧：XML定义的资源文件和Java代码创建，后面再详细讲讲这两种添加帧的方式。</p>
<p>光为AnimationDrawable设置帧还不能完成播放动画的功能，还需要AnimationDrawable定义好的其他的一些方法来操作逐帧动画，下面简单介绍一下AnimationDrawable的常用方法：</p>
<ul>
<li>void start()：开始播放逐帧动画。</li>
<li>void stop()：停止播放逐帧动画。</li>
<li>void addFrame(Drawable frame,int duration)：为AnimationDrawable添加一帧，并设置持续时间。</li>
<li>int getDuration(int i)：得到指定index的帧的持续时间。</li>
<li>Drawable getFrame(int index)：得到指定index的帧Drawable。</li>
<li>int getNumberOfFrames()：得到当前AnimationDrawable的所有帧数量。</li>
<li>boolean isOneShot()：当前AnimationDrawable是否执行一次，返回true执行一次，false循环播放。</li>
<li>boolean isRunning()：当前AnimationDrawable是否正在播放。</li>
<li>void setOneShot(boolean oneShot)：设置AnimationDrawable是否执行一次，true执行一次，false循环播放</li>
</ul>
<h2 id="使用XML定义的资源文件设置动画帧"><a href="#使用XML定义的资源文件设置动画帧" class="headerlink" title="使用XML定义的资源文件设置动画帧"></a>使用XML定义的资源文件设置动画帧</h2><p>Android下所有的资源文件均要放在/res目录下，对于动画帧的资源需要当成一个Drawable，所以需要把它放在/res/Drawable目录下。而定义逐帧动画非常简单，只要在<animation-list...>元素中使用<item...>子元素定义动画的全部帧，并制定各帧的持续时间即可。还可以在<animation-list...>元素中添加属性，来设定逐帧动画的属性。<br>例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line"> &lt;animation-list xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:oneshot=&quot;false&quot;  &gt;</div><div class="line">     &lt;!-- 定义一个动画帧，Drawable为img0，持续时间50毫秒 --&gt;</div><div class="line">     &lt;item android:drawable=&quot;@drawable/img0&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">&lt;/animation-list&gt;</div></pre></td></tr></table></figure></animation-list...></item...></animation-list...></p>
<p>定义好逐帧动画的资源文件之后，只需要使用getResources().getDrawable(int)方法获取AnimationDrawable示例，然后把它设置为某个View的背景即可。<br>下面通过一个简单的Demo，来演示如何播放一个XML定义的逐帧动画，布局很简单，一个ImageView来承载逐帧动画，两个Button控制播放与停止：</p>
<p>XML帧动画的资源文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;animation-list xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; android:oneshot=&quot;false&quot;  &gt;</div><div class="line">    &lt;!-- 定义一个动画帧，Drawable为img0，持续时间50毫秒 --&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img0&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img1&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img2&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img3&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img4&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img5&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img6&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img7&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img8&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img9&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img10&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img11&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img12&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img13&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img14&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img15&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img16&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img17&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img18&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img19&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img20&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img21&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img22&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img23&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">    &lt;item android:drawable=&quot;@drawable/img24&quot; android:duration=&quot;50&quot; /&gt;</div><div class="line">&lt;/animation-list&gt;</div></pre></td></tr></table></figure></p>
<p>实现代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line">package cn.bgxt.frameanimationdemo;</div><div class="line"></div><div class="line">import android.app.Activity;</div><div class="line">import android.graphics.drawable.AnimationDrawable;</div><div class="line">import android.os.Bundle;</div><div class="line">import android.util.Log;</div><div class="line">import android.view.View;</div><div class="line">import android.view.View.OnClickListener;</div><div class="line">import android.widget.Button;</div><div class="line">import android.widget.ImageView;</div><div class="line">import android.widget.Toast;</div><div class="line"></div><div class="line">public class ToXMLActivity extends Activity &#123;</div><div class="line"></div><div class="line">    private Button btn_start, btn_stop;</div><div class="line">    private ImageView iv_frame;</div><div class="line">    private AnimationDrawable frameAnim;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_frameanim);</div><div class="line"></div><div class="line">        btn_start = (Button) findViewById(R.id.btn_start);</div><div class="line">        btn_stop = (Button) findViewById(R.id.btn_stop);</div><div class="line"></div><div class="line">        btn_start.setOnClickListener(click);</div><div class="line">        btn_stop.setOnClickListener(click);</div><div class="line"></div><div class="line">        iv_frame = (ImageView) findViewById(R.id.iv_frame);</div><div class="line">        </div><div class="line">        // 通过逐帧动画的资源文件获得AnimationDrawable示例</div><div class="line">        frameAnim=(AnimationDrawable) getResources().getDrawable(R.drawable.bullet_anim);</div><div class="line">        // 把AnimationDrawable设置为ImageView的背景</div><div class="line">        iv_frame.setBackgroundDrawable(frameAnim);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private View.OnClickListener click = new OnClickListener() &#123;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void onClick(View v) &#123;</div><div class="line">            switch (v.getId()) &#123;</div><div class="line">            case R.id.btn_start:</div><div class="line">                start();</div><div class="line">                break;</div><div class="line">            case R.id.btn_stop:</div><div class="line">                stop();</div><div class="line">                break;</div><div class="line">            default:</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 开始播放</div><div class="line">     */</div><div class="line">    protected void start() &#123;</div><div class="line">        if (frameAnim != null &amp;&amp; !frameAnim.isRunning()) &#123;</div><div class="line">            frameAnim.start();</div><div class="line">            Toast.makeText(ToXMLActivity.this, &quot;开始播放&quot;, 0).show();</div><div class="line">            Log.i(&quot;main&quot;, &quot;index 为5的帧持续时间为：&quot;+frameAnim.getDuration(5)+&quot;毫秒&quot;);</div><div class="line">            Log.i(&quot;main&quot;, &quot;当前AnimationDrawable一共有&quot;+frameAnim.getNumberOfFrames()+&quot;帧&quot;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 停止播放</div><div class="line">     */</div><div class="line">    protected void stop() &#123;</div><div class="line">        if (frameAnim != null &amp;&amp; frameAnim.isRunning()) &#123;</div><div class="line">            frameAnim.stop();</div><div class="line">            Toast.makeText(ToXMLActivity.this, &quot;停止播放&quot;, 0).show();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="使用Java代码创建逐帧动画"><a href="#使用Java代码创建逐帧动画" class="headerlink" title="使用Java代码创建逐帧动画"></a>使用Java代码创建逐帧动画</h2><p>在Android中，除了可以通过XML文件定义一个逐帧动画之外，还可以通过AnimationDrawable.addFrame()方法为AnimationDrawable添加动画帧，上面已经提供了addFrame()的方法签名，它可以设置添加动画帧的Drawable和持续时间。其实没什么技术含量，下面通过一个简单的Demo演示一下。</p>
<p>实现代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div></pre></td><td class="code"><pre><div class="line">package cn.bgxt.frameanimationdemo;</div><div class="line"></div><div class="line">import android.app.Activity;</div><div class="line">import android.graphics.BitmapFactory;</div><div class="line">import android.graphics.Canvas;</div><div class="line">import android.graphics.ColorFilter;</div><div class="line">import android.graphics.drawable.AnimationDrawable;</div><div class="line">import android.graphics.drawable.BitmapDrawable;</div><div class="line">import android.graphics.drawable.Drawable;</div><div class="line">import android.os.Bundle;</div><div class="line">import android.view.View;</div><div class="line">import android.view.View.OnClickListener;</div><div class="line">import android.widget.Button;</div><div class="line">import android.widget.ImageView;</div><div class="line">import android.widget.Toast;</div><div class="line"></div><div class="line">public class ToCodeActivity extends Activity &#123;</div><div class="line">    private Button btn_start, btn_stop;</div><div class="line">    private ImageView iv_frame;</div><div class="line">    private AnimationDrawable frameAnim;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_frameanim);</div><div class="line"></div><div class="line">        btn_start = (Button) findViewById(R.id.btn_start);</div><div class="line">        btn_stop = (Button) findViewById(R.id.btn_stop);</div><div class="line"></div><div class="line">        btn_start.setOnClickListener(click);</div><div class="line">        btn_stop.setOnClickListener(click);</div><div class="line"></div><div class="line">        iv_frame = (ImageView) findViewById(R.id.iv_frame);</div><div class="line"></div><div class="line">        frameAnim =new AnimationDrawable();</div><div class="line">        // 为AnimationDrawable添加动画帧</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img0), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img1), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img2), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img3), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img4), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img5), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img6), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img7), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img8), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img9), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img10), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img11), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img12), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img13), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img14), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img15), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img16), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img17), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img18), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img19), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img20), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img21), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img22), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img23), 50);</div><div class="line">        frameAnim.addFrame(getResources().getDrawable(R.drawable.img24), 50);</div><div class="line">        frameAnim.setOneShot(false);</div><div class="line">        </div><div class="line">        // 设置ImageView的背景为AnimationDrawable</div><div class="line">        iv_frame.setBackgroundDrawable(frameAnim);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private View.OnClickListener click = new OnClickListener() &#123;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void onClick(View v) &#123;</div><div class="line">            switch (v.getId()) &#123;</div><div class="line">            case R.id.btn_start:</div><div class="line">                start();</div><div class="line">                break;</div><div class="line">            case R.id.btn_stop:</div><div class="line">                stop();</div><div class="line">                break;</div><div class="line">            default:</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 开始播放</div><div class="line">     */</div><div class="line">    protected void start() &#123;</div><div class="line">        if (frameAnim != null &amp;&amp; !frameAnim.isRunning()) &#123;</div><div class="line">            frameAnim.start();</div><div class="line">            Toast.makeText(ToCodeActivity.this, &quot;开始播放&quot;, 0).show();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    /**</div><div class="line">     * 停止播放</div><div class="line">     */</div><div class="line">    protected void stop() &#123;</div><div class="line">        if (frameAnim != null &amp;&amp; frameAnim.isRunning()) &#123;</div><div class="line">            frameAnim.stop();</div><div class="line">            Toast.makeText(ToCodeActivity.this, &quot;停止播放&quot;, 0).show();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其实上面两个Demo实现的都是一种效果，是一个子弹击中墙体的逐帧动画效果，下面展示一下Demo的运行效果：<br><img src="http://images.cnitblog.com/blog/234895/201311/28234041-ab9936d3f4064da5b249df9967597bf5.x-png" alt=""></p>
<h2 id="原文出自"><a href="#原文出自" class="headerlink" title="原文出自"></a>原文出自</h2><ul>
<li><a href="http://www.cnblogs.com/plokmju/p/android_AnimationDrawable.html" target="_blank" rel="external">承香墨影</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/17/android_frame_animation/" data-id="cj4zxopmy001rq4nhk4mer3j7" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/animation/">animation</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_volley" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/08/android_volley/" class="article-date">
  <time datetime="2016-03-08T01:45:29.000Z" itemprop="datePublished">2016-03-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/framework/">framework</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/08/android_volley/">Volley详解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Volley 是 Google 推出的 Android 异步网络请求框架和图片加载框架。在 Google I/O 2013 大会上发布。特别适合数据量小，通信频繁的网络操作。（个人认为 Android 应用中绝大多数的网络操作都属于这种类型）。</p>
<h2 id="Volley-的主要特点"><a href="#Volley-的主要特点" class="headerlink" title="Volley 的主要特点"></a>Volley 的主要特点</h2><ul>
<li>扩展性强。Volley 中大多是基于接口的设计，可配置性强。</li>
<li>一定程度符合 Http 规范，包括返回 ResponseCode(2xx、3xx、4xx、5xx）的处理，请求头的处理，缓存机制的支持等。并支持重试及优先级定义。</li>
<li>默认 Android2.3 及以上基于 HttpURLConnection，2.3 以下基于 HttpClient 实现。</li>
<li>提供简便的图片加载工具。 </li>
</ul>
<h2 id="总体设计"><a href="#总体设计" class="headerlink" title="总体设计"></a>总体设计</h2><p>1.总体设计图<br><img src="https://raw.githubusercontent.com/android-cn/android-open-project-analysis/master/tool-lib/network/volley/image/design.png" alt=""><br>上面是 Volley 的总体设计图，主要是通过两种Dispatch Thread不断从RequestQueue中取出请求，根据是否已缓存调用Cache或Network这两类数据获取接口之一，从内存缓存或是服务器取得请求的数据，然后交由ResponseDelivery去做结果分发及回调处理。</p>
<p>2.Volley 中的概念<br>Volley 的调用比较简单，通过 newRequestQueue(…) 函数新建并启动一个请求队列RequestQueue后，只需要往这个RequestQueue不断 add Request 即可。</p>
<ul>
<li>Volley：Volley 对外暴露的 API，通过 newRequestQueue(…) 函数新建并启动一个请求队列RequestQueue。</li>
<li>Request：表示一个请求的抽象类。StringRequest、JsonRequest、ImageRequest 都是它的子类，表示某种类型的请求。</li>
<li>RequestQueue：表示请求队列，里面包含一个CacheDispatcher(用于处理走缓存请求的调度线程)、NetworkDispatcher数组(用于处理走网络请求的调度线程)，一个ResponseDelivery(返回结果分发接口)，通过 start() 函数启动时会启动CacheDispatcher和NetworkDispatchers。</li>
<li>CacheDispatcher：一个线程，用于调度处理走缓存的请求。启动后会不断从缓存请求队列中取请求处理，队列为空则等待，请求处理结束则将结果传递给ResponseDelivery去执行后续处理。当结果未缓存过、缓存失效或缓存需要刷新的情况下，该请求都需要重新进入NetworkDispatcher去调度处理。</li>
<li>NetworkDispatcher：一个线程，用于调度处理走网络的请求。启动后会不断从网络请求队列中取请求处理，队列为空则等待，请求处理结束则将结果传递给ResponseDelivery去执行后续处理，并判断结果是否要进行缓存。</li>
<li>ResponseDelivery：返回结果分发接口，目前只有基于ExecutorDelivery的在入参 handler 对应线程内进行分发。</li>
<li>HttpStack：处理 Http 请求，返回请求结果。目前 Volley 中有基于 HttpURLConnection 的HurlStack和 基于 Apache HttpClient 的HttpClientStack。</li>
<li>Network：调用HttpStack处理请求，并将结果转换为可被ResponseDelivery处理的NetworkResponse。</li>
<li>Cache：缓存请求结果，Volley 默认使用的是基于 sdcard 的DiskBasedCache。NetworkDispatcher得到请求结果后判断是否需要存储在 Cache，CacheDispatcher会从 Cache 中取缓存结果。 </li>
</ul>
<p>3.Volley 请求流程图<br><img src="https://raw.githubusercontent.com/android-cn/android-open-project-analysis/master/tool-lib/network/volley/image/Volley-run-flow-chart.png" alt=""></p>
<h2 id="详细设计"><a href="#详细设计" class="headerlink" title="详细设计"></a>详细设计</h2><p>1.类关系图<br><img src="https://raw.githubusercontent.com/android-cn/android-open-project-analysis/master/tool-lib/network/volley/image/volley-class.png" alt=""><br>这是 Volley 框架的主要类关系图<br>图中红色圈内的部分，组成了 Volley 框架的核心，围绕 RequestQueue 类，将各个功能点以组合的方式结合在了一起。各个功能点也都是以接口或者抽象类的形式提供。<br>红色圈外面的部分，在 Volley 源码中放在了 toolbox 包中，作为 Volley 为各个功能点提供的默认的具体实现。<br>通过类图我们看出， Volley 有着非常好的拓展性。通过各个功能点的接口，我们可以给出自定义的，更符合我们需求的具体实现。</p>
<p>多用组合，少用继承；针对接口编程，不针对具体实现编程。<br>优秀框架的设计，令人叫绝，受益良多。</p>
<p>2.核心类功能介绍<br><strong> Volley.java</strong></p>
<p>这个和 Volley 框架同名的类，其实是个工具类，作用是构建一个可用于添加网络请求的RequestQueue对象。<br>(1). 主要函数<br>Volley.java 有两个重载的静态方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">public static RequestQueue newRequestQueue(Context context)</div><div class="line">public static RequestQueue newRequestQueue(Context context, HttpStack stack)</div></pre></td></tr></table></figure></p>
<p>第一个方法的实现调用了第二个方法，传 HttpStack 参数为 null。<br>第二个方法中，如果 HttpStatck 参数为 null，则如果系统在 Gingerbread 及之后(即 API Level &gt;= 9)，采用基于 HttpURLConnection 的 HurlStack，如果小于 9，采用基于 HttpClient 的 HttpClientStack。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">if (stack == null) &#123;</div><div class="line">    if (Build.VERSION.SDK_INT &gt;= 9) &#123;</div><div class="line">        stack = new HurlStack();</div><div class="line">    &#125; else &#123;</div><div class="line">        stack = new HttpClientStack(AndroidHttpClient.newInstance(userAgent));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>得到了 HttpStack,然后通过它构造一个代表网络（Network）的具体实现BasicNetwork。<br>接着构造一个代表缓存（Cache）的基于 Disk 的具体实现DiskBasedCache。<br>最后将网络（Network）对象和缓存（Cache）对象传入构建一个 RequestQueue，启动这个 RequestQueue，并返回。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Network network = new BasicNetwork(stack);</div><div class="line">RequestQueue queue = new RequestQueue(new DiskBasedCache(cacheDir), network);</div><div class="line">queue.start();</div><div class="line">return queue;</div></pre></td></tr></table></figure></p>
<p>我们平时大多采用Volly.newRequestQueue(context)的默认实现，构建 RequestQueue。<br>通过源码可以看出，我们可以抛开 Volley 工具类构建自定义的 RequestQueue，采用自定义的HttpStatck，采用自定义的Network实现，采用自定义的 Cache 实现等来构建RequestQueue。<br>优秀框架的高可拓展性的魅力来源于此。</p>
<p>HttpURLConnection 和 AndroidHttpClient(HttpClient 的封装)如何选择及原因：<br>在 Froyo(2.2) 之前，HttpURLConnection 有个重大 Bug，调用 close() 函数会影响连接池，导致连接复用失效，所以在 Froyo 之前使用 HttpURLConnection 需要关闭 keepAlive。<br>另外在 Gingerbread(2.3) HttpURLConnection 默认开启了 gzip 压缩，提高了 HTTPS 的性能，Ice Cream Sandwich(4.0) HttpURLConnection 支持了请求结果缓存。<br>再加上 HttpURLConnection 本身 API 相对简单，所以对 Android 来说，在 2.3 之后建议使用 HttpURLConnection，之前建议使用 AndroidHttpClient。 </p>
<p><strong> User Agent</strong><br>通过代码我们发现如果是使用 AndroidHttpClient，Volley 还会将请求头中的 User-Agent 字段设置为 App 的<code>${packageName}/${versionCode}</code>，如果异常则使用 “volley/0”，不过这个获取 User-Agent 的操作应该放到 if else 内部更合适。而对于 HttpURLConnection 却没有任何操作，为什么呢？<br>如果用 Fiddler 或 Charles 对数据抓包我们会发现，我们会发现 HttpURLConnection 默认是有 User-Agent 的，类似：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Dalvik/1.6.0 (Linux; U; Android 4.1.1; Google Nexus 4 - 4.1.1 - API 16 - 768x1280_1 Build/JRO03S)</div></pre></td></tr></table></figure></p>
<p>经常用 WebView 的同学会也许会发现似曾相识，是的，WebView 默认的 User-Agent 也是这个。实际在请求发出之前，会检测 User-Agent 是否为空，如果不为空，则加上系统默认 User-Agent。在 Android 2.1 之后，我们可以通过<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String userAgent = System.getProperty(&quot;http.agent&quot;);</div></pre></td></tr></table></figure></p>
<p>得到系统默认的 User-Agent，Volley 如果希望自定义 User-Agent，可在自定义 Request 中重写 getHeaders() 函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public Map&lt;String, String&gt; getHeaders() throws AuthFailureError &#123;</div><div class="line">    // self-defined user agent</div><div class="line">    Map&lt;String, String&gt; headerMap = new HashMap&lt;String, String&gt;();</div><div class="line">    headerMap.put(&quot;User-Agent&quot;, &quot;android-open-project-analysis/1.0&quot;);</div><div class="line">    return headerMap;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong> Request.java</strong></p>
<p>代表一个网络请求的抽象类。我们通过构建一个Request类的非抽象子类(StringRequest、JsonRequest、ImageRequest 或自定义)对象，并将其加入到·RequestQueue·中来完成一次网络请求操作。<br>Volley 支持 8 种 Http 请求方式 GET, POST, PUT, DELETE, HEAD, OPTIONS, TRACE, PATCH<br>Request 类中包含了请求 url，请求请求方式，请求 Header，请求 Body，请求的优先级等信息。</p>
<p>因为是抽象类，子类必须重写的两个方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">abstract protected Response&lt;T&gt; parseNetworkResponse(NetworkResponse response);</div></pre></td></tr></table></figure></p>
<p>子类重写此方法，将网络返回的原生字节内容，转换成合适的类型。此方法会在工作线程中被调用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">abstract protected void deliverResponse(T response);</div></pre></td></tr></table></figure></p>
<p>子类重写此方法，将解析成合适类型的内容传递给它们的监听回调。</p>
<p>以下两个方法也经常会被重写<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public byte[] getBody()</div></pre></td></tr></table></figure></p>
<p>重写此方法，可以构建用于 POST、PUT、PATCH 请求方式的 Body 内容。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">protected Map&lt;String, String&gt; getParams()</div></pre></td></tr></table></figure></p>
<p>在上面getBody函数没有被重写情况下，此方法的返回值会被 key、value 分别编码后拼装起来转换为字节码作为 Body 内容。 </p>
<p><strong> RequestQueue.java</strong></p>
<p>Volley 框架的核心类，将请求 Request 加入到一个运行的RequestQueue中，来完成请求操作。<br>(1). 主要成员变量</p>
<p>RequestQueue 中维护了两个基于优先级的 Request 队列，缓存请求队列和网络请求队列。<br>放在缓存请求队列中的 Request，将通过缓存获取数据；放在网络请求队列中的 Request，将通过网络获取数据。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">private final PriorityBlockingQueue&lt;Request&lt;?&gt;&gt; mCacheQueue = new PriorityBlockingQueue&lt;Request&lt;?&gt;&gt;();</div><div class="line">private final PriorityBlockingQueue&lt;Request&lt;?&gt;&gt; mNetworkQueue = new PriorityBlockingQueue&lt;Request&lt;?&gt;&gt;();</div></pre></td></tr></table></figure></p>
<p>维护了一个正在进行中，尚未完成的请求集合。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">private final Set&lt;Request&lt;?&gt;&gt; mCurrentRequests = new HashSet&lt;Request&lt;?&gt;&gt;();</div></pre></td></tr></table></figure></p>
<p>维护了一个等待请求的集合，如果一个请求正在被处理并且可以被缓存，后续的相同 url 的请求，将进入此等待队列。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">private final Map&lt;String, Queue&lt;Request&lt;?&gt;&gt;&gt; mWaitingRequests = new HashMap&lt;String, Queue&lt;Request&lt;?&gt;&gt;&gt;();</div></pre></td></tr></table></figure></p>
<p>(2). 启动队列</p>
<p>创建出 RequestQueue 以后，调用 start 方法，启动队列。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Starts the dispatchers in this queue.</div><div class="line"> */</div><div class="line">public void start() &#123;</div><div class="line">    stop();  // Make sure any currently running dispatchers are stopped.</div><div class="line">    // Create the cache dispatcher and start it.</div><div class="line">    mCacheDispatcher = new CacheDispatcher(mCacheQueue, mNetworkQueue, mCache, mDelivery);</div><div class="line">    mCacheDispatcher.start();</div><div class="line"></div><div class="line">    // Create network dispatchers (and corresponding threads) up to the pool size.</div><div class="line">    for (int i = 0; i &lt; mDispatchers.length; i++) &#123;</div><div class="line">        NetworkDispatcher networkDispatcher = new NetworkDispatcher(mNetworkQueue, mNetwork,</div><div class="line">                mCache, mDelivery);</div><div class="line">        mDispatchers[i] = networkDispatcher;</div><div class="line">        networkDispatcher.start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>start 方法中，开启一个缓存调度线程CacheDispatcher和 n 个网络调度线程NetworkDispatcher，这里 n 默认为 4，存在优化的余地，比如可以根据 CPU 核数以及网络类型计算更合适的并发数。<br>缓存调度线程不断的从缓存请求队列中取出 Request 去处理，网络调度线程不断的从网络请求队列中取出 Request 去处理。<br>(3). 加入请求<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public &lt;T&gt; Request&lt;T&gt; add(Request&lt;T&gt; request);</div></pre></td></tr></table></figure></p>
<p>流程图如下：<br><img src="https://raw.githubusercontent.com/android-cn/android-open-project-analysis/master/tool-lib/network/volley/image/RequestQueue-add-flow-chart.png" alt=""><br>(4). 请求完成<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">void finish(Request&lt;?&gt; request)</div></pre></td></tr></table></figure></p>
<p>Request 请求结束<br>A首先从正在进行中请求集合mCurrentRequests中移除该请求。<br>b然后查找请求等待集合mWaitingRequests中是否存在等待的请求，如果存在，则将等待队列移除，并将等待队列所有的请求添加到缓存请求队列中，让缓存请求处理线程CacheDispatcher自动处理。</p>
<p>(5). 请求取消<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">public void cancelAll(RequestFilter filter)</div><div class="line">public void cancelAll(final Object tag)</div></pre></td></tr></table></figure></p>
<p>取消当前请求集合中所有符合条件的请求。<br>filter 参数表示可以按照自定义的过滤器过滤需要取消的请求。<br>tag 表示按照Request.setTag设置好的 tag 取消请求，比如同属于某个 Activity 的。 </p>
<p><strong> CacheDispatcher.java</strong></p>
<p>一个线程，用于调度处理走缓存的请求。启动后会不断从缓存请求队列中取请求处理，队列为空则等待，请求处理结束则将结果传递给ResponseDelivery 去执行后续处理。当结果未缓存过、缓存失效或缓存需要刷新的情况下，该请求都需要重新进入NetworkDispatcher去调度处理。<br>(1). 成员变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">BlockingQueue&lt;Request&lt;?&gt;&gt; mCacheQueue 缓存请求队列</div><div class="line">BlockingQueue&lt;Request&lt;?&gt;&gt; mNetworkQueue 网络请求队列</div><div class="line">Cache mCache 缓存类，代表了一个可以获取请求结果，存储请求结果的缓存</div><div class="line">ResponseDelivery mDelivery 请求结果传递类</div></pre></td></tr></table></figure></p>
<p>(2). 处理流程图<br><img src="https://raw.githubusercontent.com/android-cn/android-open-project-analysis/master/tool-lib/network/volley/image/CacheDispatcher-run-flow-chart.png" alt=""></p>
<p><strong> NetworkDispatcher.java</strong></p>
<p>一个线程，用于调度处理走网络的请求。启动后会不断从网络请求队列中取请求处理，队列为空则等待，请求处理结束则将结果传递给 ResponseDelivery 去执行后续处理，并判断结果是否要进行缓存。<br>(1). 成员变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">BlockingQueue&lt;Request&lt;?&gt;&gt; mQueue 网络请求队列</div><div class="line">Network mNetwork 网络类，代表了一个可以执行请求的网络</div><div class="line">Cache mCache 缓存类，代表了一个可以获取请求结果，存储请求结果的缓存</div><div class="line">ResponseDelivery mDelivery 请求结果传递类，可以传递请求的结果或者错误到调用者</div></pre></td></tr></table></figure></p>
<p>(2). 处理流程图<br><img src="https://raw.githubusercontent.com/android-cn/android-open-project-analysis/master/tool-lib/network/volley/image/NetworkDispatcher-run-flow-chart.png" alt=""></p>
<p><strong> Cache.java</strong></p>
<p>缓存接口，代表了一个可以获取请求结果，存储请求结果的缓存。<br>(1). 主要方法：</p>
<p>public Entry get(String key); 通过 key 获取请求的缓存实体<br>public void put(String key, Entry entry); 存入一个请求的缓存实体<br>public void remove(String key); 移除指定的缓存实体<br>public void clear(); 清空缓存<br>(2). 代表缓存实体的内部类 Entry</p>
<p>成员变量和方法<br>byte[] data 请求返回的数据（Body 实体）<br>String etag Http 响应首部中用于缓存新鲜度验证的 ETag<br>long serverDate Http 响应首部中的响应产生时间<br>long ttl 缓存的过期时间<br>long softTtl 缓存的新鲜时间<br>Map<string, string=""> responseHeaders 响应的 Headers<br>boolean isExpired() 判断缓存是否过期，过期缓存不能继续使用<br>boolean refreshNeeded() 判断缓存是否新鲜，不新鲜的缓存需要发到服务端做新鲜度的检测 </string,></p>
<p><strong> DiskBasedCache.java</strong></p>
<p>继承 Cache 类，基于 Disk 的缓存实现类。<br>(1). 主要方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public synchronized void initialize() 初始化，扫描缓存目录得到所有缓存数据摘要信息放入内存。</div><div class="line">public synchronized Entry get(String key) 从缓存中得到数据。先从摘要信息中得到摘要信息，然后读取缓存数据文件得到内容。</div><div class="line">public synchronized void put(String key, Entry entry) 将数据存入缓存内。先检查缓存是否会满，会则先删除缓存中部分数据，然后再新建缓存文件。</div><div class="line">private void pruneIfNeeded(int neededSpace) 检查是否能再分配 neededSpace 字节的空间，如果不能则删除缓存中部分数据。</div><div class="line">public synchronized void clear() 清空缓存。 </div><div class="line">public synchronized void remove(String key) 删除缓存中某个元素。</div></pre></td></tr></table></figure></p>
<p>(2). CacheHeader 类<br>CacheHeader 是缓存文件摘要信息，存储在缓存文件的头部，与上面的Cache.Entry相似。</p>
<p><strong> NoCache.java</strong><br>继承 Cache 类，不做任何操作的缓存实现类，可将它作为构建RequestQueue的参数以实现一个不带缓存的请求队列。 </p>
<p><strong> Network.java</strong><br>代表网络的接口，处理网络请求。<br>唯一的方法，用于执行特定请求。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public NetworkResponse performRequest(Request&lt;?&gt; request) throws VolleyError;</div></pre></td></tr></table></figure></p>
<p><strong> NetworkResponse.java</strong></p>
<p>Network中方法 performRequest 的返回值，Request的 parseNetworkResponse(…) 方法入参，是 Volley 中用于内部 Response 转换的一级。<br>封装了网络请求响应的 StatusCode，Headers 和 Body 等。<br>(1). 成员变量</p>
<ul>
<li>int statusCode Http 响应状态码</li>
<li>byte[] data Body 数据</li>
<li>Map<string, string=""> headers 响应 Headers</string,></li>
<li>boolean notModified 表示是否为 304 响应</li>
<li>long networkTimeMs 请求耗时<br>(2). Volley 的内部 Response 转换流程图<br><img src="https://raw.githubusercontent.com/android-cn/android-open-project-analysis/master/tool-lib/network/volley/image/response-process-flow-chart.png" alt=""><br>从上到下表示从得到数据后一步步的处理，箭头旁的注释表示该步处理后的实体类。</li>
</ul>
<p><strong> BasicNetwork.java</strong></p>
<p>实现 Network，Volley 中默认的网络接口实现类。调用HttpStack处理请求，并将结果转换为可被ResponseDelivery处理的NetworkResponse。<br>主要实现了以下功能：<br>(1). 利用 HttpStack 执行网络请求。<br>(2). 如果 Request 中带有实体信息，如 Etag,Last-Modify 等，则进行缓存新鲜度的验证，并处理 304（Not Modify）响应。<br>(3). 如果发生超时，认证失败等错误，进行重试操作，直到成功、抛出异常(不满足重试策略等)结束。 </p>
<p><strong> HttpStack.java</strong></p>
<p>用于处理 Http 请求，返回请求结果的接口。目前 Volley 中的实现有基于 HttpURLConnection 的 HurlStack 和 基于 Apache HttpClient 的 HttpClientStack。<br>唯一方法，执行请求<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">public HttpResponse performRequest(Request&lt;?&gt; request, Map&lt;String, String&gt; additionalHeaders)</div><div class="line">        throws IOException, AuthFailureError;</div></pre></td></tr></table></figure></p>
<p>执行 Request 代表的请求，第二个参数表示发起请求之前，添加额外的请求 Headers。 </p>
<p><strong> HttpClientStack.java</strong><br>实现 HttpStack 接口，利用 Apache 的 HttpClient 进行各种请求方式的请求。<br>基本就是 org.apache.http 包下面相关类的常见用法，不做详解，不过与下面 HttpURLConnection 做下对比就能发现 HttpURLConnection 的 API 相对简单的多。</p>
<p><strong> HurlStack.java</strong><br>实现 HttpStack 接口，利用 Java 的 HttpURLConnection 进行各种请求方式的请求。</p>
<p><strong> Response.java</strong><br>封装了经过解析后的数据，用于传输。并且有两个内部接口 Listener 和 ErrorListener 分别可表示请求失败和成功后的回调。<br>Response 的构造函数被私有化，而通过两个函数名更易懂的静态方法构建对象。</p>
<p><strong> ByteArrayPool.java</strong><br>byte[] 的回收池，用于 byte[] 的回收再利用，减少了内存的分配和回收。 主要通过一个元素长度从小到大排序的ArrayList作为 byte[] 的缓存，另有一个按使用时间先后排序的ArrayList属性用于缓存满时清理元素。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public synchronized void returnBuf(byte[] buf)</div></pre></td></tr></table></figure></p>
<p>将用过的 byte[] 回收，根据 byte[] 长度按照从小到大的排序将 byte[] 插入到缓存中合适位置。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public synchronized byte[] getBuf(int len)</div></pre></td></tr></table></figure></p>
<p>获取长度不小于 len 的 byte[]，遍历缓存，找出第一个长度大于传入参数len的 byte[]，并返回；如果最终没有合适的 byte[]，new 一个返回。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">private synchronized void trim()</div></pre></td></tr></table></figure></p>
<p>当缓存的 byte 超过预先设置的大小时，按照先进先出的顺序删除最早的 byte[]。</p>
<p><strong> PoolingByteArrayOutputStream.java</strong><br>继承 ByteArrayOutputStream，原始 ByteArrayOutputStream 中用于接受写入 bytes 的 buf，每次空间不足时便会 new 更大容量的 byte[]，而 PoolingByteArrayOutputStream 使用了 ByteArrayPool 作为 Byte[] 缓存来减少这种操作，从而提高性能。</p>
<p><strong> HttpHeaderParser.java</strong><br>Http header 的解析工具类，在 Volley 中主要作用是用于解析 Header 从而判断返回结果是否需要缓存，如果需要返回 Header 中相关信息。<br>有三个方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static long parseDateAsEpoch(String dateStr)</div></pre></td></tr></table></figure></p>
<p>解析时间，将 RFC1123 的时间格式，解析成 epoch 时间<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static String parseCharset(Map&lt;String, String&gt; headers)</div></pre></td></tr></table></figure></p>
<p>解析编码集，在 Content-Type 首部中获取编码集，如果没有找到，默认返回 ISO-8859-1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public static Cache.Entry parseCacheHeaders(NetworkResponse response)</div></pre></td></tr></table></figure></p>
<p>比较重要的方法，通过网络响应中的缓存控制 Header 和 Body 内容，构建缓存实体。如果 Header 的 Cache-Control 字段含有no-cache或no-store表示不缓存，返回 null。</p>
<ul>
<li>根据 Date 首部，获取响应生成时间</li>
<li>根据 ETag 首部，获取响应实体标签</li>
<li>根据 Cache－Control 和 Expires 首部，计算出缓存的过期时间，和缓存的新鲜度时间</li>
</ul>
<p>两点需要说明下：<br>1.没有处理Last-Modify首部，而是处理存储了Date首部，并在后续的新鲜度验证时，使用Date来构建If-Modified-Since。 这与 Http 1.1 的语义有些违背。<br>2.计算过期时间，Cache－Control 首部优先于 Expires 首部。</p>
<p><strong> RetryPolicy.java</strong><br>重试策略接口<br>有三个方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public int getCurrentTimeout();//获取当前请求用时（用于 Log）</div><div class="line">public int getCurrentRetryCount();//获取已经重试的次数（用于 Log）</div><div class="line">public void retry(VolleyError error) throws VolleyError; //确定是否重试，参数为这次异常的具体信息。在请求异常时此接口会被调用，可在此函数实现中抛出传入的异常表示停止重试。</div></pre></td></tr></table></figure></p>
<p><strong> DefaultRetryPolicy.java</strong><br>实现 RetryPolicy，Volley 默认的重试策略实现类。主要通过在 retry(…) 函数中判断重试次数是否达到上限确定是否继续重试。<br>其中mCurrentRetryCount变量表示已经重试次数。<br>mBackoffMultiplier表示每次重试之前的 timeout 该乘以的因子。<br>mCurrentTimeoutMs变量表示当前重试的 timeout 时间，会以mBackoffMultiplier作为因子累计前几次重试的 timeout。</p>
<p><strong> ResponseDelivery.java</strong><br>请求结果的传输接口，用于传递请求结果或者请求错误。<br>有三个方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public void postResponse(Request&lt;?&gt; request, Response&lt;?&gt; response);</div></pre></td></tr></table></figure></p>
<p>此方法用于传递请求结果，request 和 response 参数分别表示请求信息和返回结果信息。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public void postResponse(Request&lt;?&gt; request, Response&lt;?&gt; response, Runnable runnable);</div></pre></td></tr></table></figure></p>
<p>此方法用于传递请求结果，并在完成传递后执行 Runnable。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public void postError(Request&lt;?&gt; request, VolleyError error);</div></pre></td></tr></table></figure></p>
<p>此方法用于传输请求错误。</p>
<p><strong> ExecutorDelivery.java</strong><br>请求结果传输接口具体实现类。<br>在 Handler 对应线程中传输缓存调度线程或者网络调度线程中产生的请求结果或请求错误，会在请求成功的情况下调用 Request.deliverResponse(…) 函数，失败时调用 Request.deliverError(…) 函数。</p>
<p><strong> StringRequest.java</strong><br>继承 Request 类,代表了一个返回值为 String 的请求。将网络返回的结果数据解析为 String 类型。通过构造函数的 listener 传参，支持请求成功后的 onResponse(…) 回调。</p>
<p><strong> JsonRequest.java</strong><br>抽象类，继承自 Request，代表了 body 为 JSON 的请求。提供了构建 JSON 请求参数的方法。</p>
<p><strong> JsonObjectRequest.java</strong><br>继承自 JsonRequest，将网络返回的结果数据解析为 JSONObject 类型。</p>
<p><strong> sonArrayRequest.java</strong><br>继承自 JsonRequest，将网络返回的结果数据解析为 JSONArray 类型。</p>
<p><strong> ImageRequest.java</strong><br>继承 Request 类，代表了一个返回值为 Image 的请求。将网络返回的结果数据解析为 Bitmap 类型。<br>可以设置图片的最大宽度和最大高度，并计算出合适尺寸返回。每次最多解析一张图片防止 OOM。</p>
<p><strong> ImageLoader.java</strong><br>封装了 ImageRequst 的方便使用的图片加载工具类。<br>1.可以设置自定义的ImageCache，可以是内存缓存，也可以是 Disk 缓存，将获取的图片缓存起来，重复利用，减少请求。<br>2.可以定义图片请求过程中显示的图片和请求失败后显示的图片。<br>3.相同请求（相同地址，相同大小）只发送一个，可以避免重复请求。</p>
<p><strong> NetworkImageView.java</strong><br>利用 ImageLoader，可以加载网络图片的 ImageView<br>有三个公开的方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public void setDefaultImageResId(int defaultImage)</div></pre></td></tr></table></figure></p>
<p>设置默认图片，加载图片过程中显示。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public void setErrorImageResId(int errorImage)</div></pre></td></tr></table></figure></p>
<p>设置错误图片，加载图片失败后显示。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public void setImageUrl(String url, ImageLoader imageLoader)</div></pre></td></tr></table></figure></p>
<p>设置网络图片的 Url 和 ImageLoader，将利用这个 ImageLoader 去获取网络图片。<br>如果有新的图片加载请求，会把这个 ImageView 上旧的加载请求取消。</p>
<p><strong> ClearCacheRequest.java</strong><br>用于人为清空 Http 缓存的请求。<br>添加到 RequestQueue 后能很快执行，因为优先级很高，为Priority.IMMEDIATE。并且清空缓存的方法mCache.clear()写在了isCanceled()方法体中，能最早的得到执行。<br>ClearCacheRequest 的写法不敢苟同，目前看来唯一的好处就是可以将清空缓存操作也当做一个请求。而在isCanceled()中做清空操作本身就造成了歧义，不看源码没人知道在NetworkDispatcher run 方法循环的过程中，isCanceled()这个读操作竟然做了可能造成缓存被清空。只能跟源码的解释一样当做一个 Hack 操作。</p>
<p><strong> Authenticator.java</strong><br>身份认证接口，用于基本认证或者摘要认证。这个类是 Volley 用于和身份验证打通的接口，比如 OAuth，不过目前的使用不是特别广泛和 Volley 的内部结合也不是特别紧密。</p>
<p><strong> AndroidAuthenticator.java</strong><br>继承 Authenticator，基于 Android AccountManager 的认证交互实现类。</p>
<p><strong> VolleyLog.java</strong><br>Volley 的 Log 工具类。</p>
<p><strong>VolleyError.java</strong><br>Volley 中所有错误异常的父类，继承自 Exception，可通过此类设置和获取 NetworkResponse 或者请求的耗时。</p>
<p><strong> AuthFailureError.java</strong><br>继承自 VolleyError，代表请求认证失败错误，如 RespondeCode 的 401 和 403。</p>
<p><strong> NetworkError.java</strong><br>继承自 VolleyError，代表网络错误。</p>
<p><strong> ParseError.java</strong><br>继承自 VolleyError，代表内容解析错误。</p>
<p><strong> ServerError.java</strong><br>继承自 VolleyError，代表服务端错误。</p>
<p><strong> TimeoutError.java</strong><br>继承自 VolleyError，代表请求超时错误。</p>
<p><strong> NoConnectionError.java</strong><br>继承自 NetworkError，代表无法建立连接错误。 </p>
<h2 id="补充说明"><a href="#补充说明" class="headerlink" title="补充说明"></a>补充说明</h2><p>1 关于 Http 缓存<br>Volley 构建了一套相对完整的符合 Http 语义的缓存机制。<br>优点和特点</p>
<ul>
<li>根据Cache-Control和Expires首部来计算缓存的过期时间。如果两个首部都存在情况下，以Cache-Control为准。</li>
<li>利用If-None-Match和If-Modified-Since对过期缓存或者不新鲜缓存，进行请求再验证，并处理 304 响应，更新缓存。</li>
<li>默认的缓存实现，将缓存以文件的形式存储在 Disk，程序退出后不会丢失。</li>
</ul>
<p>不足之处<br>缓存的再验证方面，在构建If-Modified-Since请求首部时，Volley 使用了服务端响应的Date首部，没有使用Last-Modified首部。整个框架没有使用Last-Modified首部。这与 Http 语义不符。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">private void addCacheHeaders(Map&lt;String, String&gt; headers, Cache.Entry entry) &#123;</div><div class="line">    // If there&apos;s no cache entry, we&apos;re done.</div><div class="line">    if (entry == null) &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (entry.etag != null) &#123;</div><div class="line">        headers.put(&quot;If-None-Match&quot;, entry.etag);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (entry.serverDate &gt; 0) &#123;</div><div class="line">        Date refTime = new Date(entry.serverDate);</div><div class="line">        headers.put(&quot;If-Modified-Since&quot;, DateUtils.formatDate(refTime));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>服务端根据请求时通过If-Modified-Since首部传过来的时间，判断资源文件是否在If-Modified-Since时间 以后有改动，如果有改动，返回新的请求结果。如果没有改动，返回 304 not modified。<br>Last-Modified代表了资源文件的最后修改时间。通常使用这个首部构建If-Modified-Since的时间。<br>Date代表了响应产生的时间，正常情况下Date时间在Last-Modified时间之后。也就是Date&gt;=Last-Modified。<br>通过以上原理，既然Date&gt;=Last-Modified。那么我利用Date构建，也是完全正确的。</p>
<p>可能的问题出在服务端的 Http 实现上，如果服务端完全遵守 Http 语义，采用时间比较的方式来验证If-Modified-Since，判断服务器资源文件修改时间是不是在If-Modified-Since之后。那么使用Date完全正确。<br>可是有的服务端实现不是比较时间，而是直接的判断服务器资源文件修改时间，是否和If-Modified-Since所传时间相等。这样使用Date就不能实现正确的再验证，因为Date的时间总不会和服务器资源文件修改时间相等。</p>
<p>尽管使用Date可能出现的不正确情况，归结于服务端没有正确的实现 Http 语义。<br>但我还是希望 Volley 也能完全正确的实现 Http 语义，至少同时处理Last-Modified和Date,并且优先使用Last-Modified。</p>
<p>2 Bug<br>(1). BasicNetwork.performRequest(…)</p>
<p>如下代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public NetworkResponse performRequest(Request&lt;?&gt; request) throws VolleyError &#123;</div><div class="line">    ……</div><div class="line">    while (true) &#123;</div><div class="line">        ……</div><div class="line">        try &#123;</div><div class="line">            ……</div><div class="line">        &#125; catch (IOException e) &#123;</div><div class="line">            int statusCode = 0;</div><div class="line">            NetworkResponse networkResponse = null;</div><div class="line">            ……</div><div class="line">            if (responseContents != null) &#123;</div><div class="line">              ……</div><div class="line">            &#125; else &#123;</div><div class="line">                throw new NetworkError(networkResponse);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>BasicNetwork.performRequest(…) 最后的throw new NetworkError(networkResponse);应该是throw new NetworkError(e);更合理。 </p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="http://a.codekk.com/detail/Android/grumoon/Volley%20%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90" target="_blank" rel="external">Volley 源码解析</a></li>
<li><a href="https://android.googlesource.com/platform/frameworks/volley/" target="_blank" rel="external">Volley open source</a></li>
<li><a href="https://github.com/android-cn/android-open-project-demo/tree/master/volley-demo" target="_blank" rel="external">Volley Demo</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/08/android_volley/" data-id="cj4zxopou004eq4nhxvh2zzai" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/volley/">volley</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_ndk_development1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/04/android_ndk_development1/" class="article-date">
  <time datetime="2016-03-04T03:47:29.000Z" itemprop="datePublished">2016-03-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ndk/">ndk</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/04/android_ndk_development1/">Android之NDK开发</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>JNI和NDK之前也有接触过，现在工作中有用到这个，所以决定静下心来研究一下，并且整理一下网上的一些资源结合实际的DEMO，写一篇博客。</p>
<h2 id="安装NDK开发环境"><a href="#安装NDK开发环境" class="headerlink" title="安装NDK开发环境"></a>安装NDK开发环境</h2><p>这里介绍的是在AS下的安装和使用。Android Studio 1.3 Beta1开始，就支持了NDK。不过使用的是一个全新的实验性的gradle构建工具<a href="http://tools.android.com/tech-docs/new-build-system/gradle-experimental" target="_blank" rel="external">官方地址</a>。进行配置前请先将Android Studio更新至最新版本，目前最新版本是1.5.1。然后使用Android Studio内置的SDK管理器下载NDK。<br><img src="http://img.blog.csdn.net/20150915162151993" alt=""><br>打开Project Structure，切到的SDK Location页进行安装:<br><img src="http://img.blog.csdn.net/20150915162201705" alt=""><br>不知道Project Structure在哪直接search，安装的时候直接点Download，直接下载的安装包就会自动安装并配置。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="http://tools.android.com/tech-docs/new-build-system/gradle-experimental#TOC-Gradle-Requirements" target="_blank" rel="external">Android Tools Project Site</a></li>
<li><a href="http://developer.android.com/intl/zh-cn/ndk/guides/setup.html#install" target="_blank" rel="external">NDK Setup</a></li>
<li><a href="http://www.cnblogs.com/skywang12345/archive/2013/05/23/3095013.html" target="_blank" rel="external">Android JNI和NDK学习(01)–搭建NDK开发环境</a></li>
<li><a href="http://blog.csdn.net/sbsujjbcy/article/details/48469569" target="_blank" rel="external">Android Studio使用新的Gradle构建工具配置NDK环境</a></li>
<li><a href="http://liuzhuangzhuang.com/2015/11/09/android-jni-ndk-%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5%E5%92%8C%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80/" target="_blank" rel="external">android jni ndk 开发实践和理论基础</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/04/android_ndk_development1/" data-id="cj4zxopnt002lq4nhte4i1tbh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jni/">jni</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nd/">nd</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-article_my_faith" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/02/article_my_faith/" class="article-date">
  <time datetime="2016-03-02T10:12:29.000Z" itemprop="datePublished">2016-03-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/article/">article</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/02/article_my_faith/">爱因斯坦：我的信仰</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>作者:爱因斯坦</p>
<p>我们这些终有一死的人的命运是多么奇特呀！<br>我们每个人在这个世界上都只作一个短暂的逗留：目的何在，却无所知，尽管有时自以为对此若有所感。<br>但是，不必深思，只要从日常生活就可以明白：<u>人是为别人而生存的。首先是为那样一些人，他们的喜悦和健康关系着我们自己的全部幸福；然后是为许多我们所不认识的人，他们的命运通过同情的纽带同我们密切结合在一起。</u></p>
<p>我每天上百次地提醒自己：我的精神生活和物质生活都依靠着别人的劳动，包括生者和死者，我必须尽力以同样的分量来报偿我所领受了的和至今还在领受着的东西。<br>我强烈地向往着俭朴的生活，并且时常为发觉自己占用了同胞的过多劳动而难以忍受。我认为阶级的区分是不合理的，它最后所凭借的是以暴力为根据。我也相信， 简单淳朴的生活，无论在身体上还是在精神上，对每个人都是有益的。<br>我完全不相信人类会有那种在哲学意义上的自由。<br><u>每一个人的行为，不仅受着外界的强迫，而且还要适应内心的必然。</u></p>
<p>叔本华说： “人虽然能够做他所想做的，但不能要他所想要的。” 这句话从我青年时代起，就对我是一个真正的启示；在我自己和别人生活面临困难的时候，它总是使我们得到安慰，并且永远是宽容的泉源。这种体会可以宽大为怀地减轻那种容易使人气馁的责任感，也可以防止我们过于严肃地对待自己和别人；它还导致一种特别给幽默以应有地位的人生观。<br>要追究一个人自己或一切生物生存的意义或目的，从客观的观点看来， 我总觉得是愚蠢可笑的。</p>
<p>可是每个人都有一定的理想，这种理想决定着他的努力和判断的方向。就在这个意义上，我从来不把安逸和享乐看作是生活目的本身——这种伦理基础，我叫它猪栏的理想。 照亮我的道路，并且不断地给我新的勇气去愉快地正视生活的理想，是善、美和真。要是没有志同道合者之间的亲切感情，要不是全神贯注于客观世界——那个在艺术和科学工作领域里永远达不到的对象，那么在我看来，生活就会是空虚的。人们所努力追求的庸俗的目标——财产、虚荣、奢侈的生活——我总觉得都是可鄙的。<br>我对社会正义和社会责任的强烈感觉，同我显然的对别人和社会直接接触的淡漠，两者总是形成古怪的对照。 我实在是一个“ 孤独的旅客”，<u>我未曾全心全意地属于我的国家，我的家庭，我的朋友，甚至我最接近的亲人；在所有这些关系面前，我总是感觉到有一定距离并且需要保持孤独——而这种感受正与年俱增。 人们会清楚地发觉，同别人的相互了解和协调一致是有限度的，但这不足惋惜。</u></p>
<p>这样的人无疑有点失去他的天真无邪和无忧无虑的心境；但另一方面，他却能够在很大程度上不为别人的意见、习惯和判断所左右，并且能够不受诱惑要去把他的内心平衡建立在这样一些不可靠的基础之上。<br>但是，不必深思，只要从日常生活就可以明白： 人是为别人而生存的 。<br>我的政治理想是民主主义。</p>
<p>让每一个人都作为个人而受到尊重，而不让任何人成为崇拜的偶像。我自己受到了人们过分的赞扬和尊敬，这不是由于我自己的过错，也不是由于我自己的功劳，而实在是一种命运的嘲弄。其原因大概在于 人们有一种愿望，想理解我以自己的微薄绵力通过不断的斗争所获得的少数几个观念，而这种愿望有很多人却未能实现。<br>我完全明白，一个组织要实现它的目的，就必须有一个人去思考，去指挥，并且全面担负起责任来。 但是被领导的人不应当受到强迫，他们必须有可能来选择自己的领袖。在我看来， 强迫的专制制度很快就会腐化堕落。因为暴力所招引来的总是一些品德低劣的人，而且我相信，<u>天才的暴君总是由无赖来继承，这是一条千古不易的规律。</u></p>
<p>就是这个缘故，我总是强烈地反对今天我们在意大利和俄国所见到的那种制度。像欧洲今天所存在的情况，使得民主形势受到了怀疑，这不能归咎于民主原则本身，而是由于政府的不稳定和选举制度中与个人无关的特征。</p>
<p>我相信美国在这方面已经找到了正确的道路。他们选出了一个任期足够长的总统，他有充分的权力来真正履行他的职责。另一方面，在德国的政治制度中，我所重视的是，它为救济患病或贫困的人作出了比较广泛的规定。<br>在人生的丰富多彩的表演中，<u>我觉得真正可贵的，不是政治上的国家，而是有创造性的，有感情的个人，是人格；</u>只有个人才能创造出高尚的和卓越的东西，而群众本身在思想上总是迟钝的，在感觉上也总是迟钝的。<br>讲到这里，我想起了群众生活中最坏的一种表现，那就是使我厌恶的军事制度。一个人能够洋洋得意地随着军乐队在四列纵队里行进，单凭这一点就足以使我对他轻视。他所以长了一个大脑，只是出于误会；单单一根脊髓就可满足他的全部需要了。文明国家的这种罪恶的渊薮，应当尽快加以消灭。 </p>
<p>由命令而产生的勇敢行为，毫无意义的暴行，以及在爱国主义名义下一切可恶的胡闹，所有这些都使我深恶痛绝，在我看来，战争是多么卑鄙、下流！我宁愿被千刀万剐，也不愿参预这种可憎的勾当。</p>
<p>尽管如此，我对人类的评价还是十分高的，我相信，要是人民的健康感情没有被那些通过学校和报纸而起作用的商业利益和政治利益蓄意进行败坏，那么战争这个妖魔早就该绝迹了。<br>我们所能有的最美好的经验是奥秘的经验。它是坚守在真正艺术和真正科学发源地上的基本感情。谁要是体验不到它，谁要是不再有好奇心也不再有惊讶的感觉，他就无异于行尸走肉，他的眼睛是迷糊不清的。</p>
<p>就是这样奥秘的经验产生了宗教。我们认识到有某种为我们所不能洞察的东西存在，感觉到那种只能以其最原始的形式为我们感受到的最深奥的理性和最灿烂的美——正是这种认识和这种情感构成了真正的宗教感情；在这个意义上，而且也只是在这个意义上，我才是一个具有深挚的宗教感情的人。</p>
<p>我无法想象一个会对自己的创造物加以赏罚的上帝，也无法想象它会有像在我们自己身上所体验到的那样一种意志。我不能也不愿去想象一个人在肉体死亡以后还会继续活着；让那些脆弱的灵魂，由于恐惧或者由于可笑的唯我论，去拿这种思想当宝贝吧！</p>
<p><u>我自己只求满足于生命永恒的奥秘，满足于觉察现存世界的神奇的结构，窥见它的一鳞半爪，并且以诚挚的努力去领悟在自然界中显示出来的那个理性的一部分，即使只是其极小的一部分，我也就心满意足了。</u> </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/02/article_my_faith/" data-id="cj4zxopou004kq4nhop9ub8we" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Einstein/">Einstein</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_string_replace" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/25/android_string_replace/" class="article-date">
  <time datetime="2016-02-25T04:07:29.000Z" itemprop="datePublished">2016-02-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/string/">string</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/25/android_string_replace/">Android占位符</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h2 id="整型占位符"><a href="#整型占位符" class="headerlink" title="整型占位符"></a>整型占位符</h2><p>比如“我今年23岁了”，这个23是整型的。在string.xml中可以这样写:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;string name=&quot;old&quot;&gt;我今年%1$d岁了&lt;/string&gt;</div></pre></td></tr></table></figure></p>
<p>在程序中，使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">String sAgeFormat = getResources().getString(R.string.old);  </div><div class="line">String sFinalAge = String.format(sAgeFormat, 23);</div></pre></td></tr></table></figure></p>
<p>将<code>%1$d</code>替换为23； </p>
<p><code>%1$d</code>表达的意思是整个name=”old”中，第一个整型的替代。如果一个name中有两个需要替换的整型内容，则第二个写为：<code>%2$d</code>，以此类推。</p>
<h2 id="string型占位符"><a href="#string型占位符" class="headerlink" title="string型占位符"></a>string型占位符</h2><p>比如“我的名字叫李四，我来自首都北京”；这里的“李四”和“首都北京”都需要替换。 </p>
<p>在string.xml中可以这样写：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;string name=&quot;alert&quot;&gt;我的名字叫%1$s，我来自%2$s&lt;/string&gt;</div></pre></td></tr></table></figure></p>
<p>在程序中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">String sAgeFormatString sAgeFormat1= getResources().getString(R.string.alert);     </div><div class="line">String sFinal1 = String.format(sAgeFormat1, &quot;李四&quot;,&quot;首都北京&quot;);</div></pre></td></tr></table></figure></p>
<p>这里两个string需要替换的，按照上面程序的顺序依次对应。</p>
<h2 id="标签介绍"><a href="#标签介绍" class="headerlink" title="标签介绍"></a><xliff:g>标签介绍</xliff:g></h2><p>属性id可以随便命名<br>属性值举例说明</p>
<ul>
<li>%n$ms：代表输出的是字符串，n代表是第几个参数，设置m的值可以在输出之前放置空格 </li>
<li>%n$md：代表输出的是整数，n代表是第几个参数，设置m的值可以在输出之前放置空格，也可以设为0m,在输出之前放置m个0 </li>
<li>%n$mf：代表输出的是浮点数，n代表是第几个参数，设置m的值可以控制小数位数，如m=2.2时，输出格式为00.00 </li>
<li>&amp;#8243: 代表”</li>
<li>&amp;#160: 代表空格</li>
</ul>
<p>也可简单写成：</p>
<ul>
<li>%d   （表示整数）</li>
<li>%f   （表示浮点数）</li>
<li>%s   （表示字符串）</li>
</ul>
<h2 id="Xliff使用"><a href="#Xliff使用" class="headerlink" title="Xliff使用"></a>Xliff使用</h2><p>Xliff是XML Localization Interchange File Format 的缩写，中文名为XML本地化数据交换格式。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//1.声明命名空间，增加XLIFF的 xmlns</div><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;resources xmlns:xliff=&quot;urn:oasis:names:tc:xliff:document:1.2&quot;&gt; </div><div class="line">//2.在xml中定义</div><div class="line">&lt;string name=&quot;test_xliff&quot;&gt;小红今年&lt;xliff:g id=&quot;xxx&quot;&gt;%d&lt;/xliff:g&gt;岁了，上&lt;xliff:g id=&quot;yyy&quot;&gt;%s&lt;/xliff:g&gt;年级！&lt;/string&gt;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//3. </div><div class="line">String test = String.format(getResources().getString(R.string.test_xliff), 7, &quot;小学二&quot;);</div></pre></td></tr></table></figure>
<p>输出：</p>
<blockquote>
<p>小红今年7岁了，上小学二年级！</p>
</blockquote>
<p>示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;resources xmlns:xliff=&quot;urn:oasis:names:tc:xliff:document:1.2&quot;&gt;</div><div class="line">    &lt;string name=&quot;hello_world&quot;&gt;Hello world! \n &lt;xliff:g id=&quot; anystring_you_like&quot; &gt;%1$010d&lt;/xliff:g&gt;时 &lt;xliff:g&gt;%2$2.2f&lt;/xliff:g&gt;分&lt;xliff:g&gt;%3$2s&lt;/xliff:g&gt;秒&lt;/string&gt;</div><div class="line">&lt;/resources&gt;</div></pre></td></tr></table></figure></p>
<p>程序中动态的插入内容.可在Activity的onCreate方法里调用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">getString(R.string. hello_world , 12, 6.5f ,&quot;05&quot;);</div><div class="line">//此方法实质是Context.getResources().getString(int resId, Object... formatArgs);</div></pre></td></tr></table></figure></p>
<p>这个例子将会打印出:</p>
<blockquote>
<p>Hello world!<br>0000000012时 6.50分05秒 </p>
</blockquote>
<p>注意:<br>1)<code>&lt;xliff:g&gt;</code>标签的 id 属性 可以随便命名,不给id也没关系;<br>2)使用 <code>&lt;xliff:g&gt;</code>标签的string.xml文件的&lt; resources&gt;标签必须声明命名空间 xmlns:xliff=”urn:oasis:names:tc:xliff:document:1.2”,否则报错;<br>3)<code>&lt;xliff:g&gt;</code>标签里的格式是<code>%x$yz</code>。其中:%,$符号的位置是固定的,x表示占位符,其值代表第几个参数,z有三种选择:</p>
<ul>
<li>s (代表 formatArgs是 字符串) </li>
<li>d (代表 formatArgs是 整型)</li>
<li>f (代表 formatArgs是 浮点型)</li>
</ul>
<p>说明：</p>
<ul>
<li>对应s:y的值减去字符串长度的值代表字符串前要放置的空格数,y须是整数,且不能为0 ;</li>
<li>对应d:y的值减去整型位数的值代表转化成字符串后其前要放置的空格数,如果y以0开头,将填充0而非空格,y须是整型,且不能为0;</li>
<li>对应f:y是一个小数,这个小数的整数部分减去浮点数的整数位数的值放置空格,小数部分代表小数位数;</li>
</ul>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="http://blog.csdn.net/wufen1103/article/details/7846691" target="_blank" rel="external">Android string</a></li>
<li><a href="http://www.cnblogs.com/maijin/articles/4650722.html" target="_blank" rel="external">Html与XSL字符转义</a></li>
<li><a href="http://www.tuicool.com/articles/IZ73Y3" target="_blank" rel="external"><code>&lt;xliff:g&gt;</code>使用</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/02/25/android_string_replace/" data-id="cj4zxopoe003qq4nhcvnc2geg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/placeholder/">placeholder</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/article/">article</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/coding/">coding</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/">database</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/framework/">framework</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/humanism/">humanism</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/message-push/">message_push</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/music/">music</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ndk/">ndk</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/note/">note</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/protocol/">protocol</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/reading/">reading</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/springmvc/">springmvc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/string/">string</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/study/">study</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/versioncontroll/">versioncontroll</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/好文/">好文</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/电影/">电影</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AliPay/">AliPay</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Einstein/">Einstein</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GreenDao/">GreenDao</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ORMLite/">ORMLite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WXPay/">WXPay</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/activity/">activity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-studio/">android_studio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-ui/">android_ui</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/androidstudio/">androidstudio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animation/">animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/application/">application</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/book/">book</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/broadcast/">broadcast</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bugfix/">bugfix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chinese-weman/">chinese_weman</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/code-collection/">code_collection</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/context/">context</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/database/">database</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/decomplication/">decomplication</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design-model/">design model</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eclipse/">eclipse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eventbus/">eventbus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/feminism/">feminism</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fullstack/">fullstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google/">google</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gradle/">gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/handle/">handle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/handler/">handler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/https/">https</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/humanism/">humanism</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iframe/">iframe</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/image/">image</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/imageloader/">imageloader</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/intent/">intent</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/intentflag/">intentflag</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iphone/">iphone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jni/">jni</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/listview/">listview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/material-design/">material_design</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/music/">music</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mvp/">mvp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nd/">nd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/notification/">notification</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/obfuscation/">obfuscation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/observer/">observer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/opensource/">opensource</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/otto/">otto</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pageradapter/">pageradapter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pay/">pay</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/placeholder/">placeholder</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/project-build/">project_build</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pulltorefresh/">pulltorefresh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pulltorefreshlistview/">pulltorefreshlistview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/saxophone/">saxophone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/screen-record/">screen-record</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shortkey/">shortkey</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/snack/">snack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sort/">sort</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spannable/">spannable</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/speech/">speech</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springmvc/">springmvc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlite/">sqlite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssl/">ssl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sublime/">sublime</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svg/">svg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svn/">svn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/templates/">templates</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/textview/">textview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tomcat/">tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/translate/">translate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/viewpager/">viewpager</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/volley/">volley</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/website/">website</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webview/">webview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xpnet/">xpnet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/书单/">书单</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/史玉柱/">史玉柱</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/感悟/">感悟</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/电影/">电影</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/贾樟柯/">贾樟柯</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/AliPay/" style="font-size: 10px;">AliPay</a> <a href="/tags/Einstein/" style="font-size: 10px;">Einstein</a> <a href="/tags/GreenDao/" style="font-size: 10px;">GreenDao</a> <a href="/tags/ORMLite/" style="font-size: 10px;">ORMLite</a> <a href="/tags/WXPay/" style="font-size: 10px;">WXPay</a> <a href="/tags/activity/" style="font-size: 10px;">activity</a> <a href="/tags/android-studio/" style="font-size: 10px;">android_studio</a> <a href="/tags/android-ui/" style="font-size: 10px;">android_ui</a> <a href="/tags/androidstudio/" style="font-size: 20px;">androidstudio</a> <a href="/tags/animation/" style="font-size: 20px;">animation</a> <a href="/tags/application/" style="font-size: 10px;">application</a> <a href="/tags/book/" style="font-size: 10px;">book</a> <a href="/tags/broadcast/" style="font-size: 10px;">broadcast</a> <a href="/tags/bugfix/" style="font-size: 13.33px;">bugfix</a> <a href="/tags/chinese-weman/" style="font-size: 10px;">chinese_weman</a> <a href="/tags/code-collection/" style="font-size: 10px;">code_collection</a> <a href="/tags/context/" style="font-size: 10px;">context</a> <a href="/tags/database/" style="font-size: 10px;">database</a> <a href="/tags/decomplication/" style="font-size: 10px;">decomplication</a> <a href="/tags/design-model/" style="font-size: 13.33px;">design model</a> <a href="/tags/eclipse/" style="font-size: 10px;">eclipse</a> <a href="/tags/eventbus/" style="font-size: 10px;">eventbus</a> <a href="/tags/feminism/" style="font-size: 10px;">feminism</a> <a href="/tags/fullstack/" style="font-size: 10px;">fullstack</a> <a href="/tags/github/" style="font-size: 13.33px;">github</a> <a href="/tags/google/" style="font-size: 10px;">google</a> <a href="/tags/gradle/" style="font-size: 16.67px;">gradle</a> <a href="/tags/handle/" style="font-size: 10px;">handle</a> <a href="/tags/handler/" style="font-size: 10px;">handler</a> <a href="/tags/hexo/" style="font-size: 16.67px;">hexo</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/https/" style="font-size: 10px;">https</a> <a href="/tags/humanism/" style="font-size: 10px;">humanism</a> <a href="/tags/iframe/" style="font-size: 10px;">iframe</a> <a href="/tags/image/" style="font-size: 10px;">image</a> <a href="/tags/imageloader/" style="font-size: 20px;">imageloader</a> <a href="/tags/intent/" style="font-size: 10px;">intent</a> <a href="/tags/intentflag/" style="font-size: 13.33px;">intentflag</a> <a href="/tags/iphone/" style="font-size: 10px;">iphone</a> <a href="/tags/jni/" style="font-size: 10px;">jni</a> <a href="/tags/listview/" style="font-size: 10px;">listview</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/material-design/" style="font-size: 10px;">material_design</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/music/" style="font-size: 13.33px;">music</a> <a href="/tags/mvp/" style="font-size: 10px;">mvp</a> <a href="/tags/mysql/" style="font-size: 16.67px;">mysql</a> <a href="/tags/nd/" style="font-size: 10px;">nd</a> <a href="/tags/notification/" style="font-size: 10px;">notification</a> <a href="/tags/obfuscation/" style="font-size: 10px;">obfuscation</a> <a href="/tags/observer/" style="font-size: 10px;">observer</a> <a href="/tags/opensource/" style="font-size: 13.33px;">opensource</a> <a href="/tags/otto/" style="font-size: 10px;">otto</a> <a href="/tags/pageradapter/" style="font-size: 10px;">pageradapter</a> <a href="/tags/pay/" style="font-size: 13.33px;">pay</a> <a href="/tags/placeholder/" style="font-size: 10px;">placeholder</a> <a href="/tags/project-build/" style="font-size: 10px;">project_build</a> <a href="/tags/pulltorefresh/" style="font-size: 10px;">pulltorefresh</a> <a href="/tags/pulltorefreshlistview/" style="font-size: 13.33px;">pulltorefreshlistview</a> <a href="/tags/saxophone/" style="font-size: 10px;">saxophone</a> <a href="/tags/screen-record/" style="font-size: 10px;">screen-record</a> <a href="/tags/shortkey/" style="font-size: 10px;">shortkey</a> <a href="/tags/snack/" style="font-size: 10px;">snack</a> <a href="/tags/socket/" style="font-size: 10px;">socket</a> <a href="/tags/sort/" style="font-size: 13.33px;">sort</a> <a href="/tags/spannable/" style="font-size: 10px;">spannable</a> <a href="/tags/speech/" style="font-size: 10px;">speech</a> <a href="/tags/springmvc/" style="font-size: 10px;">springmvc</a> <a href="/tags/sqlite/" style="font-size: 10px;">sqlite</a> <a href="/tags/ssl/" style="font-size: 13.33px;">ssl</a> <a href="/tags/sublime/" style="font-size: 10px;">sublime</a> <a href="/tags/svg/" style="font-size: 13.33px;">svg</a> <a href="/tags/svn/" style="font-size: 13.33px;">svn</a> <a href="/tags/templates/" style="font-size: 10px;">templates</a> <a href="/tags/textview/" style="font-size: 10px;">textview</a> <a href="/tags/tomcat/" style="font-size: 16.67px;">tomcat</a> <a href="/tags/translate/" style="font-size: 10px;">translate</a> <a href="/tags/viewpager/" style="font-size: 13.33px;">viewpager</a> <a href="/tags/volley/" style="font-size: 10px;">volley</a> <a href="/tags/website/" style="font-size: 13.33px;">website</a> <a href="/tags/webview/" style="font-size: 10px;">webview</a> <a href="/tags/xpnet/" style="font-size: 13.33px;">xpnet</a> <a href="/tags/书单/" style="font-size: 10px;">书单</a> <a href="/tags/史玉柱/" style="font-size: 10px;">史玉柱</a> <a href="/tags/感悟/" style="font-size: 10px;">感悟</a> <a href="/tags/电影/" style="font-size: 10px;">电影</a> <a href="/tags/贾樟柯/" style="font-size: 10px;">贾樟柯</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/11/11/study_my_website_collection/">常用网站收集</a>
          </li>
        
          <li>
            <a href="/2016/05/04/web_develop_config/">WEB开发之环境配置</a>
          </li>
        
          <li>
            <a href="/2016/05/04/web_springmvc1/">Spring MVC入门(一)</a>
          </li>
        
          <li>
            <a href="/2016/04/07/android_network_ssl/">为你的Android App实现自签名的SSL证书</a>
          </li>
        
          <li>
            <a href="/2016/03/28/android_notification_push/">Android实现推送方式解决方案</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 ARESXIONG<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>