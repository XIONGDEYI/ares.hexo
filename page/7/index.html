<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ARESXIONG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="ARESXIONG">
<meta property="og:url" content="http://yoursite.com/page/7/index.html">
<meta property="og:site_name" content="ARESXIONG">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ARESXIONG">
  
    <link rel="alternate" href="/atom.xml" title="ARESXIONG" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ARESXIONG</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-tools_google_website_collect" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/11/tools_google_website_collect/" class="article-date">
  <time datetime="2015-11-11T03:01:29.000Z" itemprop="datePublished">2015-11-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tools/">tools</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/11/tools_google_website_collect/">Google 镜像站搜集</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://7xku3f.com1.z0.glb.clouddn.com/wp-content/uploads/2015/04/googlelogo_color_272x92dp.png" alt=""></p>
<h2 id="原版"><a href="#原版" class="headerlink" title="原版"></a>原版</h2><p><a href="https://gg.wen.lu/" target="_blank" rel="external">https://gg.wen.lu/</a></p>
<p><a href="http://www.guge.link/" target="_blank" rel="external">http://www.guge.link/</a></p>
<p><a href="https://gg.kfd.me" target="_blank" rel="external">https://gg.kfd.me</a></p>
<p><a href="http://www.kb58.cn/" target="_blank" rel="external">http://www.kb58.cn/</a></p>
<p><a href="http://so.chongbuluo.com/" target="_blank" rel="external">http://so.chongbuluo.com/</a></p>
<p><a href="http://www.gusou.co/" target="_blank" rel="external">http://www.gusou.co/</a></p>
<p><a href="http://googless.sinaapp.com/google.php" target="_blank" rel="external">http://googless.sinaapp.com/google.php</a></p>
<p><a href="https://g.yh.gs/" target="_blank" rel="external">https://g.yh.gs/</a></p>
<p><a href="https://gs.awei.me/" target="_blank" rel="external">https://gs.awei.me/</a></p>
<p><a href="http://www.ppx.pw" target="_blank" rel="external">http://www.ppx.pw</a></p>
<p><a href="http://gg.cytbj.com/" target="_blank" rel="external">http://gg.cytbj.com/</a></p>
<p><a href="http://carbyne.net.cn/" target="_blank" rel="external">http://carbyne.net.cn/</a></p>
<p><a href="https://g.searcher.top/" target="_blank" rel="external">https://g.searcher.top/</a></p>
<p><a href="https://www.ko50.com/" target="_blank" rel="external">https://www.ko50.com/</a></p>
<p><a href="https://www.guge.click/" target="_blank" rel="external">https://www.guge.click/</a></p>
<p><a href="https://gg.searcher.top/" target="_blank" rel="external">https://gg.searcher.top/</a></p>
<p><a href="https://guge.droider.cn/" target="_blank" rel="external">https://guge.droider.cn/</a></p>
<p><a href="http://gg.cellmean.com/" target="_blank" rel="external">http://gg.cellmean.com/</a></p>
<p><a href="http://www.google52.com/" target="_blank" rel="external">http://www.google52.com/</a></p>
<p><a href="http://www.googlestable.cn/" target="_blank" rel="external">http://www.googlestable.cn/</a></p>
<p><a href="http://google.sidney-aldebaran.me/" target="_blank" rel="external">http://google.sidney-aldebaran.me/</a></p>
<h2 id="非原版"><a href="#非原版" class="headerlink" title="非原版"></a>非原版</h2><p>蝴蝶：<a href="http://www.xiexingwen.com/" target="_blank" rel="external">http://www.xiexingwen.com/</a><br>南搜：<a href="http://nan.so/" target="_blank" rel="external">http://nan.so/</a><br>微搜：<a href="http://www.wesou.org/" target="_blank" rel="external">http://www.wesou.org/</a><br>搜下看：<a href="http://soxiakan.com/" target="_blank" rel="external">http://soxiakan.com/</a><br>谷粉网：<a href="http://www.gool.wang/" target="_blank" rel="external">http://www.gool.wang/</a><br>拇指搜：<a href="http://gfss.wallpai.com/" target="_blank" rel="external">http://gfss.wallpai.com/</a><br>嘟嘟搜：<a href="http://www.dodosou.com/" target="_blank" rel="external">http://www.dodosou.com/</a><br>谷歌婊：<a href="http://www.gugebiao.com/" target="_blank" rel="external">http://www.gugebiao.com/</a><br>谷歌363：<a href="http://www.g363.com/" target="_blank" rel="external">http://www.g363.com/</a><br>给搜搜索：<a href="http://www.geiso.cn/" target="_blank" rel="external">http://www.geiso.cn/</a><br>快搜香港：<a href="http://hk.kuaiso.com/" target="_blank" rel="external">http://hk.kuaiso.com/</a><br>神灯搜索：<a href="http://www.sdeng.cn/" target="_blank" rel="external">http://www.sdeng.cn/</a><br>谷粉搜搜：<a href="http://www.gfsousou.cn/" target="_blank" rel="external">http://www.gfsousou.cn/</a><br>谷粉搜搜：<a href="http://gfsoso.hao136.com/" target="_blank" rel="external">http://gfsoso.hao136.com/</a><br>红杏谷歌：<a href="http://www.hxgoogle.com/" target="_blank" rel="external">http://www.hxgoogle.com/</a><br>布谷鸟搜索：<a href="http://m.wcuckoo.com/search/" target="_blank" rel="external">http://m.wcuckoo.com/search/</a><br>Ask：<a href="http://home.tb.ask.com/" target="_blank" rel="external">http://home.tb.ask.com/</a><br>AOL：<a href="http://m.search.aol.com/" target="_blank" rel="external">http://m.search.aol.com/</a><br>5Ask：<a href="http://cn.5ask.com/" target="_blank" rel="external">http://cn.5ask.com/</a><br>Avira：<a href="https://safesearch.avira.com/" target="_blank" rel="external">https://safesearch.avira.com/</a><br>Suche：<a href="http://suche.web.de/" target="_blank" rel="external">http://suche.web.de/</a><br>Im Google：<a href="http://www.imgoogle.cn/" target="_blank" rel="external">http://www.imgoogle.cn/</a><br>Disconnect：<a href="https://search.disconnect.me/" target="_blank" rel="external">https://search.disconnect.me/</a><br>WebWebWeb：<a href="http://webwebweb.com/" target="_blank" rel="external">http://webwebweb.com/</a></p>
<h2 id="谷歌学术"><a href="#谷歌学术" class="headerlink" title="谷歌学术"></a>谷歌学术</h2><p><a href="http://scholar.ppx.pw/" target="_blank" rel="external">http://scholar.ppx.pw/</a></p>
<p><a href="https://www.roolin.com/" target="_blank" rel="external">https://www.roolin.com/</a></p>
<p><a href="http://www.scholarnet.cn/" target="_blank" rel="external">http://www.scholarnet.cn/</a></p>
<p><a href="http://scholar.searcher.top/" target="_blank" rel="external">http://scholar.searcher.top/</a></p>
<p><a href="http://gg.cytbj.com/scholar" target="_blank" rel="external">http://gg.cytbj.com/scholar</a></p>
<p><a href="http://xueshu.cytbj.com/scholar/" target="_blank" rel="external">http://xueshu.cytbj.com/scholar/</a></p>
<p><a href="http://gfss.cc.wallpai.com/scholar/" target="_blank" rel="external">http://gfss.cc.wallpai.com/scholar/</a></p>
<p><a href="http://www.google52.com/scholar.html" target="_blank" rel="external">http://www.google52.com/scholar.html</a></p>
<h2 id="转自"><a href="#转自" class="headerlink" title="转自"></a>转自</h2><ul>
<li><a href="http://fazero.cc/archives/378" target="_blank" rel="external">Google 镜像站搜集</a> </li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/11/tools_google_website_collect/" data-id="cj4zx2kki0061qonh79tkiyvv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/google/">google</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/website/">website</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-tools_hexo_architecture" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/10/tools_hexo_architecture/" class="article-date">
  <time datetime="2015-11-10T11:48:29.000Z" itemprop="datePublished">2015-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tools/">tools</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/10/tools_hexo_architecture/">Hexo博客的云端备份与迁移</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>我们在使用Hexo写博客的时候发现在一台电脑上写博客，更新博客倒是没有什么问题，可是如果你要换一台电脑然后更新博客发现就比较麻烦。网上类似的源码迁移也有讲，不过我个人还是感觉操作太复杂了。所以自己用Oschina的代码托管做了一个Hexo的源码备份和迁移。下次你要在其他的电脑上写博客也很简单，git命令建仓，同步源码，编译部署都是可以实现的，当然这其中有相关git环境的配置是必须的。不过相比较而言是一个源码迁移和多地编辑的一个可选方案。无论在哪里从云端拉源码到本地，然后将编辑后的源码push到云端，这也是一个非常好的源码备份习惯。</p>
<h2 id="操作流程"><a href="#操作流程" class="headerlink" title="操作流程"></a>操作流程</h2><p>1.OsChina注册账号，建立私有代码库。写到这里大家应该就知道了我为什么选了OsChina而没有选github做代码托管了。因为github上建立私有库并不是免费的。但是开源中国上没有限制。</p>
<p>2.在你的电脑端建立一个文件夹，随意命名。然后git init初始化git环境，建立仓库。git clone你的OsChina上的分支。特殊说明，在OsChina创建私有库的时候，至少要添加一个README文件，否则空的仓库同步的过程会有问题。</p>
<p>3.将你的HEXO源码copy到该文件夹下。public不用copy，这个是HEXO编译自动生成的。然后在该文件目录下调起git bash命令窗口。提交代码到云端。相应的命令是：</p>
<ul>
<li>git status：查看本地代码库和云端代码库的差异</li>
<li>git add :添加修改的文件到本地分支，跟踪修改。</li>
<li>git commit :提交跟踪修改的文件到本地仓库分支。（全部提交，可以跳过add，部分跟踪修改需要add）</li>
<li>git push &lt;远程仓&gt; 提交本地仓库的修改到云端代码仓。<br>说明：这里只是简要说明了git版本控制在代码提交时的常用的命令，更多了解请上git官网学习，git版本控制非常强大，如果你还只是知道SVN，学习一下有好处的。</li>
</ul>
<p>4.提交代码成功后表示你的备份已经完成。现在假设你在另一台电脑要编辑hexo博客并部署到github上。首先建一个文件夹，git init，git clone你OsChina上的源码到本地。</p>
<p>5.此处默认你另一台电脑的hexo环境和github配置都是OK了的，直接就可以写博客了，然后在该目录调起CMD命令行，hexo g,hexo d部署博客了。部署完成后记得push备份源码。</p>
<h2 id="补充说明"><a href="#补充说明" class="headerlink" title="补充说明"></a>补充说明</h2><p>我们如果有使用第三方的主题包，有执行过一个操作就是 cd theme/xxx，然后git pull来更新过主题包，这个操作在该目录会生成一个.git的隐藏文件。我们更新完后应该删除它。自己使用过程中发现不删除会导致两个问题：<br>①编译后部署自己的博客，博客首页的访问加载速度会越来越慢，到后来浏览器几乎处于卡死状态。我现在也不是百分百肯定是它导致的，但是在我删除这个文件夹后，该问题消失。</p>
<p>②不删除的话，在首次备份代码到私有仓库时，它因为也是一个git的本地代码仓库，会导致这个主题包不会push到云端。所以你在另一处更新的时候，这个主题就缺省了，你部署博客后首页就是空白的。但是删除.git后，主题包的代码正常备份和同步，然后就不会有这个问题。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/10/tools_hexo_architecture/" data-id="cj4zx2kkj0062qonheghciff0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hexo/">hexo</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_spannable" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/10/android_spannable/" class="article-date">
  <time datetime="2015-11-10T09:26:29.000Z" itemprop="datePublished">2015-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/android/">android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/10/android_spannable/">Android中的spannable的使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>TextView和EditText是用来显示文本的，有时需要给TextView中的个别字设置为超链接，或者设置个别字的颜色、字体等，那就需要用到Spannable对象，可以借助Spannable对象实现以上设置。</p>
<p>android spannable超链接字体高亮下划线效果<br><img src="http://dl.iteye.com/upload/attachment/574415/5ee01ecc-4627-31b1-bbd1-48ab7aa9c302.png" alt=""></p>
<p>要给 TextView 加上效果，方式主要有几种：</p>
<h3 id="第一种，自动应用效果，使用-android-autoLink-属性"><a href="#第一种，自动应用效果，使用-android-autoLink-属性" class="headerlink" title="第一种，自动应用效果，使用 android:autoLink 属性"></a>第一种，自动应用效果，使用 android:autoLink 属性</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>  </span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/text1"</span>  </div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span>  </div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>  </div><div class="line">            <span class="attr">android:autoLink</span>=<span class="string">"all"</span>  </div><div class="line">            <span class="attr">android:text</span>=<span class="string">"@string/link_text_auto"</span>  </div><div class="line">            /&gt;</div></pre></td></tr></table></figure>
<h3 id="第二种，在文本中使用标签"><a href="#第二种，在文本中使用标签" class="headerlink" title="第二种，在文本中使用标签"></a>第二种，在文本中使用标签</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"link_text_manual"</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>text2:<span class="tag">&lt;/<span class="name">b</span>&gt;</span> This is some other   </div><div class="line">      text, with a <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.google.com"</span>&gt;</span>link<span class="tag">&lt;/<span class="name">a</span>&gt;</span> specified   </div><div class="line">      via an &amp;lt;a&amp;gt; tag.  Use a \"tel:\" URL   </div><div class="line">      to <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"tel:4155551212"</span>&gt;</span>dial a phone number<span class="tag">&lt;/<span class="name">a</span>&gt;</span>   </div><div class="line"><span class="tag">&lt;/<span class="name">string</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="第三种，和第二种其实是一样的，只不过将文本改在-JAVA-代码中"><a href="#第三种，和第二种其实是一样的，只不过将文本改在-JAVA-代码中" class="headerlink" title="第三种，和第二种其实是一样的，只不过将文本改在 JAVA 代码中"></a>第三种，和第二种其实是一样的，只不过将文本改在 JAVA 代码中</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">TextView t3 = (TextView) findViewById(R.id.text3);   </div><div class="line">t3.setText(   </div><div class="line">    Html.fromHtml(   </div><div class="line">         <span class="string">"&lt;b&gt;text3:&lt;/b&gt;  Text with a "</span> +   </div><div class="line">         <span class="string">"&lt;a href=\"http://www.google.com\"&gt;link&lt;/a&gt; "</span> +   </div><div class="line">         <span class="string">"created in the Java source code using HTML."</span>));   </div><div class="line">t3.setMovementMethod(LinkMovementMethod.getInstance());</div></pre></td></tr></table></figure>
<h3 id="第四种，前面三种可以说都是自动的，而第四种就是纯“手工”的了。"><a href="#第四种，前面三种可以说都是自动的，而第四种就是纯“手工”的了。" class="headerlink" title="第四种，前面三种可以说都是自动的，而第四种就是纯“手工”的了。"></a>第四种，前面三种可以说都是自动的，而第四种就是纯“手工”的了。</h3><p>通过创建 SpanableString 字符串，并在之上创建一个或多个 Span 来实现丰富的效果。例子如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">SpannableString ss = <span class="keyword">new</span> SpannableString(<span class="string">"text4: Click here to dial the phone."</span>);   </div><div class="line">ss.setSpan(<span class="keyword">new</span> StyleSpan(Typeface.BOLD), <span class="number">0</span>, <span class="number">6</span>,Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);   </div><div class="line">ss.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"tel:4155551212"</span>), <span class="number">13</span>, <span class="number">17</span>,Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);   </div><div class="line">  </div><div class="line">TextView t4 = (TextView) findViewById(R.id.text4);   </div><div class="line">t4.setText(ss);   </div><div class="line">t4.setMovementMethod(LinkMovementMethod.getInstance());</div></pre></td></tr></table></figure></p>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>.setMovementMethod，此方法在需要响应用户事件时使用，如点击一个电话号码就跳转到拨号页面。如果不执行这个方法是不会响应事件的，即便文本看着已经是下划线蓝色字了。<br>.Spanned.SPAN_EXCLUSIVE_EXCLUSIVE，这是在 setSpan 时需要指定的 flag，它是用来标识在 Span 范围内的文本前后输入新的字符时是否把它们也应用这个效果。分别有 Spanned.SPAN_EXCLUSIVE_EXCLUSIVE(前后都不包括)、Spanned.SPAN_INCLUSIVE_EXCLUSIVE(前面包括，后面不包括)、Spanned.SPAN_EXCLUSIVE_INCLUSIVE(前面不包括，后面包括)、Spanned.SPAN_INCLUSIVE_INCLUSIVE(前后都包括)。看个截图就更明白了：<br><img src="http://dl.iteye.com/upload/attachment/574419/af241334-006b-3802-9fbf-e9a2db760b3c.png" alt=""><br>对比<br><img src="http://dl.iteye.com/upload/attachment/574421/baca6fa7-7f00-38a7-9f46-94fd6bcb2296.png" alt=""></p>
<h2 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h2><blockquote>
<p>Android中一般情况下，TextView中的文本都是一个样式。实现对于TextView中各个部分的文本来设置字体，大小，颜色，样式，以及超级链接等属性。</p>
</blockquote>
<p>res-layout-main.xml:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;   </div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>  </span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span> <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span>&gt;   </div><div class="line"><span class="tag">&lt;<span class="name">TextView</span>     </span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/myTextView"</span>  </div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span>    </div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>    </div><div class="line">    /&gt;   </div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>res-color-color.xml<br>res-color-linkcolor.xml:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;   </div><div class="line"><span class="tag">&lt;<span class="name">selector</span>  <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span>   </div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_pressed</span>=<span class="string">"true"</span>  </span></div><div class="line">          <span class="attr">android:color</span>=<span class="string">"#ffffff00"</span>/&gt; <span class="comment">&lt;!-- pressed --&gt;</span>   </div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_focused</span>=<span class="string">"true"</span>  </span></div><div class="line">          <span class="attr">android:color</span>=<span class="string">"#ff00ffff"</span>/&gt; <span class="comment">&lt;!-- focused --&gt;</span>   </div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:color</span>=<span class="string">"#ff0ff000"</span>/&gt;</span> <span class="comment">&lt;!-- default --&gt;</span>   </div><div class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>TextViewLinkActivity.java类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.IOException;   </div><div class="line">  </div><div class="line"><span class="keyword">import</span> org.xmlpull.v1.XmlPullParserException;   </div><div class="line">  </div><div class="line"><span class="keyword">import</span> android.app.Activity;   </div><div class="line"><span class="keyword">import</span> android.content.res.ColorStateList;   </div><div class="line"><span class="keyword">import</span> android.content.res.XmlResourceParser;   </div><div class="line"><span class="keyword">import</span> android.graphics.Bitmap;   </div><div class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;   </div><div class="line"><span class="keyword">import</span> android.graphics.Color;   </div><div class="line"><span class="keyword">import</span> android.graphics.drawable.Drawable;   </div><div class="line"><span class="keyword">import</span> android.os.Bundle;   </div><div class="line"><span class="keyword">import</span> android.text.SpannableString;   </div><div class="line"><span class="keyword">import</span> android.text.Spanned;   </div><div class="line"><span class="keyword">import</span> android.text.method.LinkMovementMethod;   </div><div class="line"><span class="keyword">import</span> android.text.style.AbsoluteSizeSpan;   </div><div class="line"><span class="keyword">import</span> android.text.style.BackgroundColorSpan;   </div><div class="line"><span class="keyword">import</span> android.text.style.BulletSpan;   </div><div class="line"><span class="keyword">import</span> android.text.style.DrawableMarginSpan;   </div><div class="line"><span class="keyword">import</span> android.text.style.ForegroundColorSpan;   </div><div class="line"><span class="keyword">import</span> android.text.style.IconMarginSpan;   </div><div class="line"><span class="keyword">import</span> android.text.style.ImageSpan;   </div><div class="line"><span class="keyword">import</span> android.text.style.RelativeSizeSpan;   </div><div class="line"><span class="keyword">import</span> android.text.style.ScaleXSpan;   </div><div class="line"><span class="keyword">import</span> android.text.style.StrikethroughSpan;   </div><div class="line"><span class="keyword">import</span> android.text.style.StyleSpan;   </div><div class="line"><span class="keyword">import</span> android.text.style.SubscriptSpan;   </div><div class="line"><span class="keyword">import</span> android.text.style.SuperscriptSpan;   </div><div class="line"><span class="keyword">import</span> android.text.style.TextAppearanceSpan;   </div><div class="line"><span class="keyword">import</span> android.text.style.TypefaceSpan;   </div><div class="line"><span class="keyword">import</span> android.text.style.URLSpan;   </div><div class="line"><span class="keyword">import</span> android.text.style.UnderlineSpan;   </div><div class="line"><span class="keyword">import</span> android.widget.TextView;   </div><div class="line">  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TextViewLinkActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;   </div><div class="line">    TextView mTextView = <span class="keyword">null</span>;      </div><div class="line">    SpannableString msp = <span class="keyword">null</span>;     </div><div class="line">       </div><div class="line">    <span class="comment">/** Called when the activity is first created. */</span>  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;   </div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);   </div><div class="line">        setContentView(R.layout.main);   </div><div class="line">           </div><div class="line">        mTextView = (TextView)findViewById(R.id.myTextView);   </div><div class="line">           </div><div class="line">        <span class="comment">//创建一个 SpannableString对象     </span></div><div class="line">        msp = <span class="keyword">new</span> SpannableString(<span class="string">"字体测试字体大小一半两倍前景色背景色正常粗体斜体粗斜体下划线删除线x1x2电话邮件网站短信彩信地图X轴综合/bot"</span>);    </div><div class="line">           </div><div class="line">        <span class="comment">//设置字体(default,default-bold,monospace,serif,sans-serif)   </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> TypefaceSpan(<span class="string">"monospace"</span>), <span class="number">0</span>, <span class="number">2</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);   </div><div class="line">        msp.setSpan(<span class="keyword">new</span> TypefaceSpan(<span class="string">"serif"</span>), <span class="number">2</span>, <span class="number">4</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);   </div><div class="line">           </div><div class="line">        <span class="comment">//设置字体大小（绝对值,单位：像素）    </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> AbsoluteSizeSpan(<span class="number">20</span>), <span class="number">4</span>, <span class="number">6</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);   </div><div class="line">        msp.setSpan(<span class="keyword">new</span> AbsoluteSizeSpan(<span class="number">20</span>,<span class="keyword">true</span>), <span class="number">6</span>, <span class="number">8</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  <span class="comment">//第二个参数boolean dip，如果为true，表示前面的字体大小单位为dip，否则为像素，同上。   </span></div><div class="line">           </div><div class="line">        <span class="comment">//设置字体大小（相对值,单位：像素） 参数表示为默认字体大小的多少倍   </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> RelativeSizeSpan(<span class="number">0.5f</span>), <span class="number">8</span>, <span class="number">10</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  <span class="comment">//0.5f表示默认字体大小的一半   </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> RelativeSizeSpan(<span class="number">2.0f</span>), <span class="number">10</span>, <span class="number">12</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  <span class="comment">//2.0f表示默认字体大小的两倍   </span></div><div class="line">           </div><div class="line">        <span class="comment">//设置字体前景色   </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> ForegroundColorSpan(Color.MAGENTA), <span class="number">12</span>, <span class="number">15</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  <span class="comment">//设置前景色为洋红色   </span></div><div class="line">           </div><div class="line">        <span class="comment">//设置字体背景色   </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> BackgroundColorSpan(Color.CYAN), <span class="number">15</span>, <span class="number">18</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  <span class="comment">//设置背景色为青色   </span></div><div class="line">        </div><div class="line">        <span class="comment">//设置字体样式正常，粗体，斜体，粗斜体   </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> StyleSpan(android.graphics.Typeface.NORMAL), <span class="number">18</span>, <span class="number">20</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  <span class="comment">//正常   </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> StyleSpan(android.graphics.Typeface.BOLD), <span class="number">20</span>, <span class="number">22</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  <span class="comment">//粗体   </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> StyleSpan(android.graphics.Typeface.ITALIC), <span class="number">22</span>, <span class="number">24</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  <span class="comment">//斜体   </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> StyleSpan(android.graphics.Typeface.BOLD_ITALIC), <span class="number">24</span>, <span class="number">27</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);  <span class="comment">//粗斜体   </span></div><div class="line">           </div><div class="line">        <span class="comment">//设置下划线   </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> UnderlineSpan(), <span class="number">27</span>, <span class="number">30</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);   </div><div class="line">           </div><div class="line">        <span class="comment">//设置删除线   </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> StrikethroughSpan(), <span class="number">30</span>, <span class="number">33</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);   </div><div class="line">           </div><div class="line">        <span class="comment">//设置上下标   </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> SubscriptSpan(), <span class="number">34</span>, <span class="number">35</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);     <span class="comment">//下标      </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> SuperscriptSpan(), <span class="number">36</span>, <span class="number">37</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);   <span class="comment">//上标               </span></div><div class="line">           </div><div class="line">        <span class="comment">//超级链接（需要添加setMovementMethod方法附加响应）   </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"tel:4155551212"</span>), <span class="number">37</span>, <span class="number">39</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);     <span class="comment">//电话      </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"mailto:webmaster@google.com"</span>), <span class="number">39</span>, <span class="number">41</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);     <span class="comment">//邮件      </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"http://www.baidu.com"</span>), <span class="number">41</span>, <span class="number">43</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);     <span class="comment">//网络      </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"sms:4155551212"</span>), <span class="number">43</span>, <span class="number">45</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);     <span class="comment">//短信   使用sms:或者smsto:   </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"mms:4155551212"</span>), <span class="number">45</span>, <span class="number">47</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);     <span class="comment">//彩信   使用mms:或者mmsto:   </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"geo:38.899533,-77.036476"</span>), <span class="number">47</span>, <span class="number">49</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);     <span class="comment">//地图      </span></div><div class="line">           </div><div class="line">        <span class="comment">//设置字体大小（相对值,单位：像素） 参数表示为默认字体宽度的多少倍   </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> ScaleXSpan(<span class="number">2.0f</span>), <span class="number">49</span>, <span class="number">51</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">//2.0f表示默认字体宽度的两倍，即X轴方向放大为默认字体的两倍，而高度不变   </span></div><div class="line">           </div><div class="line">        <span class="comment">//设置字体（依次包括字体名称，字体大小，字体样式，字体颜色，链接颜色）   </span></div><div class="line">        ColorStateList csllink = <span class="keyword">null</span>;   </div><div class="line">        ColorStateList csl = <span class="keyword">null</span>;   </div><div class="line">        XmlResourceParser xppcolor=getResources().getXml (R.color.color);   </div><div class="line">        <span class="keyword">try</span> &#123;   </div><div class="line">            csl= ColorStateList.createFromXml(getResources(),xppcolor);   </div><div class="line">        &#125;<span class="keyword">catch</span>(XmlPullParserException e)&#123;   </div><div class="line">            <span class="comment">// <span class="doctag">TODO:</span> handle exception   </span></div><div class="line">            e.printStackTrace();           </div><div class="line">        &#125;<span class="keyword">catch</span>(IOException e)&#123;   </div><div class="line">            <span class="comment">// <span class="doctag">TODO:</span> handle exception   </span></div><div class="line">            e.printStackTrace();           </div><div class="line">        &#125;   </div><div class="line">  </div><div class="line">        XmlResourceParser xpplinkcolor=getResources().getXml(R.color.linkcolor);   </div><div class="line">        <span class="keyword">try</span> &#123;   </div><div class="line">            csllink= ColorStateList.createFromXml(getResources(),xpplinkcolor);   </div><div class="line">        &#125;<span class="keyword">catch</span>(XmlPullParserException e)&#123;   </div><div class="line">            <span class="comment">// <span class="doctag">TODO:</span> handle exception   </span></div><div class="line">            e.printStackTrace();           </div><div class="line">        &#125;<span class="keyword">catch</span>(IOException e)&#123;   </div><div class="line">            <span class="comment">// <span class="doctag">TODO:</span> handle exception   </span></div><div class="line">            e.printStackTrace();           </div><div class="line">        &#125;   </div><div class="line">        msp.setSpan(<span class="keyword">new</span> TextAppearanceSpan(<span class="string">"monospace"</span>,android.graphics.Typeface.BOLD_ITALIC, <span class="number">30</span>, csl, csllink), <span class="number">51</span>, <span class="number">53</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);    </div><div class="line">        </div><div class="line">        <span class="comment">//设置项目符号   </span></div><div class="line">        msp.setSpan(<span class="keyword">new</span> BulletSpan(android.text.style.BulletSpan.STANDARD_GAP_WIDTH,Color.GREEN), <span class="number">0</span> ,msp.length(), Spanned.SPAN_EXCLUSIVE_EXCLUSIVE); <span class="comment">//第一个参数表示项目符号占用的宽度，第二个参数为项目符号的颜色   </span></div><div class="line">  </div><div class="line">        <span class="comment">//设置图片   </span></div><div class="line">        Drawable drawable = getResources().getDrawable(R.drawable.icon);    </div><div class="line">        drawable.setBounds(<span class="number">0</span>, <span class="number">0</span>, drawable.getIntrinsicWidth(), drawable.getIntrinsicHeight());     </div><div class="line">        msp.setSpan(<span class="keyword">new</span> ImageSpan(drawable), <span class="number">53</span>, <span class="number">57</span>, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);   </div><div class="line">           </div><div class="line">        mTextView.setText(msp);   </div><div class="line">        mTextView.setMovementMethod(LinkMovementMethod.getInstance());    </div><div class="line">    &#125;   </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>效果预览<br><img src="http://dl.iteye.com/upload/attachment/574409/368eff70-10ae-393c-8e00-e94ee213c1a2.png" alt=""></p>
<h2 id="常用的属性"><a href="#常用的属性" class="headerlink" title="常用的属性"></a>常用的属性</h2><ul>
<li>1、BackgroundColorSpan 背景色 </li>
<li>2、ClickableSpan 文本可点击，有点击事件</li>
<li>3、ForegroundColorSpan 文本颜色（前景色）</li>
<li>4、MaskFilterSpan 修饰效果，如模糊(BlurMaskFilter)、浮雕(EmbossMaskFilter)</li>
<li>5、MetricAffectingSpan 父类，一般不用</li>
<li>6、RasterizerSpan 光栅效果</li>
<li>7、StrikethroughSpan 删除线（中划线）</li>
<li>8、SuggestionSpan 相当于占位符</li>
<li>9、UnderlineSpan 下划线</li>
<li>10、AbsoluteSizeSpan 绝对大小（文本字体）</li>
<li>11、DynamicDrawableSpan 设置图片，基于文本基线或底部对齐。</li>
<li>12、ImageSpan 图片</li>
<li>13、RelativeSizeSpan 相对大小（文本字体）</li>
<li>14、ReplacementSpan 父类，一般不用</li>
<li>15、ScaleXSpan 基于x轴缩放</li>
<li>16、StyleSpan 字体样式：粗体、斜体等</li>
<li>17、SubscriptSpan 下标（数学公式会用到）</li>
<li>18、SuperscriptSpan 上标（数学公式会用到）</li>
<li>19、TextAppearanceSpan 文本外貌（包括字体、大小、样式和颜色）</li>
<li>20、TypefaceSpan 文本字体</li>
<li>21、URLSpan 文本超链接<h3 id="使用示例-1"><a href="#使用示例-1" class="headerlink" title="使用示例"></a>使用示例</h3>1、BackgroundColorSpan 背景色<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SpannableString spanText = <span class="keyword">new</span> SpannableString(<span class="string">"萝卜白菜的博客 -- http://orgcent.com"</span>);</div><div class="line">spanText.setSpan(<span class="keyword">new</span> BackgroundColorSpan(Color.GREEN), <span class="number">0</span>, spanText.length(),</div><div class="line">Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line">mTVText.append(<span class="string">"\n"</span>);</div><div class="line">mTVText.append(spanText);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>2、ClickableSpan 文本可点击，有点击事件(见本文前半部分)</p>
<p>3、ForegroundColorSpan 文本颜色（前景色）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">spanText = <span class="keyword">new</span> SpannableString(<span class="string">"萝卜白菜的博客 -- http://orgcent.com"</span>);</div><div class="line">spanText.setSpan(<span class="keyword">new</span> ForegroundColorSpan(Color.BLUE), <span class="number">6</span>, spanText.length(),</div><div class="line">Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line">mTVText.append(<span class="string">"\n"</span>);</div><div class="line">mTVText.append(spanText);</div></pre></td></tr></table></figure></p>
<p>4、MaskFilterSpan 修饰效果，如模糊(BlurMaskFilter)、浮雕(EmbossMaskFilter)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">spanText = <span class="keyword">new</span> SpannableString(<span class="string">"MaskFilterSpan -- http://orgcent.com"</span>);</div><div class="line"><span class="keyword">int</span> length = spanText.length();</div><div class="line"><span class="comment">//模糊(BlurMaskFilter)</span></div><div class="line">MaskFilterSpan maskFilterSpan = <span class="keyword">new</span> MaskFilterSpan(<span class="keyword">new</span> BlurMaskFilter(<span class="number">3</span>, Blur.OUTER));</div><div class="line">spanText.setSpan(maskFilterSpan, <span class="number">0</span>, length - <span class="number">10</span>, Spannable.</div><div class="line">SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line"><span class="comment">//浮雕(EmbossMaskFilter)</span></div><div class="line">maskFilterSpan = <span class="keyword">new</span> MaskFilterSpan(<span class="keyword">new</span> EmbossMaskFilter(<span class="keyword">new</span> <span class="keyword">float</span>[]&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">3</span>&#125;, <span class="number">1.5f</span>, <span class="number">8</span>, <span class="number">3</span>));</div><div class="line">spanText.setSpan(maskFilterSpan, length - <span class="number">10</span>, length, Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line">mTVText.append(<span class="string">"\n"</span>);</div><div class="line">mTVText.append(spanText);</div></pre></td></tr></table></figure></p>
<p>PS:从上图看，浮雕效果不明显。把字体设置大点后可以看得清晰些。需要其他效果可以继承MaskFilter来自定义。</p>
<p>6、RasterizerSpan 光栅效果<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">spanText = <span class="keyword">new</span> SpannableString(<span class="string">"StrikethroughSpan"</span>);</div><div class="line">spanText.setSpan(<span class="keyword">new</span> StrikethroughSpan(), <span class="number">0</span>, <span class="number">7</span>, Spannable.</div><div class="line">SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line">mTVText.append(<span class="string">"\n"</span>);</div><div class="line">mTVText.append(spanText);</div></pre></td></tr></table></figure></p>
<p>PS:暂不清楚，效果不明显。</p>
<p>7、StrikethroughSpan 删除线（中划线）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">spanText = <span class="keyword">new</span> SpannableString(<span class="string">"StrikethroughSpan"</span>);</div><div class="line">spanText.setSpan(<span class="keyword">new</span> StrikethroughSpan(), <span class="number">0</span>, <span class="number">7</span>, Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line">mTVText.append(<span class="string">"\n"</span>);</div><div class="line">mTVText.append(spanText);</div></pre></td></tr></table></figure></p>
<p>8、SuggestionSpan<br>相当于占位符，一般用在EditText输入框中。当双击此文本时，会弹出提示框选择一些建议（推荐的）文字，选中的文本将替换此占位符。在输入法上用的较多。<br>PS：API 14新增，暂无示例。</p>
<p>9、UnderlineSpan 下划线<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">spanText = <span class="keyword">new</span> SpannableString(<span class="string">"UnderlineSpan"</span>);</div><div class="line">spanText.setSpan(<span class="keyword">new</span> UnderlineSpan(), <span class="number">0</span>, spanText.length(),</div><div class="line">Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line">mTVText.append(<span class="string">"\n"</span>);</div><div class="line">mTVText.append(spanText);</div></pre></td></tr></table></figure></p>
<p>10、AbsoluteSizeSpan 绝对大小（文本字体）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">spanText = <span class="keyword">new</span> SpannableString(<span class="string">"AbsoluteSizeSpan"</span>);</div><div class="line">spanText.setSpan(<span class="keyword">new</span> AbsoluteSizeSpan(<span class="number">20</span>, <span class="keyword">true</span>), <span class="number">0</span>, spanText.length(),</div><div class="line">Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line">mTVText.append(<span class="string">"\n"</span>);</div><div class="line">mTVText.append(spanText);</div></pre></td></tr></table></figure></p>
<p>PS:把字体大小设置大点，效果硬朗。</p>
<p>11、DynamicDrawableSpan 设置图片，基于文本基线或底部对齐。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">DynamicDrawableSpan drawableSpan =</div><div class="line"> <span class="keyword">new</span> DynamicDrawableSpan(DynamicDrawableSpan.ALIGN_BASELINE) &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Drawable <span class="title">getDrawable</span><span class="params">()</span> </span>&#123;</div><div class="line">        Drawable d = getResources().getDrawable(R.drawable.ic_launcher);</div><div class="line">        d.setBounds(<span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">50</span>);</div><div class="line">        <span class="keyword">return</span> d;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line">DynamicDrawableSpan drawableSpan2 = <span class="keyword">new</span> DynamicDrawableSpan(</div><div class="line">DynamicDrawableSpan.ALIGN_BOTTOM) &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Drawable <span class="title">getDrawable</span><span class="params">()</span> </span>&#123;</div><div class="line">          Drawable d = getResources().getDrawable(R.drawable.ic_launcher);</div><div class="line">          d.setBounds(<span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">50</span>);</div><div class="line">                <span class="keyword">return</span> d;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">spanText.setSpan(drawableSpan, <span class="number">3</span>, <span class="number">4</span>, Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line">spanText.setSpan(drawableSpan2, <span class="number">7</span>, <span class="number">8</span>, Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line">mTVText.append(<span class="string">"\n"</span>);</div><div class="line">mTVText.append(spanText);</div></pre></td></tr></table></figure></p>
<p>PS:左边图片基于基线对齐，右边图片基于底部对齐</p>
<p>12、ImageSpan 图片<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">spanText = new SpannableString("ImageSpan");</div><div class="line">Drawable d = getResources().getDrawable(R.drawable.ic_launcher);</div><div class="line">&lt;/strong&gt;d.setBounds(0, 0, 50, 50);</div><div class="line">spanText.setSpan(new ImageSpan(d), 3, 4, Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line">mTVText.append("\n");</div><div class="line">mTVText.append(spanText);</div></pre></td></tr></table></figure></p>
<p>PS:和DynamicDrawableSpan差别不大</p>
<p>13、RelativeSizeSpan 相对大小（文本字体）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">spanText = <span class="keyword">new</span> SpannableString(<span class="string">"RelativeSizeSpan"</span>);</div><div class="line"><span class="comment">//参数proportion:比例大小</span></div><div class="line">spanText.setSpan(<span class="keyword">new</span> RelativeSizeSpan(<span class="number">2.5f</span>), <span class="number">3</span>, <span class="number">4</span>,</div><div class="line">Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line">mTVText.append(<span class="string">"\n"</span>);</div><div class="line">mTVText.append(spanText);</div></pre></td></tr></table></figure></p>
<p>PS:相对大小的比例是基于当前文本字体大小</p>
<p>15、ScaleXSpan 基于x轴缩放<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">spanText = <span class="keyword">new</span> SpannableString(<span class="string">"ScaleXSpan -- 萝卜白菜的博客"</span>);</div><div class="line"><span class="comment">//参数proportion:比例大小</span></div><div class="line">spanText.setSpan(<span class="keyword">new</span> ScaleXSpan(<span class="number">3.8f</span>), <span class="number">3</span>, <span class="number">7</span>, Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line">mTVText.append(<span class="string">"\n"</span>);</div><div class="line">mTVText.append(spanText);</div></pre></td></tr></table></figure></p>
<p>16、StyleSpan 字体样式：粗体、斜体等<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">spanText = <span class="keyword">new</span> SpannableString(<span class="string">"StyleSpan -- 萝卜白菜的博客"</span>);</div><div class="line"><span class="comment">//Typeface.BOLD_ITALIC:粗体+斜体</span></div><div class="line">spanText.setSpan(<span class="keyword">new</span> StyleSpan(Typeface.BOLD_ITALIC), <span class="number">3</span>, <span class="number">7</span>,</div><div class="line">Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line">mTVText.append(<span class="string">"\n"</span>);</div><div class="line">mTVText.append(spanText);</div></pre></td></tr></table></figure></p>
<p>17、SubscriptSpan 下标（数学公式会用到）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">spanText = <span class="keyword">new</span> SpannableString(<span class="string">"SubscriptSpan -- 萝卜白菜的博客"</span>);</div><div class="line">spanText.setSpan(<span class="keyword">new</span> SubscriptSpan(), <span class="number">6</span>, <span class="number">7</span>, Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line">mTVText.append(<span class="string">"\n"</span>);</div><div class="line">mTVText.append(spanText);</div></pre></td></tr></table></figure></p>
<p>18、SuperscriptSpan 上标（数学公式会用到）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">spanText = <span class="keyword">new</span> SpannableString(<span class="string">"SuperscriptSpan -- 萝卜白菜的博客"</span>);</div><div class="line">spanText.setSpan(<span class="keyword">new</span> SuperscriptSpan(), <span class="number">6</span>, <span class="number">7</span>, Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line">mTVText.append(<span class="string">"\n"</span>);</div><div class="line">mTVText.append(spanText);</div></pre></td></tr></table></figure></p>
<p>19、TextAppearanceSpan 文本外貌（包括字体、大小、样式和颜色）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">spanText = <span class="keyword">new</span> SpannableString(<span class="string">"TextAppearanceSpan -- 萝卜白菜的博客"</span>);</div><div class="line"><span class="comment">//若需自定义TextAppearance，可以在系统样式上进行修改</span></div><div class="line">spanText.setSpan(<span class="keyword">new</span> TextAppearanceSpan(<span class="keyword">this</span>, android.R.style.TextAppearance_Medium),</div><div class="line"> <span class="number">6</span>, <span class="number">7</span>, Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line">mTVText.append(<span class="string">"\n"</span>);</div><div class="line">mTVText.append(spanText);</div></pre></td></tr></table></figure></p>
<p>PS:系统还提供了相关值TextAppearance_Small, TextAppearance_Large等。如有需要可在以上样式基础上修改。</p>
<p>20、TypefaceSpan 文本字体<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">spanText = <span class="keyword">new</span> SpannableString(<span class="string">"TypefaceSpan -- 萝卜白菜的博客"</span>);</div><div class="line"><span class="comment">//若需使用自定义字体，可能要重写类TypefaceSpan</span></div><div class="line">spanText.setSpan(<span class="keyword">new</span> TypefaceSpan(<span class="string">"monospace"</span>), <span class="number">3</span>, <span class="number">10</span>,</div><div class="line">Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line">mTVText.append(<span class="string">"\n"</span>);</div><div class="line">mTVText.append(spanText);</div></pre></td></tr></table></figure></p>
<p>PS:关于自定义字体的设置，后面将介绍如何使用</p>
<p>21、URLSpan 文本超链接<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">spanText = <span class="keyword">new</span> SpannableString(<span class="string">"URLSpan -- 萝卜白菜的博客"</span>);</div><div class="line">spanText.setSpan(<span class="keyword">new</span> URLSpan(<span class="string">"http://orgcent.com"</span>), <span class="number">10</span>, spanText.length(),</div><div class="line">Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</div><div class="line">mTVText.append(<span class="string">"\n"</span>);</div><div class="line">mTVText.append(spanText);</div><div class="line"><span class="comment">//让URLSpan可以点击</span></div><div class="line">mTVText.setMovementMethod(<span class="keyword">new</span> LinkMovementMethod());</div></pre></td></tr></table></figure></p>
<h3 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h3><p><img src="http://orgcent.com/wp-content/uploads/2012/04/textview_spannablestring.jpg" alt=""></p>
<h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ul>
<li><a href="http://www.iteedu.com/handset/android/spannablediary/intro.php" target="_blank" rel="external">Spannable简介</a></li>
<li><a href="http://hunankeda110.iteye.com/blog/1420470" target="_blank" rel="external">android中的spannable的使用</a></li>
<li><a href="http://www.cnblogs.com/jisheng/archive/2013/01/10/2854088.html" target="_blank" rel="external">TextView使用SpannableString设置复合文本</a></li>
<li><a href="http://blog.csdn.net/yang_hui1986527/article/details/6776629" target="_blank" rel="external">TextView通过SpannableString来设置超链接、颜色、字体等属性</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/10/android_spannable/" data-id="cj4zx2kiq003nqonha1u7q6l9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spannable/">spannable</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_eventbus" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/10/android_eventbus/" class="article-date">
  <time datetime="2015-11-10T02:48:29.000Z" itemprop="datePublished">2015-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/android/">android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/10/android_eventbus/">Android事件总线之EventBus</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>EventBus是一款针对Android优化的发布/订阅事件总线。主要功能是使用观察者模式替代Intent,Handler,BroadCast在Fragment，Activity，Service，线程之间传递消息.优点是开销小，代码更优雅。以及将发送者和接收者解耦。</p>
<ul>
<li>支持在不同类型的线程中处理订阅，包括发布所在线程，UI线程、单一后台线程、异步线程</li>
<li>支持事件优先级定义，支持优先级高的订阅者取消事件继续传递，支持粘性事件，跟系统的有序广播、粘性广播很像</li>
<li>不是基于annotations</li>
<li>性能更优</li>
<li>体积小</li>
<li>支持单例创建或创建多个对象</li>
<li>支持根据事件类型订阅</li>
</ul>
<p><strong> 概念图</strong><br><img src="http://www.carrotsight.com/wp-content/uploads/2015/10/eventbus_concept.png" alt=""></p>
<p><strong> 特点</strong><br>“事件”是一个POJO，根据自己需要自己随便定义的一个JAVA类，包含需要传递给其他组件的信息。<br>事件发布者不需要注册，直接使用EventBus.getDefault().post(new TextEvent(“我有一头小毛驴”))。其中TextEvent是一个自定义类。<br>事件订阅者（接受者、处理者）需要在onCreate()方法中通过EventBus.getDefault().register(this)注册自己，在onDestroy()方法中通过EventBus.getDefault().unregister(this)取消注册。同时，需要至少实现4种onEventXXX方法中的一种。</p>
<p>支持4种事件响应模式：</p>
<ul>
<li>MainThread：对应的响应函数写法为onEventMainThread，事件响应函数会在Android应用的主线程(大部分情况下都是UI线程)中执行。</li>
<li>PostThread：对应的响应函数写法为onEvent，即默认的处理方式就是post方式。事件响应函数和事件发布在同一线程中执行。这个是默认值，这样可以避免线程切换。</li>
<li>BackgroundThread：对应的响应函数写法为onEventBackgroundThread，事件响应函数会在一个后台线程中执行。如果事件发布函数不是在主线程中，则会立即在事件发布线程中执行响应函数。如果事件发布函数在主线程中，EventBus则会在唯一的一个后台线程中按照顺序来执行所有的后台事件响应函数。</li>
<li>Async：对应的响应函数写法为onEventAsync，每接收到一个事件都会开启一个异步线程执行。</li>
</ul>
<p>前3种响应函数都要求其中不能有耗时操作，防止UI更新、事件分发或新事件的处理等操作被阻塞。</p>
<p>通过实验，如果在同一个订阅者中对同一个事件同时注册了这4种响应函数，则控制台打印的时间处理函数顺序为 :<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">onEvent()-&gt;onEventMainThread()-&gt;onEventAsync()-&gt;onEventBackgroundThread()</div></pre></td></tr></table></figure></p>
<p>或<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">onEvent()-&gt;onEventMainThread()-&gt;onEventBackgroundThread()-&gt;onEventAsync()</div></pre></td></tr></table></figure></p>
<p>由于onEventBackgroundThread（）和onEventAsync（）都是在后台线程执行的，包括在控制台打印函数名的操作，所以此顺序不一定就是这几个函数被触发的顺序。</p>
<h2 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h2><p>1、下载EventBus的类库: <a href="https://github.com/greenrobot/EventBus" target="_blank" rel="external">EventBus源码下载</a></p>
<p>2、基本使用</p>
<p>（1）自定义一个类，可以是空类，比如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnyEventType</span> </span>&#123;  </div><div class="line">     <span class="function"><span class="keyword">public</span> <span class="title">AnyEventType</span><span class="params">()</span></span>&#123;&#125;  </div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<p>（2）在要接收消息的页面注册：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">eventBus.register(<span class="keyword">this</span>);</div></pre></td></tr></table></figure></p>
<p>（3）发送消息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">eventBus.post(new AnyEventType event);</div></pre></td></tr></table></figure></p>
<p>（4）接受消息的页面实现(共有四个函数，各功能不同，这是其中之一，可以选择性的实现，这里先实现一个)：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(AnyEventType event)</span> </span>&#123;&#125;</div></pre></td></tr></table></figure></p>
<p>（5）解除注册<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">eventBus.unregister(<span class="keyword">this</span>);</div></pre></td></tr></table></figure></p>
<p>以上就是使用的基本流程和步骤，下面举个例子来说明下。</p>
<blockquote>
<p>首先，在EventBus中，获取实例的方法一般是采用EventBus.getInstance()来获取默认的EventBus实例，当然你也可以new实现，个人感觉还是用默认的比较好，以防出错。<br><img src="http://img.blog.csdn.net/20141102142444304" alt=""></p>
</blockquote>
<h2 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h2><blockquote>
<p>当击btn_try按钮的时候，跳到第二个Activity，当点击第二个activity上面的First Event按钮的时候向第一个Activity发送消息，当第一个Activity收到消息后，一方面将消息Toast显示，一方面放入textView中显示。</p>
</blockquote>
<p>按照下面的步骤，下面来建这个工程：</p>
<h3 id="1、基本框架搭建"><a href="#1、基本框架搭建" class="headerlink" title="1、基本框架搭建"></a>1、基本框架搭建</h3><p>想必大家从一个Activity跳转到第二个Activity的程序应该都会写，这里先稍稍把两个Activity跳转的代码建起来。后面再添加EventBus相关的玩意。</p>
<p>MainActivity布局（activity_main.xml）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>  </span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span>  </div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span>  </div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>  </div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;  </div><div class="line">      </div><div class="line">    <span class="tag">&lt;<span class="name">Button</span>   </span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/btn_try"</span>  </div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span>  </div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>  </div><div class="line">        <span class="attr">android:text</span>=<span class="string">"btn_bty"</span>/&gt;  </div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span>   </span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/tv"</span>  </div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span>  </div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>/&gt;  </div><div class="line">  </div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>新建一个Activity，SecondActivity布局（activity_second.xml）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>  </span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span>  </div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span>  </div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>  </div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>  </div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"com.harvic.try_eventbus_1.SecondActivity"</span> &gt;  </div><div class="line">  </div><div class="line">    <span class="tag">&lt;<span class="name">Button</span>   </span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/btn_first_event"</span>  </div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span>  </div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>  </div><div class="line">        <span class="attr">android:text</span>=<span class="string">"First Event"</span>/&gt;  </div><div class="line">  </div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>MainActivity.java （点击btn跳转到第二个Activity）<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;  </div><div class="line">  </div><div class="line">    Button btn;  </div><div class="line">  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);  </div><div class="line">        setContentView(R.layout.activity_main);  </div><div class="line">  </div><div class="line">        btn = (Button) findViewById(R.id.btn_try);  </div><div class="line">  </div><div class="line">        btn.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;  </div><div class="line">  </div><div class="line">            <span class="meta">@Override</span>  </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;  </div><div class="line">                <span class="comment">// TODO Auto-generated method stub  </span></div><div class="line">                Intent intent = <span class="keyword">new</span> Intent(getApplicationContext(),  </div><div class="line">                        SecondActivity.class);  </div><div class="line">                startActivity(intent);  </div><div class="line">            &#125;  </div><div class="line">        &#125;);  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>到这，基本框架就搭完了，下面开始按步骤使用EventBus了。</p>
<h3 id="2、新建一个类FirstEvent"><a href="#2、新建一个类FirstEvent" class="headerlink" title="2、新建一个类FirstEvent"></a>2、新建一个类FirstEvent</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.harvic.other;  </div><div class="line">  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstEvent</span> </span>&#123;  </div><div class="line">  </div><div class="line">    <span class="keyword">private</span> String mMsg;  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FirstEvent</span><span class="params">(String msg)</span> </span>&#123;  </div><div class="line">        <span class="comment">// TODO Auto-generated constructor stub  </span></div><div class="line">        mMsg = msg;  </div><div class="line">    &#125;  </div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span></span>&#123;  </div><div class="line">        <span class="keyword">return</span> mMsg;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个类很简单，构造时传进去一个字符串，然后可以通过getMsg()获取出来。</p>
<h3 id="3、在要接收消息的页面注册EventBus："><a href="#3、在要接收消息的页面注册EventBus：" class="headerlink" title="3、在要接收消息的页面注册EventBus："></a>3、在要接收消息的页面注册EventBus：</h3><p>在上面的GIF图片的演示中，大家也可以看到，我们是要在MainActivity中接收发过来的消息的，所以我们在MainActivity中注册消息。</p>
<p>通过我们会在OnCreate()函数中注册EventBus，在OnDestroy（）函数中反注册。所以整体的注册与反注册的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.tryeventbus_simple;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> com.harvic.other.FirstEvent;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> de.greenrobot.event.EventBus;  </div><div class="line"><span class="keyword">import</span> android.app.Activity;  </div><div class="line"><span class="keyword">import</span> android.content.Intent;  </div><div class="line"><span class="keyword">import</span> android.os.Bundle;  </div><div class="line"><span class="keyword">import</span> android.util.Log;  </div><div class="line"><span class="keyword">import</span> android.view.View;  </div><div class="line"><span class="keyword">import</span> android.widget.Button;  </div><div class="line"><span class="keyword">import</span> android.widget.TextView;  </div><div class="line"><span class="keyword">import</span> android.widget.Toast;  </div><div class="line">  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;  </div><div class="line">  </div><div class="line">    Button btn;  </div><div class="line">    TextView tv;  </div><div class="line">  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);  </div><div class="line">        setContentView(R.layout.activity_main);  </div><div class="line">                <span class="comment">//注册EventBus  </span></div><div class="line">        EventBus.getDefault().register(<span class="keyword">this</span>);  </div><div class="line">  </div><div class="line">        btn = (Button) findViewById(R.id.btn_try);  </div><div class="line">        tv = (TextView)findViewById(R.id.tv);  </div><div class="line">  </div><div class="line">        btn.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;  </div><div class="line">  </div><div class="line">            <span class="meta">@Override</span>  </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;  </div><div class="line">                <span class="comment">// TODO Auto-generated method stub  </span></div><div class="line">                Intent intent = <span class="keyword">new</span> Intent(getApplicationContext(),  </div><div class="line">                        SecondActivity.class);  </div><div class="line">                startActivity(intent);  </div><div class="line">            &#125;  </div><div class="line">        &#125;);  </div><div class="line">    &#125;  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span></span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onDestroy();  </div><div class="line">        EventBus.getDefault().unregister(<span class="keyword">this</span>);<span class="comment">//反注册EventBus  </span></div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4、发送消息"><a href="#4、发送消息" class="headerlink" title="4、发送消息"></a>4、发送消息</h3><p>发送消息是使用EventBus中的Post方法来实现发送的，发送过去的是我们新建的类的实例！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">EventBus.getDefault().post(<span class="keyword">new</span> FirstEvent(<span class="string">"FirstEvent btn clicked"</span>));</div></pre></td></tr></table></figure>
<p>完整的SecondActivity.java的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.tryeventbus_simple;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> com.harvic.other.FirstEvent;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> de.greenrobot.event.EventBus;  </div><div class="line"><span class="keyword">import</span> android.app.Activity;  </div><div class="line"><span class="keyword">import</span> android.os.Bundle;  </div><div class="line"><span class="keyword">import</span> android.view.View;  </div><div class="line"><span class="keyword">import</span> android.widget.Button;  </div><div class="line">  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;  </div><div class="line">    <span class="keyword">private</span> Button btn_FirstEvent;  </div><div class="line">  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);  </div><div class="line">        setContentView(R.layout.activity_second);  </div><div class="line">        btn_FirstEvent = (Button) findViewById(R.id.btn_first_event);  </div><div class="line">  </div><div class="line">        btn_FirstEvent.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;  </div><div class="line">  </div><div class="line">            <span class="meta">@Override</span>  </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;  </div><div class="line">                <span class="comment">// TODO Auto-generated method stub  </span></div><div class="line">                EventBus.getDefault().post(  </div><div class="line">                        <span class="keyword">new</span> FirstEvent(<span class="string">"FirstEvent btn clicked"</span>));  </div><div class="line">            &#125;  </div><div class="line">        &#125;);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="5、接收消息"><a href="#5、接收消息" class="headerlink" title="5、接收消息"></a>5、接收消息</h3><p>接收消息时，我们使用EventBus中最常用的onEventMainThread（）函数来接收消息，具体为什么用这个，我们下篇再讲，这里先给大家一个初步认识，要先能把EventBus用起来先。</p>
<p>在MainActivity中重写onEventMainThread（FirstEvent event），参数就是我们自己定义的类：</p>
<p>在收到Event实例后，我们将其中携带的消息取出，一方面Toast出去，一方面传到TextView中；<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEventMainThread</span><span class="params">(FirstEvent event)</span> </span>&#123;  </div><div class="line">  </div><div class="line">    String msg = <span class="string">"onEventMainThread收到了消息："</span> + event.getMsg();  </div><div class="line">    Log.d(<span class="string">"harvic"</span>, msg);  </div><div class="line">    tv.setText(msg);  </div><div class="line">    Toast.makeText(<span class="keyword">this</span>, msg, Toast.LENGTH_LONG).show();  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>完整的MainActiviy代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.tryeventbus_simple;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> com.harvic.other.FirstEvent;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> de.greenrobot.event.EventBus;  </div><div class="line"><span class="keyword">import</span> android.app.Activity;  </div><div class="line"><span class="keyword">import</span> android.content.Intent;  </div><div class="line"><span class="keyword">import</span> android.os.Bundle;  </div><div class="line"><span class="keyword">import</span> android.util.Log;  </div><div class="line"><span class="keyword">import</span> android.view.View;  </div><div class="line"><span class="keyword">import</span> android.widget.Button;  </div><div class="line"><span class="keyword">import</span> android.widget.TextView;  </div><div class="line"><span class="keyword">import</span> android.widget.Toast;  </div><div class="line">  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;  </div><div class="line">  </div><div class="line">    Button btn;  </div><div class="line">    TextView tv;  </div><div class="line">  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);  </div><div class="line">        setContentView(R.layout.activity_main);  </div><div class="line">  </div><div class="line">        EventBus.getDefault().register(<span class="keyword">this</span>);  </div><div class="line">  </div><div class="line">        btn = (Button) findViewById(R.id.btn_try);  </div><div class="line">        tv = (TextView)findViewById(R.id.tv);  </div><div class="line">  </div><div class="line">        btn.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;  </div><div class="line">  </div><div class="line">            <span class="meta">@Override</span>  </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;  </div><div class="line">                <span class="comment">// TODO Auto-generated method stub  </span></div><div class="line">                Intent intent = <span class="keyword">new</span> Intent(getApplicationContext(),  </div><div class="line">                        SecondActivity.class);  </div><div class="line">                startActivity(intent);  </div><div class="line">            &#125;  </div><div class="line">        &#125;);  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEventMainThread</span><span class="params">(FirstEvent event)</span> </span>&#123;  </div><div class="line">  </div><div class="line">        String msg = <span class="string">"onEventMainThread收到了消息："</span> + event.getMsg();  </div><div class="line">        Log.d(<span class="string">"harvic"</span>, msg);  </div><div class="line">        tv.setText(msg);  </div><div class="line">        Toast.makeText(<span class="keyword">this</span>, msg, Toast.LENGTH_LONG).show();  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span></span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onDestroy();  </div><div class="line">        EventBus.getDefault().unregister(<span class="keyword">this</span>);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>好了，到这，基本上算初步把EventBus用起来了，接下来讲讲EventBus的几个函数，及各个函数间是如何识别当前如何调用哪个函数的。</p>
<h3 id="StickyEvent"><a href="#StickyEvent" class="headerlink" title="StickyEvent"></a>StickyEvent</h3><p>除了普通的Event，还有一类特殊的StickyEvent，它也是POJO，事件本身和普通事件无区别，只是在注册订阅者注册时需要使用EventBus.getDefault().registerSticky(this)。事件处理函数的函数名也与普通事件的处理函数一样，因为注册为了StickyEvent的监听器，所以EventBus在调用这些事件处理函数时会按照StickyEvent的方式来处理。StickyEvent与普通Event的普通就在于，EventBus会自动维护被作为StickyEvent被post出来（即在发布事件时使用EventBus.getDefault().postSticky(new MyEvent())方法）的事件的最后一个副本在缓存中。任何时候在任何一个订阅了该事件的订阅者中的任何地方（可以在任何函数中，而不仅仅是在onEventXXX方法中），都可以通过EventBus.getDefault().getStickyEvent(MyEvent.class)来取得该类型事件的最后一次缓存。同时，即便事件已经在所有订阅者中传递完成了，如果此时再创建一个新的订阅者（如一个注册了该StickyEvent的Activity），则在订阅者启动后，会自动调用一次该订阅者的noEventXXX方法来处理该StickyEvent。也可以在需要的时候，利用removeStickyEvent方法来移除对某种StickyEvent的缓存。</p>
<h2 id="订阅函数"><a href="#订阅函数" class="headerlink" title="订阅函数"></a>订阅函数</h2><ul>
<li>onEvent</li>
<li>onEventMainThread</li>
<li>onEventBackgroundThread</li>
<li>onEventAsync</li>
</ul>
<p>这四种订阅函数都是使用onEvent开头的，它们的功能稍有不同,在介绍不同之前先介绍两个概念：<br>告知观察者事件发生时通过EventBus.post函数实现，这个过程叫做事件的发布，观察者被告知事件发生叫做事件的接收，是通过下面的订阅函数实现的。</p>
<p><u>onEvent:</u>如果使用onEvent作为订阅函数，那么该事件在哪个线程发布出来的，onEvent就会在这个线程中运行，也就是说发布事件和接收事件线程在同一个线程。使用这个方法时，在onEvent方法中不能执行耗时操作，如果执行耗时操作容易导致事件分发延迟。</p>
<p><u>onEventMainThread:</u>如果使用onEventMainThread作为订阅函数，那么不论事件是在哪个线程中发布出来的，onEventMainThread都会在UI线程中执行，接收事件就会在UI线程中运行，这个在Android中是非常有用的，因为在Android中只能在UI线程中跟新UI，所以在onEvnetMainThread方法中是不能执行耗时操作的。</p>
<p><u>onEventBackground:</u>如果使用onEventBackgrond作为订阅函数，那么如果事件是在UI线程中发布出来的，那么onEventBackground就会在子线程中运行，如果事件本来就是子线程中发布出来的，那么onEventBackground函数直接在该子线程中执行。</p>
<p><u>onEventAsync:</u>使用这个函数作为订阅函数，那么无论事件在哪个线程发布，都会创建新的子线程在执行onEventAsync.</p>
<h2 id="函数分析"><a href="#函数分析" class="headerlink" title="函数分析"></a>函数分析</h2><p><strong> 1、解析</strong></p>
<p>上面列出的这四个函数，关键问题在于，我们怎么指定调用哪个函数呢？</p>
<p>我们先研究一下，上一篇中是怎么调用的onEventMainThread函数，除了在接收端注册与反注册以后，关键问题在于新建的一个类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.harvic.other;  </div><div class="line">  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstEvent</span> </span>&#123;  </div><div class="line">  </div><div class="line">    <span class="keyword">private</span> String mMsg;  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FirstEvent</span><span class="params">(String msg)</span> </span>&#123;  </div><div class="line">        <span class="comment">// TODO Auto-generated constructor stub  </span></div><div class="line">        mMsg = msg;  </div><div class="line">    &#125;  </div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span></span>&#123;  </div><div class="line">        <span class="keyword">return</span> mMsg;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>发送时：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">EventBus.getDefault().post(<span class="keyword">new</span> FirstEvent(<span class="string">"FirstEvent btn clicked"</span>));</div></pre></td></tr></table></figure></p>
<p>接收时：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEventMainThread</span><span class="params">(FirstEvent event)</span> </span>&#123;    </div><div class="line">  </div><div class="line">    ……  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>发现什么问题了没？</p>
<p>没错，发送时发送的是这个类的实例，接收时参数就是这个类实例。</p>
<p>所以当发过来一个消息的时候，EventBus怎么知道要调哪个函数呢，就看哪个函数传进去的参数是这个类的实例，哪个是就调哪个。那如果有两个是呢，那两个都会被调用！</p>
<p>为了证明这个问题，下面写个例子，先看下效果。</p>
<p><strong> 2、实例</strong> </p>
<p>这次我们在上一篇的基础上，新建三个类：FirstEvent、SecondEvent、ThirdEvent,在第二个Activity中发送请求，在MainActivity中接收这三个类的实例，接收时的代码为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEventMainThread</span><span class="params">(FirstEvent event)</span> </span>&#123;  </div><div class="line">  </div><div class="line">    Log.d(<span class="string">"harvic"</span>, <span class="string">"onEventMainThread收到了消息："</span> + event.getMsg());  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEventMainThread</span><span class="params">(SecondEvent event)</span> </span>&#123;  </div><div class="line">  </div><div class="line">    Log.d(<span class="string">"harvic"</span>, <span class="string">"onEventMainThread收到了消息："</span> + event.getMsg());  </div><div class="line">&#125;  </div><div class="line">  </div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(ThirdEvent event)</span> </span>&#123;  </div><div class="line">    Log.d(<span class="string">"harvic"</span>, <span class="string">"OnEvent收到了消息："</span> + event.getMsg());  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用两个onEventMainThread分别接收FirstEvent实例的消息和SecondEvent实例的消息，使用onEvent接收ThirdEvent实例的消息。界面操作及结果如下：<br><img src="http://img.blog.csdn.net/20141105144303093" alt=""></p>
<p>Log输出结果：<br><img src="http://img.blog.csdn.net/20141105144243991?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGFydmljODgwOTI1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>可以看到，在发送FirstEvent时，在MainActiviy中虽然有三个函数，但只有第一个onEventMainThread函数的接收参数是FirstEvent，所以会传到它这来接收。所以这里识别调用EventBus中四个函数中哪个函数，是通过参数中的实例来决定的。</p>
<p>因为我们是在上一篇例子的基础上完成的，所以这里的代码就不详细写了，只写改动的部分。</p>
<p><strong> 1、三个类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.harvic.other;  </div><div class="line">  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FirstEvent</span> </span>&#123;  </div><div class="line">  </div><div class="line">    <span class="keyword">private</span> String mMsg;  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FirstEvent</span><span class="params">(String msg)</span> </span>&#123;  </div><div class="line">        <span class="comment">// TODO Auto-generated constructor stub  </span></div><div class="line">        mMsg = msg;  </div><div class="line">    &#125;  </div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span></span>&#123;  </div><div class="line">        <span class="keyword">return</span> mMsg;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.harvic.other;  </div><div class="line">  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondEvent</span></span>&#123;  </div><div class="line">  </div><div class="line">    <span class="keyword">private</span> String mMsg;  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SecondEvent</span><span class="params">(String msg)</span> </span>&#123;  </div><div class="line">        <span class="comment">// TODO Auto-generated constructor stub  </span></div><div class="line">        mMsg = <span class="string">"MainEvent:"</span>+msg;  </div><div class="line">    &#125;  </div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span></span>&#123;  </div><div class="line">        <span class="keyword">return</span> mMsg;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.harvic.other;  </div><div class="line">  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThirdEvent</span> </span>&#123;  </div><div class="line">  </div><div class="line">    <span class="keyword">private</span> String mMsg;  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThirdEvent</span><span class="params">(String msg)</span> </span>&#123;  </div><div class="line">        <span class="comment">// TODO Auto-generated constructor stub  </span></div><div class="line">        mMsg = msg;  </div><div class="line">    &#125;  </div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span></span>&#123;  </div><div class="line">        <span class="keyword">return</span> mMsg;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong> 2、发送</strong> </p>
<p>然后在SecondActivity中新建三个按钮，分别发送不同的类的实例，代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.harvic.tryeventbus2;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> com.harvic.other.FirstEvent;  </div><div class="line"><span class="keyword">import</span> com.harvic.other.SecondEvent;  </div><div class="line"><span class="keyword">import</span> com.harvic.other.ThirdEvent;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> de.greenrobot.event.EventBus;  </div><div class="line"><span class="keyword">import</span> android.app.Activity;  </div><div class="line"><span class="keyword">import</span> android.os.Bundle;  </div><div class="line"><span class="keyword">import</span> android.view.View;  </div><div class="line"><span class="keyword">import</span> android.widget.Button;  </div><div class="line">  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;  </div><div class="line">    <span class="keyword">private</span> Button btn_FirstEvent, btn_SecondEvent, btn_ThirdEvent;  </div><div class="line">  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);  </div><div class="line">        setContentView(R.layout.activity_second);  </div><div class="line">        btn_FirstEvent = (Button) findViewById(R.id.btn_first_event);  </div><div class="line">        btn_SecondEvent = (Button) findViewById(R.id.btn_second_event);  </div><div class="line">        btn_ThirdEvent = (Button) findViewById(R.id.btn_third_event);  </div><div class="line">  </div><div class="line">        btn_FirstEvent.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;  </div><div class="line">  </div><div class="line">            <span class="meta">@Override</span>  </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;  </div><div class="line">                <span class="comment">// TODO Auto-generated method stub  </span></div><div class="line">                EventBus.getDefault().post(  </div><div class="line">                        <span class="keyword">new</span> FirstEvent(<span class="string">"FirstEvent btn clicked"</span>));  </div><div class="line">            &#125;  </div><div class="line">        &#125;);  </div><div class="line">          </div><div class="line">        btn_SecondEvent.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;  </div><div class="line">  </div><div class="line">            <span class="meta">@Override</span>  </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;  </div><div class="line">                <span class="comment">// TODO Auto-generated method stub  </span></div><div class="line">                EventBus.getDefault().post(  </div><div class="line">                        <span class="keyword">new</span> SecondEvent(<span class="string">"SecondEvent btn clicked"</span>));  </div><div class="line">            &#125;  </div><div class="line">        &#125;);  </div><div class="line">  </div><div class="line">        btn_ThirdEvent.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;  </div><div class="line">  </div><div class="line">            <span class="meta">@Override</span>  </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;  </div><div class="line">                <span class="comment">// TODO Auto-generated method stub  </span></div><div class="line">                EventBus.getDefault().post(  </div><div class="line">                        <span class="keyword">new</span> ThirdEvent(<span class="string">"ThirdEvent btn clicked"</span>));  </div><div class="line">  </div><div class="line">            &#125;  </div><div class="line">        &#125;);  </div><div class="line">  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong> 3、接收</strong><br>在MainActivity中，除了注册与注册，我们利用onEventMainThread(FirstEvent event)来接收来自FirstEvent的消息，使用onEventMainThread(SecondEvent event)接收来自SecondEvent 实例的消息，使用onEvent(ThirdEvent event) 来接收ThirdEvent 实例的消息。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.harvic.tryeventbus2;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> com.harvic.other.FirstEvent;  </div><div class="line"><span class="keyword">import</span> com.harvic.other.SecondEvent;  </div><div class="line"><span class="keyword">import</span> com.harvic.other.ThirdEvent;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> de.greenrobot.event.EventBus;  </div><div class="line"><span class="keyword">import</span> android.app.Activity;  </div><div class="line"><span class="keyword">import</span> android.content.Intent;  </div><div class="line"><span class="keyword">import</span> android.os.Bundle;  </div><div class="line"><span class="keyword">import</span> android.util.Log;  </div><div class="line"><span class="keyword">import</span> android.view.Menu;  </div><div class="line"><span class="keyword">import</span> android.view.MenuItem;  </div><div class="line"><span class="keyword">import</span> android.view.View;  </div><div class="line"><span class="keyword">import</span> android.widget.Button;  </div><div class="line"><span class="keyword">import</span> android.widget.TextView;  </div><div class="line">  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;  </div><div class="line">  </div><div class="line">    Button btn;  </div><div class="line">    TextView tv;  </div><div class="line">    EventBus eventBus;  </div><div class="line">  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);  </div><div class="line">        setContentView(R.layout.activity_main);  </div><div class="line">  </div><div class="line">        EventBus.getDefault().register(<span class="keyword">this</span>);  </div><div class="line">  </div><div class="line">        btn = (Button) findViewById(R.id.btn_try);  </div><div class="line">  </div><div class="line">        btn.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;  </div><div class="line">  </div><div class="line">            <span class="meta">@Override</span>  </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;  </div><div class="line">                <span class="comment">// TODO Auto-generated method stub  </span></div><div class="line">                Intent intent = <span class="keyword">new</span> Intent(getApplicationContext(),  </div><div class="line">                        SecondActivity.class);  </div><div class="line">                startActivity(intent);  </div><div class="line">            &#125;  </div><div class="line">        &#125;);  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEventMainThread</span><span class="params">(FirstEvent event)</span> </span>&#123;  </div><div class="line">  </div><div class="line">        Log.d(<span class="string">"harvic"</span>, <span class="string">"onEventMainThread收到了消息："</span> + event.getMsg());  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEventMainThread</span><span class="params">(SecondEvent event)</span> </span>&#123;  </div><div class="line">  </div><div class="line">        Log.d(<span class="string">"harvic"</span>, <span class="string">"onEventMainThread收到了消息："</span> + event.getMsg());  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(ThirdEvent event)</span> </span>&#123;  </div><div class="line">        Log.d(<span class="string">"harvic"</span>, <span class="string">"OnEvent收到了消息："</span> + event.getMsg());  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;  </div><div class="line">        <span class="comment">// TODO Auto-generated method stub  </span></div><div class="line">        <span class="keyword">super</span>.onDestroy();  </div><div class="line">        EventBus.getDefault().unregister(<span class="keyword">this</span>);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>到这里，代码就结束 了，从上面的代码，我们可以看到，EventBus是怎么接收消息的，是根据参数中类的实例的类型的判定的，所以当如果我们在接收时，同一个类的实例参数有两个函数来接收会怎样？答案是，这两个函数都会执行，下面实验一下：</p>
<p>在MainActivity中接收时，我们在接收SecondEvent时，在上面onEventMainThread基础上另加一个onEventBackgroundThread和onEventAsync，即下面的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//SecondEvent接收函数一  </span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEventMainThread</span><span class="params">(SecondEvent event)</span> </span>&#123;  </div><div class="line">  </div><div class="line">    Log.d(<span class="string">"harvic"</span>, <span class="string">"onEventMainThread收到了消息："</span> + event.getMsg());  </div><div class="line">&#125;  </div><div class="line"><span class="comment">//SecondEvent接收函数二  </span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEventBackgroundThread</span><span class="params">(SecondEvent event)</span></span>&#123;  </div><div class="line">    Log.d(<span class="string">"harvic"</span>, <span class="string">"onEventBackground收到了消息："</span> + event.getMsg());  </div><div class="line">&#125;  </div><div class="line"><span class="comment">//SecondEvent接收函数三  </span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEventAsync</span><span class="params">(SecondEvent event)</span></span>&#123;  </div><div class="line">    Log.d(<span class="string">"harvic"</span>, <span class="string">"onEventAsync收到了消息："</span> + event.getMsg());  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>完整的代码在这里：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.harvic.tryeventbus2;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> com.harvic.other.FirstEvent;  </div><div class="line"><span class="keyword">import</span> com.harvic.other.SecondEvent;  </div><div class="line"><span class="keyword">import</span> com.harvic.other.ThirdEvent;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> de.greenrobot.event.EventBus;  </div><div class="line"><span class="keyword">import</span> android.app.Activity;  </div><div class="line"><span class="keyword">import</span> android.content.Intent;  </div><div class="line"><span class="keyword">import</span> android.os.Bundle;  </div><div class="line"><span class="keyword">import</span> android.util.Log;  </div><div class="line"><span class="keyword">import</span> android.view.Menu;  </div><div class="line"><span class="keyword">import</span> android.view.MenuItem;  </div><div class="line"><span class="keyword">import</span> android.view.View;  </div><div class="line"><span class="keyword">import</span> android.widget.Button;  </div><div class="line"><span class="keyword">import</span> android.widget.TextView;  </div><div class="line">  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;  </div><div class="line">  </div><div class="line">    Button btn;  </div><div class="line">    TextView tv;  </div><div class="line">    EventBus eventBus;  </div><div class="line">  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;  </div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);  </div><div class="line">        setContentView(R.layout.activity_main);  </div><div class="line">  </div><div class="line">        EventBus.getDefault().register(<span class="keyword">this</span>);  </div><div class="line">  </div><div class="line">        btn = (Button) findViewById(R.id.btn_try);  </div><div class="line">  </div><div class="line">        btn.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;  </div><div class="line">  </div><div class="line">            <span class="meta">@Override</span>  </div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;  </div><div class="line">                <span class="comment">// TODO Auto-generated method stub  </span></div><div class="line">                Intent intent = <span class="keyword">new</span> Intent(getApplicationContext(),  </div><div class="line">                        SecondActivity.class);  </div><div class="line">                startActivity(intent);  </div><div class="line">            &#125;  </div><div class="line">        &#125;);  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEventMainThread</span><span class="params">(FirstEvent event)</span> </span>&#123;  </div><div class="line">  </div><div class="line">        Log.d(<span class="string">"harvic"</span>, <span class="string">"onEventMainThread收到了消息："</span> + event.getMsg());  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="comment">//SecondEvent接收函数一  </span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEventMainThread</span><span class="params">(SecondEvent event)</span> </span>&#123;  </div><div class="line">  </div><div class="line">        Log.d(<span class="string">"harvic"</span>, <span class="string">"onEventMainThread收到了消息："</span> + event.getMsg());  </div><div class="line">    &#125;  </div><div class="line">    <span class="comment">//SecondEvent接收函数二  </span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEventBackgroundThread</span><span class="params">(SecondEvent event)</span></span>&#123;  </div><div class="line">        Log.d(<span class="string">"harvic"</span>, <span class="string">"onEventBackground收到了消息："</span> + event.getMsg());  </div><div class="line">    &#125;  </div><div class="line">    <span class="comment">//SecondEvent接收函数三  </span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEventAsync</span><span class="params">(SecondEvent event)</span></span>&#123;  </div><div class="line">        Log.d(<span class="string">"harvic"</span>, <span class="string">"onEventAsync收到了消息："</span> + event.getMsg());  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(ThirdEvent event)</span> </span>&#123;  </div><div class="line">        Log.d(<span class="string">"harvic"</span>, <span class="string">"OnEvent收到了消息："</span> + event.getMsg());  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;  </div><div class="line">        <span class="comment">// TODO Auto-generated method stub  </span></div><div class="line">        <span class="keyword">super</span>.onDestroy();  </div><div class="line">        EventBus.getDefault().unregister(<span class="keyword">this</span>);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>经过上面的分析，当发送SecondEvent实例的消息过来的时候，这三个函数会同时接收到并各自执行，所以当点击Second Event这个button的时候，会出现下面的结果：<br><img src="http://img.blog.csdn.net/20141106163644296?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaGFydmljODgwOTI1/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>结论：消息的接收是根据参数中的类名来决定执行哪一个的。</p>
<h2 id="附加说明"><a href="#附加说明" class="headerlink" title="附加说明"></a>附加说明</h2><p>事件总线的模式利用订阅/发布的模式，降低了耦合度的框架除了EventBus，另外还有square的otto和android support包里提供的LocalBroadcast，他们使得两个类没有直接的依赖关系，对架构来说进行了解耦，把双向依赖变成了单向依赖，在大型项目中尤其显得重要。</p>
<h3 id="Why-publish-subscribe"><a href="#Why-publish-subscribe" class="headerlink" title="Why publish/subscribe"></a>Why publish/subscribe</h3><p>一方面，callback很容易产生内存泄露，如I/O、网络操作持有了Activity/Fragment的引用，导致不能及时释放，而团队中也很难保证每个成员都足够优秀在写callback的时候能使用弱引用或静态变量。相比起来订阅/发布者模式则比较简单，直接在BaseActivity的onDestroy释放掉，避免了可能的坑。另外，从可扩展性、可维护性的角度来说，callback也更局限，比如以前某个接口是告诉上层网络数据拉回来了，现在我们希望扩展，这个接口也支持直接告诉上层数据库拉回来了，向上层屏蔽数据来源，如果用callback，则在一次回调结束后，没有办法再次进行回调了。页面必须自己去处理数据来源和拉数据的逻辑。<br>虽然有些over-architect的嫌疑，但是Android-CleanArchitecture 确实是一种很clean的architecture，而其也正是通过观察者/订阅者模式来实现了单向依赖。</p>
<h3 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h3><p>EventBus的github上就有其和otto的比较： <a href="https://github.com/greenrobot/EventBus/blob/master/COMPARISON.md" target="_blank" rel="external">EventBus vs Otto</a><br>总的来说，两者功能差的不多，otto多了Event producers (e.g. for coding cached events)，而EventBus则多了各种线程的处理、订阅者继承、sticky event等。<br>但从性能来说，由于otto使用了基于反射的annotation，而和EventBus产生了一定的差距。<br>三者都不支持跨进程，LocalBroadcast内部其实使用的是Handler，所以其实更像是一个utils类。<br>如果要做选择的话，LocalBroadcast更轻量，otto相比起api更好用，而EventBus则拥有很棒的线程模型。</p>
<h3 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h3><ul>
<li><a href="http://www.carrotsight.com/2015/eventbus_study.html" target="_blank" rel="external">EventBus学习总结</a></li>
<li><a href="https://github.com/greenrobot/EventBus/blob/master/HOWTO.md" target="_blank" rel="external">EventBus官方使用说明</a></li>
<li><a href="http://blog.csdn.net/pp_hdsny/article/details/14523561" target="_blank" rel="external">EventBus的使用初试</a></li>
<li><a href="https://code.google.com/p/guava-libraries/wiki/EventBusExplained" target="_blank" rel="external">EventBusExplained</a></li>
<li><a href="http://blog.it985.com/12276.html" target="_blank" rel="external">EventBus使用详解(一)——初步使用EventBus</a></li>
<li><a href="http://blog.csdn.net/harvic880925/article/details/40787203" target="_blank" rel="external">EventBus使用详解(二)——初步使用EventBus</a></li>
<li><a href="http://blog.csdn.net/yuanzeyao/article/details/38174537" target="_blank" rel="external">Android解耦库EventBus的使用和源码分析</a></li>
<li><a href="http://blog.csdn.net/marktheone/article/details/47725553" target="_blank" rel="external">EventBus, otto, LocalBroadcast的选择 </a></li>
<li><a href="http://download.alipay.com/public/api/base/WS_MOBILE_PAY_SDK_BASE.zip" target="_blank" rel="external">官网DEMO下载地址</a></li>
<li><a href="http://pan.baidu.com/s/1i3lkH6X" target="_blank" rel="external">EventBusDemo1下载地址</a> 密码：ax3x</li>
<li><a href="http://pan.baidu.com/s/1hqg3aeC" target="_blank" rel="external">EventBusDemo2下载地址</a> 密码：iwp2</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/10/android_eventbus/" data-id="cj4zx2kh9001oqonh1ec1nk2m" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/eventbus/">eventbus</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_fresco1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/09/android_fresco1/" class="article-date">
  <time datetime="2015-11-09T09:42:29.000Z" itemprop="datePublished">2015-11-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/android/">android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/09/android_fresco1/">图片缓存框架Fresco使用详解(一)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>周末闲来无事，研究了一下facebook开源的android图片缓存框架<a href="https://github.com/facebook/fresco" target="_blank" rel="external">Fresco</a>，并从AS整合到eclipse里。做了一些修改，仔细的研究了该框架的使用配置，也详细的标注了配置说明。目前暂未研究网络层，数据源层以及线程池等替换，不过这些在<a href="http://fresco-cn.org/" target="_blank" rel="external">http://fresco-cn.org/</a> 上有详细说明。<br>吐槽下，Fresco项目开发人员为了凸显该框架的强大，把android常用的网络层和图片缓存都整到Demo里，不熟悉折腾起来还是挺麻烦的，而且NDK环境明明配置正确，还老报NDK配置错误，找不到NDK，偶然一次运行成功，再次导入项目又报错了。</p>
<p>PS：该图片缓存框架强大，可以说目前最强的android图片缓存框架，决定下周就把项目里的UniversalImageLoader换成Fresco，不过该框架里暂未找到不用UI组件直接把图片拉入缓存的方法，知道小伙伴们共享下吧。</p>
<h2 id="代码注解"><a href="#代码注解" class="headerlink" title="代码注解"></a>代码注解</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line"> * This file provided by Facebook is for non-commercial testing and evaluation</div><div class="line"> * purposes only.  Facebook reserves all rights not expressly granted.</div><div class="line"> *</div><div class="line"> * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</div><div class="line"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</div><div class="line"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL</div><div class="line"> * FACEBOOK BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</div><div class="line"> * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</div><div class="line"> * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</div><div class="line"> */</div><div class="line"> </div><div class="line"><span class="keyword">package</span> com.facebook.fresco.sample.configs;</div><div class="line"> </div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.content.res.Resources;</div><div class="line"><span class="keyword">import</span> android.graphics.drawable.Drawable;</div><div class="line"><span class="keyword">import</span> android.net.Uri;</div><div class="line"><span class="keyword">import</span> android.os.Environment;</div><div class="line"> </div><div class="line"><span class="keyword">import</span> com.facebook.cache.disk.DiskCacheConfig;</div><div class="line"><span class="keyword">import</span> com.facebook.common.internal.Supplier;</div><div class="line"><span class="keyword">import</span> com.facebook.common.util.ByteConstants;</div><div class="line"><span class="keyword">import</span> com.facebook.drawee.backends.pipeline.Fresco;</div><div class="line"><span class="keyword">import</span> com.facebook.drawee.drawable.ProgressBarDrawable;</div><div class="line"><span class="keyword">import</span> com.facebook.drawee.generic.GenericDraweeHierarchy;</div><div class="line"><span class="keyword">import</span> com.facebook.drawee.generic.GenericDraweeHierarchyBuilder;</div><div class="line"><span class="keyword">import</span> com.facebook.drawee.generic.RoundingParams;</div><div class="line"><span class="keyword">import</span> com.facebook.drawee.interfaces.DraweeController;</div><div class="line"><span class="keyword">import</span> com.facebook.drawee.interfaces.SimpleDraweeControllerBuilder;</div><div class="line"><span class="keyword">import</span> com.facebook.fresco.sample.R;</div><div class="line"><span class="keyword">import</span> com.facebook.fresco.sample.instrumentation.InstrumentedDraweeView;</div><div class="line"><span class="keyword">import</span> com.facebook.imagepipeline.cache.MemoryCacheParams;</div><div class="line"><span class="keyword">import</span> com.facebook.imagepipeline.common.ImageDecodeOptions;</div><div class="line"><span class="keyword">import</span> com.facebook.imagepipeline.common.ResizeOptions;</div><div class="line"><span class="keyword">import</span> com.facebook.imagepipeline.core.ImagePipelineConfig;</div><div class="line"><span class="keyword">import</span> com.facebook.imagepipeline.request.ImageRequest;</div><div class="line"><span class="keyword">import</span> com.facebook.imagepipeline.request.ImageRequest.RequestLevel;</div><div class="line"><span class="keyword">import</span> com.facebook.imagepipeline.request.ImageRequestBuilder;</div><div class="line"><span class="comment">/**</span></div><div class="line"> * 配置才是关键～～～细细看来确实是不错的图片缓存框架，</div><div class="line"> * <span class="doctag">@author</span> notreami</div><div class="line"> *</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigConstants</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_HEAP_SIZE = (<span class="keyword">int</span>) Runtime.getRuntime().maxMemory();<span class="comment">//分配的可用内存</span></div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_MEMORY_CACHE_SIZE = MAX_HEAP_SIZE / <span class="number">4</span>;<span class="comment">//使用的缓存数量</span></div><div class="line">   </div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_SMALL_DISK_VERYLOW_CACHE_SIZE = <span class="number">5</span> * ByteConstants.MB;<span class="comment">//小图极低磁盘空间缓存的最大值（特性：可将大量的小图放到额外放在另一个磁盘空间防止大图占用磁盘空间而删除了大量的小图）</span></div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_SMALL_DISK_LOW_CACHE_SIZE = <span class="number">10</span> * ByteConstants.MB;<span class="comment">//小图低磁盘空间缓存的最大值（特性：可将大量的小图放到额外放在另一个磁盘空间防止大图占用磁盘空间而删除了大量的小图）</span></div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_SMALL_DISK_CACHE_SIZE = <span class="number">20</span> * ByteConstants.MB;<span class="comment">//小图磁盘缓存的最大值（特性：可将大量的小图放到额外放在另一个磁盘空间防止大图占用磁盘空间而删除了大量的小图）</span></div><div class="line">   </div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_DISK_CACHE_VERYLOW_SIZE = <span class="number">10</span> * ByteConstants.MB;<span class="comment">//默认图极低磁盘空间缓存的最大值</span></div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_DISK_CACHE_LOW_SIZE = <span class="number">30</span> * ByteConstants.MB;<span class="comment">//默认图低磁盘空间缓存的最大值</span></div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_DISK_CACHE_SIZE = <span class="number">50</span> * ByteConstants.MB;<span class="comment">//默认图磁盘缓存的最大值</span></div><div class="line">   </div><div class="line">   </div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String IMAGE_PIPELINE_SMALL_CACHE_DIR = <span class="string">"imagepipeline_cache"</span>;<span class="comment">//小图所放路径的文件夹名</span></div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String IMAGE_PIPELINE_CACHE_DIR = <span class="string">"imagepipeline_cache"</span>;<span class="comment">//默认图所放路径的文件夹名</span></div><div class="line"> </div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> ImagePipelineConfig sImagePipelineConfig;</div><div class="line"> </div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="title">ConfigConstants</span><span class="params">()</span></span>&#123;</div><div class="line">       </div><div class="line">  &#125;</div><div class="line">  <span class="comment">/**</span></div><div class="line">   * 初始化配置，单例</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ImagePipelineConfig <span class="title">getImagePipelineConfig</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (sImagePipelineConfig == <span class="keyword">null</span>) &#123;</div><div class="line">      sImagePipelineConfig = configureCaches(context);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> sImagePipelineConfig;</div><div class="line">  &#125;</div><div class="line"> </div><div class="line"> </div><div class="line"> </div><div class="line">  <span class="comment">/**</span></div><div class="line">   * 初始化配置</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ImagePipelineConfig <span class="title">configureCaches</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">      <span class="comment">//内存配置</span></div><div class="line">      <span class="keyword">final</span> MemoryCacheParams bitmapCacheParams = <span class="keyword">new</span> MemoryCacheParams(</div><div class="line">                ConfigConstants.MAX_MEMORY_CACHE_SIZE, <span class="comment">// 内存缓存中总图片的最大大小,以字节为单位。</span></div><div class="line">                Integer.MAX_VALUE,                     <span class="comment">// 内存缓存中图片的最大数量。</span></div><div class="line">                ConfigConstants.MAX_MEMORY_CACHE_SIZE, <span class="comment">// 内存缓存中准备清除但尚未被删除的总图片的最大大小,以字节为单位。</span></div><div class="line">                Integer.MAX_VALUE,                     <span class="comment">// 内存缓存中准备清除的总图片的最大数量。</span></div><div class="line">                Integer.MAX_VALUE);                    <span class="comment">// 内存缓存中单个图片的最大大小。</span></div><div class="line">       </div><div class="line">      <span class="comment">//修改内存图片缓存数量，空间策略（这个方式有点恶心）</span></div><div class="line">      Supplier&lt;MemoryCacheParams&gt;  mSupplierMemoryCacheParams= <span class="keyword">new</span> Supplier&lt;MemoryCacheParams&gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">         <span class="function"><span class="keyword">public</span> MemoryCacheParams <span class="title">get</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> bitmapCacheParams;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">     </div><div class="line">    <span class="comment">//小图片的磁盘配置</span></div><div class="line">      DiskCacheConfig diskSmallCacheConfig =  DiskCacheConfig.newBuilder()</div><div class="line">              .setBaseDirectoryPath(context.getApplicationContext().getCacheDir())<span class="comment">//缓存图片基路径</span></div><div class="line">              .setBaseDirectoryName(IMAGE_PIPELINE_SMALL_CACHE_DIR)<span class="comment">//文件夹名</span></div><div class="line"><span class="comment">//            .setCacheErrorLogger(cacheErrorLogger)//日志记录器用于日志错误的缓存。</span></div><div class="line"><span class="comment">//            .setCacheEventListener(cacheEventListener)//缓存事件侦听器。</span></div><div class="line"><span class="comment">//            .setDiskTrimmableRegistry(diskTrimmableRegistry)//类将包含一个注册表的缓存减少磁盘空间的环境。</span></div><div class="line">              .setMaxCacheSize(ConfigConstants.MAX_DISK_CACHE_SIZE)<span class="comment">//默认缓存的最大大小。</span></div><div class="line">              .setMaxCacheSizeOnLowDiskSpace(MAX_SMALL_DISK_LOW_CACHE_SIZE)<span class="comment">//缓存的最大大小,使用设备时低磁盘空间。</span></div><div class="line">              .setMaxCacheSizeOnVeryLowDiskSpace(MAX_SMALL_DISK_VERYLOW_CACHE_SIZE)<span class="comment">//缓存的最大大小,当设备极低磁盘空间</span></div><div class="line"><span class="comment">//            .setVersion(version)</span></div><div class="line">              .build();</div><div class="line">       </div><div class="line">    <span class="comment">//默认图片的磁盘配置</span></div><div class="line">      DiskCacheConfig diskCacheConfig =  DiskCacheConfig.newBuilder()</div><div class="line">              .setBaseDirectoryPath(Environment.getExternalStorageDirectory().getAbsoluteFile())<span class="comment">//缓存图片基路径</span></div><div class="line">              .setBaseDirectoryName(IMAGE_PIPELINE_CACHE_DIR)<span class="comment">//文件夹名</span></div><div class="line"><span class="comment">//            .setCacheErrorLogger(cacheErrorLogger)//日志记录器用于日志错误的缓存。</span></div><div class="line"><span class="comment">//            .setCacheEventListener(cacheEventListener)//缓存事件侦听器。</span></div><div class="line"><span class="comment">//            .setDiskTrimmableRegistry(diskTrimmableRegistry)//类将包含一个注册表的缓存减少磁盘空间的环境。</span></div><div class="line">              .setMaxCacheSize(ConfigConstants.MAX_DISK_CACHE_SIZE)<span class="comment">//默认缓存的最大大小。</span></div><div class="line">              .setMaxCacheSizeOnLowDiskSpace(MAX_DISK_CACHE_LOW_SIZE)<span class="comment">//缓存的最大大小,使用设备时低磁盘空间。</span></div><div class="line">              .setMaxCacheSizeOnVeryLowDiskSpace(MAX_DISK_CACHE_VERYLOW_SIZE)<span class="comment">//缓存的最大大小,当设备极低磁盘空间</span></div><div class="line"><span class="comment">//            .setVersion(version)</span></div><div class="line">              .build();</div><div class="line">       </div><div class="line">      <span class="comment">//缓存图片配置</span></div><div class="line">      ImagePipelineConfig.Builder configBuilder = ImagePipelineConfig.newBuilder(context)</div><div class="line"><span class="comment">//            .setAnimatedImageFactory(AnimatedImageFactory animatedImageFactory)//图片加载动画</span></div><div class="line">              .setBitmapMemoryCacheParamsSupplier(mSupplierMemoryCacheParams)<span class="comment">//内存缓存配置（一级缓存，已解码的图片）</span></div><div class="line"><span class="comment">//            .setCacheKeyFactory(cacheKeyFactory)//缓存Key工厂</span></div><div class="line"><span class="comment">//            .setEncodedMemoryCacheParamsSupplier(encodedCacheParamsSupplier)//内存缓存和未解码的内存缓存的配置（二级缓存）</span></div><div class="line"><span class="comment">//            .setExecutorSupplier(executorSupplier)//线程池配置</span></div><div class="line"><span class="comment">//            .setImageCacheStatsTracker(imageCacheStatsTracker)//统计缓存的命中率</span></div><div class="line"><span class="comment">//            .setImageDecoder(ImageDecoder imageDecoder) //图片解码器配置</span></div><div class="line"><span class="comment">//            .setIsPrefetchEnabledSupplier(Supplier&lt;Boolean&gt; isPrefetchEnabledSupplier)//图片预览（缩略图，预加载图等）预加载到文件缓存</span></div><div class="line">              .setMainDiskCacheConfig(diskCacheConfig)<span class="comment">//磁盘缓存配置（总，三级缓存）</span></div><div class="line"><span class="comment">//            .setMemoryTrimmableRegistry(memoryTrimmableRegistry) //内存用量的缩减,有时我们可能会想缩小内存用量。比如应用中有其他数据需要占用内存，不得不把图片缓存清除或者减小或者我们想检查看看手机是否已经内存不够了。</span></div><div class="line"><span class="comment">//            .setNetworkFetchProducer(networkFetchProducer)//自定的网络层配置：如OkHttp，Volley</span></div><div class="line"><span class="comment">//            .setPoolFactory(poolFactory)//线程池工厂配置</span></div><div class="line"><span class="comment">//            .setProgressiveJpegConfig(progressiveJpegConfig)//渐进式JPEG图</span></div><div class="line"><span class="comment">//            .setRequestListeners(requestListeners)//图片请求监听</span></div><div class="line"><span class="comment">//            .setResizeAndRotateEnabledForNetwork(boolean resizeAndRotateEnabledForNetwork)//调整和旋转是否支持网络图片</span></div><div class="line">              .setSmallImageDiskCacheConfig(diskSmallCacheConfig)<span class="comment">//磁盘缓存配置（小图片，可选～三级缓存的小图优化缓存）</span></div><div class="line">              ;   </div><div class="line">    <span class="keyword">return</span> configBuilder.build();       </div><div class="line">  &#125;</div><div class="line">  <span class="comment">//圆形，圆角切图，对动图无效</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RoundingParams <span class="title">getRoundingParams</span><span class="params">()</span></span>&#123;</div><div class="line">      RoundingParams roundingParams = RoundingParams.fromCornersRadius(<span class="number">7f</span>);</div><div class="line"><span class="comment">//    roundingParams.asCircle();//圆形</span></div><div class="line"><span class="comment">//    roundingParams.setBorder(color, width);//fresco:roundingBorderWidth="2dp"边框  fresco:roundingBorderColor="@color/border_color"</span></div><div class="line"><span class="comment">//    roundingParams.setCornersRadii(radii);//半径</span></div><div class="line"><span class="comment">//    roundingParams.setCornersRadii(topLeft, topRight, bottomRight, bottomLeft)</span></div><div class="line"><span class="comment">//    fresco:roundTopLeft="true" fresco:roundTopRight="false" fresco:roundBottomLeft="false"fresco:roundBottomRight="true"</span></div><div class="line"><span class="comment">//    roundingParams. setCornersRadius(radius);//fresco:roundedCornerRadius="1dp"圆角</span></div><div class="line"><span class="comment">//    roundingParams.setOverlayColor(overlayColor);//fresco:roundWithOverlayColor="@color/corner_color"</span></div><div class="line"><span class="comment">//    roundingParams.setRoundAsCircle(roundAsCircle);//圆</span></div><div class="line"><span class="comment">//    roundingParams.setRoundingMethod(roundingMethod);</span></div><div class="line"><span class="comment">//    fresco:progressBarAutoRotateInterval="1000"自动旋转间隔</span></div><div class="line">      <span class="comment">// 或用 fromCornersRadii 以及 asCircle 方法</span></div><div class="line">      <span class="keyword">return</span> roundingParams;</div><div class="line">  &#125;</div><div class="line">   </div><div class="line"><span class="comment">//Drawees   DraweeHierarchy  组织</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> GenericDraweeHierarchy <span class="title">getGenericDraweeHierarchy</span><span class="params">(Context context)</span></span>&#123;</div><div class="line">      GenericDraweeHierarchy gdh = <span class="keyword">new</span> GenericDraweeHierarchyBuilder(context.getResources())</div><div class="line"><span class="comment">//            .reset()//重置</span></div><div class="line"><span class="comment">//            .setActualImageColorFilter(colorFilter)//颜色过滤</span></div><div class="line"><span class="comment">//            .setActualImageFocusPoint(focusPoint)//focusCrop, 需要指定一个居中点</span></div><div class="line"><span class="comment">//            .setActualImageMatrix(actualImageMatrix)</span></div><div class="line"><span class="comment">//            .setActualImageScaleType(actualImageScaleType)//fresco:actualImageScaleType="focusCrop"缩放类型</span></div><div class="line"><span class="comment">//            .setBackground(background)//fresco:backgroundImage="@color/blue"背景图片</span></div><div class="line"><span class="comment">//            .setBackgrounds(backgrounds)</span></div><div class="line"><span class="comment">//            .setFadeDuration(fadeDuration)//fresco:fadeDuration="300"加载图片动画时间</span></div><div class="line">              .setFailureImage(ConfigConstants.sErrorDrawable)<span class="comment">//fresco:failureImage="@drawable/error"失败图</span></div><div class="line"><span class="comment">//            .setFailureImage(failureDrawable, failureImageScaleType)//fresco:failureImageScaleType="centerInside"失败图缩放类型</span></div><div class="line"><span class="comment">//            .setOverlay(overlay)//fresco:overlayImage="@drawable/watermark"叠加图</span></div><div class="line"><span class="comment">//            .setOverlays(overlays)</span></div><div class="line">              .setPlaceholderImage(ConfigConstants.sPlaceholderDrawable)<span class="comment">//fresco:placeholderImage="@color/wait_color"占位图</span></div><div class="line"><span class="comment">//            .setPlaceholderImage(placeholderDrawable, placeholderImageScaleType)//fresco:placeholderImageScaleType="fitCenter"占位图缩放类型</span></div><div class="line"><span class="comment">//            .setPressedStateOverlay(drawable)//fresco:pressedStateOverlayImage="@color/red"按压状态下的叠加图</span></div><div class="line">              .setProgressBarImage(<span class="keyword">new</span> ProgressBarDrawable())<span class="comment">//进度条fresco:progressBarImage="@drawable/progress_bar"进度条</span></div><div class="line"><span class="comment">//            .setProgressBarImage(progressBarImage, progressBarImageScaleType)//fresco:progressBarImageScaleType="centerInside"进度条类型</span></div><div class="line"><span class="comment">//            .setRetryImage(retryDrawable)//fresco:retryImage="@drawable/retrying"点击重新加载</span></div><div class="line"><span class="comment">//            .setRetryImage(retryDrawable, retryImageScaleType)//fresco:retryImageScaleType="centerCrop"点击重新加载缩放类型</span></div><div class="line">              .setRoundingParams(RoundingParams.asCircle())<span class="comment">//圆形/圆角fresco:roundAsCircle="true"圆形</span></div><div class="line">              .build();</div><div class="line">      <span class="keyword">return</span> gdh;</div><div class="line">  &#125;</div><div class="line">   </div><div class="line">   </div><div class="line"><span class="comment">//DraweeView～～～SimpleDraweeView——UI组件</span></div><div class="line"><span class="comment">//  public static SimpleDraweeView getSimpleDraweeView(Context context,Uri uri)&#123;</span></div><div class="line"><span class="comment">//    SimpleDraweeView simpleDraweeView=new SimpleDraweeView(context);</span></div><div class="line"><span class="comment">//    simpleDraweeView.setImageURI(uri);</span></div><div class="line"><span class="comment">//    simpleDraweeView.setAspectRatio(1.33f);//宽高缩放比</span></div><div class="line"><span class="comment">//    return simpleDraweeView;</span></div><div class="line"><span class="comment">//  &#125;</span></div><div class="line">   </div><div class="line">  <span class="comment">//SimpleDraweeControllerBuilder</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SimpleDraweeControllerBuilder <span class="title">getSimpleDraweeControllerBuilder</span><span class="params">(SimpleDraweeControllerBuilder sdcb,Uri uri,  Object callerContext,DraweeController draweeController)</span></span>&#123;</div><div class="line">      SimpleDraweeControllerBuilder controllerBuilder = sdcb</div><div class="line">                .setUri(uri)</div><div class="line">                .setCallerContext(callerContext)</div><div class="line"><span class="comment">//              .setAspectRatio(1.33f);//宽高缩放比</span></div><div class="line">                .setOldController(draweeController);</div><div class="line">      <span class="keyword">return</span> controllerBuilder;</div><div class="line">  &#125;</div><div class="line">   </div><div class="line">  <span class="comment">//图片解码</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ImageDecodeOptions <span class="title">getImageDecodeOptions</span><span class="params">()</span></span>&#123;</div><div class="line">      ImageDecodeOptions decodeOptions = ImageDecodeOptions.newBuilder()</div><div class="line"><span class="comment">//            .setBackgroundColor(Color.TRANSPARENT)//图片的背景颜色</span></div><div class="line"><span class="comment">//            .setDecodeAllFrames(decodeAllFrames)//解码所有帧</span></div><div class="line"><span class="comment">//            .setDecodePreviewFrame(decodePreviewFrame)//解码预览框</span></div><div class="line"><span class="comment">//            .setForceOldAnimationCode(forceOldAnimationCode)//使用以前动画</span></div><div class="line"><span class="comment">//            .setFrom(options)//使用已经存在的图像解码</span></div><div class="line"><span class="comment">//            .setMinDecodeIntervalMs(intervalMs)//最小解码间隔（分位单位）</span></div><div class="line">              .setUseLastFrameForPreview(<span class="keyword">true</span>)<span class="comment">//使用最后一帧进行预览</span></div><div class="line">              .build();</div><div class="line">      <span class="keyword">return</span> decodeOptions;</div><div class="line">  &#125;</div><div class="line">   </div><div class="line">  <span class="comment">//图片显示</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ImageRequest <span class="title">getImageRequest</span><span class="params">(InstrumentedDraweeView view,String uri)</span></span>&#123;</div><div class="line">      ImageRequest imageRequest = ImageRequestBuilder.newBuilderWithSource(Uri.parse(uri))</div><div class="line"><span class="comment">//            .setAutoRotateEnabled(true)//自动旋转图片方向</span></div><div class="line"><span class="comment">//            .setImageDecodeOptions(getImageDecodeOptions())//  图片解码库</span></div><div class="line"><span class="comment">//            .setImageType(ImageType.SMALL)//图片类型，设置后可调整图片放入小图磁盘空间还是默认图片磁盘空间</span></div><div class="line"><span class="comment">//            .setLocalThumbnailPreviewsEnabled(true)//缩略图预览，影响图片显示速度（轻微）</span></div><div class="line">              .setLowestPermittedRequestLevel(RequestLevel.FULL_FETCH)<span class="comment">//请求经过缓存级别  BITMAP_MEMORY_CACHE，ENCODED_MEMORY_CACHE，DISK_CACHE，FULL_FETCH</span></div><div class="line"><span class="comment">//            .setPostprocessor(postprocessor)//修改图片</span></div><div class="line"><span class="comment">//            .setProgressiveRenderingEnabled(true)//渐进加载，主要用于渐进式的JPEG图，影响图片显示速度（普通）</span></div><div class="line">              .setResizeOptions(<span class="keyword">new</span> ResizeOptions(view.getLayoutParams().width, view.getLayoutParams().height))<span class="comment">//调整大小</span></div><div class="line"><span class="comment">//            .setSource(Uri uri)//设置图片地址</span></div><div class="line">              .build();</div><div class="line">      <span class="keyword">return</span> imageRequest;</div><div class="line">  &#125;</div><div class="line">   </div><div class="line"><span class="comment">//DraweeController 控制 DraweeControllerBuilder</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DraweeController <span class="title">getDraweeController</span><span class="params">(ImageRequest imageRequest,InstrumentedDraweeView view)</span></span>&#123;</div><div class="line">      DraweeController draweeController = Fresco.newDraweeControllerBuilder()</div><div class="line"><span class="comment">//            .reset()//重置</span></div><div class="line">              .setAutoPlayAnimations(<span class="keyword">true</span>)<span class="comment">//自动播放图片动画</span></div><div class="line"><span class="comment">//            .setCallerContext(callerContext)//回调</span></div><div class="line">              .setControllerListener(view.getListener())<span class="comment">//监听图片下载完毕等</span></div><div class="line"><span class="comment">//            .setDataSourceSupplier(dataSourceSupplier)//数据源</span></div><div class="line"><span class="comment">//            .setFirstAvailableImageRequests(firstAvailableImageRequests)//本地图片复用，可加入ImageRequest数组</span></div><div class="line">              .setImageRequest(imageRequest)<span class="comment">//设置单个图片请求～～～不可与setFirstAvailableImageRequests共用，配合setLowResImageRequest为高分辨率的图</span></div><div class="line"><span class="comment">//            .setLowResImageRequest(ImageRequest.fromUri(lowResUri))//先下载显示低分辨率的图</span></div><div class="line">              .setOldController(view.getController())<span class="comment">//DraweeController复用</span></div><div class="line">              .setTapToRetryEnabled(<span class="keyword">true</span>)<span class="comment">//点击重新加载图</span></div><div class="line">              .build();</div><div class="line">      <span class="keyword">return</span> draweeController;</div><div class="line">  &#125;</div><div class="line">   </div><div class="line">  <span class="comment">//默认加载图片和失败图片</span></div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Drawable sPlaceholderDrawable;</div><div class="line">  <span class="keyword">public</span> <span class="keyword">static</span> Drawable sErrorDrawable;</div><div class="line">   </div><div class="line">  <span class="meta">@SuppressWarnings</span>(<span class="string">"deprecation"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">final</span> Resources resources)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (sPlaceholderDrawable == <span class="keyword">null</span>) &#123;</div><div class="line">          sPlaceholderDrawable = resources.getDrawable(R.color.placeholder);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (sErrorDrawable == <span class="keyword">null</span>) &#123;</div><div class="line">          sErrorDrawable = resources.getDrawable(R.color.error);</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="效果截图"><a href="#效果截图" class="headerlink" title="效果截图"></a>效果截图</h2><p><img src="http://static.oschina.net/uploads/code/201504/26192509_hDqX.jpg" alt=""> </p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="http://www.oschina.net/code/snippet_2310130_47596" target="_blank" rel="external">Fresco图片缓存框架的eclipse整合与使用探索</a> </li>
<li><a href="http://pan.baidu.com/s/1eQsctyE" target="_blank" rel="external">DEMO下载地址</a> 密码：a8eo</li>
<li><a href="https://github.com/facebook/fresco" target="_blank" rel="external">GitHub Fresco</a></li>
<li><a href="http://fresco-cn.org/" target="_blank" rel="external">Fresco API</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/09/android_fresco1/" data-id="cj4zx2khq001uqonh5r9rlfxt" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/imageloader/">imageloader</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_imgloader2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/09/android_imgloader2/" class="article-date">
  <time datetime="2015-11-09T08:53:29.000Z" itemprop="datePublished">2015-11-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/android/">android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/09/android_imgloader2/">Universal-Image-Loader使用详解(二)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="一、介绍"><a href="#一、介绍" class="headerlink" title="一、介绍"></a>一、介绍</h2><p>Android-Universal-Image-Loader是一个开源的UI组件程序，该项目的目的是提供一个可重复使用的仪器为异步图像加载，缓存和显示。所以，如果你的程序里需要这个功能的话，那么不妨试试它。因为已经封装好了一些类和方法。我们 可以直接拿来用了。而不用重复去写了。其实，写一个这方面的程序还是比较麻烦的，要考虑多线程缓存，内存溢出等很多方面。 下面是ImageLoader三大组件DisplayImageOptions、ImageLoader、ImageLoaderConfiguration的详解。</p>
<h2 id="二、具体使用"><a href="#二、具体使用" class="headerlink" title="二、具体使用"></a>二、具体使用</h2><p>一个好的类库的重要特征就是可配置性强。我们先简单使用Android-Universal-Image-Loader，一般情况下使用默认配置就可以了。</p>
<p>下面的实例利用Android-Universal-Image-Loader将网络图片加载到图片墙中。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">    ImageLoader imageLoader;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">          <span class="comment">// Create global configuration and initialize ImageLoader with this configuration</span></div><div class="line">        ImageLoaderConfiguration config = <span class="keyword">new</span> ImageLoaderConfiguration.Builder(getApplicationContext())</div><div class="line">            .build();</div><div class="line">        ImageLoader.getInstance().init(config);</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">BaseActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">  </div><div class="line">        ImageLoader imageLoader = ImageLoader.getInstance();</div><div class="line"></div><div class="line">        GridView gridView = (GridView) <span class="keyword">this</span>.findViewById(R.id.grdvImageWall);</div><div class="line">        gridView.setAdapter(<span class="keyword">new</span> PhotoWallAdapter(Constants.IMAGES));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> </span>&#123;</div><div class="line">        ImageView imageView;</div><div class="line">        ProgressBar progressBar;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhotoWallAdapter</span> <span class="keyword">extends</span> <span class="title">BaseAdapter</span> </span>&#123;</div><div class="line">        String[] imageUrls;</div><div class="line">        ImageLoader imageLoad;</div><div class="line">        DisplayImageOptions options;</div><div class="line">        LinearLayout gridViewItem;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PhotoWallAdapter</span><span class="params">(String[] imageUrls)</span> </span>&#123;</div><div class="line">            <span class="keyword">assert</span> imageUrls != <span class="keyword">null</span>;</div><div class="line">            <span class="keyword">this</span>.imageUrls = imageUrls;</div><div class="line"></div><div class="line">            options = <span class="keyword">new</span> DisplayImageOptions.Builder()</div><div class="line">                    .showImageOnLoading(R.drawable.ic_stub) <span class="comment">// resource or</span></div><div class="line">                                                            <span class="comment">// drawable</span></div><div class="line">                    .showImageForEmptyUri(R.drawable.ic_empty) <span class="comment">// resource or</span></div><div class="line">                                                                <span class="comment">// drawable</span></div><div class="line">                    .showImageOnFail(R.drawable.ic_error) <span class="comment">// resource or</span></div><div class="line">                                                            <span class="comment">// drawable</span></div><div class="line">                    .resetViewBeforeLoading(<span class="keyword">false</span>) <span class="comment">// default</span></div><div class="line">                    .delayBeforeLoading(<span class="number">1000</span>).cacheInMemory(<span class="keyword">false</span>) <span class="comment">// default</span></div><div class="line">                    .cacheOnDisk(<span class="keyword">false</span>) <span class="comment">// default</span></div><div class="line">                    .considerExifParams(<span class="keyword">false</span>) <span class="comment">// default</span></div><div class="line">                    .imageScaleType(ImageScaleType.IN_SAMPLE_POWER_OF_2) <span class="comment">// default</span></div><div class="line">                    .bitmapConfig(Bitmap.Config.ARGB_8888) <span class="comment">// default</span></div><div class="line">                    .displayer(<span class="keyword">new</span> SimpleBitmapDisplayer()) <span class="comment">// default</span></div><div class="line">                    .handler(<span class="keyword">new</span> Handler()) <span class="comment">// default</span></div><div class="line">                    .build();</div><div class="line">            <span class="keyword">this</span>.imageLoad = ImageLoader.getInstance();</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.imageUrls.length;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (position &lt;= <span class="number">0</span> || position &gt;= <span class="keyword">this</span>.imageUrls.length) &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</div><div class="line">                        <span class="string">"position&lt;=0||position&gt;=this.imageUrls.length"</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.imageUrls[position];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getItemId</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> position;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(<span class="keyword">int</span> position, View convertView, ViewGroup parent)</span> </span>&#123;</div><div class="line">            <span class="comment">// 判断这个image是否已经在缓存当中，如果没有就下载</span></div><div class="line">            <span class="keyword">final</span> ViewHolder holder;</div><div class="line">            <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) &#123;</div><div class="line">                holder = <span class="keyword">new</span> ViewHolder();</div><div class="line">                gridViewItem = (LinearLayout) getLayoutInflater().inflate(</div><div class="line">                        R.layout.image_wall_item, <span class="keyword">null</span>);</div><div class="line">                holder.imageView = (ImageView) gridViewItem</div><div class="line">                        .findViewById(R.id.item_image);</div><div class="line">                holder.progressBar = (ProgressBar) gridViewItem</div><div class="line">                        .findViewById(R.id.item_process);</div><div class="line">                gridViewItem.setTag(holder);</div><div class="line">                convertView = gridViewItem;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                holder = (ViewHolder) gridViewItem.getTag();</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">this</span>.imageLoad.displayImage(<span class="keyword">this</span>.imageUrls[position],</div><div class="line">                    holder.imageView, options,</div><div class="line">                    <span class="keyword">new</span> SimpleImageLoadingListener() &#123;</div><div class="line"></div><div class="line">                        <span class="meta">@Override</span></div><div class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLoadingStarted</span><span class="params">(String imageUri, View view)</span> </span>&#123;</div><div class="line">                            holder.progressBar.setProgress(<span class="number">0</span>);</div><div class="line">                            holder.progressBar.setVisibility(View.VISIBLE);</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        <span class="meta">@Override</span></div><div class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLoadingFailed</span><span class="params">(String imageUri, View view,</span></span></div><div class="line">                                FailReason failReason) &#123;</div><div class="line">                            holder.progressBar.setVisibility(View.GONE);</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        <span class="meta">@Override</span></div><div class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLoadingComplete</span><span class="params">(String imageUri,</span></span></div><div class="line">                                View view, Bitmap loadedImage) &#123;</div><div class="line">                            holder.progressBar.setVisibility(View.GONE);</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                    &#125;, <span class="keyword">new</span> ImageLoadingProgressListener() &#123;</div><div class="line"></div><div class="line">                        <span class="meta">@Override</span></div><div class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onProgressUpdate</span><span class="params">(String imageUri,</span></span></div><div class="line">                                View view, <span class="keyword">int</span> current, <span class="keyword">int</span> total) &#123;</div><div class="line">                            holder.progressBar.setProgress(Math.round(<span class="number">100.0f</span></div><div class="line">                                    * current / total));</div><div class="line">                        &#125;</div><div class="line">                    &#125;); <span class="comment">// 通过URL判断图片是否已经下载</span></div><div class="line">            <span class="keyword">return</span> convertView;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong> 三者的关系</strong></p>
<ul>
<li>ImageLoaderConfiguration是针对图片缓存的全局配置，主要有线程类、缓存大小、磁盘大小、图片下载与解析、日志方面的配置。</li>
<li>ImageLoader是具体下载图片，缓存图片，显示图片的具体执行类，它有两个具体的方法displayImage(…)、loadImage(…)，但是其实最终他们的实现都是displayImage(…)。</li>
<li>DisplayImageOptions用于指导每一个Imageloader根据网络图片的状态（空白、下载错误、正在下载）显示对应的图片，是否将缓存加载到磁盘上，下载完后对图片进行怎么样的处理。</li>
</ul>
<p>从三者的协作关系上看，他们有点像厨房规定、厨师、客户个人口味之间的关系。ImageLoaderConfiguration就像是厨房里面的规定，每一个厨师要怎么着装，要怎么保持厨房的干净，这是针对每一个厨师都适用的规定，而且不允许个性化改变。ImageLoader就像是具体做菜的厨师，负责具体菜谱的制作。DisplayImageOptions就像每个客户的偏好，根据客户是重口味还是清淡，每一个imageLoader根据DisplayImageOptions的要求具体执行。</p>
<h3 id="ImageLoaderConfiguration"><a href="#ImageLoaderConfiguration" class="headerlink" title="ImageLoaderConfiguration"></a>ImageLoaderConfiguration</h3><p>在上面的示例代码中，我们使用ImageLoaderConfiguration的默认配置，下面给出ImageLoaderConfiguration比较详尽的配置，从下面的配置中，可以看出ImageLoaderConfiguration的配置主要是全局性的配置，主要有线程类、缓存大小、磁盘大小、图片下载与解析、日志方面的配置。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">ImageLoaderConfiguration config = <span class="keyword">new</span> ImageLoaderConfiguration.Builder(context)</div><div class="line">        .memoryCacheExtraOptions(<span class="number">480</span>, <span class="number">800</span>) <span class="comment">// default = device screen dimensions</span></div><div class="line">        .diskCacheExtraOptions(<span class="number">480</span>, <span class="number">800</span>, <span class="keyword">null</span>)</div><div class="line">        .taskExecutor(...)</div><div class="line">        .taskExecutorForCachedImages(...)</div><div class="line">        .threadPoolSize(<span class="number">3</span>) <span class="comment">// default</span></div><div class="line">        .threadPriority(Thread.NORM_PRIORITY - <span class="number">1</span>) <span class="comment">// default</span></div><div class="line">        .tasksProcessingOrder(QueueProcessingType.FIFO) <span class="comment">// default</span></div><div class="line">        .denyCacheImageMultipleSizesInMemory()</div><div class="line">        .memoryCache(<span class="keyword">new</span> LruMemoryCache(<span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>))</div><div class="line">        .memoryCacheSize(<span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>)</div><div class="line">        .memoryCacheSizePercentage(<span class="number">13</span>) <span class="comment">// default</span></div><div class="line">        .diskCache(<span class="keyword">new</span> UnlimitedDiscCache(cacheDir)) <span class="comment">// default</span></div><div class="line">        .diskCacheSize(<span class="number">50</span> * <span class="number">1024</span> * <span class="number">1024</span>)</div><div class="line">        .diskCacheFileCount(<span class="number">100</span>)</div><div class="line">        .diskCacheFileNameGenerator(<span class="keyword">new</span> HashCodeFileNameGenerator()) <span class="comment">// default</span></div><div class="line">        .imageDownloader(<span class="keyword">new</span> BaseImageDownloader(context)) <span class="comment">// default</span></div><div class="line">        .imageDecoder(<span class="keyword">new</span> BaseImageDecoder()) <span class="comment">// default</span></div><div class="line">        .defaultDisplayImageOptions(DisplayImageOptions.createSimple()) <span class="comment">// default</span></div><div class="line">        .writeDebugLogs()</div><div class="line">        .build();</div></pre></td></tr></table></figure></p>
<p>ImageLoaderConfiguration的主要职责就是记录相关的配置，它的内部其实就是一些字段的集合（如下面的源代码）。它有一个builder的内部类，这个类中的字段跟ImageLoaderConfiguration中的字段完全一致，它有一些默认值，通过修改builder可以配置ImageLoaderConfiguration。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">/*******************************************************************************</span></div><div class="line"> * Copyright 2011-2013 Sergey Tarasevich</div><div class="line"> *</div><div class="line"> * Licensed under the Apache License, Version 2.0 (the "License");</div><div class="line"> * you may not use this file except in compliance with the License.</div><div class="line"> * You may obtain a copy of the License at</div><div class="line"> *</div><div class="line"> * http://www.apache.org/licenses/LICENSE-2.0</div><div class="line"> *</div><div class="line"> * Unless required by applicable law or agreed to in writing, software</div><div class="line"> * distributed under the License is distributed on an "AS IS" BASIS,</div><div class="line"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</div><div class="line"> * See the License for the specific language governing permissions and</div><div class="line"> * limitations under the License.</div><div class="line"> *******************************************************************************/</div><div class="line"><span class="keyword">package</span> com.nostra13.universalimageloader.core;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.content.res.Resources;</div><div class="line"><span class="keyword">import</span> android.util.DisplayMetrics;</div><div class="line"><span class="keyword">import</span> com.nostra13.universalimageloader.cache.disc.DiskCache;</div><div class="line"><span class="keyword">import</span> com.nostra13.universalimageloader.cache.disc.naming.FileNameGenerator;</div><div class="line"><span class="keyword">import</span> com.nostra13.universalimageloader.cache.memory.MemoryCache;</div><div class="line"><span class="keyword">import</span> com.nostra13.universalimageloader.cache.memory.impl.FuzzyKeyMemoryCache;</div><div class="line"><span class="keyword">import</span> com.nostra13.universalimageloader.core.assist.FlushedInputStream;</div><div class="line"><span class="keyword">import</span> com.nostra13.universalimageloader.core.assist.ImageSize;</div><div class="line"><span class="keyword">import</span> com.nostra13.universalimageloader.core.assist.QueueProcessingType;</div><div class="line"><span class="keyword">import</span> com.nostra13.universalimageloader.core.decode.ImageDecoder;</div><div class="line"><span class="keyword">import</span> com.nostra13.universalimageloader.core.download.ImageDownloader;</div><div class="line"><span class="keyword">import</span> com.nostra13.universalimageloader.core.process.BitmapProcessor;</div><div class="line"><span class="keyword">import</span> com.nostra13.universalimageloader.utils.L;</div><div class="line"><span class="keyword">import</span> com.nostra13.universalimageloader.utils.MemoryCacheUtils;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.Executor;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Presents configuration for &#123;<span class="doctag">@link</span> ImageLoader&#125;</div><div class="line"> *</div><div class="line"> * <span class="doctag">@author</span> Sergey Tarasevich (nostra13[at]gmail[dot]com)</div><div class="line"> * <span class="doctag">@see</span> ImageLoader</div><div class="line"> * <span class="doctag">@see</span> MemoryCache</div><div class="line"> * <span class="doctag">@see</span> DiskCache</div><div class="line"> * <span class="doctag">@see</span> DisplayImageOptions</div><div class="line"> * <span class="doctag">@see</span> ImageDownloader</div><div class="line"> * <span class="doctag">@see</span> FileNameGenerator</div><div class="line"> * <span class="doctag">@since</span> 1.0.0</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageLoaderConfiguration</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">final</span> Resources resources;</div><div class="line"></div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> maxImageWidthForMemoryCache;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> maxImageHeightForMemoryCache;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> maxImageWidthForDiskCache;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> maxImageHeightForDiskCache;</div><div class="line">    <span class="keyword">final</span> BitmapProcessor processorForDiskCache;</div><div class="line"></div><div class="line">    <span class="keyword">final</span> Executor taskExecutor;</div><div class="line">    <span class="keyword">final</span> Executor taskExecutorForCachedImages;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> customExecutor;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> customExecutorForCachedImages;</div><div class="line"></div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> threadPoolSize;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> threadPriority;</div><div class="line">    <span class="keyword">final</span> QueueProcessingType tasksProcessingType;</div><div class="line"></div><div class="line">    <span class="keyword">final</span> MemoryCache memoryCache;</div><div class="line">    <span class="keyword">final</span> DiskCache diskCache;</div><div class="line">    <span class="keyword">final</span> ImageDownloader downloader;</div><div class="line">    <span class="keyword">final</span> ImageDecoder decoder;</div><div class="line">    <span class="keyword">final</span> DisplayImageOptions defaultDisplayImageOptions;</div><div class="line"></div><div class="line">    <span class="keyword">final</span> ImageDownloader networkDeniedDownloader;</div><div class="line">    <span class="keyword">final</span> ImageDownloader slowNetworkDownloader;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ImageLoaderConfiguration</span><span class="params">(<span class="keyword">final</span> Builder builder)</span> </span>&#123;</div><div class="line">        resources = builder.context.getResources();</div><div class="line">        maxImageWidthForMemoryCache = builder.maxImageWidthForMemoryCache;</div><div class="line">        maxImageHeightForMemoryCache = builder.maxImageHeightForMemoryCache;</div><div class="line">        maxImageWidthForDiskCache = builder.maxImageWidthForDiskCache;</div><div class="line">        maxImageHeightForDiskCache = builder.maxImageHeightForDiskCache;</div><div class="line">        processorForDiskCache = builder.processorForDiskCache;</div><div class="line">        taskExecutor = builder.taskExecutor;</div><div class="line">        taskExecutorForCachedImages = builder.taskExecutorForCachedImages;</div><div class="line">        threadPoolSize = builder.threadPoolSize;</div><div class="line">        threadPriority = builder.threadPriority;</div><div class="line">        tasksProcessingType = builder.tasksProcessingType;</div><div class="line">        diskCache = builder.diskCache;</div><div class="line">        memoryCache = builder.memoryCache;</div><div class="line">        defaultDisplayImageOptions = builder.defaultDisplayImageOptions;</div><div class="line">        downloader = builder.downloader;</div><div class="line">        decoder = builder.decoder;</div><div class="line"></div><div class="line">        customExecutor = builder.customExecutor;</div><div class="line">        customExecutorForCachedImages = builder.customExecutorForCachedImages;</div><div class="line"></div><div class="line">        networkDeniedDownloader = <span class="keyword">new</span> NetworkDeniedImageDownloader(downloader);</div><div class="line">        slowNetworkDownloader = <span class="keyword">new</span> SlowNetworkImageDownloader(downloader);</div><div class="line"></div><div class="line">        L.writeDebugLogs(builder.writeLogs);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Creates default configuration for &#123;<span class="doctag">@link</span> ImageLoader&#125; &lt;br /&gt;</div><div class="line">     * &lt;b&gt;Default values:&lt;/b&gt;</div><div class="line">     * &lt;ul&gt;</div><div class="line">     * &lt;li&gt;maxImageWidthForMemoryCache = device's screen width&lt;/li&gt;</div><div class="line">     * &lt;li&gt;maxImageHeightForMemoryCache = device's screen height&lt;/li&gt;</div><div class="line">     * &lt;li&gt;maxImageWidthForDikcCache = unlimited&lt;/li&gt;</div><div class="line">     * &lt;li&gt;maxImageHeightForDiskCache = unlimited&lt;/li&gt;</div><div class="line">     * &lt;li&gt;threadPoolSize = &#123;<span class="doctag">@link</span> Builder#DEFAULT_THREAD_POOL_SIZE this&#125;&lt;/li&gt;</div><div class="line">     * &lt;li&gt;threadPriority = &#123;<span class="doctag">@link</span> Builder#DEFAULT_THREAD_PRIORITY this&#125;&lt;/li&gt;</div><div class="line">     * &lt;li&gt;allow to cache different sizes of image in memory&lt;/li&gt;</div><div class="line">     * &lt;li&gt;memoryCache = &#123;<span class="doctag">@link</span> DefaultConfigurationFactory#createMemoryCache(int)&#125;&lt;/li&gt;</div><div class="line">     * &lt;li&gt;diskCache = &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.cache.disc.impl.UnlimitedDiscCache&#125;&lt;/li&gt;</div><div class="line">     * &lt;li&gt;imageDownloader = &#123;<span class="doctag">@link</span> DefaultConfigurationFactory#createImageDownloader(Context)&#125;&lt;/li&gt;</div><div class="line">     * &lt;li&gt;imageDecoder = &#123;<span class="doctag">@link</span> DefaultConfigurationFactory#createImageDecoder(boolean)&#125;&lt;/li&gt;</div><div class="line">     * &lt;li&gt;diskCacheFileNameGenerator = &#123;<span class="doctag">@link</span> DefaultConfigurationFactory#createFileNameGenerator()&#125;&lt;/li&gt;</div><div class="line">     * &lt;li&gt;defaultDisplayImageOptions = &#123;<span class="doctag">@link</span> DisplayImageOptions#createSimple() Simple options&#125;&lt;/li&gt;</div><div class="line">     * &lt;li&gt;tasksProcessingOrder = &#123;<span class="doctag">@link</span> QueueProcessingType#FIFO&#125;&lt;/li&gt;</div><div class="line">     * &lt;li&gt;detailed logging disabled&lt;/li&gt;</div><div class="line">     * &lt;/ul&gt;</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ImageLoaderConfiguration <span class="title">createDefault</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Builder(context).build();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function">ImageSize <span class="title">getMaxImageSize</span><span class="params">()</span> </span>&#123;</div><div class="line">        DisplayMetrics displayMetrics = resources.getDisplayMetrics();</div><div class="line"></div><div class="line">        <span class="keyword">int</span> width = maxImageWidthForMemoryCache;</div><div class="line">        <span class="keyword">if</span> (width &lt;= <span class="number">0</span>) &#123;</div><div class="line">            width = displayMetrics.widthPixels;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> height = maxImageHeightForMemoryCache;</div><div class="line">        <span class="keyword">if</span> (height &lt;= <span class="number">0</span>) &#123;</div><div class="line">            height = displayMetrics.heightPixels;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ImageSize(width, height);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Builder for &#123;<span class="doctag">@link</span> ImageLoaderConfiguration&#125;</div><div class="line">     *</div><div class="line">     * <span class="doctag">@author</span> Sergey Tarasevich (nostra13[at]gmail[dot]com)</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String WARNING_OVERLAP_DISK_CACHE_PARAMS = <span class="string">"diskCache(), diskCacheSize() and diskCacheFileCount calls overlap each other"</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String WARNING_OVERLAP_DISK_CACHE_NAME_GENERATOR = <span class="string">"diskCache() and diskCacheFileNameGenerator() calls overlap each other"</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String WARNING_OVERLAP_MEMORY_CACHE = <span class="string">"memoryCache() and memoryCacheSize() calls overlap each other"</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String WARNING_OVERLAP_EXECUTOR = <span class="string">"threadPoolSize(), threadPriority() and tasksProcessingOrder() calls "</span></div><div class="line">                + <span class="string">"can overlap taskExecutor() and taskExecutorForCachedImages() calls."</span>;</div><div class="line"></div><div class="line">        <span class="comment">/** &#123;<span class="doctag">@value</span>&#125; */</span></div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_THREAD_POOL_SIZE = <span class="number">3</span>;</div><div class="line">        <span class="comment">/** &#123;<span class="doctag">@value</span>&#125; */</span></div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_THREAD_PRIORITY = Thread.NORM_PRIORITY - <span class="number">1</span>;</div><div class="line">        <span class="comment">/** &#123;<span class="doctag">@value</span>&#125; */</span></div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> QueueProcessingType DEFAULT_TASK_PROCESSING_TYPE = QueueProcessingType.FIFO;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> Context context;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> maxImageWidthForMemoryCache = <span class="number">0</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> maxImageHeightForMemoryCache = <span class="number">0</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> maxImageWidthForDiskCache = <span class="number">0</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> maxImageHeightForDiskCache = <span class="number">0</span>;</div><div class="line">        <span class="keyword">private</span> BitmapProcessor processorForDiskCache = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> Executor taskExecutor = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">private</span> Executor taskExecutorForCachedImages = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> customExecutor = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> customExecutorForCachedImages = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> threadPoolSize = DEFAULT_THREAD_POOL_SIZE;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> threadPriority = DEFAULT_THREAD_PRIORITY;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> denyCacheImageMultipleSizesInMemory = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">private</span> QueueProcessingType tasksProcessingType = DEFAULT_TASK_PROCESSING_TYPE;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> memoryCacheSize = <span class="number">0</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">long</span> diskCacheSize = <span class="number">0</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> diskCacheFileCount = <span class="number">0</span>;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> MemoryCache memoryCache = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">private</span> DiskCache diskCache = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">private</span> FileNameGenerator diskCacheFileNameGenerator = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">private</span> ImageDownloader downloader = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">private</span> ImageDecoder decoder;</div><div class="line">        <span class="keyword">private</span> DisplayImageOptions defaultDisplayImageOptions = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> writeLogs = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.context = context.getApplicationContext();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets options for memory cache</div><div class="line">         *</div><div class="line">         * <span class="doctag">@param</span> maxImageWidthForMemoryCache  Maximum image width which will be used for memory saving during decoding</div><div class="line">         *                                     an image to &#123;<span class="doctag">@link</span> android.graphics.Bitmap Bitmap&#125;. &lt;b&gt;Default value - device's screen width&lt;/b&gt;</div><div class="line">         * <span class="doctag">@param</span> maxImageHeightForMemoryCache Maximum image height which will be used for memory saving during decoding</div><div class="line">         *                                     an image to &#123;<span class="doctag">@link</span> android.graphics.Bitmap Bitmap&#125;. &lt;b&gt;Default value&lt;/b&gt; - device's screen height</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">memoryCacheExtraOptions</span><span class="params">(<span class="keyword">int</span> maxImageWidthForMemoryCache, <span class="keyword">int</span> maxImageHeightForMemoryCache)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.maxImageWidthForMemoryCache = maxImageWidthForMemoryCache;</div><div class="line">            <span class="keyword">this</span>.maxImageHeightForMemoryCache = maxImageHeightForMemoryCache;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * <span class="doctag">@deprecated</span> Use</div><div class="line">         * &#123;<span class="doctag">@link</span> #diskCacheExtraOptions(int, int, com.nostra13.universalimageloader.core.process.BitmapProcessor)&#125;</div><div class="line">         * instead</div><div class="line">         */</div><div class="line">        <span class="meta">@Deprecated</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">discCacheExtraOptions</span><span class="params">(<span class="keyword">int</span> maxImageWidthForDiskCache, <span class="keyword">int</span> maxImageHeightForDiskCache,</span></span></div><div class="line">                BitmapProcessor processorForDiskCache) &#123;</div><div class="line">            <span class="keyword">return</span> diskCacheExtraOptions(maxImageWidthForDiskCache, maxImageHeightForDiskCache, processorForDiskCache);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets options for resizing/compressing of downloaded images before saving to disk cache.&lt;br /&gt;</div><div class="line">         * &lt;b&gt;<span class="doctag">NOTE:</span> Use this option only when you have appropriate needs. It can make ImageLoader slower.&lt;/b&gt;</div><div class="line">         *</div><div class="line">         * <span class="doctag">@param</span> maxImageWidthForDiskCache  Maximum width of downloaded images for saving at disk cache</div><div class="line">         * <span class="doctag">@param</span> maxImageHeightForDiskCache Maximum height of downloaded images for saving at disk cache</div><div class="line">         * <span class="doctag">@param</span> processorForDiskCache      null-ok; &#123;<span class="doctag">@linkplain</span> BitmapProcessor Bitmap processor&#125; which process images before saving them in disc cache</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">diskCacheExtraOptions</span><span class="params">(<span class="keyword">int</span> maxImageWidthForDiskCache, <span class="keyword">int</span> maxImageHeightForDiskCache,</span></span></div><div class="line">                BitmapProcessor processorForDiskCache) &#123;</div><div class="line">            <span class="keyword">this</span>.maxImageWidthForDiskCache = maxImageWidthForDiskCache;</div><div class="line">            <span class="keyword">this</span>.maxImageHeightForDiskCache = maxImageHeightForDiskCache;</div><div class="line">            <span class="keyword">this</span>.processorForDiskCache = processorForDiskCache;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets custom &#123;<span class="doctag">@linkplain</span> Executor executor&#125; for tasks of loading and displaying images.&lt;br /&gt;</div><div class="line">         * &lt;br /&gt;</div><div class="line">         * &lt;b&gt;<span class="doctag">NOTE:</span>&lt;/b&gt; If you set custom executor then following configuration options will not be considered for this</div><div class="line">         * executor:</div><div class="line">         * &lt;ul&gt;</div><div class="line">         * &lt;li&gt;&#123;<span class="doctag">@link</span> #threadPoolSize(int)&#125;&lt;/li&gt;</div><div class="line">         * &lt;li&gt;&#123;<span class="doctag">@link</span> #threadPriority(int)&#125;&lt;/li&gt;</div><div class="line">         * &lt;li&gt;&#123;<span class="doctag">@link</span> #tasksProcessingOrder(QueueProcessingType)&#125;&lt;/li&gt;</div><div class="line">         * &lt;/ul&gt;</div><div class="line">         *</div><div class="line">         * <span class="doctag">@see</span> #taskExecutorForCachedImages(Executor)</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">taskExecutor</span><span class="params">(Executor executor)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (threadPoolSize != DEFAULT_THREAD_POOL_SIZE || threadPriority != DEFAULT_THREAD_PRIORITY || tasksProcessingType != DEFAULT_TASK_PROCESSING_TYPE) &#123;</div><div class="line">                L.w(WARNING_OVERLAP_EXECUTOR);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">this</span>.taskExecutor = executor;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets custom &#123;<span class="doctag">@linkplain</span> Executor executor&#125; for tasks of displaying &lt;b&gt;cached on disk&lt;/b&gt; images (these tasks</div><div class="line">         * are executed quickly so UIL prefer to use separate executor for them).&lt;br /&gt;</div><div class="line">         * &lt;br /&gt;</div><div class="line">         * If you set the same executor for &#123;<span class="doctag">@linkplain</span> #taskExecutor(Executor) general tasks&#125; and</div><div class="line">         * tasks about cached images (this method) then these tasks will be in the</div><div class="line">         * same thread pool. So short-lived tasks can wait a long time for their turn.&lt;br /&gt;</div><div class="line">         * &lt;br /&gt;</div><div class="line">         * &lt;b&gt;<span class="doctag">NOTE:</span>&lt;/b&gt; If you set custom executor then following configuration options will not be considered for this</div><div class="line">         * executor:</div><div class="line">         * &lt;ul&gt;</div><div class="line">         * &lt;li&gt;&#123;<span class="doctag">@link</span> #threadPoolSize(int)&#125;&lt;/li&gt;</div><div class="line">         * &lt;li&gt;&#123;<span class="doctag">@link</span> #threadPriority(int)&#125;&lt;/li&gt;</div><div class="line">         * &lt;li&gt;&#123;<span class="doctag">@link</span> #tasksProcessingOrder(QueueProcessingType)&#125;&lt;/li&gt;</div><div class="line">         * &lt;/ul&gt;</div><div class="line">         *</div><div class="line">         * <span class="doctag">@see</span> #taskExecutor(Executor)</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">taskExecutorForCachedImages</span><span class="params">(Executor executorForCachedImages)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (threadPoolSize != DEFAULT_THREAD_POOL_SIZE || threadPriority != DEFAULT_THREAD_PRIORITY || tasksProcessingType != DEFAULT_TASK_PROCESSING_TYPE) &#123;</div><div class="line">                L.w(WARNING_OVERLAP_EXECUTOR);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">this</span>.taskExecutorForCachedImages = executorForCachedImages;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets thread pool size for image display tasks.&lt;br /&gt;</div><div class="line">         * Default value - &#123;<span class="doctag">@link</span> #DEFAULT_THREAD_POOL_SIZE this&#125;</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">threadPoolSize</span><span class="params">(<span class="keyword">int</span> threadPoolSize)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (taskExecutor != <span class="keyword">null</span> || taskExecutorForCachedImages != <span class="keyword">null</span>) &#123;</div><div class="line">                L.w(WARNING_OVERLAP_EXECUTOR);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">this</span>.threadPoolSize = threadPoolSize;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets the priority for image loading threads. Should be &lt;b&gt;NOT&lt;/b&gt; greater than &#123;<span class="doctag">@link</span> Thread#MAX_PRIORITY&#125; or</div><div class="line">         * less than &#123;<span class="doctag">@link</span> Thread#MIN_PRIORITY&#125;&lt;br /&gt;</div><div class="line">         * Default value - &#123;<span class="doctag">@link</span> #DEFAULT_THREAD_PRIORITY this&#125;</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">threadPriority</span><span class="params">(<span class="keyword">int</span> threadPriority)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (taskExecutor != <span class="keyword">null</span> || taskExecutorForCachedImages != <span class="keyword">null</span>) &#123;</div><div class="line">                L.w(WARNING_OVERLAP_EXECUTOR);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (threadPriority &lt; Thread.MIN_PRIORITY) &#123;</div><div class="line">                <span class="keyword">this</span>.threadPriority = Thread.MIN_PRIORITY;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">if</span> (threadPriority &gt; Thread.MAX_PRIORITY) &#123;</div><div class="line">                    <span class="keyword">this</span>.threadPriority = Thread.MAX_PRIORITY;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="keyword">this</span>.threadPriority = threadPriority;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * When you display an image in a small &#123;<span class="doctag">@link</span> android.widget.ImageView ImageView&#125; and later you try to display</div><div class="line">         * this image (from identical URI) in a larger &#123;<span class="doctag">@link</span> android.widget.ImageView ImageView&#125; so decoded image of</div><div class="line">         * bigger size will be cached in memory as a previous decoded image of smaller size.&lt;br /&gt;</div><div class="line">         * So &lt;b&gt;the default behavior is to allow to cache multiple sizes of one image in memory&lt;/b&gt;. You can</div><div class="line">         * &lt;b&gt;deny&lt;/b&gt; it by calling &lt;b&gt;this&lt;/b&gt; method: so when some image will be cached in memory then previous</div><div class="line">         * cached size of this image (if it exists) will be removed from memory cache before.</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">denyCacheImageMultipleSizesInMemory</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.denyCacheImageMultipleSizesInMemory = <span class="keyword">true</span>;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets type of queue processing for tasks for loading and displaying images.&lt;br /&gt;</div><div class="line">         * Default value - &#123;<span class="doctag">@link</span> QueueProcessingType#FIFO&#125;</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">tasksProcessingOrder</span><span class="params">(QueueProcessingType tasksProcessingType)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (taskExecutor != <span class="keyword">null</span> || taskExecutorForCachedImages != <span class="keyword">null</span>) &#123;</div><div class="line">                L.w(WARNING_OVERLAP_EXECUTOR);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">this</span>.tasksProcessingType = tasksProcessingType;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets maximum memory cache size for &#123;<span class="doctag">@link</span> android.graphics.Bitmap bitmaps&#125; (in bytes).&lt;br /&gt;</div><div class="line">         * Default value - 1/8 of available app memory.&lt;br /&gt;</div><div class="line">         * &lt;b&gt;<span class="doctag">NOTE:</span>&lt;/b&gt; If you use this method then</div><div class="line">         * &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.cache.memory.impl.LruMemoryCache LruMemoryCache&#125; will be used as</div><div class="line">         * memory cache. You can use &#123;<span class="doctag">@link</span> #memoryCache(MemoryCache)&#125; method to set your own implementation of</div><div class="line">         * &#123;<span class="doctag">@link</span> MemoryCache&#125;.</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">memoryCacheSize</span><span class="params">(<span class="keyword">int</span> memoryCacheSize)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (memoryCacheSize &lt;= <span class="number">0</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"memoryCacheSize must be a positive number"</span>);</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (memoryCache != <span class="keyword">null</span>) &#123;</div><div class="line">                L.w(WARNING_OVERLAP_MEMORY_CACHE);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">this</span>.memoryCacheSize = memoryCacheSize;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets maximum memory cache size (in percent of available app memory) for &#123;<span class="doctag">@link</span> android.graphics.Bitmap</div><div class="line">         * bitmaps&#125;.&lt;br /&gt;</div><div class="line">         * Default value - 1/8 of available app memory.&lt;br /&gt;</div><div class="line">         * &lt;b&gt;<span class="doctag">NOTE:</span>&lt;/b&gt; If you use this method then</div><div class="line">         * &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.cache.memory.impl.LruMemoryCache LruMemoryCache&#125; will be used as</div><div class="line">         * memory cache. You can use &#123;<span class="doctag">@link</span> #memoryCache(MemoryCache)&#125; method to set your own implementation of</div><div class="line">         * &#123;<span class="doctag">@link</span> MemoryCache&#125;.</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">memoryCacheSizePercentage</span><span class="params">(<span class="keyword">int</span> availableMemoryPercent)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (availableMemoryPercent &lt;= <span class="number">0</span> || availableMemoryPercent &gt;= <span class="number">100</span>) &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"availableMemoryPercent must be in range (0 &lt; % &lt; 100)"</span>);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (memoryCache != <span class="keyword">null</span>) &#123;</div><div class="line">                L.w(WARNING_OVERLAP_MEMORY_CACHE);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">long</span> availableMemory = Runtime.getRuntime().maxMemory();</div><div class="line">            memoryCacheSize = (<span class="keyword">int</span>) (availableMemory * (availableMemoryPercent / <span class="number">100f</span>));</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets memory cache for &#123;<span class="doctag">@link</span> android.graphics.Bitmap bitmaps&#125;.&lt;br /&gt;</div><div class="line">         * Default value - &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.cache.memory.impl.LruMemoryCache LruMemoryCache&#125;</div><div class="line">         * with limited memory cache size (size = 1/8 of available app memory)&lt;br /&gt;</div><div class="line">         * &lt;br /&gt;</div><div class="line">         * &lt;b&gt;<span class="doctag">NOTE:</span>&lt;/b&gt; If you set custom memory cache then following configuration option will not be considered:</div><div class="line">         * &lt;ul&gt;</div><div class="line">         * &lt;li&gt;&#123;<span class="doctag">@link</span> #memoryCacheSize(int)&#125;&lt;/li&gt;</div><div class="line">         * &lt;/ul&gt;</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">memoryCache</span><span class="params">(MemoryCache memoryCache)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (memoryCacheSize != <span class="number">0</span>) &#123;</div><div class="line">                L.w(WARNING_OVERLAP_MEMORY_CACHE);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">this</span>.memoryCache = memoryCache;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/** <span class="doctag">@deprecated</span> Use &#123;<span class="doctag">@link</span> #diskCacheSize(int)&#125; instead */</span></div><div class="line">        <span class="meta">@Deprecated</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">discCacheSize</span><span class="params">(<span class="keyword">int</span> maxCacheSize)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> diskCacheSize(maxCacheSize);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets maximum disk cache size for images (in bytes).&lt;br /&gt;</div><div class="line">         * By default: disk cache is unlimited.&lt;br /&gt;</div><div class="line">         * &lt;b&gt;<span class="doctag">NOTE:</span>&lt;/b&gt; If you use this method then</div><div class="line">         * &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.cache.disc.impl.ext.LruDiscCache LruDiscCache&#125;</div><div class="line">         * will be used as disk cache. You can use &#123;<span class="doctag">@link</span> #diskCache(DiskCache)&#125; method for introduction your own</div><div class="line">         * implementation of &#123;<span class="doctag">@link</span> DiskCache&#125;</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">diskCacheSize</span><span class="params">(<span class="keyword">int</span> maxCacheSize)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (maxCacheSize &lt;= <span class="number">0</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"maxCacheSize must be a positive number"</span>);</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (diskCache != <span class="keyword">null</span>) &#123;</div><div class="line">                L.w(WARNING_OVERLAP_DISK_CACHE_PARAMS);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">this</span>.diskCacheSize = maxCacheSize;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/** <span class="doctag">@deprecated</span> Use &#123;<span class="doctag">@link</span> #diskCacheFileCount(int)&#125; instead */</span></div><div class="line">        <span class="meta">@Deprecated</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">discCacheFileCount</span><span class="params">(<span class="keyword">int</span> maxFileCount)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> diskCacheFileCount(maxFileCount);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets maximum file count in disk cache directory.&lt;br /&gt;</div><div class="line">         * By default: disk cache is unlimited.&lt;br /&gt;</div><div class="line">         * &lt;b&gt;<span class="doctag">NOTE:</span>&lt;/b&gt; If you use this method then</div><div class="line">         * &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.cache.disc.impl.ext.LruDiscCache LruDiscCache&#125;</div><div class="line">         * will be used as disk cache. You can use &#123;<span class="doctag">@link</span> #diskCache(DiskCache)&#125; method for introduction your own</div><div class="line">         * implementation of &#123;<span class="doctag">@link</span> DiskCache&#125;</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">diskCacheFileCount</span><span class="params">(<span class="keyword">int</span> maxFileCount)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (maxFileCount &lt;= <span class="number">0</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"maxFileCount must be a positive number"</span>);</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (diskCache != <span class="keyword">null</span>) &#123;</div><div class="line">                L.w(WARNING_OVERLAP_DISK_CACHE_PARAMS);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">this</span>.diskCacheFileCount = maxFileCount;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/** <span class="doctag">@deprecated</span> Use &#123;<span class="doctag">@link</span> #diskCacheFileNameGenerator(com.nostra13.universalimageloader.cache.disc.naming.FileNameGenerator)&#125; */</span></div><div class="line">        <span class="meta">@Deprecated</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">discCacheFileNameGenerator</span><span class="params">(FileNameGenerator fileNameGenerator)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> diskCacheFileNameGenerator(fileNameGenerator);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets name generator for files cached in disk cache.&lt;br /&gt;</div><div class="line">         * Default value -</div><div class="line">         * &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.core.DefaultConfigurationFactory#createFileNameGenerator()</div><div class="line">         * DefaultConfigurationFactory.createFileNameGenerator()&#125;</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">diskCacheFileNameGenerator</span><span class="params">(FileNameGenerator fileNameGenerator)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (diskCache != <span class="keyword">null</span>) &#123;</div><div class="line">                L.w(WARNING_OVERLAP_DISK_CACHE_NAME_GENERATOR);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">this</span>.diskCacheFileNameGenerator = fileNameGenerator;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/** <span class="doctag">@deprecated</span> Use &#123;<span class="doctag">@link</span> #diskCache(com.nostra13.universalimageloader.cache.disc.DiskCache)&#125; */</span></div><div class="line">        <span class="meta">@Deprecated</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">discCache</span><span class="params">(DiskCache diskCache)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> diskCache(diskCache);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets disk cache for images.&lt;br /&gt;</div><div class="line">         * Default value - &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.cache.disc.impl.UnlimitedDiscCache</div><div class="line">         * BaseDiscCache&#125;. Cache directory is defined by</div><div class="line">         * &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.utils.StorageUtils#getCacheDirectory(Context)</div><div class="line">         * StorageUtils.getCacheDirectory(Context)&#125;.&lt;br /&gt;</div><div class="line">         * &lt;br /&gt;</div><div class="line">         * &lt;b&gt;<span class="doctag">NOTE:</span>&lt;/b&gt; If you set custom disk cache then following configuration option will not be considered:</div><div class="line">         * &lt;ul&gt;</div><div class="line">         * &lt;li&gt;&#123;<span class="doctag">@link</span> #diskCacheSize(int)&#125;&lt;/li&gt;</div><div class="line">         * &lt;li&gt;&#123;<span class="doctag">@link</span> #diskCacheFileCount(int)&#125;&lt;/li&gt;</div><div class="line">         * &lt;li&gt;&#123;<span class="doctag">@link</span> #diskCacheFileNameGenerator(FileNameGenerator)&#125;&lt;/li&gt;</div><div class="line">         * &lt;/ul&gt;</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">diskCache</span><span class="params">(DiskCache diskCache)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (diskCacheSize &gt; <span class="number">0</span> || diskCacheFileCount &gt; <span class="number">0</span>) &#123;</div><div class="line">                L.w(WARNING_OVERLAP_DISK_CACHE_PARAMS);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (diskCacheFileNameGenerator != <span class="keyword">null</span>) &#123;</div><div class="line">                L.w(WARNING_OVERLAP_DISK_CACHE_NAME_GENERATOR);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">this</span>.diskCache = diskCache;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets utility which will be responsible for downloading of image.&lt;br /&gt;</div><div class="line">         * Default value -</div><div class="line">         * &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.core.DefaultConfigurationFactory#createImageDownloader(Context)</div><div class="line">         * DefaultConfigurationFactory.createImageDownloader()&#125;</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">imageDownloader</span><span class="params">(ImageDownloader imageDownloader)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.downloader = imageDownloader;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets utility which will be responsible for decoding of image stream.&lt;br /&gt;</div><div class="line">         * Default value -</div><div class="line">         * &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.core.DefaultConfigurationFactory#createImageDecoder(boolean)</div><div class="line">         * DefaultConfigurationFactory.createImageDecoder()&#125;</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">imageDecoder</span><span class="params">(ImageDecoder imageDecoder)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.decoder = imageDecoder;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets default &#123;<span class="doctag">@linkplain</span> DisplayImageOptions display image options&#125; for image displaying. These options will</div><div class="line">         * be used for every &#123;<span class="doctag">@linkplain</span> ImageLoader#displayImage(String, android.widget.ImageView) image display call&#125;</div><div class="line">         * without passing custom &#123;<span class="doctag">@linkplain</span> DisplayImageOptions options&#125;&lt;br /&gt;</div><div class="line">         * Default value - &#123;<span class="doctag">@link</span> DisplayImageOptions#createSimple() Simple options&#125;</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">defaultDisplayImageOptions</span><span class="params">(DisplayImageOptions defaultDisplayImageOptions)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.defaultDisplayImageOptions = defaultDisplayImageOptions;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Enables detail logging of &#123;<span class="doctag">@link</span> ImageLoader&#125; work. To prevent detail logs don't call this method.</div><div class="line">         * Consider &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.utils.L#disableLogging()&#125; to disable</div><div class="line">         * ImageLoader logging completely (even error logs)</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">writeDebugLogs</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.writeLogs = <span class="keyword">true</span>;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/** Builds configured &#123;<span class="doctag">@link</span> ImageLoaderConfiguration&#125; object */</span></div><div class="line">        <span class="function"><span class="keyword">public</span> ImageLoaderConfiguration <span class="title">build</span><span class="params">()</span> </span>&#123;</div><div class="line">            initEmptyFieldsWithDefaultValues();</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ImageLoaderConfiguration(<span class="keyword">this</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initEmptyFieldsWithDefaultValues</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (taskExecutor == <span class="keyword">null</span>) &#123;</div><div class="line">                taskExecutor = DefaultConfigurationFactory</div><div class="line">                        .createExecutor(threadPoolSize, threadPriority, tasksProcessingType);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                customExecutor = <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (taskExecutorForCachedImages == <span class="keyword">null</span>) &#123;</div><div class="line">                taskExecutorForCachedImages = DefaultConfigurationFactory</div><div class="line">                        .createExecutor(threadPoolSize, threadPriority, tasksProcessingType);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                customExecutorForCachedImages = <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (diskCache == <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">if</span> (diskCacheFileNameGenerator == <span class="keyword">null</span>) &#123;</div><div class="line">                    diskCacheFileNameGenerator = DefaultConfigurationFactory.createFileNameGenerator();</div><div class="line">                &#125;</div><div class="line">                diskCache = DefaultConfigurationFactory</div><div class="line">                        .createDiskCache(context, diskCacheFileNameGenerator, diskCacheSize, diskCacheFileCount);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (memoryCache == <span class="keyword">null</span>) &#123;</div><div class="line">                memoryCache = DefaultConfigurationFactory.createMemoryCache(memoryCacheSize);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (denyCacheImageMultipleSizesInMemory) &#123;</div><div class="line">                memoryCache = <span class="keyword">new</span> FuzzyKeyMemoryCache(memoryCache, MemoryCacheUtils.createFuzzyKeyComparator());</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (downloader == <span class="keyword">null</span>) &#123;</div><div class="line">                downloader = DefaultConfigurationFactory.createImageDownloader(context);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (decoder == <span class="keyword">null</span>) &#123;</div><div class="line">                decoder = DefaultConfigurationFactory.createImageDecoder(writeLogs);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (defaultDisplayImageOptions == <span class="keyword">null</span>) &#123;</div><div class="line">                defaultDisplayImageOptions = DisplayImageOptions.createSimple();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Decorator. Prevents downloads from network (throws &#123;<span class="doctag">@link</span> IllegalStateException exception&#125;).&lt;br /&gt;</div><div class="line">     * In most cases this downloader shouldn't be used directly.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@author</span> Sergey Tarasevich (nostra13[at]gmail[dot]com)</div><div class="line">     * <span class="doctag">@since</span> 1.8.0</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">NetworkDeniedImageDownloader</span> <span class="keyword">implements</span> <span class="title">ImageDownloader</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> ImageDownloader wrappedDownloader;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">NetworkDeniedImageDownloader</span><span class="params">(ImageDownloader wrappedDownloader)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.wrappedDownloader = wrappedDownloader;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> InputStream <span class="title">getStream</span><span class="params">(String imageUri, Object extra)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">            <span class="keyword">switch</span> (Scheme.ofUri(imageUri)) &#123;</div><div class="line">                <span class="keyword">case</span> HTTP:</div><div class="line">                <span class="keyword">case</span> HTTPS:</div><div class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</div><div class="line">                <span class="keyword">default</span>:</div><div class="line">                    <span class="keyword">return</span> wrappedDownloader.getStream(imageUri, extra);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Decorator. Handles &lt;a href="http://code.google.com/p/android/issues/detail?id=6066"&gt;this problem&lt;/a&gt; on slow networks</div><div class="line">     * using &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.core.assist.FlushedInputStream&#125;.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@author</span> Sergey Tarasevich (nostra13[at]gmail[dot]com)</div><div class="line">     * <span class="doctag">@since</span> 1.8.1</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SlowNetworkImageDownloader</span> <span class="keyword">implements</span> <span class="title">ImageDownloader</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> ImageDownloader wrappedDownloader;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SlowNetworkImageDownloader</span><span class="params">(ImageDownloader wrappedDownloader)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.wrappedDownloader = wrappedDownloader;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> InputStream <span class="title">getStream</span><span class="params">(String imageUri, Object extra)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">            InputStream imageStream = wrappedDownloader.getStream(imageUri, extra);</div><div class="line">            <span class="keyword">switch</span> (Scheme.ofUri(imageUri)) &#123;</div><div class="line">                <span class="keyword">case</span> HTTP:</div><div class="line">                <span class="keyword">case</span> HTTPS:</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> FlushedInputStream(imageStream);</div><div class="line">                <span class="keyword">default</span>:</div><div class="line">                    <span class="keyword">return</span> imageStream;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Display-Options"><a href="#Display-Options" class="headerlink" title="Display Options"></a>Display Options</h3><p>每一个ImageLoader.displayImage(…)都可以使用Display Options。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">DisplayImageOptions options = <span class="keyword">new</span> DisplayImageOptions.Builder()</div><div class="line">        .showImageOnLoading(R.drawable.ic_stub) <span class="comment">// resource or drawable</span></div><div class="line">        .showImageForEmptyUri(R.drawable.ic_empty) <span class="comment">// resource or drawable</span></div><div class="line">        .showImageOnFail(R.drawable.ic_error) <span class="comment">// resource or drawable</span></div><div class="line">        .resetViewBeforeLoading(<span class="keyword">false</span>)  <span class="comment">// default</span></div><div class="line">        .delayBeforeLoading(<span class="number">1000</span>)</div><div class="line">        .cacheInMemory(<span class="keyword">false</span>) <span class="comment">// default</span></div><div class="line">        .cacheOnDisk(<span class="keyword">false</span>) <span class="comment">// default</span></div><div class="line">        .preProcessor(...)</div><div class="line">        .postProcessor(...)</div><div class="line">        .extraForDownloader(...)</div><div class="line">        .considerExifParams(<span class="keyword">false</span>) <span class="comment">// default</span></div><div class="line">        .imageScaleType(ImageScaleType.IN_SAMPLE_POWER_OF_2) <span class="comment">// default</span></div><div class="line">        .bitmapConfig(Bitmap.Config.ARGB_8888) <span class="comment">// default</span></div><div class="line">        .decodingOptions(...)</div><div class="line">        .displayer(<span class="keyword">new</span> SimpleBitmapDisplayer()) <span class="comment">// default</span></div><div class="line">        .handler(<span class="keyword">new</span> Handler()) <span class="comment">// default</span></div><div class="line">        .build();</div></pre></td></tr></table></figure></p>
<p> Display Options的主要职责就是记录相关的配置，它的内部其实就是一些字段的集合（如下面的源代码）。它有一个builder的内部类，这个类中的字段跟DisplayOption中的字段完全一致，它有一些默认值，通过修改builder可以配置DisplayOptions。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">DisplayImageOptions</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> imageResOnLoading;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> imageResForEmptyUri;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> imageResOnFail;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Drawable imageOnLoading;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Drawable imageForEmptyUri;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Drawable imageOnFail;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> resetViewBeforeLoading;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> cacheInMemory;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> cacheOnDisk;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ImageScaleType imageScaleType;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Options decodingOptions;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> delayBeforeLoading;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> considerExifParams;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object extraForDownloader;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BitmapProcessor preProcessor;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BitmapProcessor postProcessor;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BitmapDisplayer displayer;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Handler handler;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> isSyncLoading;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">DisplayImageOptions</span><span class="params">(Builder builder)</span> </span>&#123;</div><div class="line">        imageResOnLoading = builder.imageResOnLoading;</div><div class="line">        imageResForEmptyUri = builder.imageResForEmptyUri;</div><div class="line">        imageResOnFail = builder.imageResOnFail;</div><div class="line">        imageOnLoading = builder.imageOnLoading;</div><div class="line">        imageForEmptyUri = builder.imageForEmptyUri;</div><div class="line">        imageOnFail = builder.imageOnFail;</div><div class="line">        resetViewBeforeLoading = builder.resetViewBeforeLoading;</div><div class="line">        cacheInMemory = builder.cacheInMemory;</div><div class="line">        cacheOnDisk = builder.cacheOnDisk;</div><div class="line">        imageScaleType = builder.imageScaleType;</div><div class="line">        decodingOptions = builder.decodingOptions;</div><div class="line">        delayBeforeLoading = builder.delayBeforeLoading;</div><div class="line">        considerExifParams = builder.considerExifParams;</div><div class="line">        extraForDownloader = builder.extraForDownloader;</div><div class="line">        preProcessor = builder.preProcessor;</div><div class="line">        postProcessor = builder.postProcessor;</div><div class="line">        displayer = builder.displayer;</div><div class="line">        handler = builder.handler;</div><div class="line">        isSyncLoading = builder.isSyncLoading;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldShowImageOnLoading</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> imageOnLoading != <span class="keyword">null</span> || imageResOnLoading != <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldShowImageForEmptyUri</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> imageForEmptyUri != <span class="keyword">null</span> || imageResForEmptyUri != <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldShowImageOnFail</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> imageOnFail != <span class="keyword">null</span> || imageResOnFail != <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldPreProcess</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> preProcessor != <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldPostProcess</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> postProcessor != <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldDelayBeforeLoading</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> delayBeforeLoading &gt; <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Drawable <span class="title">getImageOnLoading</span><span class="params">(Resources res)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> imageResOnLoading != <span class="number">0</span> ? res.getDrawable(imageResOnLoading) : imageOnLoading;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Drawable <span class="title">getImageForEmptyUri</span><span class="params">(Resources res)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> imageResForEmptyUri != <span class="number">0</span> ? res.getDrawable(imageResForEmptyUri) : imageForEmptyUri;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Drawable <span class="title">getImageOnFail</span><span class="params">(Resources res)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> imageResOnFail != <span class="number">0</span> ? res.getDrawable(imageResOnFail) : imageOnFail;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isResetViewBeforeLoading</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> resetViewBeforeLoading;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCacheInMemory</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> cacheInMemory;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCacheOnDisk</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> cacheOnDisk;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> ImageScaleType <span class="title">getImageScaleType</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> imageScaleType;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Options <span class="title">getDecodingOptions</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> decodingOptions;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getDelayBeforeLoading</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> delayBeforeLoading;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isConsiderExifParams</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> considerExifParams;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getExtraForDownloader</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> extraForDownloader;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> BitmapProcessor <span class="title">getPreProcessor</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> preProcessor;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> BitmapProcessor <span class="title">getPostProcessor</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> postProcessor;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> BitmapDisplayer <span class="title">getDisplayer</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> displayer;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Handler <span class="title">getHandler</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> handler;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isSyncLoading</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> isSyncLoading;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Builder for &#123;<span class="doctag">@link</span> DisplayImageOptions&#125;</div><div class="line">     *</div><div class="line">     * <span class="doctag">@author</span> Sergey Tarasevich (nostra13[at]gmail[dot]com)</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> imageResOnLoading = <span class="number">0</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> imageResForEmptyUri = <span class="number">0</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> imageResOnFail = <span class="number">0</span>;</div><div class="line">        <span class="keyword">private</span> Drawable imageOnLoading = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">private</span> Drawable imageForEmptyUri = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">private</span> Drawable imageOnFail = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> resetViewBeforeLoading = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> cacheInMemory = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> cacheOnDisk = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">private</span> ImageScaleType imageScaleType = ImageScaleType.IN_SAMPLE_POWER_OF_2;</div><div class="line">        <span class="keyword">private</span> Options decodingOptions = <span class="keyword">new</span> Options();</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> delayBeforeLoading = <span class="number">0</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> considerExifParams = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">private</span> Object extraForDownloader = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">private</span> BitmapProcessor preProcessor = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">private</span> BitmapProcessor postProcessor = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">private</span> BitmapDisplayer displayer = DefaultConfigurationFactory.createBitmapDisplayer();</div><div class="line">        <span class="keyword">private</span> Handler handler = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> isSyncLoading = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">()</span> </span>&#123;</div><div class="line">            decodingOptions.inPurgeable = <span class="keyword">true</span>;</div><div class="line">            decodingOptions.inInputShareable = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Stub image will be displayed in &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.core.imageaware.ImageAware</div><div class="line">         * image aware view&#125; during image loading</div><div class="line">         *</div><div class="line">         * <span class="doctag">@param</span> imageRes Stub image resource</div><div class="line">         * <span class="doctag">@deprecated</span> Use &#123;<span class="doctag">@link</span> #showImageOnLoading(int)&#125; instead</div><div class="line">         */</div><div class="line">        <span class="meta">@Deprecated</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">showStubImage</span><span class="params">(<span class="keyword">int</span> imageRes)</span> </span>&#123;</div><div class="line">            imageResOnLoading = imageRes;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Incoming image will be displayed in &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.core.imageaware.ImageAware</div><div class="line">         * image aware view&#125; during image loading</div><div class="line">         *</div><div class="line">         * <span class="doctag">@param</span> imageRes Image resource</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">showImageOnLoading</span><span class="params">(<span class="keyword">int</span> imageRes)</span> </span>&#123;</div><div class="line">            imageResOnLoading = imageRes;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Incoming drawable will be displayed in &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.core.imageaware.ImageAware</div><div class="line">         * image aware view&#125; during image loading.</div><div class="line">         * This option will be ignored if &#123;<span class="doctag">@link</span> DisplayImageOptions.Builder#showImageOnLoading(int)&#125; is set.</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">showImageOnLoading</span><span class="params">(Drawable drawable)</span> </span>&#123;</div><div class="line">            imageOnLoading = drawable;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Incoming image will be displayed in &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.core.imageaware.ImageAware</div><div class="line">         * image aware view&#125; if empty URI (null or empty</div><div class="line">         * string) will be passed to &lt;b&gt;ImageLoader.displayImage(...)&lt;/b&gt; method.</div><div class="line">         *</div><div class="line">         * <span class="doctag">@param</span> imageRes Image resource</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">showImageForEmptyUri</span><span class="params">(<span class="keyword">int</span> imageRes)</span> </span>&#123;</div><div class="line">            imageResForEmptyUri = imageRes;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Incoming drawable will be displayed in &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.core.imageaware.ImageAware</div><div class="line">         * image aware view&#125; if empty URI (null or empty</div><div class="line">         * string) will be passed to &lt;b&gt;ImageLoader.displayImage(...)&lt;/b&gt; method.</div><div class="line">         * This option will be ignored if &#123;<span class="doctag">@link</span> DisplayImageOptions.Builder#showImageForEmptyUri(int)&#125; is set.</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">showImageForEmptyUri</span><span class="params">(Drawable drawable)</span> </span>&#123;</div><div class="line">            imageForEmptyUri = drawable;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Incoming image will be displayed in &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.core.imageaware.ImageAware</div><div class="line">         * image aware view&#125; if some error occurs during</div><div class="line">         * requested image loading/decoding.</div><div class="line">         *</div><div class="line">         * <span class="doctag">@param</span> imageRes Image resource</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">showImageOnFail</span><span class="params">(<span class="keyword">int</span> imageRes)</span> </span>&#123;</div><div class="line">            imageResOnFail = imageRes;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Incoming drawable will be displayed in &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.core.imageaware.ImageAware</div><div class="line">         * image aware view&#125; if some error occurs during</div><div class="line">         * requested image loading/decoding.</div><div class="line">         * This option will be ignored if &#123;<span class="doctag">@link</span> DisplayImageOptions.Builder#showImageOnFail(int)&#125; is set.</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">showImageOnFail</span><span class="params">(Drawable drawable)</span> </span>&#123;</div><div class="line">            imageOnFail = drawable;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.core.imageaware.ImageAware</div><div class="line">         * image aware view&#125; will be reset (set &lt;b&gt;null&lt;/b&gt;) before image loading start</div><div class="line">         *</div><div class="line">         * <span class="doctag">@deprecated</span> Use &#123;<span class="doctag">@link</span> #resetViewBeforeLoading(boolean) resetViewBeforeLoading(true)&#125; instead</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">resetViewBeforeLoading</span><span class="params">()</span> </span>&#123;</div><div class="line">            resetViewBeforeLoading = <span class="keyword">true</span>;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets whether &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.core.imageaware.ImageAware</div><div class="line">         * image aware view&#125; will be reset (set &lt;b&gt;null&lt;/b&gt;) before image loading start</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">resetViewBeforeLoading</span><span class="params">(<span class="keyword">boolean</span> resetViewBeforeLoading)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.resetViewBeforeLoading = resetViewBeforeLoading;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Loaded image will be cached in memory</div><div class="line">         *</div><div class="line">         * <span class="doctag">@deprecated</span> Use &#123;<span class="doctag">@link</span> #cacheInMemory(boolean) cacheInMemory(true)&#125; instead</div><div class="line">         */</div><div class="line">        <span class="meta">@Deprecated</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">cacheInMemory</span><span class="params">()</span> </span>&#123;</div><div class="line">            cacheInMemory = <span class="keyword">true</span>;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/** Sets whether loaded image will be cached in memory */</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">cacheInMemory</span><span class="params">(<span class="keyword">boolean</span> cacheInMemory)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.cacheInMemory = cacheInMemory;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Loaded image will be cached on disk</div><div class="line">         *</div><div class="line">         * <span class="doctag">@deprecated</span> Use &#123;<span class="doctag">@link</span> #cacheOnDisk(boolean) cacheOnDisk(true)&#125; instead</div><div class="line">         */</div><div class="line">        <span class="meta">@Deprecated</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">cacheOnDisc</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> cacheOnDisk(<span class="keyword">true</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets whether loaded image will be cached on disk</div><div class="line">         *</div><div class="line">         * <span class="doctag">@deprecated</span> Use &#123;<span class="doctag">@link</span> #cacheOnDisk(boolean)&#125; instead</div><div class="line">         */</div><div class="line">        <span class="meta">@Deprecated</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">cacheOnDisc</span><span class="params">(<span class="keyword">boolean</span> cacheOnDisk)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> cacheOnDisk(cacheOnDisk);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/** Sets whether loaded image will be cached on disk */</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">cacheOnDisk</span><span class="params">(<span class="keyword">boolean</span> cacheOnDisk)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.cacheOnDisk = cacheOnDisk;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets &#123;<span class="doctag">@linkplain</span> ImageScaleType scale type&#125; for decoding image. This parameter is used while define scale</div><div class="line">         * size for decoding image to Bitmap. Default value - &#123;<span class="doctag">@link</span> ImageScaleType#IN_SAMPLE_POWER_OF_2&#125;</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">imageScaleType</span><span class="params">(ImageScaleType imageScaleType)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.imageScaleType = imageScaleType;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/** Sets &#123;<span class="doctag">@link</span> Bitmap.Config bitmap config&#125; for image decoding. Default value - &#123;<span class="doctag">@link</span> Bitmap.Config#ARGB_8888&#125; */</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">bitmapConfig</span><span class="params">(Bitmap.Config bitmapConfig)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (bitmapConfig == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"bitmapConfig can't be null"</span>);</div><div class="line">            decodingOptions.inPreferredConfig = bitmapConfig;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets options for image decoding.&lt;br /&gt;</div><div class="line">         * &lt;b&gt;<span class="doctag">NOTE:</span>&lt;/b&gt; &#123;<span class="doctag">@link</span> Options#inSampleSize&#125; of incoming options will &lt;b&gt;NOT&lt;/b&gt; be considered. Library</div><div class="line">         * calculate the most appropriate sample size itself according yo &#123;<span class="doctag">@link</span> #imageScaleType(ImageScaleType)&#125;</div><div class="line">         * options.&lt;br /&gt;</div><div class="line">         * &lt;b&gt;<span class="doctag">NOTE:</span>&lt;/b&gt; This option overlaps &#123;<span class="doctag">@link</span> #bitmapConfig(android.graphics.Bitmap.Config) bitmapConfig()&#125;</div><div class="line">         * option.</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">decodingOptions</span><span class="params">(Options decodingOptions)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (decodingOptions == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"decodingOptions can't be null"</span>);</div><div class="line">            <span class="keyword">this</span>.decodingOptions = decodingOptions;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/** Sets delay time before starting loading task. Default - no delay. */</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">delayBeforeLoading</span><span class="params">(<span class="keyword">int</span> delayInMillis)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.delayBeforeLoading = delayInMillis;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/** Sets auxiliary object which will be passed to &#123;<span class="doctag">@link</span> ImageDownloader#getStream(String, Object)&#125; */</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">extraForDownloader</span><span class="params">(Object extra)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.extraForDownloader = extra;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/** Sets whether ImageLoader will consider EXIF parameters of JPEG image (rotate, flip) */</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">considerExifParams</span><span class="params">(<span class="keyword">boolean</span> considerExifParams)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.considerExifParams = considerExifParams;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets bitmap processor which will be process bitmaps before they will be cached in memory. So memory cache</div><div class="line">         * will contain bitmap processed by incoming preProcessor.&lt;br /&gt;</div><div class="line">         * Image will be pre-processed even if caching in memory is disabled.</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">preProcessor</span><span class="params">(BitmapProcessor preProcessor)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.preProcessor = preProcessor;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets bitmap processor which will be process bitmaps before they will be displayed in</div><div class="line">         * &#123;<span class="doctag">@link</span> com.nostra13.universalimageloader.core.imageaware.ImageAware image aware view&#125; but</div><div class="line">         * after they'll have been saved in memory cache.</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">postProcessor</span><span class="params">(BitmapProcessor postProcessor)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.postProcessor = postProcessor;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets custom &#123;<span class="doctag">@link</span> BitmapDisplayer displayer&#125; for image loading task. Default value -</div><div class="line">         * &#123;<span class="doctag">@link</span> DefaultConfigurationFactory#createBitmapDisplayer()&#125;</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">displayer</span><span class="params">(BitmapDisplayer displayer)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (displayer == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"displayer can't be null"</span>);</div><div class="line">            <span class="keyword">this</span>.displayer = displayer;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function">Builder <span class="title">syncLoading</span><span class="params">(<span class="keyword">boolean</span> isSyncLoading)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.isSyncLoading = isSyncLoading;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * Sets custom &#123;<span class="doctag">@linkplain</span> Handler handler&#125; for displaying images and firing &#123;<span class="doctag">@linkplain</span> ImageLoadingListener</div><div class="line">         * listener&#125; events.</div><div class="line">         */</div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">handler</span><span class="params">(Handler handler)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.handler = handler;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/** Sets all options equal to incoming options */</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">cloneFrom</span><span class="params">(DisplayImageOptions options)</span> </span>&#123;</div><div class="line">            imageResOnLoading = options.imageResOnLoading;</div><div class="line">            imageResForEmptyUri = options.imageResForEmptyUri;</div><div class="line">            imageResOnFail = options.imageResOnFail;</div><div class="line">            imageOnLoading = options.imageOnLoading;</div><div class="line">            imageForEmptyUri = options.imageForEmptyUri;</div><div class="line">            imageOnFail = options.imageOnFail;</div><div class="line">            resetViewBeforeLoading = options.resetViewBeforeLoading;</div><div class="line">            cacheInMemory = options.cacheInMemory;</div><div class="line">            cacheOnDisk = options.cacheOnDisk;</div><div class="line">            imageScaleType = options.imageScaleType;</div><div class="line">            decodingOptions = options.decodingOptions;</div><div class="line">            delayBeforeLoading = options.delayBeforeLoading;</div><div class="line">            considerExifParams = options.considerExifParams;</div><div class="line">            extraForDownloader = options.extraForDownloader;</div><div class="line">            preProcessor = options.preProcessor;</div><div class="line">            postProcessor = options.postProcessor;</div><div class="line">            displayer = options.displayer;</div><div class="line">            handler = options.handler;</div><div class="line">            isSyncLoading = options.isSyncLoading;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/** Builds configured &#123;<span class="doctag">@link</span> DisplayImageOptions&#125; object */</span></div><div class="line">        <span class="function"><span class="keyword">public</span> DisplayImageOptions <span class="title">build</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> DisplayImageOptions(<span class="keyword">this</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Creates options appropriate for single displaying:</div><div class="line">     * &lt;ul&gt;</div><div class="line">     * &lt;li&gt;View will &lt;b&gt;not&lt;/b&gt; be reset before loading&lt;/li&gt;</div><div class="line">     * &lt;li&gt;Loaded image will &lt;b&gt;not&lt;/b&gt; be cached in memory&lt;/li&gt;</div><div class="line">     * &lt;li&gt;Loaded image will &lt;b&gt;not&lt;/b&gt; be cached on disk&lt;/li&gt;</div><div class="line">     * &lt;li&gt;&#123;<span class="doctag">@link</span> ImageScaleType#IN_SAMPLE_POWER_OF_2&#125; decoding type will be used&lt;/li&gt;</div><div class="line">     * &lt;li&gt;&#123;<span class="doctag">@link</span> Bitmap.Config#ARGB_8888&#125; bitmap config will be used for image decoding&lt;/li&gt;</div><div class="line">     * &lt;li&gt;&#123;<span class="doctag">@link</span> SimpleBitmapDisplayer&#125; will be used for image displaying&lt;/li&gt;</div><div class="line">     * &lt;/ul&gt;</div><div class="line">     * &lt;p/&gt;</div><div class="line">     * These option are appropriate for simple single-use image (from drawables or from Internet) displaying.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DisplayImageOptions <span class="title">createSimple</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Builder().build();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="http://www.cnblogs.com/kissazi2/p/3886563.html" target="_blank" rel="external">Android-Universal-Image-Loader三大组件详解</a> </li>
<li><a href="http://blog.csdn.net/wangjinyu501/article/details/8091623" target="_blank" rel="external">Android-Universal-Image-Loader应用详解</a></li>
<li><a href="https://github.com/nostra13/Android-Universal-Image-Loader" target="_blank" rel="external">Android-Universal-Image-Loader</a></li>
<li><a href="http://www.intexsoft.com/blog/item/74-universal-image-loader-part-3.html" target="_blank" rel="external">Universal Image Loader. Part 3</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/09/android_imgloader2/" data-id="cj4zx2khv002cqonhsyz09nhm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/imageloader/">imageloader</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_imgloader1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/09/android_imgloader1/" class="article-date">
  <time datetime="2015-11-09T08:50:29.000Z" itemprop="datePublished">2015-11-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/android/">android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/09/android_imgloader1/">Universal-Image-Loader使用详解(一)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Android上最让人头疼的莫过于从网络获取图片、显示、回收，任何一个环节有问题都可能直接OOM，这个项目或许能帮到你。Universal Image Loader for Android的目的是为了实现异步的网络图片加载、缓存及显示，支持多线程异步加载。它最初来源于Fedor Vlasov的项目，且自此之后，经过大规模的重构和改进。</p>
<p>特性列举：</p>
<ul>
<li>多线程下载图片，图片可以来源于网络，文件系统，项目文件夹assets中以及drawable中等</li>
<li>支持随意的配置ImageLoader，例如线程池，图片下载器，内存缓存策略，硬盘缓存策略，图片显示选项以及其他的一些配置</li>
<li>支持图片的内存缓存，文件系统缓存或者SD卡缓存</li>
<li>支持图片下载过程的监听</li>
<li>根据控件(ImageView)的大小对Bitmap进行裁剪，减少Bitmap占用过多的内存</li>
<li>较好的控制图片的加载过程，例如暂停图片加载，重新开始加载图片，一般使用在ListView,GridView中，滑动过程中暂停加载图片，停止滑动的时候去加载图片</li>
<li>提供在较慢的网络下对图片进行加载</li>
</ul>
<h2 id="初始化设置"><a href="#初始化设置" class="headerlink" title="初始化设置"></a>初始化设置</h2><p>创建默认的ImageLoader，所有的操作都由ImageLoader控制。该类使用单例设计模式，所以如果要获取该类的实例，需要调用getInstance()方法。在使用ImageLoader显示图片之前，你首先要初始化它的配置，调用ImageLoaderConfiguration的init()方法，然后你就可以实现各种的显示了。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//创建默认的ImageLoader配置参数    </span></div><div class="line">ImageLoaderConfiguration configuration = ImageLoaderConfiguration.createDefault(<span class="keyword">this</span>);    </div><div class="line"><span class="comment">//Initialize ImageLoader with configuration.    </span></div><div class="line">ImageLoader.getInstance().init(configuration);</div></pre></td></tr></table></figure></p>
<p>自定义配置imageloader, 就像你已经知道的，首先，你需要使用ImageLoaderConfiguration对象来初始化ImageLoader。由于ImageLoader是单例，所以在程序开始的时候只需要初始化一次就好了。建议你在Activity的onCreate（）方法中初始化。如果一个ImageLoader已经初始化过，再次初始化不会有任何效果。下面我们通过ImageLoaderConfiguration.Builder创建一个设置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">File cacheDir =StorageUtils.getOwnCacheDirectory(<span class="keyword">this</span>, <span class="string">"imageloader/Cache"</span>);  </div><div class="line">ImageLoaderConfigurationconfig = <span class="keyword">new</span> ImageLoaderConfiguration   </div><div class="line">          .Builder(<span class="keyword">this</span>)   </div><div class="line">          .memoryCacheExtraOptions(<span class="number">480</span>, <span class="number">800</span>) <span class="comment">// maxwidth, max height，即保存的每个缓存文件的最大长宽   </span></div><div class="line">          .threadPoolSize(<span class="number">3</span>)<span class="comment">//线程池内加载的数量   </span></div><div class="line">          .threadPriority(Thread.NORM_PRIORITY -<span class="number">2</span>)   </div><div class="line">          .denyCacheImageMultipleSizesInMemory()   </div><div class="line">           .memoryCache(<span class="keyword">new</span> UsingFreqLimitedMemoryCache(<span class="number">2</span>* <span class="number">1024</span> * <span class="number">1024</span>)) <span class="comment">// You can pass your own memory cache implementation/你可以通过自己的内存缓存实现   </span></div><div class="line">           .memoryCacheSize(<span class="number">2</span> * <span class="number">1024</span> * <span class="number">1024</span>)     </div><div class="line">          .discCacheSize(<span class="number">50</span> * <span class="number">1024</span> * <span class="number">1024</span>)     </div><div class="line">          .discCacheFileNameGenerator(newMd5FileNameGenerator())<span class="comment">//将保存的时候的URI名称用MD5 加密   </span></div><div class="line">           .tasksProcessingOrder(QueueProcessingType.LIFO)   </div><div class="line">           .discCacheFileCount(<span class="number">100</span>) <span class="comment">//缓存的文件数量   </span></div><div class="line">           .discCache(<span class="keyword">new</span> UnlimitedDiscCache(cacheDir))<span class="comment">//自定义缓存路径   </span></div><div class="line">           .defaultDisplayImageOptions(DisplayImageOptions.createSimple())   </div><div class="line">           .imageDownloader(<span class="keyword">new</span> BaseImageDownloader(<span class="keyword">this</span>,<span class="number">5</span> * <span class="number">1000</span>, <span class="number">30</span> * <span class="number">1000</span>)) <span class="comment">// connectTimeout (5 s), readTimeout (30 s)超时时间   </span></div><div class="line">           .writeDebugLogs() <span class="comment">// Remove for releaseapp   </span></div><div class="line">          .build();<span class="comment">//开始构建   </span></div><div class="line">ImageLoader.getInstance().init(config);  </div><div class="line"></div><div class="line"><span class="comment">//示例：实际开发中的配置</span></div><div class="line">ImageLoaderConfiguration configuration = <span class="keyword">new</span> ImageLoaderConfiguration</div><div class="line">            .Builder(context)</div><div class="line">            .denyCacheImageMultipleSizesInMemory()</div><div class="line">            .threadPoolSize(<span class="number">3</span>)</div><div class="line">            .memoryCache(<span class="keyword">new</span> LruMemoryCache(IMG_MAX_SIZE))</div><div class="line">            .memoryCache(<span class="keyword">new</span> UsingFreqLimitedMemoryCache(IMG_MAX_SIZE))</div><div class="line">            .memoryCacheSize(IMG_MAX_SIZE).memoryCacheSizePercentage(<span class="number">13</span>)</div><div class="line">            .diskCache(<span class="keyword">new</span> UnlimitedDiscCache(<span class="keyword">new</span> File(IMAGE_FILE_PATH)))</div><div class="line">            .diskCacheSize(<span class="number">50</span> * <span class="number">1024</span> * <span class="number">1024</span>)</div><div class="line">            .diskCacheFileNameGenerator(<span class="keyword">new</span> HashCodeFileNameGenerator())</div><div class="line">            .defaultDisplayImageOptions(defaultOption.build())</div><div class="line">            .imageDownloader(<span class="keyword">new</span> BaseImageDownloader(context, <span class="number">5</span> * <span class="number">1000</span>, <span class="number">30</span> * <span class="number">1000</span>))</div><div class="line">            .build();</div><div class="line">ImageLoader.getInstance().init(configuration);</div></pre></td></tr></table></figure>
<p>得到imageLoader<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ImageLoader imageLoader imageLoader = ImageLoader.getInstance();</div></pre></td></tr></table></figure></p>
<h2 id="使用具体配置"><a href="#使用具体配置" class="headerlink" title="使用具体配置"></a>使用具体配置</h2><p>(1)图像操作是否参与缓存以及图像效果的配置操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">DisplayImageOptions options = <span class="keyword">new</span> DisplayImageOptions.Builder()  </div><div class="line">          .showImageOnLoading(R.drawable.ic_stub)            <span class="comment">//加载图片时的图片  </span></div><div class="line">          .showImageForEmptyUri(R.drawable.ic_empty)         <span class="comment">//没有图片资源时的默认图片  </span></div><div class="line">          .showImageOnFail(R.drawable.ic_error)              <span class="comment">//加载失败时的图片  </span></div><div class="line">          .cacheInMemory(<span class="keyword">true</span>)                               <span class="comment">//启用内存缓存  </span></div><div class="line">          .cacheOnDisk(<span class="keyword">true</span>)                                 <span class="comment">//启用外存缓存  </span></div><div class="line">          .considerExifParams(<span class="keyword">true</span>)                          <span class="comment">//启用EXIF和JPEG图像格式  </span></div><div class="line">          .displayer(<span class="keyword">new</span> RoundedBitmapDisplayer(<span class="number">20</span>))         <span class="comment">//设置显示风格这里是圆角矩形  </span></div><div class="line">          .build();</div></pre></td></tr></table></figure>
<p>DisplayImageOptions以下是所有默认配置参数根据需求可以自定义配置<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">int</span> imageResOnLoading = <span class="number">0</span>;  </div><div class="line"> <span class="keyword">private</span> <span class="keyword">int</span> imageResForEmptyUri = <span class="number">0</span>;  </div><div class="line"> <span class="keyword">private</span> <span class="keyword">int</span> imageResOnFail = <span class="number">0</span>;  </div><div class="line"> <span class="keyword">private</span> Drawable imageOnLoading = <span class="keyword">null</span>;  </div><div class="line"> <span class="keyword">private</span> Drawable imageForEmptyUri = <span class="keyword">null</span>;  </div><div class="line"> <span class="keyword">private</span> Drawable imageOnFail = <span class="keyword">null</span>;  </div><div class="line"> <span class="keyword">private</span> <span class="keyword">boolean</span> resetViewBeforeLoading = <span class="keyword">false</span>;  </div><div class="line"> <span class="keyword">private</span> <span class="keyword">boolean</span> cacheInMemory = <span class="keyword">false</span>;  </div><div class="line"> <span class="keyword">private</span> <span class="keyword">boolean</span> cacheOnDisk = <span class="keyword">false</span>;  </div><div class="line"> <span class="keyword">private</span> ImageScaleType imageScaleType = ImageScaleType.IN_SAMPLE_POWER_OF_2;  </div><div class="line"> <span class="keyword">private</span> Options decodingOptions = <span class="keyword">new</span> Options();  </div><div class="line"> <span class="keyword">private</span> <span class="keyword">int</span> delayBeforeLoading = <span class="number">0</span>;  </div><div class="line"> <span class="keyword">private</span> <span class="keyword">boolean</span> considerExifParams = <span class="keyword">false</span>;  </div><div class="line"> <span class="keyword">private</span> Object extraForDownloader = <span class="keyword">null</span>;  </div><div class="line"> <span class="keyword">private</span> BitmapProcessor preProcessor = <span class="keyword">null</span>;  </div><div class="line"> <span class="keyword">private</span> BitmapProcessor postProcessor = <span class="keyword">null</span>;  </div><div class="line"> <span class="keyword">private</span> BitmapDisplayer displayer = DefaultConfigurationFactory.createBitmapDisplayer();  </div><div class="line"> <span class="keyword">private</span> Handler handler = <span class="keyword">null</span>;  </div><div class="line"> <span class="keyword">private</span> <span class="keyword">boolean</span> isSyncLoading = <span class="keyword">false</span>;</div></pre></td></tr></table></figure></p>
<p>（2）图片加载监听器在这里吧可以设置加载时的动画或者进度条之类的东西这里</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">ImageLoadingListener animateFirstListener = <span class="keyword">new</span> AnimateFirstDisplayListener();  </div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AnimateFirstDisplayListener</span> <span class="keyword">extends</span> <span class="title">SimpleImageLoadingListener</span> </span>&#123;  </div><div class="line">        <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; displayedImages = Collections.synchronizedList(<span class="keyword">new</span> LinkedList&lt;String&gt;());  </div><div class="line">         <span class="meta">@Override</span>  </div><div class="line">         <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLoadingComplete</span><span class="params">(String imageUri, View view, Bitmap loadedImage)</span> </span>&#123;  </div><div class="line">              <span class="keyword">if</span> (loadedImage != <span class="keyword">null</span>) &#123;  </div><div class="line">                  ImageView imageView = (ImageView) view;  </div><div class="line">                  <span class="keyword">boolean</span> firstDisplay = !displayedImages.contains(imageUri);  </div><div class="line">                  <span class="keyword">if</span> (firstDisplay) &#123;  </div><div class="line">                       FadeInBitmapDisplayer.animate(imageView, <span class="number">500</span>);  </div><div class="line">                       displayedImages.add(imageUri);  </div><div class="line">                    &#125;  </div><div class="line">              &#125;  </div><div class="line">        &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>（3）简单设置就可以给ImageView添加图片了<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">imageLoader.displayImage(imageUrl, imageview, options, animateFirstListener);</div></pre></td></tr></table></figure></p>
<p>对于本地的图片 ，在其绝对地址前面要加入”file://“。网络图片就直接写路径了。</p>
<p>由于我的这个是最新的包，可能跟以前老的版本不同，看到有些网友说的是：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">String imageUri = <span class="string">"http://site.com/image.png"</span>; <span class="comment">// 网络图片  </span></div><div class="line">String imageUri = <span class="string">"file:///mnt/sdcard/image.png"</span>; <span class="comment">//SD卡图片  </span></div><div class="line">String imageUri = <span class="string">"content://media/external/audio/albumart/13"</span>; <span class="comment">// 媒体文件夹  </span></div><div class="line">String imageUri = <span class="string">"assets://image.png"</span>; <span class="comment">// assets  </span></div><div class="line">String imageUri = <span class="string">"drawable://"</span> + R.drawable.image; <span class="comment">//  drawable文件</span></div></pre></td></tr></table></figure></p>
<h3 id="缓存的清理"><a href="#缓存的清理" class="headerlink" title="缓存的清理"></a>缓存的清理</h3><p>缓存的清理可以按需求来定，可以再每个Activity的生命周期函数onDestroy中清理也可以单独设置让用户自行清理。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span>  </div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;  </div><div class="line">          <span class="keyword">super</span>.onDestroy();  </div><div class="line">          imageLoader.clearMemoryCache();  </div><div class="line">          imageLoader.clearDiskCache();  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="GirdView-ListView加载图片"><a href="#GirdView-ListView加载图片" class="headerlink" title="GirdView,ListView加载图片"></a>GirdView,ListView加载图片</h3><p>相信大部分人都是使用GridView，ListView来显示大量的图片，而当我们快速滑动GridView，ListView，我们希望能停止图片的加载，而在GridView，ListView停止滑动的时候加载当前界面的图片，这个框架当然也提供这个功能，使用起来也很简单，它提供了PauseOnScrollListener这个类来控制ListView,GridView滑动过程中停止去加载图片，该类使用的是代理模式<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">listView.setOnScrollListener(<span class="keyword">new</span> PauseOnScrollListener(imageLoader, pauseOnScroll, pauseOnFling));    </div><div class="line">gridView.setOnScrollListener(<span class="keyword">new</span> PauseOnScrollListener(imageLoader, pauseOnScroll, pauseOnFling));</div></pre></td></tr></table></figure></p>
<p>第一个参数就是我们的图片加载对象ImageLoader, 第二个是控制是否在滑动过程中暂停加载图片，如果需要暂停传true就行了，第三个参数控制猛的滑动界面的时候图片是否加载</p>
<h3 id="OutOfMemoryError："><a href="#OutOfMemoryError：" class="headerlink" title="OutOfMemoryError："></a>OutOfMemoryError：</h3><p>虽然这个框架有很好的缓存机制，有效的避免了OOM的产生，一般的情况下产生OOM的概率比较小，但是并不能保证OutOfMemoryError永远不发生，这个框架对于OutOfMemoryError做了简单的catch,保证我们的程序遇到OOM而不被crash掉，但是如果我们使用该框架经常发生OOM，我们应该怎么去改善呢？</p>
<ul>
<li>减少线程池中线程的个数，在ImageLoaderConfiguration中的（.threadPoolSize）中配置，推荐配置1-5</li>
<li>在DisplayImageOptions选项中配置bitmapConfig为Bitmap.Config.RGB_565，因为默认是ARGB_8888， 使用RGB_565会比使用ARGB_8888少消耗2倍的内存</li>
<li>在ImageLoaderConfiguration中配置图片的内存缓存为memoryCache(newWeakMemoryCache()) 或者不使用内存缓存</li>
<li>在DisplayImageOptions选项中设置.imageScaleType(ImageScaleType.IN_SAMPLE_INT)或者imageScaleType(ImageScaleType.EXACTLY)</li>
</ul>
<p>通过上面这些，相信大家对Universal-Image-Loader框架的使用已经非常的了解了，我们在使用该框架的时候尽量的使用displayImage()方法去加载图片，loadImage()是将图片对象回调到ImageLoadingListener接口的onLoadingComplete()方法中，需要我们手动去设置到ImageView上面，displayImage()方法中，对ImageView对象使用的是Weak references，方便垃圾回收器回收ImageView对象，如果我们要加载固定大小的图片的时候，使用loadImage()方法需要传递一个ImageSize对象，而displayImage()方法会根据ImageView对象的测量值，或者android:layout_width and android:layout_height设定的值，或者android:maxWidth and/or android:maxHeight设定的值来裁剪图片。</p>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a href="http://write.blog.csdn.net/postedit?ref=toolbar" target="_blank" rel="external">Universal-Image-Loader（android图片缓存）</a> </li>
<li><a href="http://blog.csdn.net/wangjinyu501/article/details/8091623" target="_blank" rel="external">Android-Universal-Image-Loader应用详解</a></li>
<li><a href="https://github.com/nostra13/Android-Universal-Image-Loader" target="_blank" rel="external">Android-Universal-Image-Loader</a></li>
<li><a href="http://www.intexsoft.com/blog/item/74-universal-image-loader-part-3.html" target="_blank" rel="external">Universal Image Loader. Part 3</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/09/android_imgloader1/" data-id="cj4zx2khv0029qonh46w3icck" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/imageloader/">imageloader</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_pulltorefresh_listview3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/09/android_pulltorefresh_listview3/" class="article-date">
  <time datetime="2015-11-09T08:03:29.000Z" itemprop="datePublished">2015-11-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/android/">android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/09/android_pulltorefresh_listview3/">PullToRefresh使用详解（三）—— 自定义下拉刷新动画</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>首先，下载著名的刷新框架<a href="https://github.com/chrisbanes/Android-PullToRefresh" target="_blank" rel="external">Android-PullToRefresh</a>，其中simple为demo，library和extras作为项目包导入到simple中。</p>
<h2 id="一，定义刷新动画的layout"><a href="#一，定义刷新动画的layout" class="headerlink" title="一，定义刷新动画的layout"></a>一，定义刷新动画的layout</h2><p>在library下的com.handmark.pulltorefresh.library.internal包中的FlipLoadingLayout和RotateLoadingLayout。</p>
<ul>
<li>FlipLoadingLayout为ios风格的箭头颠倒的刷新动画</li>
<li>RotateLoadingLayout为android风格的图片旋转动画</li>
</ul>
<p>共同的设置方法是</p>
<ul>
<li>1，getDefaultDrawableResId()  //动画默认图片，可以替换为自己的图片</li>
<li>2，refreshingImpl()  //正在刷新时的回调方法，可以设置开始动画</li>
<li>3，resetImpl()  //重置</li>
</ul>
<h2 id="二，正在刷新时为图片居中旋转的效果"><a href="#二，正在刷新时为图片居中旋转的效果" class="headerlink" title="二，正在刷新时为图片居中旋转的效果"></a>二，正在刷新时为图片居中旋转的效果</h2><p>1，首先修改library中的pull_to_refresh_header_vertical.xml，去除文字的layout，图片layout水平居中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;  </div><div class="line"><span class="tag">&lt;<span class="name">merge</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span> &gt;</span>  </div><div class="line">  </div><div class="line">    <span class="tag">&lt;<span class="name">FrameLayout</span>  </span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/fl_inner"</span>  </div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"fill_parent"</span>  </div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>  </div><div class="line">        <span class="attr">android:paddingBottom</span>=<span class="string">"@dimen/header_footer_top_bottom_padding"</span>  </div><div class="line">        <span class="attr">android:paddingLeft</span>=<span class="string">"@dimen/header_footer_left_right_padding"</span>  </div><div class="line">        <span class="attr">android:paddingRight</span>=<span class="string">"@dimen/header_footer_left_right_padding"</span>  </div><div class="line">        <span class="attr">android:paddingTop</span>=<span class="string">"@dimen/header_footer_top_bottom_padding"</span> &gt;  </div><div class="line">  </div><div class="line">        <span class="tag">&lt;<span class="name">FrameLayout</span>  </span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span>  </div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>  </div><div class="line">            <span class="attr">android:layout_gravity</span>=<span class="string">"center_horizontal"</span> &gt;  </div><div class="line">  </div><div class="line">            <span class="tag">&lt;<span class="name">ImageView</span>  </span></div><div class="line">                <span class="attr">android:id</span>=<span class="string">"@+id/pull_to_refresh_image"</span>  </div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span>  </div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>  </div><div class="line">                <span class="attr">android:layout_gravity</span>=<span class="string">"center"</span> /&gt;  </div><div class="line">  </div><div class="line">            <span class="tag">&lt;<span class="name">ProgressBar</span>  </span></div><div class="line">                <span class="attr">android:id</span>=<span class="string">"@+id/pull_to_refresh_progress"</span>  </div><div class="line">                <span class="attr">style</span>=<span class="string">"?android:attr/progressBarStyleSmall"</span>  </div><div class="line">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span>  </div><div class="line">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>  </div><div class="line">                <span class="attr">android:layout_gravity</span>=<span class="string">"center"</span>  </div><div class="line">                <span class="attr">android:indeterminate</span>=<span class="string">"true"</span>  </div><div class="line">                <span class="attr">android:visibility</span>=<span class="string">"gone"</span> /&gt;  </div><div class="line">        <span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span>  </div><div class="line">  </div><div class="line">     <span class="comment">&lt;!--    &lt;LinearLayout  </span></div><div class="line">            android:layout_width="wrap_content"  </div><div class="line">            android:layout_height="wrap_content"  </div><div class="line">            android:layout_gravity="center"  </div><div class="line">            android:gravity="center_horizontal"  </div><div class="line">            android:orientation="vertical" &gt;  </div><div class="line">  </div><div class="line">            &lt;TextView  </div><div class="line">                android:id="@+id/pull_to_refresh_text"  </div><div class="line">                android:layout_width="wrap_content"  </div><div class="line">                android:layout_height="wrap_content"  </div><div class="line">                android:singleLine="true"  </div><div class="line">                android:textAppearance="?android:attr/textAppearance"  </div><div class="line">                android:textStyle="bold" /&gt;  </div><div class="line">  </div><div class="line">            &lt;TextView  </div><div class="line">                android:id="@+id/pull_to_refresh_sub_text"  </div><div class="line">                android:layout_width="wrap_content"  </div><div class="line">                android:layout_height="wrap_content"  </div><div class="line">                android:singleLine="true"  </div><div class="line">                android:textAppearance="?android:attr/textAppearanceSmall"  </div><div class="line">                android:visibility="gone" /&gt;  </div><div class="line">        &lt;/LinearLayout&gt; --&gt;  </div><div class="line">    <span class="tag">&lt;/<span class="name">FrameLayout</span>&gt;</span>  </div><div class="line">  </div><div class="line"><span class="tag">&lt;/<span class="name">merge</span>&gt;</span></div></pre></td></tr></table></figure>
<p>2，去除LoadingLayout中的关于textview的代码。</p>
<p>3，可以在RotateLoadingLayout中的getDefaultDrawableResId()方法替换成自己的图片。</p>
<h2 id="三，设置自定义动画效果"><a href="#三，设置自定义动画效果" class="headerlink" title="三，设置自定义动画效果"></a>三，设置自定义动画效果</h2><p>1，首先设置一个简单的小人走的动画效果，在anim文件夹下新建一个xml，需要加载两张图片，控制图片的停留时间。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;    </div><div class="line"><span class="tag">&lt;<span class="name">animation-list</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>    </span></div><div class="line">    <span class="attr">android:oneshot</span>=<span class="string">"false"</span> &gt;    </div><div class="line">    </div><div class="line">    <span class="tag">&lt;<span class="name">item</span>    </span></div><div class="line">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/app_loading0"</span>    </div><div class="line">        <span class="attr">android:duration</span>=<span class="string">"150"</span>/&gt;    </div><div class="line">    <span class="tag">&lt;<span class="name">item</span>    </span></div><div class="line">        <span class="attr">android:drawable</span>=<span class="string">"@drawable/app_loading1"</span>    </div><div class="line">        <span class="attr">android:duration</span>=<span class="string">"150"</span>/&gt;    </div><div class="line">    </div><div class="line"><span class="tag">&lt;/<span class="name">animation-list</span>&gt;</span></div></pre></td></tr></table></figure>
<p>2，新建刷新动画的layout，TweenAnimLoadingLayout，类似于之前的源码中的FlipLoadingLayout和RotateLoadingLayout</p>
<p>主要设置初始化，和那几个关键方法就行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.handmark.pulltorefresh.library.internal;  </div><div class="line">  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> com.handmark.pulltorefresh.library.R;  </div><div class="line"><span class="keyword">import</span> com.handmark.pulltorefresh.library.PullToRefreshBase.Mode;  </div><div class="line"><span class="keyword">import</span> com.handmark.pulltorefresh.library.PullToRefreshBase.Orientation;  </div><div class="line">  </div><div class="line"><span class="keyword">import</span> android.content.Context;  </div><div class="line"><span class="keyword">import</span> android.content.res.TypedArray;  </div><div class="line"><span class="keyword">import</span> android.graphics.drawable.AnimationDrawable;  </div><div class="line"><span class="keyword">import</span> android.graphics.drawable.Drawable;  </div><div class="line"><span class="keyword">import</span> android.view.View;  </div><div class="line">  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * <span class="doctag">@date</span> 2015/1/8 </div><div class="line"> * <span class="doctag">@author</span> wuwenjie </div><div class="line"> * <span class="doctag">@desc</span> 帧动画加载布局 </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TweenAnimLoadingLayout</span> <span class="keyword">extends</span> <span class="title">LoadingLayout</span> </span>&#123;  </div><div class="line">  </div><div class="line">    <span class="keyword">private</span> AnimationDrawable animationDrawable;  </div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TweenAnimLoadingLayout</span><span class="params">(Context context, Mode mode,  </span></span></div><div class="line">            Orientation scrollDirection, TypedArray attrs) &#123;  </div><div class="line">        <span class="keyword">super</span>(context, mode, scrollDirection, attrs);  </div><div class="line">        <span class="comment">// 初始化  </span></div><div class="line">        mHeaderImage.setImageResource(R.anim.loading);  </div><div class="line">        animationDrawable = (AnimationDrawable) mHeaderImage.getDrawable();  </div><div class="line">    &#125;  </div><div class="line">    <span class="comment">// 默认图片  </span></div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">getDefaultDrawableResId</span><span class="params">()</span> </span>&#123;  </div><div class="line">        <span class="keyword">return</span> R.drawable.app_loading0;  </div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLoadingDrawableSet</span><span class="params">(Drawable imageDrawable)</span> </span>&#123;  </div><div class="line">        <span class="comment">// NO-OP  </span></div><div class="line">    &#125;  </div><div class="line">      </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onPullImpl</span><span class="params">(<span class="keyword">float</span> scaleOfLayout)</span> </span>&#123;  </div><div class="line">        <span class="comment">// NO-OP  </span></div><div class="line">    &#125;  </div><div class="line">    <span class="comment">// 下拉以刷新  </span></div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">pullToRefreshImpl</span><span class="params">()</span> </span>&#123;  </div><div class="line">        <span class="comment">// NO-OP  </span></div><div class="line">    &#125;  </div><div class="line">    <span class="comment">// 正在刷新时回调  </span></div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">refreshingImpl</span><span class="params">()</span> </span>&#123;  </div><div class="line">        <span class="comment">// 播放帧动画  </span></div><div class="line">        animationDrawable.start();  </div><div class="line">    &#125;  </div><div class="line">    <span class="comment">// 释放以刷新  </span></div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">releaseToRefreshImpl</span><span class="params">()</span> </span>&#123;  </div><div class="line">        <span class="comment">// NO-OP  </span></div><div class="line">    &#125;  </div><div class="line">    <span class="comment">// 重新设置  </span></div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">resetImpl</span><span class="params">()</span> </span>&#123;  </div><div class="line">        mHeaderImage.setVisibility(View.VISIBLE);  </div><div class="line">        mHeaderImage.clearAnimation();  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>3，替换之前的刷新layout为TweenAnimLoadingLayout。</p>
<p>找到library项目com.handmark.pulltorefresh.library包下的PullToRefreshListView，发现头脚的layout用的都是LoadingLayout，找到头脚layout的创建方法createLoadingLayout进入，在createLoadingLayout方法中再进入createLoadingLayout，找到最原始的新建动画layout的地方，把默认的RotateLoadingLayout改成TweenAnimLoadingLayout就行了。</p>
<p>在PullToRefreshBase类下，变为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//在最原始的地方把新建动画layout换成TweenAnimLoadingLayout  </span></div><div class="line">        <span class="function">LoadingLayout <span class="title">createLoadingLayout</span><span class="params">(Context context, Mode mode, Orientation scrollDirection, TypedArray attrs)</span> </span>&#123;  </div><div class="line">            <span class="keyword">switch</span> (<span class="keyword">this</span>) &#123;  </div><div class="line">                <span class="keyword">case</span> ROTATE:  </div><div class="line">                <span class="keyword">default</span>:  </div><div class="line"><span class="comment">//                  return new RotateLoadingLayout(context, mode, scrollDirection, attrs);  </span></div><div class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> TweenAnimLoadingLayout(context, mode, scrollDirection, attrs);  </div><div class="line">                <span class="keyword">case</span> FLIP:  </div><div class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> FlipLoadingLayout(context, mode, scrollDirection, attrs);  </div><div class="line">            &#125;  </div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>4，去除LoadingLayout中的关于textview的代码。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="http://blog.csdn.net/superjunjin/article/details/45022595" target="_blank" rel="external">原文链接</a></li>
<li><a href="http://download.csdn.net/detail/superjunjin/8589827" target="_blank" rel="external">DEMO下载</a></li>
<li><a href="http://blog.csdn.net/wwj_748/article/details/42523611" target="_blank" rel="external">Android UI- PullToRrefresh自定义下拉刷新动画</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/09/android_pulltorefresh_listview3/" data-id="cj4zx2kiq003hqonhkaurk2d4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pulltorefreshlistview/">pulltorefreshlistview</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_pay_alipay" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/09/android_pay_alipay/" class="article-date">
  <time datetime="2015-11-09T02:48:29.000Z" itemprop="datePublished">2015-11-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/android/">android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/09/android_pay_alipay/">Android移动支付之支付宝支付</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>项目需要，需要在客户端集成支付宝接口。就研究了一下：因为使用支付宝接口，就需要到<a href="https://openhome.alipay.com/platform/home.htm" target="_blank" rel="external">支付宝开发平台</a>：注册帐号，到管理中心创建应用，申请审核通过后进入应用详情，配置相关参数。下面讲的是申请好之后的操作。登录成功之后，在开发平台的文档中心找到移动支付，点击DEMO下载，下载Android版资源。然后解压出来之后一般会得到三个文件夹。</p>
<p>这个时候要打开文件名为：  支付宝钱包支付接口开发包2.0标准版的文件。打开之后有一个Demo 文件。打开Demo文件。里面会有三个文件夹：第一个 openssl; 第二个 服务端 Demo,第三个 客户端demo. 这个时候，我们需要关心的是  openssl 文件与 客户端Demo 的文件。</p>
<p>Android 版的Demo宰你部署运行的时候，会发现不能支付成功。在项目主文件里面这样一段代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">    </div><div class="line"><span class="comment">//商户PID</span></div><div class="line"> </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PARTNER = <span class="string">""</span>;</div><div class="line"> </div><div class="line"><span class="comment">//商户收款账号</span></div><div class="line"> </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SELLER = <span class="string">""</span>;</div><div class="line"> </div><div class="line"><span class="comment">//商户私钥，pkcs8格式</span></div><div class="line"> </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String RSA_PRIVATE = <span class="string">""</span>;</div><div class="line"> </div><div class="line"><span class="comment">//支付宝公钥</span></div><div class="line"> </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String RSA_PUBLIC = <span class="string">""</span>;</div></pre></td></tr></table></figure></p>
<p>因为这些，都是需要根据商户注册的信息来填写的。所以就算下下载了Demo，没有正确配置，还是不能调起支付的。下面讲的就是如何获取支付所需的私钥与支付宝公钥。</p>
<h2 id="私钥公钥生成"><a href="#私钥公钥生成" class="headerlink" title="私钥公钥生成"></a>私钥公钥生成</h2><p>刚刚我们解压之后的openssl文件，获取私钥与公钥的方法就在里面：</p>
<p>首先打开openssl文件：以下是文件打开顺序： openssl–&gt;bin –&gt; 双击 openssl.exe文件。这个时候会出现一个命令框：(首先要说明的是这个文件是在Windows系统下打开的)要是苹果系统好像不行.接着继续往下说：</p>
<p>打开命令框后:输入第一行命令 ，生成私钥，如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">genrsa -out rsa_private_key.pem 1024</div></pre></td></tr></table></figure></p>
<p>按回车键，接着输入第二行命令，生成公钥：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rsa -<span class="keyword">in</span> rsa_private_key.pem -pubout -out rsa_public_key.pem</div></pre></td></tr></table></figure></p>
<p>按回车键，接着输入第三行命令，将RSA私钥转换成PKCS8格式<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pkcs8 -topk8 -inform PEM -<span class="keyword">in</span> rsa_private_key.pem -outform PEM -nocrypt</div></pre></td></tr></table></figure></p>
<p>执行完这三行命令后，就生成了两个以：.pem 结尾的文件。这就是我们生成的公钥与私钥.文件位置就在： bin  目录下。当然我们打不开这两个文件。但是我们可以复制一份到桌面，改成Txt文件打开即可。因为我们需要的只是里面的字符串，记住当我们引用这两个长的字符串的时候，需要注意的是：字符串，不能包括，换行，空格，以及其他误加的字符。所以复制的时候一定要小心。</p>
<p>当然私钥就是我们需要的私钥了，如何获得支付宝公钥呢：回到支付宝开发平台，首先登录,</p>
<p>一:  点击“查看PID|KEY”，在新打开的<a href="https://b.alipay.com/order/pidAndKey.htm" target="_blank" rel="external">页面</a>，可查看到签约支付宝账号、合作者身份ID(PID)。</p>
<p>二：输入支付密码，查询key、支付宝公钥。</p>
<p>三：上传RSA公钥，在“合作伙伴密钥管理”下，点击“RSA加密”后的“添加密钥”，把自己的公钥复制进去。注意不能有空格，换行之类的。<br><img src="http://blog.it985.com/wp-content/uploads/2015/06/zhifub.png" alt=""></p>
<p>四：点击确认上传，若是提示上传成功。则就是成功。</p>
<p>这个时候就可查看支付宝公钥了。如图：<br><img src="http://blog.it985.com/wp-content/uploads/2015/06/zhifua.png" alt=""></p>
<p>至此，将对应的私钥与公钥填到我们的Demo的相应配置类中。按DEMO默认的本地订单信息和签名基本就可以运行了。</p>
<h2 id="支付流程"><a href="#支付流程" class="headerlink" title="支付流程"></a>支付流程</h2><p><strong> 首先我们看一下整个支付的流程图：</strong><br><img src="https://t.alipayobjects.com/images/rmsweb/T1TkxgXcBjXXXXXXXX.png" alt=""></p>
<p>流程说明（以Android平台为例）：</p>
<ul>
<li>①第2步：调用支付接口：此消息就是本接口所描述的开发包提供的支付对象PayTask，将商户订单信息传进pay方法唤起支付宝收银台。</li>
<li>②第3步：手机支付宝支付开发包将会按照商户App提供的参数发送支付请求。</li>
<li>③第5步：异步发送支付通知：手机支付宝支付服务器端发送异步通知消息给商户服务器端。</li>
<li>④第7步：接口返回支付结果：商户应用客户端通过当前调用支付的Activity的Handler对象，通过它的回调函数获取支付结果。</li>
</ul>
<p><strong> 数据交互</strong><br><img src="https://t.alipayobjects.com/images/rmsweb/T1RBNgXblXXXXXXXXX.png" alt=""></p>
<ul>
<li>①构造订单数据并签名<br>  商户客户端根据手机支付宝支付开发包的接口规则，通过程序生成得到签名结果及要传输给手机支付宝支付开发包的数据集合。签名相关的公私钥生成及配置规则，详情见官网PID和密钥管理。</li>
<li>②发送请求数据<br>  把构造完成的数据集合传递给手机支付宝支付开发包。</li>
<li>③手机支付宝支付开发包对请求数据进行处理<br>  手机支付宝支付开发包将请求数据根据业务规则包装后传递给支付宝服务端，服务端得到这些集合后，会先进行安全校验等验证，一系列验证通过后便会处理完成这次发送过来的数据请求。</li>
<li>④返回处理的结果数据<br>  对于处理完成的交易，支付宝会以两种方式把数据分别反馈给商户应用和商户服务器。<br>  1.在手机客户端上，开发包客户端直接把处理的数据结果反馈给商户客户端。<br>  2.支付宝服务器主动发起通知，调用商户在请求时设定好的支付回调页面路径（参数notify_url，如果商户没设定，则不会进行该操作）。</li>
<li>⑤对获取的返回结果数据进行处理<br>  商户在客户端同步通知接收模块或服务端异步通知接收模块获取支付宝返回的结果数据后，可以结合商户自身业务逻辑进行数据处理（如：订单更新、自动充值到会员账号中等）。同步通知结果仅用于结果展示，入库数据需以异步通知为准。</li>
</ul>
<h2 id="附加说明"><a href="#附加说明" class="headerlink" title="附加说明"></a>附加说明</h2><p>支付过程中所需的订单信息和签名最好放在server端完成（这也是支付宝官方的建议），客户端通过请求server端数据，自己拼接orderInfo信息。这里要特别说明的是，orderInfo中的字段很多，一定要和server端的字段保持一致，不然客户端拿server端返回的签名调起支付的时候会报“服务器忙”，“订单信息错误”等信息，从而支付失败。<br>开发平台官网上创建的移动支付也需要填写应用的包名还有32位的MD5应用签名。不过我自己在开发的过程中验证发现，这个配置在实际支付中好像并没有用到，不像微信支付，你如果配置有误一定会导致支付失败。初步结论是支付宝并没有把这个信息纳入支付校验，不过出于严谨性考虑，建议开发的过程中准确配置各项参数。</p>
<p>最后强调一点，在实际开发中如果遇到问题，首先一定要去官网查找开发规范，不要首先想着去论坛获得帮助。官方文档肯定是最权威而且全面的，这样会少走很多弯路。</p>
<h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ul>
<li><a href="http://blog.it985.com/12276.html" target="_blank" rel="external">支付宝集成获取私钥与公钥</a></li>
<li><a href="http://doc.open.alipay.com/doc2/detail?spm=0.0.0.0.58qLhQ&amp;treeId=59&amp;articleId=103658&amp;docType=1" target="_blank" rel="external">官网移动支付交互流程</a></li>
<li><a href="http://doc.open.alipay.com/doc2/detail?spm=0.0.0.0.mpQtjx&amp;treeId=59&amp;articleId=103663&amp;docType=1" target="_blank" rel="external">官网移动支付请求参数说明</a></li>
<li><a href="http://download.alipay.com/public/api/base/WS_MOBILE_PAY_SDK_BASE.zip" target="_blank" rel="external">官网DEMO下载地址</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/09/android_pay_alipay/" data-id="cj4zx2kia0032qonh9y2glmkv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AliPay/">AliPay</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pay/">pay</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_pay_weixinpay" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/11/09/android_pay_weixinpay/" class="article-date">
  <time datetime="2015-11-09T02:47:29.000Z" itemprop="datePublished">2015-11-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/android/">android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/09/android_pay_weixinpay/">Android移动支付之微信支付</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>现在移动应用的开发中，需要支付的场景很多，这篇文章主要介绍android上微信支付的相关细节，首先建议有这方面需求的人直接上官网下载demo，查询接口文档，不要首先想着去第三方论坛找demo或者解答，这样会少走很多弯路。本文不再赘述在微信开放平台申请app_id,app_key（默认你已经会了，并且有了）。</p>
<ul>
<li><a href="https://open.weixin.qq.com/cgi-bin/index?t=home/index&amp;lang=zh_CN" target="_blank" rel="external">微信开发平台</a></li>
<li><a href="https://pay.weixin.qq.com/index.php/home/login?return_url=%2Findex.php%2Faccount" target="_blank" rel="external">微信商户平台</a><br>客户端的开发主要用到微信开发平台，参数配置也是在开发平台。登录账号后：管理中心 - - - 创建移动应用 - - - 填写基本信息提交审核（一周左右时间审核通过） - - - 点应用查看 - - -开发信息（修改）。IOS应用添加Bundle ID即可，Android开发添加应用包名和应用签名，这些在官方开发文档里写的非常清楚了，请参考官方文档。需要特别说明的是，签名一定要用你自己应用的正式keystore签名（这样当然有一点比较麻烦就是，你每次开发debug时要用签名导出安装才能正常支付，不能直接在手机上run Application）。签名是32位的MD5码，官网也有提供签名工具(文章结尾有下载地址)。</li>
</ul>
<h2 id="支付流程"><a href="#支付流程" class="headerlink" title="支付流程"></a>支付流程</h2><p>下面我就来说一说微信支付开发时需要注意的地方：</p>
<p><strong> 1 首先来看一下，微信支付的架构和流程图</strong><br><img src="http://img.blog.csdn.net/20150321155907863" alt=""></p>
<p><img src="https://pay.weixin.qq.com/wiki/doc/api/img/chapter8_3_1.png" alt=""></p>
<p><strong> 2 再来看一下成功调起微信支付的界面</strong><br><img src="http://img.blog.csdn.net/20150321160654957" alt=""></p>
<h2 id="配置工程"><a href="#配置工程" class="headerlink" title="配置工程"></a>配置工程</h2><p><strong> 1 wxapi.WXPayEntryActivity</strong></p>
<p>这里必须要有wxapi这个包名，同时必须有WXPayEntryActivity这个类名，否则无法调起微信支付，（开发文档和官方的demo都有提到这点，但是描述没有很详细，容易被坑）。WXPayEntryActivity是请求支付的回调类，再次要特别说明的是，wxapi的包名，WXPayEntryActivity的类名都是固定的，不要自己更改，否则回调失败，尤其需要注意的是wxapi要放到你的应用包路径的第一层目录下，比如你的包路径是com.xx.xxx(这个包路径以你的AndroidManifest中的为准。)，那么wxapi就一定要是com.xx.xxx.wxapi。要是你自己建了一个com.xx.xxx.pay.wxapi的路径，回调也是有问题的。<br><img src="http://img.blog.csdn.net/20150321162930990" alt=""></p>
<p><strong> 2 支付成功通知</strong></p>
<p>在WXPayEntryActivity的OnResp中处理，不能以微信返回的通知界面为准（我遇到的情况，网络不稳定的时候，微信返回界面提示支付失败，但是收到微信通知其实已经支付成功了），必须要去自己的服务器查询支付状态，这里微信建议用轮循机制去查询。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResp</span><span class="params">(BaseResp resp)</span> </span>&#123;</div><div class="line">    Log.d(TAG, <span class="string">"onPayFinish, errCode = "</span> + resp.errCode);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (resp.getType() == ConstantsAPI.COMMAND_PAY_BY_WX) &#123;</div><div class="line">        AlertDialog.Builder builder = <span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>);</div><div class="line">        builder.setTitle(R.string.app_tip);</div><div class="line">        builder.setMessage(getString(R.string.pay_result_callback_msg, resp.errStr +<span class="string">";code="</span> + String.valueOf(resp.errCode)));</div><div class="line">        builder.show();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>上面是官方的代码，建议你修改成如下的样式。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResp</span><span class="params">(BaseResp resp)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (resp.getType() == ConstantsAPI.COMMAND_PAY_BY_WX) &#123;</div><div class="line"><span class="comment">//          AlertDialog.Builder builder = new AlertDialog.Builder(this);</span></div><div class="line"><span class="comment">//          builder.setTitle(R.string.wxpay_tip);</span></div><div class="line"><span class="comment">//          builder.setMessage(getString(R.string.pay_result_callback_msg, resp.errStr +";code=" + String.valueOf(resp.errCode)));</span></div><div class="line"><span class="comment">//          builder.show();</span></div><div class="line">            <span class="keyword">switch</span> (resp.errCode) &#123;</div><div class="line">                <span class="keyword">case</span> BaseResp.ErrCode.ERR_OK: <span class="comment">//成功</span></div><div class="line">                    T.showShort(<span class="keyword">this</span>, R.string.wxpay_result_success);</div><div class="line">                    IntentUtil.gotoActivityToTop(WXPayEntryActivity.<span class="keyword">this</span>, Mine_gentuan_order_ok.class);</div><div class="line">                    <span class="keyword">this</span>.finish();</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> BaseResp.ErrCode.ERR_USER_CANCEL: <span class="comment">//用户取消</span></div><div class="line">                    T.showShort(<span class="keyword">this</span>, R.string.wxpay_result_cancel);</div><div class="line">                    <span class="keyword">this</span>.finish();</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> BaseResp.ErrCode.ERR_COMM:     <span class="comment">//错误</span></div><div class="line">                    T.showShort(<span class="keyword">this</span>, R.string.wxpay_result_error);</div><div class="line">                    <span class="keyword">this</span>.finish();</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>说明：T是我自己写的一个Toast工具类。回调后返回errCode值的说明：</p>
<ul>
<li>0   成功  展示成功页面</li>
<li>-1  错误  可能的原因：签名错误、未注册APPID、项目设置APPID不正确、注册的APPID与设置的不匹配、其他异常等。</li>
<li>-2  用户取消    无需处理。发生场景：用户不支付了，点击取消，返回APP。</li>
</ul>
<p><strong> 3 生成prepay_id,在服务器完成，由服务器去跟微信服务器交互，客户端不需要参与。</strong></p>
<p>这和支付宝支付的主要区别之一，支付宝支付需要客户端拼接订单信息，然后调起支付接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">   * 获取预支付订单号:</div><div class="line">   * prepay_id（服务器完成）！！！</div><div class="line">   * 注意：如果服务端开发文档跟客户端demo里的参数不一样，以demo里的参数为准，</div><div class="line">   * 否则服务器传过来的参数无法调起微信支付！！！</div><div class="line">   * */</div><div class="line">   <span class="function"><span class="keyword">private</span> String <span class="title">genProductArgs</span><span class="params">()</span> </span>&#123;</div><div class="line">       StringBuffer xml = <span class="keyword">new</span> StringBuffer();</div><div class="line"></div><div class="line">       <span class="keyword">try</span> &#123;</div><div class="line">           String  nonceStr = genNonceStr();</div><div class="line"></div><div class="line"></div><div class="line">           xml.append(<span class="string">"&lt;/xml&gt;"</span>);</div><div class="line">          List&lt;NameValuePair&gt; packageParams = <span class="keyword">new</span> LinkedList&lt;NameValuePair&gt;();</div><div class="line">           packageParams.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"appid"</span>, Constants.APP_ID));</div><div class="line">           packageParams.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"body"</span>, <span class="string">"APP pay test"</span>));</div><div class="line">           <span class="comment">/**这里用的是mach_id,跟sign签名时参数名不同，一定要注意*/</span></div><div class="line">           packageParams.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"mch_id"</span>, Constants.MCH_ID));</div><div class="line">           packageParams.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"nonce_str"</span>, nonceStr));</div><div class="line">           packageParams.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"notify_url"</span>, <span class="string">"http://121.40.35.3/test"</span>));</div><div class="line">           packageParams.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"out_trade_no"</span>,genOutTradNo()));</div><div class="line">           packageParams.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"spbill_create_ip"</span>,<span class="string">"127.0.0.1"</span>));</div><div class="line">           packageParams.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"total_fee"</span>, <span class="string">"1"</span>));</div><div class="line">           packageParams.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"trade_type"</span>, <span class="string">"APP"</span>));</div><div class="line"></div><div class="line"></div><div class="line">           String sign = genPackageSign(packageParams);</div><div class="line">           packageParams.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"sign"</span>, sign));</div><div class="line"></div><div class="line"></div><div class="line">          String xmlstring =toXml(packageParams);</div><div class="line"></div><div class="line">           <span class="keyword">return</span> xmlstring;</div><div class="line"></div><div class="line">       &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">           Log.e(TAG, <span class="string">"genProductArgs fail, ex = "</span> + e.getMessage());</div><div class="line">           <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">       &#125;</div><div class="line"></div><div class="line"></div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p><strong> 4 获取二次签名sign</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">genPayReq</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        req.appId = Constants.APP_ID;</div><div class="line">        req.partnerId = Constants.MCH_ID;</div><div class="line">        req.prepayId = resultunifiedorder.get(<span class="string">"prepay_id"</span>);</div><div class="line"><span class="comment">//      req.packageValue = "prepay_id="+resultunifiedorder.get("prepay_id");</span></div><div class="line">        req.packageValue = <span class="string">"Sign=WXPay"</span>;</div><div class="line">        req.nonceStr = genNonceStr();</div><div class="line">        req.timeStamp = String.valueOf(genTimeStamp());</div><div class="line"></div><div class="line"></div><div class="line">        List&lt;NameValuePair&gt; signParams = <span class="keyword">new</span> LinkedList&lt;NameValuePair&gt;();</div><div class="line">        signParams.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"appid"</span>, req.appId));</div><div class="line">        signParams.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"noncestr"</span>, req.nonceStr));</div><div class="line">        <span class="comment">/**</span></div><div class="line">         * 这里的package参数值必须是Sign=WXPay,否则IOS端调不起微信支付，</div><div class="line">         * (参数值是"prepay_id="+resultunifiedorder.get("prepay_id")的时候Android可以，IOS不可以)</div><div class="line">         */</div><div class="line">        signParams.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"package"</span>, req.packageValue));</div><div class="line">        <span class="comment">/**注意二次签名这里不再是mch_id,变成了prepayid;*/</span></div><div class="line">        signParams.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"partnerid"</span>, req.partnerId));</div><div class="line">        signParams.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"prepayid"</span>, req.prepayId));</div><div class="line">        signParams.add(<span class="keyword">new</span> BasicNameValuePair(<span class="string">"timestamp"</span>, req.timeStamp));</div><div class="line"></div><div class="line">        req.sign = genAppSign(signParams);</div><div class="line"></div><div class="line">        sb.append(<span class="string">"sign\n"</span>+req.sign+<span class="string">"\n\n"</span>);</div><div class="line"></div><div class="line">        show.setText(sb.toString());</div><div class="line"></div><div class="line">        Log.e(<span class="string">"orion"</span>, signParams.toString());</div><div class="line"></div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p><strong> 5 起调微信支付</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendPayReq</span><span class="params">()</span> </span>&#123;</div><div class="line">    msgApi.registerApp(Constants.APP_ID);</div><div class="line">    msgApi.sendReq(req);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong> 6 配置Manifest.xml，权限什么的按照文档的配置就行了</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">activity</span></span></div><div class="line">           <span class="attr">android:name</span>=<span class="string">".PayActivity"</span></div><div class="line">           <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></div><div class="line">           <span class="attr">android:exported</span>=<span class="string">"true"</span></div><div class="line">           <span class="attr">android:launchMode</span>=<span class="string">"singleTop"</span>&gt;</div><div class="line">           <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></div><div class="line">               <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span> /&gt;</span></div><div class="line">               <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.LAUNCHER"</span> /&gt;</span></div><div class="line">           <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></div><div class="line">           <span class="comment">&lt;!--这个intent-filter不要忘了--&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></div><div class="line">               <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.VIEW"</span>/&gt;</span></div><div class="line">               <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span>/&gt;</span></div><div class="line">               <span class="tag">&lt;<span class="name">data</span> <span class="attr">android:scheme</span>=<span class="string">"wxd930ea5d5a258f4f"</span>/&gt;</span></div><div class="line">           <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></div><div class="line">       <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>5，支付通知接口和退款接口按照开发文档即可，这里不再赘述。</p>
<h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><ul>
<li><a href="https://pay.weixin.qq.com/wiki/doc/api/app.php?chapter=8_3" target="_blank" rel="external">官网微信支付业务流程</a></li>
<li><a href="https://pay.weixin.qq.com/wiki/doc/api/app.php?chapter=8_5" target="_blank" rel="external">官网APP端开发步骤</a></li>
<li><a href="https://open.weixin.qq.com/zh_CN/htmledition/res/dev/download/sdk/Gen_Signature_Android.apk" target="_blank" rel="external">应用签名工具</a></li>
<li><a href="http://blog.csdn.net/baidu_17508977/article/details/44517283" target="_blank" rel="external">微信支付（不得不吐槽腾讯这个坑货）</a></li>
<li><a href="http://download.csdn.net/detail/baidu_17508977/8997405" target="_blank" rel="external">DEMO下载地址</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/09/android_pay_weixinpay/" data-id="cj4zx2kia0034qonhjmqzr0aa" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WXPay/">WXPay</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pay/">pay</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/6/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/8/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/article/">article</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/coding/">coding</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/">database</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/framework/">framework</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/humanism/">humanism</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/message-push/">message_push</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/music/">music</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ndk/">ndk</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/note/">note</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/protocol/">protocol</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/reading/">reading</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/springmvc/">springmvc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/string/">string</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/study/">study</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/versioncontroll/">versioncontroll</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/好文/">好文</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/电影/">电影</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AliPay/">AliPay</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Einstein/">Einstein</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GreenDao/">GreenDao</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ORMLite/">ORMLite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WXPay/">WXPay</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/activity/">activity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-studio/">android_studio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-ui/">android_ui</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/androidstudio/">androidstudio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animation/">animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/application/">application</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/book/">book</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/broadcast/">broadcast</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bugfix/">bugfix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chinese-weman/">chinese_weman</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/code-collection/">code_collection</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/context/">context</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/database/">database</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/decomplication/">decomplication</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design-model/">design model</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eclipse/">eclipse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eventbus/">eventbus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/feminism/">feminism</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fullstack/">fullstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google/">google</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gradle/">gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/handle/">handle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/handler/">handler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/https/">https</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/humanism/">humanism</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iframe/">iframe</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/image/">image</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/imageloader/">imageloader</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/intent/">intent</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/intentflag/">intentflag</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iphone/">iphone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jni/">jni</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/listview/">listview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/material-design/">material_design</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/music/">music</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mvp/">mvp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nd/">nd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/notification/">notification</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/obfuscation/">obfuscation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/observer/">observer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/opensource/">opensource</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/otto/">otto</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pageradapter/">pageradapter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pay/">pay</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/placeholder/">placeholder</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/project-build/">project_build</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pulltorefresh/">pulltorefresh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pulltorefreshlistview/">pulltorefreshlistview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/saxophone/">saxophone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/screen-record/">screen-record</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shortkey/">shortkey</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/snack/">snack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sort/">sort</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spannable/">spannable</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/speech/">speech</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springmvc/">springmvc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlite/">sqlite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssl/">ssl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sublime/">sublime</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svg/">svg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svn/">svn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/templates/">templates</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/textview/">textview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tomcat/">tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/translate/">translate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/viewpager/">viewpager</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/volley/">volley</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/website/">website</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webview/">webview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xpnet/">xpnet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/书单/">书单</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/史玉柱/">史玉柱</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/感悟/">感悟</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/电影/">电影</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/贾樟柯/">贾樟柯</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/AliPay/" style="font-size: 10px;">AliPay</a> <a href="/tags/Einstein/" style="font-size: 10px;">Einstein</a> <a href="/tags/GreenDao/" style="font-size: 10px;">GreenDao</a> <a href="/tags/ORMLite/" style="font-size: 10px;">ORMLite</a> <a href="/tags/WXPay/" style="font-size: 10px;">WXPay</a> <a href="/tags/activity/" style="font-size: 10px;">activity</a> <a href="/tags/android-studio/" style="font-size: 10px;">android_studio</a> <a href="/tags/android-ui/" style="font-size: 10px;">android_ui</a> <a href="/tags/androidstudio/" style="font-size: 20px;">androidstudio</a> <a href="/tags/animation/" style="font-size: 20px;">animation</a> <a href="/tags/application/" style="font-size: 10px;">application</a> <a href="/tags/book/" style="font-size: 10px;">book</a> <a href="/tags/broadcast/" style="font-size: 10px;">broadcast</a> <a href="/tags/bugfix/" style="font-size: 13.33px;">bugfix</a> <a href="/tags/chinese-weman/" style="font-size: 10px;">chinese_weman</a> <a href="/tags/code-collection/" style="font-size: 10px;">code_collection</a> <a href="/tags/context/" style="font-size: 10px;">context</a> <a href="/tags/database/" style="font-size: 10px;">database</a> <a href="/tags/decomplication/" style="font-size: 10px;">decomplication</a> <a href="/tags/design-model/" style="font-size: 13.33px;">design model</a> <a href="/tags/eclipse/" style="font-size: 10px;">eclipse</a> <a href="/tags/eventbus/" style="font-size: 10px;">eventbus</a> <a href="/tags/feminism/" style="font-size: 10px;">feminism</a> <a href="/tags/fullstack/" style="font-size: 10px;">fullstack</a> <a href="/tags/github/" style="font-size: 13.33px;">github</a> <a href="/tags/google/" style="font-size: 10px;">google</a> <a href="/tags/gradle/" style="font-size: 16.67px;">gradle</a> <a href="/tags/handle/" style="font-size: 10px;">handle</a> <a href="/tags/handler/" style="font-size: 10px;">handler</a> <a href="/tags/hexo/" style="font-size: 16.67px;">hexo</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/https/" style="font-size: 10px;">https</a> <a href="/tags/humanism/" style="font-size: 10px;">humanism</a> <a href="/tags/iframe/" style="font-size: 10px;">iframe</a> <a href="/tags/image/" style="font-size: 10px;">image</a> <a href="/tags/imageloader/" style="font-size: 20px;">imageloader</a> <a href="/tags/intent/" style="font-size: 10px;">intent</a> <a href="/tags/intentflag/" style="font-size: 13.33px;">intentflag</a> <a href="/tags/iphone/" style="font-size: 10px;">iphone</a> <a href="/tags/jni/" style="font-size: 10px;">jni</a> <a href="/tags/listview/" style="font-size: 10px;">listview</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/material-design/" style="font-size: 10px;">material_design</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/music/" style="font-size: 13.33px;">music</a> <a href="/tags/mvp/" style="font-size: 10px;">mvp</a> <a href="/tags/mysql/" style="font-size: 16.67px;">mysql</a> <a href="/tags/nd/" style="font-size: 10px;">nd</a> <a href="/tags/notification/" style="font-size: 10px;">notification</a> <a href="/tags/obfuscation/" style="font-size: 10px;">obfuscation</a> <a href="/tags/observer/" style="font-size: 10px;">observer</a> <a href="/tags/opensource/" style="font-size: 13.33px;">opensource</a> <a href="/tags/otto/" style="font-size: 10px;">otto</a> <a href="/tags/pageradapter/" style="font-size: 10px;">pageradapter</a> <a href="/tags/pay/" style="font-size: 13.33px;">pay</a> <a href="/tags/placeholder/" style="font-size: 10px;">placeholder</a> <a href="/tags/project-build/" style="font-size: 10px;">project_build</a> <a href="/tags/pulltorefresh/" style="font-size: 10px;">pulltorefresh</a> <a href="/tags/pulltorefreshlistview/" style="font-size: 13.33px;">pulltorefreshlistview</a> <a href="/tags/saxophone/" style="font-size: 10px;">saxophone</a> <a href="/tags/screen-record/" style="font-size: 10px;">screen-record</a> <a href="/tags/shortkey/" style="font-size: 10px;">shortkey</a> <a href="/tags/snack/" style="font-size: 10px;">snack</a> <a href="/tags/socket/" style="font-size: 10px;">socket</a> <a href="/tags/sort/" style="font-size: 13.33px;">sort</a> <a href="/tags/spannable/" style="font-size: 10px;">spannable</a> <a href="/tags/speech/" style="font-size: 10px;">speech</a> <a href="/tags/springmvc/" style="font-size: 10px;">springmvc</a> <a href="/tags/sqlite/" style="font-size: 10px;">sqlite</a> <a href="/tags/ssl/" style="font-size: 13.33px;">ssl</a> <a href="/tags/sublime/" style="font-size: 10px;">sublime</a> <a href="/tags/svg/" style="font-size: 13.33px;">svg</a> <a href="/tags/svn/" style="font-size: 13.33px;">svn</a> <a href="/tags/templates/" style="font-size: 10px;">templates</a> <a href="/tags/textview/" style="font-size: 10px;">textview</a> <a href="/tags/tomcat/" style="font-size: 16.67px;">tomcat</a> <a href="/tags/translate/" style="font-size: 10px;">translate</a> <a href="/tags/viewpager/" style="font-size: 13.33px;">viewpager</a> <a href="/tags/volley/" style="font-size: 10px;">volley</a> <a href="/tags/website/" style="font-size: 13.33px;">website</a> <a href="/tags/webview/" style="font-size: 10px;">webview</a> <a href="/tags/xpnet/" style="font-size: 13.33px;">xpnet</a> <a href="/tags/书单/" style="font-size: 10px;">书单</a> <a href="/tags/史玉柱/" style="font-size: 10px;">史玉柱</a> <a href="/tags/感悟/" style="font-size: 10px;">感悟</a> <a href="/tags/电影/" style="font-size: 10px;">电影</a> <a href="/tags/贾樟柯/" style="font-size: 10px;">贾樟柯</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/11/11/study_my_website_collection/">常用网站收集</a>
          </li>
        
          <li>
            <a href="/2016/05/04/web_develop_config/">WEB开发之环境配置</a>
          </li>
        
          <li>
            <a href="/2016/05/04/web_springmvc1/">Spring MVC入门(一)</a>
          </li>
        
          <li>
            <a href="/2016/04/07/android_network_ssl/">为你的Android App实现自签名的SSL证书</a>
          </li>
        
          <li>
            <a href="/2016/03/28/android_notification_push/">Android实现推送方式解决方案</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 ARESXIONG<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>