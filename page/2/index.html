<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-note_work_xp02" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/23/note_work_xp02/" class="article-date">
  <time datetime="2016-02-23T08:14:29.000Z" itemprop="datePublished">2016-02-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/note/">note</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/23/note_work_xp02/">工作笔记整理02</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>2015下半年到2016年年初的工作笔记整理02辑。</p>
<h2 id="android广播"><a href="#android广播" class="headerlink" title="android广播"></a>android广播</h2><p>dynamic broadcast sample：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">    Intent intent=new Intent(INTENAL_ACTION);</div><div class="line">    sendBroadcast(intent);</div><div class="line"></div><div class="line">    // 接收动态注册广播的BroadcastReceiver</div><div class="line">    /**</div><div class="line">     * 草稿界面刷新广播接收器</div><div class="line">     * </div><div class="line">     * @version 1.0</div><div class="line">     * @createTime 2015-8-14</div><div class="line">     * @updateTime 2015-8-14</div><div class="line">     * @createAuthor aresxiong</div><div class="line">     * @updateAuthor aresxiong</div><div class="line">     * @updateInfo</div><div class="line">     */</div><div class="line">    private BroadcastReceiver refreshReciver =new BroadcastReceiver() &#123;</div><div class="line">        </div><div class="line">        @Override</div><div class="line">        public void onReceive(Context context, Intent intent) &#123;</div><div class="line">            String action = intent.getAction();</div><div class="line">            if(action.equals(INTENAL_ACTION))&#123;</div><div class="line">                refreshViewOfDraft();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">------------------------------------------regist&amp;unregist--------------------------</div><div class="line">    @Override</div><div class="line">    protected void onStart() &#123;</div><div class="line"></div><div class="line">        IntentFilter intentFilter=new IntentFilter();</div><div class="line">        intentFilter.addAction(INTENAL_ACTION);</div><div class="line">        registerReceiver(refreshReciver, intentFilter);</div><div class="line">        super.onStart();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onStop() &#123;</div><div class="line">        unregisterReceiver(refreshReciver);</div><div class="line">        System.out.println(&quot;aresxiong:--start unregist receiver&quot;);</div><div class="line">        super.onStop();</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>PS：or in functions: onCreate &amp; onDestroy</p>
<h2 id="布局问题"><a href="#布局问题" class="headerlink" title="布局问题"></a>布局问题</h2><p>1.textView中 drawableLeft居中的问题修改：<br><a href="http://www.cnblogs.com/over140/p/3464348.html" target="_blank" rel="external">自定义控件让TextView的drawableLeft与文本一起居中显示</a></p>
<p>2.属性生效问题<br>layout_alignParentLeft及类似属性需要在父布局为RelativeLayout</p>
<p>3.除了自定义控件以外，还可以通过xml控制布局显示<br>android:background=”@drawable/mine_travel_write_but”</p>
<p>4.使用示例：<br>android:layout_above=”@+id/txt_travel_add”  //组件相对于另一个组件的位置。<br>android:maxLength=”220”                     //EditView对字数的控制，不用代码中实现。</p>
<p>5.TextView的跑马灯效果<br>TextView设置以下属性来实现跑马灯效果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">android:singleLine=true</div><div class="line">android:ellipsize=marquee</div><div class="line">android:focusableInTouchMode=true</div><div class="line">android:focusable=true</div><div class="line">android:marqueeRepeatLimit=marquee_forever</div></pre></td></tr></table></figure></p>
<p>说明:TextView的滚动问题<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">textview.setMovementMethod(new ScrollingMovementMethod());//实现多余内容的滚动。</div><div class="line"></div><div class="line"> * 设置控件获取焦点</div><div class="line"> */</div><div class="line">private void getFocus(View v) &#123;</div><div class="line">    v.setFocusableInTouchMode(true);</div><div class="line">    v.requestFocus();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>6.layout的引用格式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;include layout=&quot;@layout/home_find_theme_travel_leftmenu&quot; /&gt;</div></pre></td></tr></table></figure></p>
<p>7.代码设置drawableRight<br>在代码中如果要修改drawableRight设置的图片可以使用API<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">void android.widget.TextView.setCompoundDrawables(Drawable left, Drawable top, Drawable right, Drawable bottom)</div></pre></td></tr></table></figure></p>
<p>8.自定义按钮的样式<br>在drawble文件目录下添加样式文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:shape=&quot;rectangle&quot;&gt;</div><div class="line">    //背景颜色</div><div class="line">    &lt;solid android:color=&quot;#FFFFFF&quot; /&gt;</div><div class="line">    //圆角半径</div><div class="line">    &lt;corners android:radius=&quot;5dp&quot; /&gt;</div><div class="line">&lt;/shape&gt;</div></pre></td></tr></table></figure>
<h2 id="存储路径常识"><a href="#存储路径常识" class="headerlink" title="存储路径常识"></a>存储路径常识</h2><p>获取Android设备的外存路径的接口为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Environment.getExternalStorageDirectory().getAbsolutePath()</div></pre></td></tr></table></figure></p>
<p>所以，给自己的程序建个目录可如下所写：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String appHome = Environment.getExternalStorageDirectory().getAbsolutePath()+&quot;/myApp&quot;;</div></pre></td></tr></table></figure></p>
<h2 id="Android中正则的使用："><a href="#Android中正则的使用：" class="headerlink" title="Android中正则的使用："></a>Android中正则的使用：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Pattern pattern = Pattern.compile(&quot;^[\u4e00-\u9fa5]&#123;0,&#125;$&quot;);     //定义匹配的正则表达式</div><div class="line">Matcher matcher = pattern.matcher(&quot;要匹配的字符串&quot;); </div><div class="line">boolean isMathed = matcher.matches();   //匹配的结果</div></pre></td></tr></table></figure>
<p><strong> 常用的正则匹配表达式</strong><br>只能输入整数，正数负数零都可以：<code>^[+-]?[0-9]+$&quot;或\d*</code><br>整数或者小数：<code>^[0-9]+\.{0,1}[0-9]{0,2}$</code><br>只能输入数字：<code>^[0-9]*$</code><br>只能输入n位的数字：<code>^\d{n}$</code><br>只能输入至少n位的数字：<code>^\d{n,}$</code><br>只能输入m~n位的数字：。<code>^\d{m,n}$</code><br>只能输入零和非零开头的数字：<code>^(0|[1-9][0-9]*)$</code><br>只能输入有两位小数的正实数：<code>^[0-9]+(.[0-9]{2})?$</code><br>只能输入有1~3位小数的正实数：<code>^[0-9]+(.[0-9]{1,3})?$</code><br>只能输入非零的正整数：<code>^\+?[1-9][0-9]*$</code><br>只能输入非零的负整数：<code>^\-[1-9][]0-9&quot;*$</code><br>只能输入长度为3的字符：<code>^.{3}$</code><br>只能输入由26个英文字母组成的字符串：<code>^[A-Za-z]+$</code><br>只能输入由26个大写英文字母组成的字符串：<code>^[A-Z]+$</code><br>只能输入由26个小写英文字母组成的字符串：<code>^[a-z]+$</code><br>只能输入由数字和26个英文字母组成的字符串：<code>^[A-Za-z0-9]+$</code><br>只能输入由数字、26个英文字母或者下划线组成的字符串：<code>^\w+$</code><br>验证用户密码：<code>^[a-zA-Z]\w{5,17}$</code>正确格式为：以字母开头，长度在6~18之间，只能包含字符、数字和下划线。<br>验证是否含有^%&amp;’,;=?$”等字符：<code>[^%&amp;&#39;,;=?$\x22]+</code><br>只能输入汉字：<code>^[\u4e00-\u9fa5]{0,}$</code><br>验证Email地址：<code>^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$</code><br>验证InternetURL：<code>^http://([\w-]+\.)+[\w-]+(/[\w-./?%&amp;=]*)?$</code><br>验证电话号码：<code>^(\(\d{3,4}-)|\d{3.4}-)?\d{7,8}$</code>正确格式为：”XXX-XXXXXXX”、”XXXX-XXXXXXXX”、”XXX-XXXXXXX”、”XXX-XXXXXXXX”、”XXXXXXX”和”XXXXXXXX”。<br>验证身份证号（15位或18位数字）：<code>^\d{15}|\d{18}$</code><br>验证一年的12个月：<code>^(0?[1-9]|1[0-2])$</code>正确格式为：”01”～”09”和”1”～”12”。<br>验证一个月的31天：<code>^((0?[1-9])|((1|2)[0-9])|30|31)$</code>正确格式为；”01”～”09”和”1”～”31”。<br>匹配中文字符的正则表达式： <code>[\u4e00-\u9fa5]</code><br>匹配双字节字符(包括汉字在内)：<code>[^\x00-\xff]</code></p>
<h2 id="viewPager的使用"><a href="#viewPager的使用" class="headerlink" title="viewPager的使用"></a>viewPager的使用</h2><p>①activity中addPagerView()<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 填充viewpager</div><div class="line"> * @version 1.0</div><div class="line"> * @createTime 2015-9-7</div><div class="line"> * @updateTime 2015-9-7</div><div class="line"> * @createAuthor aresxiong</div><div class="line"> * @updateAuthor aresxiong</div><div class="line"> * @updateInfo</div><div class="line"> * @param viewPager</div><div class="line"> */</div><div class="line"></div><div class="line">private void addPagerView() &#123;</div><div class="line"></div><div class="line">    view_pagers = new ArrayList&lt;View&gt;();</div><div class="line"></div><div class="line">    // 热门</div><div class="line"></div><div class="line">    view_pagers.add(new Pager_city_hot(this));</div><div class="line"></div><div class="line">    // 国内</div><div class="line"></div><div class="line">    view_pagers.add(new Pager_city_home(this));</div><div class="line"></div><div class="line">    // 出境</div><div class="line"></div><div class="line">    // view_pagers.add(new Pager_city_foreign(this));</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    viewPager_master.setAdapter(new MyPagerAdapter(view_pagers));</div><div class="line"></div><div class="line">    viewPager_master.setOffscreenPageLimit(2);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>②写单个的viewpager。</p>
<h2 id="view的background设定"><a href="#view的background设定" class="headerlink" title="view的background设定"></a>view的background设定</h2><p>①.设置背景图片，图片来源于drawable；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">flightInfoPanel.setBackgroundDrawable(getResources().getDrawable(R.drawable.search_label_click));</div></pre></td></tr></table></figure></p>
<p>②.转换字符串为int（颜色）；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">listItemView.deleteFilghtBg.setBackgroundColor(Color.parseColor(&quot;#F5F5DC&quot;));</div></pre></td></tr></table></figure></p>
<h2 id="Monkey测试"><a href="#Monkey测试" class="headerlink" title="Monkey测试"></a>Monkey测试</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">adb shell monkey -p com.xp.lvbh -vvv 10000 &gt;d:\log.txt</div></pre></td></tr></table></figure>
<h2 id="混淆的配置："><a href="#混淆的配置：" class="headerlink" title="混淆的配置："></a>混淆的配置：</h2><p>见博客中的<a href="http://aresxiong.com/2015/12/10/android_app_obfuscation/" target="_blank" rel="external">android应用代码混淆</a>一文。</p>
<h2 id="android获得屏幕高度和宽度"><a href="#android获得屏幕高度和宽度" class="headerlink" title="android获得屏幕高度和宽度"></a>android获得屏幕高度和宽度</h2><p>android获取屏幕的高度和宽度用到WindowManager这个类，两种方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">1、WindowManager wm = (WindowManager) getContext().getSystemService(Context.WINDOW_SERVICE);</div><div class="line"></div><div class="line">     int width = wm.getDefaultDisplay().getWidth();</div><div class="line"></div><div class="line">    int height = wm.getDefaultDisplay().getHeight();</div><div class="line"></div><div class="line">2、WindowManager wm = this.getWindowManager();</div><div class="line"></div><div class="line">     int width = wm.getDefaultDisplay().getWidth();</div><div class="line"></div><div class="line">    int height = wm.getDefaultDisplay().getHeight();</div></pre></td></tr></table></figure></p>
<h2 id="listView设置滑动到指定item"><a href="#listView设置滑动到指定item" class="headerlink" title="listView设置滑动到指定item"></a>listView设置滑动到指定item</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">private void setListViewPos(int pos) &#123;  </div><div class="line"></div><div class="line">    if (android.os.Build.VERSION.SDK_INT &gt;= 8) &#123;  </div><div class="line">        mCateListView.smoothScrollToPosition(pos);  </div><div class="line">    &#125; else &#123;  </div><div class="line">        mCateListView.setSelection(pos);  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="子线程启动"><a href="#子线程启动" class="headerlink" title="子线程启动"></a>子线程启动</h2><p>第一种：直接创建子线程并启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">private Thread newThread;//声明一个子线程</div><div class="line">new Thread() &#123;</div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">            //这里写入子线程需要做的工作</div><div class="line">        &#125;</div><div class="line">    &#125;.start();</div></pre></td></tr></table></figure></p>
<p>第二种：先创建子线程，然后启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">private Thread newThread;//声明一个子线程</div><div class="line">newThread = new Thread(new Runnable() &#123;</div><div class="line">    @Override</div><div class="line">    public void run() &#123;</div><div class="line">            //这里写入子线程需要做的工作</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">newThread.start(); //启动线程</div></pre></td></tr></table></figure></p>
<h2 id="支付问题"><a href="#支付问题" class="headerlink" title="支付问题"></a>支付问题</h2><p>微信支付问题：<br>微信支付需要配置开放平台的参数，主要是两个参数，一个是包名，一个是MD5签名（可以通过第三方工具获得32位签名）。见官网说明。<br>特别需要注意的是，应用本身keystore变更后，签名会改变，这时需要同时修改开放平台的签名，签名的修改是即可完成的，但是生效要等24小时左右的时间。（亲测）</p>
<h2 id="android-gradle学习总结"><a href="#android-gradle学习总结" class="headerlink" title="android gradle学习总结"></a>android gradle学习总结</h2><p>见博客:</p>
<ul>
<li><a href="http://aresxiong.com/2015/11/11/android_studio_gradle/" target="_blank" rel="external">AndroidStudio之Gradle详解(一)</a></li>
<li><a href="http://aresxiong.com/2015/11/11/android_studio_problems_solution/" target="_blank" rel="external">AndroidStudio常见问题解决方案 </a></li>
<li><a href="http://aresxiong.com/2015/11/12/android_studio_gradle_guide/" target="_blank" rel="external">AndroidStudio之Gradle Guide官方文档翻译</a><br>前言：<br>Gradle构建工具是任务驱动型的构建工具，可以通过各种Plugin插件扩展功能以适应各种构建任务。而Eclipse的ADT插件使用的是Ant构建工具。<br>Gradle是一个优秀的构建系统和构建工具，它允许通过插件创建自定义的构建逻辑。<br>采用了Domain Specific Language(DSL语言)来描述和控制构建逻辑。<br>构建文件基于Groovy，并且允许通过混合声明DSL元素和使用代码来控制DSL元素以控制自定义的构建逻辑。<br>支持Maven或者Ivy的依赖管理。<br>良好的API工具供IDE集成。</li>
</ul>
<p>一个Gradle项目的构建过程定义在build.gradle文件中，位于项目的根目录下。<br>组成元素：<br>buildscrip{…}这里配置了驱动构建过程的代码。<br>andorid{…}配置了所有android构建过程需要的参数。这里也是Android DSL的入口点。</p>
<h2 id="读取本地文件"><a href="#读取本地文件" class="headerlink" title="读取本地文件"></a>读取本地文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 读取本地保存的用户须知文档</div><div class="line"> */</div><div class="line"> private String readTravelItemsFromLocal(int type)&#123;</div><div class="line">    String content = &quot;&quot;;</div><div class="line">    InputStream inputStream;</div><div class="line">    int contentType = type;</div><div class="line">    try &#123;</div><div class="line">       if(contentType == 0)&#123;</div><div class="line">          inputStream = getResources().getAssets().open(&quot;Inland_Book_Notice.html&quot;);</div><div class="line">       &#125;else&#123;</div><div class="line">          inputStream = getResources().getAssets().open(&quot;Internal_Book_Notice.html&quot;);</div><div class="line">       &#125;</div><div class="line">       InputStreamReader isr = new InputStreamReader(inputStream, &quot;UTF-8&quot;);</div><div class="line">       BufferedReader br = new BufferedReader(isr);</div><div class="line">       String mimeTypeLine = &quot;&quot;;</div><div class="line">       while ((mimeTypeLine = br.readLine()) != null) &#123;</div><div class="line">          content = content + mimeTypeLine;</div><div class="line">       &#125;</div><div class="line">         content = URLEncoder.encode(str, &quot;utf-8&quot;);</div><div class="line">    &#125; catch (Exception e) &#123;</div><div class="line">       e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">    return content;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h2 id="转义特殊字符"><a href="#转义特殊字符" class="headerlink" title="转义特殊字符"></a>转义特殊字符</h2><p>&amp;#160和&amp;nbsp的区别：都是空格，但是&nbsp;是html中的空格的转义，而&#160;是XSL中的。XSL并不认识&nbsp;他会原样输出。<br>注：XSL是可扩展样式表语言(EXtensible Stylesheet Language)，是一种用于以可读格式呈现 XML（标准通用标记语言的子集）数据的语言。<br>参考<a href="http://www.cnblogs.com/maijin/articles/4650722.html" target="_blank" rel="external">Html与XSL字符转义</a></p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="http://aresxiong.com/2015/11/11/android_studio_gradle/" target="_blank" rel="external">AndroidStudio之Gradle详解(一)</a></li>
<li><a href="http://aresxiong.com/2015/11/11/android_studio_problems_solution/" target="_blank" rel="external">AndroidStudio常见问题解决方案 </a></li>
<li><a href="http://aresxiong.com/2015/11/12/android_studio_gradle_guide/" target="_blank" rel="external">AndroidStudio之Gradle Guide官方文档翻译</a></li>
<li><a href="http://aresxiong.com/2015/12/10/android_app_obfuscation/" target="_blank" rel="external">android应用代码混淆</a></li>
<li><a href="http://www.cnblogs.com/over140/p/3464348.html" target="_blank" rel="external">自定义控件让TextView的drawableLeft与文本一起居中显示</a></li>
<li><a href="http://www.cnblogs.com/maijin/articles/4650722.html" target="_blank" rel="external">Html与XSL字符转义</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/02/23/note_work_xp02/" data-id="cj4zvsgcl005u0gnhgexcmmmw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xpnet/">xpnet</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-note_work_xp01" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/23/note_work_xp01/" class="article-date">
  <time datetime="2016-02-23T02:14:29.000Z" itemprop="datePublished">2016-02-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/note/">note</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/23/note_work_xp01/">工作笔记整理01</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>2015下半年到2016年年初的工作笔记整理01辑。</p>
<h2 id="SVN相关知识点"><a href="#SVN相关知识点" class="headerlink" title="SVN相关知识点"></a>SVN相关知识点</h2><p><strong> SVN查询文件改动</strong><br>通过 svn 命令行(TortoiseSVN不行, 需要先安装 svn 命令行工具)是可以获得这个列表的.<br>命令格式如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">svn diff -r REVNO:HEAD --summarize http://svn-url</div></pre></td></tr></table></figure></p>
<p>[例如]<br>想检查从 724版本 开始到目前所有改动文件的列表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">svn diff -r 724:HEAD --summarize https://192.168.198.2/svn &gt; changedfiles.txt</div></pre></td></tr></table></figure></p>
<p>可以简写成这样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">svn diff -r 724 --summarize https://192.168.198.2/svn &gt; changedfiles.txt</div></pre></td></tr></table></figure></p>
<p>或者你只知道需要检查版本的日期, 这就相当于检查从 2015-05-06(上次封版日期) 开始到目前(此次发版日期)所有的文件改动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">svn diff -r &#123;2015-05-06&#125; --summarize https://192.168.198.2/svn &gt; changedfiles.txt</div></pre></td></tr></table></figure></p>
<p>或者日期区间<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">svn diff -r &#123;2015-05-04&#125;:&#123;2015-05-05&#125; --summarize https://192.168.198.2/svn &gt; changedfiles.txt</div></pre></td></tr></table></figure></p>
<p>注：<br>需要先安装svn 命令行工具<a href="https://www.visualsvn.com/downloads/" target="_blank" rel="external">Apache Subversion command line tools</a></p>
<h2 id="集合相关"><a href="#集合相关" class="headerlink" title="集合相关"></a>集合相关</h2><p><strong> 集合输出</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public static void printPL(Map hm) &#123;</div><div class="line">Set s = hm.keySet();   </div><div class="line">Iterator i = s.iterator();</div><div class="line">while(i.hasNext()) &#123;</div><div class="line">Object o = i.next();</div><div class="line">System.out.println(o +&quot; -- &quot;+hm.get(o));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong> HashMap取值</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">if(hashmap!=null || !hashmap.isEmpty()) &#123;</div><div class="line">    Set set = hashmap.keySet();</div><div class="line">    Iterator it = set.iterator();</div><div class="line">    while(it.hasNext()) &#123;</div><div class="line">         String key = (String)it.next();</div><div class="line">         Integer integer = (Integer)hashmap.get(key);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong> HashMap格式化</strong><br>HttpUtils.java<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 参数统一格式化</div><div class="line"> * </div><div class="line"> * @version 1.0</div><div class="line"> * @createTime 2015-4-30,下午12:13:13</div><div class="line"> * @updateTime 2015-4-30,下午12:13:13</div><div class="line"> * @info 提取map中的值以&amp;分割返回</div><div class="line"> * @createAuthor ares</div><div class="line"> * @updateAuthor ares</div><div class="line"> * @updateInfo</div><div class="line"> * @param attrs</div><div class="line"> * @return</div><div class="line"> * @throws UnsupportedEncodingException</div><div class="line"> */</div><div class="line">private String fomateAttrs(HashMap&lt;String, String&gt; attrs) &#123;</div><div class="line">    // 获取键的集合</div><div class="line">    Set&lt;String&gt; keys = attrs.keySet();</div><div class="line">    Iterator&lt;String&gt; iterator = keys.iterator();</div><div class="line">    StringBuffer params = new StringBuffer();</div><div class="line"></div><div class="line">    while (iterator.hasNext()) &#123;</div><div class="line">        String key = iterator.next();</div><div class="line">        try &#123;</div><div class="line">            params.append(key + &quot;=&quot; + URLEncoder.encode(attrs.get(key), &quot;UTF-8&quot;) + &quot;&amp;&quot;);</div><div class="line">        &#125; catch (Exception e) &#123;</div><div class="line">            L.d(&quot;net connection attrs error..&quot;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    System.out.println(&quot;params----&gt;&quot; + params.toString().substring(0, params.toString().length() - 1));</div><div class="line">    return params.toString().substring(0, params.toString().length() - 1);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="WINDOWS重启关机"><a href="#WINDOWS重启关机" class="headerlink" title="WINDOWS重启关机"></a>WINDOWS重启关机</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">shutdown -r -t second  (r means restart )</div><div class="line">shutdown -s -t second  (s means poweroff )</div></pre></td></tr></table></figure>
<h2 id="Request请求样式"><a href="#Request请求样式" class="headerlink" title="Request请求样式"></a>Request请求样式</h2><p>所有的请求在UserBiz类中，下面是获取用户信息的示例。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line">     * 获取用户信息</div><div class="line">     * </div><div class="line">     * @version 1.0</div><div class="line">     * @createTime 2015-7-20,上午11:05:06</div><div class="line">     * @updateTime 2015-7-20,上午11:05:06</div><div class="line">     * @createAuthor ares</div><div class="line">     * @updateAuthor ares</div><div class="line">     * @updateInfo</div><div class="line">     * @return</div><div class="line">     */</div><div class="line">    @SuppressWarnings(&quot;unchecked&quot;)</div><div class="line">    public static ResponseBean getUserInfo() &#123;</div><div class="line">        HashMap&lt;String, String&gt; params = ReqUtil.getPostRequestHeader(URL_GET_USER_INFO); //接口名</div><div class="line">        ResponseBean response = ReqUtil.sendPostRequest(URL_GET_USER_INFO,params);</div><div class="line">        if (response.isSuccess()) &#123;</div><div class="line">            try &#123;</div><div class="line">                HashMap&lt;String, String&gt; infos = JsonUtil.resolvingJsonObject(response.getData().toString());</div><div class="line">                String userinfo = infos.get(&quot;userinfo&quot;);</div><div class="line">                Mine_user_info userInfo = (Mine_user_info) Lvbh_bean_base.newInstance(Mine_user_info.class, userinfo);</div><div class="line">                String upinfo = infos.get(&quot;loglist&quot;);</div><div class="line">                ArrayList&lt;Mine_lvbh_acctoun_up_info&gt; upinfos = (ArrayList&lt;Mine_lvbh_acctoun_up_info&gt;) Lvbh_bean_base</div><div class="line">                        .toModelList(upinfo, Mine_lvbh_acctoun_up_info.class);</div><div class="line">                if (upinfos.size() &gt; 0)userInfo.setInfos(upinfos);</div><div class="line">                response.setData(userInfo);</div><div class="line">            &#125; catch (JSONException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        return response;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p><strong> Response请求判断和取值</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">if (response.isSuccess()) &#123;</div><div class="line">    try &#123;</div><div class="line">        HashMap&lt;String, String&gt; infos = JsonUtil.resolvingJsonObject(response.getData().toString());</div><div class="line">        String travelInfo = infos.get(&quot;json字段&quot;);</div></pre></td></tr></table></figure></p>
<p>json字符串转为hashmap：JsonUtil.java<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 解析JsonObject.</div><div class="line"> * </div><div class="line"> * @version 1.0</div><div class="line"> * @createTime 2015-5-4,上午10:17:14</div><div class="line"> * @updateTime 2015-5-4,上午10:17:14</div><div class="line"> * @createAuthor ares</div><div class="line"> * @updateAuthor ares</div><div class="line"> * @param json  需要解析的json信息.</div><div class="line"> * @return      解析完成的信息.</div><div class="line"> * @throws JSONException  Json解析发生错误时抛出异常.</div><div class="line"> * @updateInfo</div><div class="line"> */</div><div class="line">public static HashMap&lt;String, String&gt; resolvingJsonObject(String json) throws JSONException &#123;</div><div class="line">    HashMap&lt;String, String&gt; map = new HashMap&lt;String, String&gt;();</div><div class="line">    if (!StrUtil.isEmpty(json)) &#123;</div><div class="line">        JSONObject jsonObject = new JSONObject(json);</div><div class="line">        Iterator&lt;String&gt; it = jsonObject.keys();</div><div class="line">        while (it.hasNext()) &#123;</div><div class="line">            String key = it.next().toString();</div><div class="line">            map.put(key, jsonObject.getString(key));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return map;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="标题自定义控件"><a href="#标题自定义控件" class="headerlink" title="标题自定义控件"></a>标题自定义控件</h2><p>JAVA代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div></pre></td><td class="code"><pre><div class="line">package com.xp.lvbh.others.widget;</div><div class="line"></div><div class="line">import android.app.Activity;</div><div class="line">import android.content.Context;</div><div class="line">import android.graphics.Color;</div><div class="line">import android.graphics.drawable.Drawable;</div><div class="line">import android.text.TextUtils.TruncateAt;</div><div class="line">import android.util.AttributeSet;</div><div class="line">import android.util.TypedValue;</div><div class="line">import android.view.View;</div><div class="line">import android.view.inputmethod.InputMethodManager;</div><div class="line">import android.widget.Button;</div><div class="line">import android.widget.ImageButton;</div><div class="line">import android.widget.ImageView;</div><div class="line">import android.widget.RelativeLayout;</div><div class="line">import android.widget.TextView;</div><div class="line"></div><div class="line">import com.xp.lvbh.R;</div><div class="line"></div><div class="line">/**</div><div class="line"> * 标题</div><div class="line"> *</div><div class="line"> * @author ares</div><div class="line"> * @date 2015-4-22</div><div class="line"> * @Copyright: Copyright (c) 2015 Shenzhen JD</div><div class="line"> */</div><div class="line">public class TitleView extends RelativeLayout &#123;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 上下文环境</div><div class="line">     */</div><div class="line">    private Context context;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 标题</div><div class="line">     */</div><div class="line">    private TextView txt_title;</div><div class="line">    /**</div><div class="line">     * 左文字按钮</div><div class="line">     */</div><div class="line">    private Button btn_left;</div><div class="line">    /**</div><div class="line">     * 右文字按钮</div><div class="line">     */</div><div class="line">    private TextView btn_right;</div><div class="line">    /**</div><div class="line">     * 左图标按钮</div><div class="line">     */</div><div class="line">    private ImageButton imgbtn_left;</div><div class="line">    /**</div><div class="line">     * 右一图标按钮</div><div class="line">     */</div><div class="line">    private ImageView imgbtn_rightOne;</div><div class="line">    /**</div><div class="line">     * 右二图标按钮</div><div class="line">     */</div><div class="line">    private ImageView imgbtn_rightTwo;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 左右边距</div><div class="line">     */</div><div class="line">    private int marginHorizontal;</div><div class="line">    /**</div><div class="line">     * 上下边距</div><div class="line">     */</div><div class="line">    private int marginVertical;</div><div class="line">    /**</div><div class="line">     * 标题文字大小</div><div class="line">     */</div><div class="line">    private float titleFontSize;</div><div class="line">    /**</div><div class="line">     * 标题文字颜色</div><div class="line">     */</div><div class="line">    private int titleFontColor;</div><div class="line">    /**</div><div class="line">     * 返回</div><div class="line">     */</div><div class="line">    private String back;</div><div class="line">    private int backFontColor;</div><div class="line">    private int resBack;</div><div class="line">    private int resBackDrawable;</div><div class="line">    /**</div><div class="line">     * 背景色</div><div class="line">     */</div><div class="line">    private int backgroundColor = -1;</div><div class="line">    private int background = -1;</div><div class="line">    private int padding = 10;</div><div class="line"></div><div class="line">    public TitleView(Context context) &#123;</div><div class="line">        super(context);</div><div class="line">        this.context = context;</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public TitleView(Context context, AttributeSet attrs) &#123;</div><div class="line">        super(context, attrs);</div><div class="line">        this.context = context;</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public TitleView(Context context, AttributeSet attrs, int defStyle) &#123;</div><div class="line">        super(context, attrs, defStyle);</div><div class="line">        this.context = context;</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 初始化</div><div class="line">     *</div><div class="line">     * @version 1.0</div><div class="line">     * @createTime 2015-4-22,下午5:56:06</div><div class="line">     * @updateTime 2015-4-22,下午5:56:06</div><div class="line">     * @createAuthor ares</div><div class="line">     * @updateAuthor ares</div><div class="line">     * @updateInfo</div><div class="line">     */</div><div class="line">    private void init() &#123;</div><div class="line">        initParams(); // 初始化参数.</div><div class="line"></div><div class="line">        // 设置背景色.</div><div class="line">        if (-1 != backgroundColor) &#123;</div><div class="line">            super.setBackgroundColor(getResources().getColor(backgroundColor));</div><div class="line">        &#125; else if (-1 != background) &#123;</div><div class="line">            this.setBackgroundResource(background);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        // 添加标题文字控件.</div><div class="line">        txt_title = new TextView(context);</div><div class="line">        LayoutParams titleParams = new LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT);</div><div class="line">        titleParams.addRule(RelativeLayout.CENTER_IN_PARENT, RelativeLayout.TRUE);</div><div class="line">        txt_title.setPadding(0, 0, 0, 0);</div><div class="line">        this.addView(txt_title, titleParams);</div><div class="line">        txt_title.setTextSize(TypedValue.COMPLEX_UNIT_PX, titleFontSize);</div><div class="line">        txt_title.setMaxWidth(getResources().getDimensionPixelSize(R.dimen.title_max));</div><div class="line">        txt_title.setEllipsize(TruncateAt.END);</div><div class="line">        txt_title.setSingleLine(true);</div><div class="line">        txt_title.setTextColor(Color.WHITE);</div><div class="line"></div><div class="line">        // 添加左一文字按钮和左一图标按钮控件.</div><div class="line">        LayoutParams leftParams = new LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT);</div><div class="line">        leftParams.addRule(RelativeLayout.CENTER_VERTICAL, RelativeLayout.TRUE);</div><div class="line">        leftParams.addRule(RelativeLayout.ALIGN_PARENT_LEFT, RelativeLayout.TRUE);</div><div class="line">        leftParams.leftMargin = marginHorizontal;</div><div class="line">        btn_left = new Button(context);</div><div class="line">        btn_left.setPadding(padding, padding, padding, padding);</div><div class="line">        btn_left.setTextColor(Color.WHITE);</div><div class="line">        this.addView(btn_left, leftParams);</div><div class="line">        imgbtn_left = new ImageButton(context);</div><div class="line">        imgbtn_left.setPadding(padding, padding, padding, padding);</div><div class="line">        imgbtn_left.setBackgroundColor(Color.TRANSPARENT);</div><div class="line">        this.addView(imgbtn_left, leftParams);</div><div class="line">        btn_left.setVisibility(View.GONE);</div><div class="line">        imgbtn_left.setVisibility(View.GONE);</div><div class="line"></div><div class="line">        // 添加右一文字按钮和右一图标按钮控件.</div><div class="line">        LayoutParams rightOneParams = new LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT);</div><div class="line">        rightOneParams.addRule(RelativeLayout.CENTER_VERTICAL, RelativeLayout.TRUE);</div><div class="line">        rightOneParams.addRule(RelativeLayout.ALIGN_PARENT_RIGHT, RelativeLayout.TRUE);</div><div class="line">        rightOneParams.rightMargin = marginVertical;</div><div class="line">        btn_right = new TextView(context);</div><div class="line">        btn_right.setBackgroundColor(Color.TRANSPARENT);</div><div class="line">        btn_right.setPadding(padding, padding, padding, padding);</div><div class="line">        btn_right.setTextSize(TypedValue.COMPLEX_UNIT_PX, getResources().getDimension(R.dimen.font_size_default));</div><div class="line">        btn_right.setTextColor(Color.WHITE);</div><div class="line">        this.addView(btn_right, rightOneParams);</div><div class="line"></div><div class="line">        imgbtn_rightOne = new ImageView(context);</div><div class="line">        imgbtn_rightOne.setPadding(padding, padding, padding, padding);</div><div class="line">        imgbtn_rightOne.setBackgroundColor(Color.TRANSPARENT);</div><div class="line">        this.addView(imgbtn_rightOne, rightOneParams);</div><div class="line">        btn_right.setVisibility(View.GONE);</div><div class="line">        imgbtn_rightOne.setVisibility(View.GONE);</div><div class="line"></div><div class="line">        // 添加右二文字按钮和右二图标按钮控件.</div><div class="line">        LayoutParams rightTwoParams = new LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT);</div><div class="line">        rightTwoParams.addRule(RelativeLayout.CENTER_VERTICAL, RelativeLayout.TRUE);</div><div class="line">        rightTwoParams.addRule(RelativeLayout.LEFT_OF, imgbtn_rightOne.getId());</div><div class="line">        rightOneParams.rightMargin = marginVertical;</div><div class="line"></div><div class="line">        imgbtn_rightTwo = new ImageView(context);</div><div class="line">        imgbtn_rightTwo.setPadding(padding, padding, padding, padding);</div><div class="line">        imgbtn_rightTwo.setBackgroundColor(Color.TRANSPARENT);</div><div class="line">        this.addView(imgbtn_rightTwo, rightTwoParams);</div><div class="line">        imgbtn_rightTwo.setVisibility(View.GONE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 初始化参数</div><div class="line">     *</div><div class="line">     * @version 1.0</div><div class="line">     * @createTime 2015-4-22,下午5:56:22</div><div class="line">     * @updateTime 2015-4-22,下午5:56:22</div><div class="line">     * @createAuthor ares</div><div class="line">     * @updateAuthor ares</div><div class="line">     * @updateInfo</div><div class="line">     */</div><div class="line">    private void initParams() &#123;</div><div class="line">        marginHorizontal = getResources().getDimensionPixelSize(R.dimen.spacing_small);</div><div class="line">        marginVertical = getResources().getDimensionPixelSize(R.dimen.spacing_small);</div><div class="line">        padding = getResources().getDimensionPixelSize(R.dimen.spacing_small);</div><div class="line">        titleFontSize = getResources().getDimension(R.dimen.font_size_big);</div><div class="line">        titleFontColor = R.color.white;</div><div class="line">        back = context.getString(R.string.return_reg);</div><div class="line">        resBack = R.mipmap.register_bnt_back;</div><div class="line">        resBackDrawable = R.mipmap.register_bnt_back;</div><div class="line">        backFontColor = R.color.white;</div><div class="line">        backgroundColor = R.color.main;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置标题.</div><div class="line">     */</div><div class="line">    public void setTitle(String title) &#123;</div><div class="line">        txt_title.setText(title);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置标题背景颜色.</div><div class="line">     */</div><div class="line">    public void setBackgroundColor(int backgroundColor) &#123;</div><div class="line">        this.backgroundColor = backgroundColor;</div><div class="line">        super.setBackgroundColor(backgroundColor);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置标题文字颜色.</div><div class="line">     */</div><div class="line">    public void setTitleTextColor(int titleFontColor) &#123;</div><div class="line">        this.titleFontColor = titleFontColor;</div><div class="line">        txt_title.setTextColor(context.getResources().getColor(titleFontColor));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置标题.</div><div class="line">     */</div><div class="line">    public void setTitle(int resID) &#123;</div><div class="line">        txt_title.setText(resID);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置返回文字按钮.</div><div class="line">     */</div><div class="line">    public void setBackButton() &#123;</div><div class="line">        btn_left.setText(back);</div><div class="line">        btn_left.setTextColor(context.getResources().getColor(backFontColor));</div><div class="line">        btn_left.setOnClickListener(new OnClickListener() &#123;</div><div class="line"></div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                finishActivity();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;);</div><div class="line">        btn_left.setVisibility(View.VISIBLE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置返回图标加文字按钮.</div><div class="line">     */</div><div class="line">    public void setBackDrawableButton() &#123;</div><div class="line">        btn_left.setTextColor(backFontColor);</div><div class="line">        btn_left.setCompoundDrawablesWithIntrinsicBounds(getResources().getDrawable(resBackDrawable), null, null, null);</div><div class="line">        // btn_left.setBackgroundColor(getResources().getColor(R.color.transparent));</div><div class="line">        btn_left.setText(back);</div><div class="line">        btn_left.setOnClickListener(new OnClickListener() &#123;</div><div class="line"></div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                finishActivity();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;);</div><div class="line">        btn_left.setVisibility(View.VISIBLE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置返回图标按钮.</div><div class="line">     */</div><div class="line">    public void setBackImageButton() &#123;</div><div class="line">        imgbtn_left.setImageResource(resBack);</div><div class="line">        imgbtn_left.setOnClickListener(new OnClickListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                finishActivity();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;);</div><div class="line">        imgbtn_left.setVisibility(View.VISIBLE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置返回图标按钮.</div><div class="line">     */</div><div class="line">    public void setButtonBackImageButton() &#123;</div><div class="line">        imgbtn_left.setImageResource(resBack);</div><div class="line">        imgbtn_left.setOnClickListener(new OnClickListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                finishActivityFromButton();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;);</div><div class="line">        imgbtn_left.setVisibility(View.VISIBLE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置返回图标按钮.</div><div class="line">     */</div><div class="line">    public void setBackImageButton(int resID) &#123;</div><div class="line">        imgbtn_left.setImageResource(resID);</div><div class="line">        imgbtn_left.setOnClickListener(new OnClickListener() &#123;</div><div class="line"></div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                finishActivity();</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;);</div><div class="line">        imgbtn_left.setVisibility(View.VISIBLE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置返回图标按钮</div><div class="line">     *</div><div class="line">     * @param resID         图片引用</div><div class="line">     * @param clickListener 点击监听对象</div><div class="line">     */</div><div class="line">    public void setBackImageButton(int resID, OnClickListener clickListener) &#123;</div><div class="line">        imgbtn_left.setImageResource(resID);</div><div class="line">        imgbtn_left.setOnClickListener(clickListener);</div><div class="line">        imgbtn_left.setVisibility(View.VISIBLE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 关闭显示标题控件的界面.</div><div class="line">     */</div><div class="line">    private void finishActivity() &#123;</div><div class="line">        closeSoftKeyBoard();</div><div class="line">        ((Activity) context).finish();</div><div class="line">        ((Activity) context).overridePendingTransition(R.anim.exit_enter, R.anim.exit_exit);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 关闭显示标题控件的界面.</div><div class="line">     */</div><div class="line">    private void finishActivityFromButton() &#123;</div><div class="line">        closeSoftKeyBoard();</div><div class="line">        ((Activity) context).finish();</div><div class="line">        ((Activity) context).overridePendingTransition(R.anim.enter_exit_from_top, R.anim.enter_enter_from_botton);</div><div class="line">    &#125;</div><div class="line">    /**</div><div class="line">     * 设置左文字按钮.</div><div class="line">     *</div><div class="line">     * @param btnTxt 按钮文字.</div><div class="line">     * @param clk    点击监听对象.</div><div class="line">     */</div><div class="line">    public void setLeftButton(String btnTxt, OnClickListener clk) &#123;</div><div class="line">        btn_left.setText(btnTxt);</div><div class="line">        btn_left.setBackgroundDrawable(null);</div><div class="line">        btn_left.setOnClickListener(clk);</div><div class="line">        btn_left.setVisibility(View.VISIBLE);</div><div class="line">    &#125;</div><div class="line">    /**</div><div class="line">     * 更新左侧按钮文字</div><div class="line">     */</div><div class="line">    public void setleftBtnText(String text) &#123;</div><div class="line">        btn_left.setText(text);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置左按钮四周图标.</div><div class="line">     *</div><div class="line">     * @param left   左图标.</div><div class="line">     * @param top    上图标.</div><div class="line">     * @param right  右图标.</div><div class="line">     * @param bottom 下图标.</div><div class="line">     */</div><div class="line">    public void setLeftButtonDrawable(Drawable left, Drawable top, Drawable right, Drawable bottom) &#123;</div><div class="line">        if (null != left) &#123;</div><div class="line">            left.setBounds(0, 0, left.getMinimumWidth(), left.getMinimumHeight());</div><div class="line">        &#125;</div><div class="line">        if (null != top) &#123;</div><div class="line">            top.setBounds(0, 0, top.getMinimumWidth(), top.getMinimumHeight());</div><div class="line">        &#125;</div><div class="line">        if (null != right) &#123;</div><div class="line">            right.setBounds(0, 0, right.getMinimumWidth(), right.getMinimumHeight());</div><div class="line">        &#125;</div><div class="line">        if (null != bottom) &#123;</div><div class="line">            bottom.setBounds(0, 0, bottom.getMinimumWidth(), bottom.getMinimumHeight());</div><div class="line">        &#125;</div><div class="line">        btn_left.setCompoundDrawables(left, top, right, bottom);</div><div class="line">        btn_left.setCompoundDrawablePadding(context.getResources().getDimensionPixelOffset(R.dimen.spacing_mini));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置左文字按钮.</div><div class="line">     *</div><div class="line">     * @param resID 按钮文字引用id.</div><div class="line">     * @param clk   点击监听对象.</div><div class="line">     */</div><div class="line">    public void setLeftButton(int resID, OnClickListener clk) &#123;</div><div class="line">        btn_left.setText(resID);</div><div class="line">        btn_left.setOnClickListener(clk);</div><div class="line">        btn_left.setBackgroundDrawable(null);</div><div class="line">        btn_left.setVisibility(View.VISIBLE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置左图片按钮.</div><div class="line">     *</div><div class="line">     * @param resID 按钮文字引用id.</div><div class="line">     * @param clk   点击监听对象.</div><div class="line">     */</div><div class="line">    public void setLeftImageButton(int resID, OnClickListener clk) &#123;</div><div class="line">        imgbtn_left.setImageResource(resID);</div><div class="line">        imgbtn_left.setOnClickListener(clk);</div><div class="line">        imgbtn_left.setVisibility(View.VISIBLE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置右文字按钮.</div><div class="line">     *</div><div class="line">     * @param btnTxt 按钮文字.</div><div class="line">     * @param clk    点击监听对象.</div><div class="line">     */</div><div class="line">    public void setRightButton(String btnTxt, OnClickListener clk) &#123;</div><div class="line">        btn_right.setText(btnTxt);</div><div class="line">        btn_right.setOnClickListener(clk);</div><div class="line">        btn_right.setVisibility(View.VISIBLE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置右文字按钮.</div><div class="line">     *</div><div class="line">     * @param resID 按钮文字引用id.</div><div class="line">     * @param clk   点击监听对象.</div><div class="line">     */</div><div class="line">    public void setRightButton(int resID, OnClickListener clk) &#123;</div><div class="line">        btn_right.setText(resID);</div><div class="line">        btn_right.setOnClickListener(clk);</div><div class="line">        btn_right.setVisibility(View.VISIBLE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置右一图标按钮.</div><div class="line">     *</div><div class="line">     * @param resID 图标引用id.</div><div class="line">     * @param clk   点击监听对象.</div><div class="line">     */</div><div class="line">    public void setRightOneImageButton(int resID, OnClickListener clk) &#123;</div><div class="line">        imgbtn_rightOne.setImageResource(resID);</div><div class="line">        imgbtn_rightOne.setOnClickListener(clk);</div><div class="line">        imgbtn_rightOne.setVisibility(View.VISIBLE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置右一图标按钮</div><div class="line">     *</div><div class="line">     * @param resID     图标引用id</div><div class="line">     * @param longclick 长按监听对象</div><div class="line">     */</div><div class="line">    public void setRightOneImageButton(int resID, OnLongClickListener longclick) &#123;</div><div class="line">        imgbtn_rightOne.setImageResource(resID);</div><div class="line">        imgbtn_rightOne.setOnLongClickListener(longclick);</div><div class="line">        imgbtn_rightOne.setVisibility(View.VISIBLE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 设置右二图标按钮(若右一图标按钮未显示,则界面会出现一场).</div><div class="line">     *</div><div class="line">     * @param resID 图标引用id.</div><div class="line">     * @param clk   点击监听对象.</div><div class="line">     */</div><div class="line">    public void setRightTwoImageButton(int resID, OnClickListener clk) &#123;</div><div class="line">        imgbtn_rightTwo.setImageResource(resID);</div><div class="line">        imgbtn_rightTwo.setOnClickListener(clk);</div><div class="line">        imgbtn_rightTwo.setVisibility(View.VISIBLE);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * 关闭键盘.</div><div class="line">     */</div><div class="line">    private void closeSoftKeyBoard() &#123;</div><div class="line">        InputMethodManager imm = (InputMethodManager) context.getSystemService(Context.INPUT_METHOD_SERVICE);</div><div class="line">        // 得到InputMethodManager的实例</div><div class="line">        if (null != ((Activity) context).getCurrentFocus() &amp;&amp; imm.isActive()) &#123; // 如果开启</div><div class="line">            imm.hideSoftInputFromWindow(((Activity) context).getCurrentFocus().getWindowToken(), InputMethodManager.HIDE_NOT_ALWAYS);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>XML使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;com.xp.lvbh.java.others.widget.TitleView</div><div class="line">    android:id=&quot;@+id/view_title&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;@dimen/title_view_height&quot; /&gt;</div></pre></td></tr></table></figure></p>
<h2 id="json数据格式"><a href="#json数据格式" class="headerlink" title="json数据格式"></a>json数据格式</h2><p><strong> json</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;&quot;key&quot;:value,&quot;key2&quot;:value2...&#125;</div></pre></td></tr></table></figure></p>
<p><strong> json array</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[&#123;&quot;key&quot;:value,&quot;key2&quot;:value2...&#125;,&#123;&quot;key&quot;:value,&quot;key2&quot;:value2...&#125;,...]</div></pre></td></tr></table></figure></p>
<h2 id="eclipse快捷键"><a href="#eclipse快捷键" class="headerlink" title="eclipse快捷键"></a>eclipse快捷键</h2><p>ctr+shift+O 导入和删除多余的包<br>alt+向上或向下箭头”移动本行代码向上或向下移动</p>
<h2 id="Android布局问题"><a href="#Android布局问题" class="headerlink" title="Android布局问题"></a>Android布局问题</h2><p>1.RelativeLayout中嵌套LinearLayout，LinearLayout可以设置android:layout_alignParentBottom=”true”将组件固定到底部。但是如果是LinearLayout中嵌套LinearLayout则设置该属性没有用。</p>
<p>2.android:gravity是对元素本身说的,android:layout_gravity是相对与它的父元素说的。</p>
<p>3.当作为父layout的LinearLayout的属性为android：orientation=”vertical” 的时候，android:layout_gravity=”？”这里设为横向的时候才能生效。比如：left，right，center_horizontal等</p>
<p>4.当作为父layout的LinearLayout的属性为android：orientation=”horizental” 的时候，android:layout_gravity=”？”这里设为纵向的时候才能生效。比如：top，bottom，center_vertical等；</p>
<p>5.布局属性：<br>①ListView中设置点击隐藏色变和去掉分隔线。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">android:listSelector=&quot;@android:color/transparent&quot;</div><div class="line">android:divider=&quot;@null&quot;</div></pre></td></tr></table></figure></p>
<p>②ImageView中图片撑满布局。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android:scaleType=&quot;fitXY&quot;</div></pre></td></tr></table></figure></p>
<p>③ScrollView布局须知：<br>android 采用ScrollView布局时出现异常：ScrollView can host only one direct child。主要是ScrollView内部只能有一个子元素，即不能并列两个子元素，所以需要把所有的子元素放到一个LinearLayout内部或RelativeLayout等其他布局方式。</p>
<h2 id="View的事件绑定"><a href="#View的事件绑定" class="headerlink" title="View的事件绑定"></a>View的事件绑定</h2><p>View的setOnClickListener的添加方法<br>1）第一种，也是最长见的添加方法（都以Button为例）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Button btn = (Button) findViewById(R.id.myButton);</div><div class="line">btn .setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">        public void onClick(View v) &#123;</div><div class="line">            //do something</div><div class="line">        &#125;</div><div class="line">    &#125;);</div></pre></td></tr></table></figure></p>
<p>2)第二种，下面这个方法较前一种稍微简单了一些，允许多个Buttons共享一个Listener。通过Switch控制对不同Button Click事件的响应方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">Button btn = (Button) findViewById(R.id.mybutton);</div><div class="line">Button btn2 = (Button) findViewById(R.id.mybutton2);</div><div class="line">btn.setOnClickListener(handler);</div><div class="line">btn2.setOnClickListener(handler);</div><div class="line">View.OnClickListener handler = View.OnClickListener() &#123;</div><div class="line">        public void onClick(View v) &#123;</div><div class="line">            switch (v.getId()) &#123;</div><div class="line">               case R.id.mybutton:</div><div class="line">                    //do something</div><div class="line">               break;</div><div class="line">               case R.id.mybutton2:</div><div class="line">                    //do something</div><div class="line">               break;</div><div class="line">            &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>3)第三种，直接将Clicklistener捆绑XML layout中的Views元素，在程序中定义的Listener方法需要带有一个View类型的参数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    android:orientation=&quot;vertical&quot; android:layout_width=&quot;fill_parent&quot;</div><div class="line">    android:layout_height=&quot;fill_parent&quot;&gt;</div><div class="line">    &lt;TextView android:layout_width=&quot;fill_parent&quot;</div><div class="line">        android:layout_height=&quot;wrap_content&quot; </div><div class="line">        android:id=&quot;@+id/text&quot;</div><div class="line">        android:text=&quot;@string/hello&quot; /&gt;</div><div class="line">    &lt;Button android:id=&quot;@+id/mybutton&quot; </div><div class="line">        android:layout_height=&quot;wrap_content&quot;</div><div class="line">        android:layout_width=&quot;wrap_content&quot; </div><div class="line">        android:onClick=&quot;mybuttonlistener&quot;&gt;</div><div class="line">    &lt;/Button&gt;</div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure></p>
<p>java代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Button btn = (Button) findViewById(R.id.mybutton);</div><div class="line">public void mybuttonlistener(View target)&#123;</div><div class="line">        //do something</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<h2 id="Android数据传递"><a href="#Android数据传递" class="headerlink" title="Android数据传递"></a>Android数据传递</h2><p>基于消息的通信机制 Intent（boudle,extra）[activity之间]<br><strong> Intent传值1</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//a:</div><div class="line">Intent intent = new Intent();</div><div class="line">intent.setClass(ActivityA.this, ActivityB.class);</div><div class="line">Bundle bundle = new Bundle();</div><div class="line">bundle.putString(&quot;invitecode&quot;, invitecode);</div><div class="line">intent.putExtras(bundle);</div><div class="line">startActivity(intent);</div><div class="line"></div><div class="line">//b:      </div><div class="line">Bundle bundle=getIntent().getExtras();</div><div class="line">String info=bundle.getString(&quot;invitecode&quot;);</div></pre></td></tr></table></figure></p>
<p><strong> Intent传值2</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//a：</div><div class="line">Intent intent = new Intent(ActivityA.this, ActivityB.class);</div><div class="line">intent.putExtra(&quot;flag&quot;, flag);</div><div class="line">startActivity(intent);</div><div class="line"></div><div class="line">//b:</div><div class="line">Intent intent1 = this.getIntent(); </div><div class="line">String flag = intent1.getStringExtra(&quot;flag&quot;);</div></pre></td></tr></table></figure></p>
<p>注：数据类型有限，遇到不可序列化的数据Bitmap，Inputstream，或者是LinkList链表等数据类型就不太好用。</p>
<p>下面是基于外部存储的传输 ，File/Preference/Sqlite,如果要针对第三方应用需要Content provider</p>
<p><strong> SharedPreferences</strong><br>1.根据Context获取SharedPreferences对象<br>2.利用edit()方法获取Editor对象。<br>3.通过Editor对象存储key-value键值对数据。<br>4.通过commit()方法提交数据。</p>
<p><strong> ContentProvider</strong><br>其步骤为：</p>
<ol>
<li>在当前应用程序中定义一个ContentProvider。</li>
<li>在当前应用程序的AndroidManifest.xml中注册此ContentProvider</li>
<li>其他应用程序通过ContentResolver和Uri来获取此ContentProvider的数据。<br>注：在其AndroidManifest.xml中声明此ContentProvider，其中authorities属性定义了此ContentProvider的Uri标识。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;provider android:name=&quot;.MyProvider&quot; android:authorities=&quot;com.test.MyProvider&quot;/&gt;</div></pre></td></tr></table></figure>
</li>
</ol>
<p><strong> File&amp;SQLite(略)</strong></p>
<p><strong> 基于IPC的通信机制</strong><br>Inter-Process Communication,进程间通信。context与service之间的传输，如Activity与Service之间的通信。</p>
<p><strong> 基于Application  Context</strong><br>用application context来关联这些状态，每个activity都是context，里面包含了运行时的状态。同样application也有一个context，android会保证这个context是唯一的实例。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public class MyApp extends Application &#123;</div><div class="line">    private Bitmap mBitmap;</div><div class="line"></div><div class="line">    public Bitmap getBitmap() &#123;</div><div class="line">        return mBitmap;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void setBitmap(Bitmap bitmap) &#123;</div><div class="line">        this.mBitmap = bitmap;</div><div class="line">    &#125;</div><div class="line">   </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;application android:name=&quot;.MyApp&quot; android:icon=&quot;@drawable/icon&quot; android:label=&quot;@string/app_name&quot;&gt;&lt;/application&gt;</div></pre></td></tr></table></figure>
<p>获得Bitmap对象的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ImageView imageview = (ImageView)findViewById(R.id.ivImageView);</div><div class="line">MyApp myApp = (MyApp)getApplication();</div><div class="line">imageview.setImageBitmap(myApp.getBitmap());</div></pre></td></tr></table></figure></p>
<p>上面两段代码可以在任何的Service、Activity中使用,全局的。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="http://blog.csdn.net/zyq0335/article/details/7636724" target="_blank" rel="external">activity之间的数据传递方法</a></li>
<li><a href="https://www.visualsvn.com/" target="_blank" rel="external">Apache Subversion</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/02/23/note_work_xp01/" data-id="cj4zvsgd0006q0gnhmvadyewz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xpnet/">xpnet</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-algorithm_sort_heapsort" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/19/algorithm_sort_heapsort/" class="article-date">
  <time datetime="2016-02-19T06:34:29.000Z" itemprop="datePublished">2016-02-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/algorithm/">algorithm</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/19/algorithm_sort_heapsort/">排序算法之堆排序</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>堆排序(Heapsort)是指利用堆积树（堆）这种数据结构所设计的一种排序算法，它是选择排序的一种。可以利用数组的特点快速定位指定索引的元素。堆分为大根堆和小根堆，是完全二叉树。大根堆的要求是每个节点的值都不大于其父节点的值，即A[PARENT[i]] &gt;= A[i]。在数组的非降序排序中，需要使用的就是大根堆，因为根据大根堆的要求可知，最大的值一定在堆顶。</p>
<p>1991年的计算机先驱奖获得者、斯坦福大学计算机科学系教授罗伯特·弗洛伊德(Robert W．Floyd）和威廉姆斯(J．Williams）在1964年共同发明了著名的堆排序算法（ Heap Sort )。</p>
<h2 id="二叉堆"><a href="#二叉堆" class="headerlink" title="二叉堆"></a>二叉堆</h2><p>二叉堆是完全二叉树或者是近似完全二叉树。<br>二叉堆满足二个特性：<br>1．父结点的键值总是大于或等于（小于或等于）任何一个子节点的键值。<br>2．每个结点的左子树和右子树都是一个二叉堆（都是最大堆或最小堆）。<br>当父结点的键值总是大于或等于任何一个子节点的键值时为最大堆。当父结点的键值总是小于或等于任何一个子节点的键值时为最小堆。下图展示一个最小堆：<br><img src="http://hi.csdn.net/attachment/201108/22/0_1314014666d5oe.gif" alt=""></p>
<p>大根堆和小根堆：<br>根结点（亦称为堆顶）的关键字是堆里所有结点关键字中最小者的堆称为小根堆，又称最小堆。<br>根结点（亦称为堆顶）的关键字是堆里所有结点关键字中最大者，称为大根堆，又称最大堆。<br><img src="http://hi.csdn.net/attachment/201109/22/0_1316660169VUBb.gif" alt=""><br>注意：<br>①堆中任一子树亦是堆。②以上讨论的堆实际上是二叉堆（Binary Heap），类似地可定义k叉堆。</p>
<p>高度<br>堆可以被看成是一棵树，结点在堆中的高度可以被定义为从本结点到叶子结点的最长简单下降路径上边的数目；定义堆的高度为树根的高度。我们将看到，堆结构上的一些基本操作的运行时间至多是与树的高度成正比，为O（lgn）。</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>堆排序利用了大根堆（或小根堆）堆顶记录的关键字最大（或最小）这一特征，使得在当前无序区中选取最大（或最小）关键字的记录变得简单。<br>（1）用大根堆排序的基本思想<br>① 先将初始文件R[1..n]建成一个大根堆，此堆为初始的无序区<br>② 再将关键字最大的记录R[1]（即堆顶）和无序区的最后一个记录R[n]交换，由此得到新的无序区R[1..n-1]和有序区R[n]，且满足R[1..n-1].keys≤R[n].key<br>③由于交换后新的根R[1]可能违反堆性质，故应将当前无序区R[1..n-1]调整为堆。然后再次将R[1..n-1]中关键字最大的记录R[1]和该区间的最后一个记录R[n-1]交换，由此得到新的无序区R[1..n-2]和有序区R[n-1..n]，且仍满足关系R[1..n-2].keys≤R[n-1..n].keys，同样要将R[1..n-2]调整为堆。<br>……<br>直到无序区只有一个元素为止。<br>（2）大根堆排序算法的基本操作：<br>①建堆，建堆是不断调整堆的过程，从len/2处开始调整，一直到第一个节点，此处len是堆中元素的个数。建堆的过程是线性的过程，从len/2到0处一直调用调整堆的过程，相当于o(h1)+o(h2)…+o(hlen/2) 其中h表示节点的深度，len/2表示节点的个数，这是一个求和的过程，结果是线性的O(n)。<br>②调整堆：调整堆在构建堆的过程中会用到，而且在堆排序过程中也会用到。利用的思想是比较节点i和它的孩子节点left(i),right(i)，选出三者最大(或者最小)者，如果最大（小）值不是节点i而是它的一个孩子节点，那边交互节点i和该节点，然后再调用调整堆过程，这是一个递归的过程。调整堆的过程时间复杂度与堆的深度有关系，是lgn的操作，因为是沿着深度方向进行调整的。<br>③堆排序：堆排序是利用上面的两个过程来进行的。首先是根据元素构建堆。然后将堆的根节点取出(一般是与最后一个节点进行交换)，将前面len-1个节点继续进行堆调整的过程，然后再将根节点取出，这样一直到所有节点都取出。堆排序过程的时间复杂度是O(nlgn)。因为建堆的时间复杂度是O(n)（调用一次）；调整堆的时间复杂度是lgn，调用了n-1次，所以堆排序的时间复杂度是O(nlgn)[2]<br>注意<br>①只需做n-1趟排序，选出较大的n-1个关键字即可以使得文件递增有序。<br>②用小根堆排序与利用大根堆类似，只不过其排序结果是递减有序的。堆排序和直接选择排序相反：在任何时刻堆排序中无序区总是在有序区之前，且有序区是在原向量的尾部由后往前逐步扩大至整个向量为止<br>特点<br>堆排序（HeapSort）是一树形选择排序。堆排序的特点是：在排序过程中，将R[l..n]看成是一棵完全二叉树的顺序存储结构，利用完全二叉树中双亲结点和孩子结点之间的内在关系（参见二叉树的顺序存储结构），在当前无序区中选择关键字最大（或最小）的记录。</p>
<h2 id="算法分析"><a href="#算法分析" class="headerlink" title="算法分析"></a>算法分析</h2><p>堆排序的时间，主要由建立初始堆和反复重建堆这两部分的时间开销构成，它们均是通过调用Heapify实现的。<br>平均性能<br>O(N*logN)。</p>
<p><strong> 其他性能</strong><br>由于建初始堆所需的比较次数较多，所以堆排序不适宜于记录数较少的文件。<br>堆排序是就地排序，辅助空间为O(1）.<br>它是不稳定的排序方法。（排序的稳定性是指如果在排序的序列中，存在前后相同的两个元素的话，排序前 和排序后他们的相对位置不发生变化）</p>
<h2 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div></pre></td><td class="code"><pre><div class="line">public class HeapSort&#123;</div><div class="line">    private static int[] sort=new int[]&#123;1,0,10,20,3,5,6,4,9,8,12,</div><div class="line">            17,34,11&#125;;</div><div class="line"></div><div class="line">    public static void main(String[] args)&#123;</div><div class="line">        buildMaxHeapify(sort);</div><div class="line">        heapSort(sort);</div><div class="line">        print(sort);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static void buildMaxHeapify(int[] data)&#123;</div><div class="line">//没有子节点的才需要创建最大堆，从最后一个的父节点开始</div><div class="line">        int startIndex=getParentIndex(data.length-1);</div><div class="line">//从尾端开始创建最大堆，每次都是正确的堆</div><div class="line">        for(int i=startIndex;i&gt;=0;i--)&#123;</div><div class="line">            maxHeapify(data,data.length,i);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     *创建最大堆</div><div class="line">     *</div><div class="line">     *@paramdata</div><div class="line">     *@paramheapSize需要创建最大堆的大小，一般在sort的时候用到，因为最多值放在末尾，末尾就不再归入最大堆了</div><div class="line">     *@paramindex当前需要创建最大堆的位置</div><div class="line">     */</div><div class="line">    private static void maxHeapify(int[] data,int heapSize,int index)&#123;</div><div class="line">//当前点与左右子节点比较</div><div class="line">        int left=getChildLeftIndex(index);</div><div class="line">        int right=getChildRightIndex(index);</div><div class="line"></div><div class="line">        int largest=index;</div><div class="line">        if(left&lt;heapSize&amp;&amp;data[index]&lt;data[left])&#123;</div><div class="line">            largest=left;</div><div class="line">        &#125;</div><div class="line">        if(right&lt;heapSize&amp;&amp;data[largest]&lt;data[right])&#123;</div><div class="line">            largest=right;</div><div class="line">        &#125;</div><div class="line">//得到最大值后可能需要交换，如果交换了，其子节点可能就不是最大堆了，需要重新调整</div><div class="line">        if(largest!=index)&#123;</div><div class="line">            int temp=data[index];</div><div class="line">            data[index]=data[largest];</div><div class="line">            data[largest]=temp;</div><div class="line">            maxHeapify(data,heapSize,largest);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     *排序，最大值放在末尾，data虽然是最大堆，在排序后就成了递增的</div><div class="line">     *</div><div class="line">     *@paramdata</div><div class="line">     */</div><div class="line">    private static void heapSort(int[] data)&#123;</div><div class="line">//末尾与头交换，交换后调整最大堆</div><div class="line">        for(int i=data.length-1;i&gt;0;i--)&#123;</div><div class="line">            int temp=data[0];</div><div class="line">            data[0]=data[i];</div><div class="line">            data[i]=temp;</div><div class="line">            maxHeapify(data,i,0);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     *父节点位置</div><div class="line">     *</div><div class="line">     *@paramcurrent</div><div class="line">     *@return</div><div class="line">     */</div><div class="line">    private static int getParentIndex(int current)&#123;</div><div class="line">        return(current-1)&gt;&gt;1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     *左子节点position注意括号，加法优先级更高</div><div class="line">     *</div><div class="line">     *@paramcurrent</div><div class="line">     *@return</div><div class="line">     */</div><div class="line">    private static int getChildLeftIndex(int current)&#123;</div><div class="line">        return(current&lt;&lt;1)+1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     *右子节点position</div><div class="line">     *</div><div class="line">     *@paramcurrent</div><div class="line">     *@return</div><div class="line">     */</div><div class="line">    private static int getChildRightIndex(int current)&#123;</div><div class="line">        return(current&lt;&lt;1)+2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static void print(int[] data)&#123;</div><div class="line">        int pre=-2;</div><div class="line">        for(int i=0;i&lt;data.length;i++)&#123;</div><div class="line">            if(pre&lt;(int)getLog(i+1))&#123;</div><div class="line">                pre=(int)getLog(i+1);</div><div class="line">                System.out.println();</div><div class="line">            &#125;</div><div class="line">            System.out.print(data[i]+&quot;|&quot;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     *以2为底的对数</div><div class="line">     *</div><div class="line">     *@paramparam</div><div class="line">     *@return</div><div class="line">     */</div><div class="line">    private static double getLog(double param)&#123;</div><div class="line">        return Math.log(param)/Math.log(2);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>演示：<br><img src="https://upload.wikimedia.org/wikipedia/commons/1/1b/Sorting_heapsort_anim.gif" alt=""><br>首先，将元素进行重排，以符合堆的条件。图中排序过程之前简单的绘出了堆树的结构。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="http://baike.baidu.com/link?url=TAmDWj4EUeqkrvql8wCotntQNZ7UPlqsQx7X8mcz9F_LftIVHuZdQbNgLh5ajmZUwJRex1iSB1I-aggvYgKjrK" target="_blank" rel="external">百度百科:堆排序</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E5%A0%86%E6%8E%92%E5%BA%8F" target="_blank" rel="external">维基百科:堆排序</a></li>
<li><a href="http://blog.csdn.net/morewindows/article/details/6709644" target="_blank" rel="external">白话经典算法系列之七:堆与堆排序</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/02/19/algorithm_sort_heapsort/" data-id="cj4zvsg7000000gnhrfh6y7jz" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sort/">sort</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-algorithm_sort_heap" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/02/19/algorithm_sort_heap/" class="article-date">
  <time datetime="2016-02-19T06:34:29.000Z" itemprop="datePublished">2016-02-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/algorithm/">algorithm</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/19/algorithm_sort_heap/">排序算法之堆排序</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>堆排序(Heapsort)是指利用堆积树（堆）这种数据结构所设计的一种排序算法，它是选择排序的一种。可以利用数组的特点快速定位指定索引的元素。堆分为大根堆和小根堆，是完全二叉树。大根堆的要求是每个节点的值都不大于其父节点的值，即A[PARENT[i]] &gt;= A[i]。在数组的非降序排序中，需要使用的就是大根堆，因为根据大根堆的要求可知，最大的值一定在堆顶。</p>
<p>1991年的计算机先驱奖获得者、斯坦福大学计算机科学系教授罗伯特·弗洛伊德(Robert W．Floyd）和威廉姆斯(J．Williams）在1964年共同发明了著名的堆排序算法（ Heap Sort )。</p>
<h2 id="二叉堆"><a href="#二叉堆" class="headerlink" title="二叉堆"></a>二叉堆</h2><p>二叉堆是完全二叉树或者是近似完全二叉树。<br>二叉堆满足二个特性：<br>1．父结点的键值总是大于或等于（小于或等于）任何一个子节点的键值。<br>2．每个结点的左子树和右子树都是一个二叉堆（都是最大堆或最小堆）。<br>当父结点的键值总是大于或等于任何一个子节点的键值时为最大堆。当父结点的键值总是小于或等于任何一个子节点的键值时为最小堆。下图展示一个最小堆：<br><img src="http://hi.csdn.net/attachment/201108/22/0_1314014666d5oe.gif" alt=""></p>
<p>大根堆和小根堆：<br>根结点（亦称为堆顶）的关键字是堆里所有结点关键字中最小者的堆称为小根堆，又称最小堆。<br>根结点（亦称为堆顶）的关键字是堆里所有结点关键字中最大者，称为大根堆，又称最大堆。<br><img src="http://hi.csdn.net/attachment/201109/22/0_1316660169VUBb.gif" alt=""><br>注意：<br>①堆中任一子树亦是堆。②以上讨论的堆实际上是二叉堆（Binary Heap），类似地可定义k叉堆。</p>
<p>高度<br>堆可以被看成是一棵树，结点在堆中的高度可以被定义为从本结点到叶子结点的最长简单下降路径上边的数目；定义堆的高度为树根的高度。我们将看到，堆结构上的一些基本操作的运行时间至多是与树的高度成正比，为O（lgn）。</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>堆排序利用了大根堆（或小根堆）堆顶记录的关键字最大（或最小）这一特征，使得在当前无序区中选取最大（或最小）关键字的记录变得简单。<br>（1）用大根堆排序的基本思想<br>① 先将初始文件R[1..n]建成一个大根堆，此堆为初始的无序区<br>② 再将关键字最大的记录R[1]（即堆顶）和无序区的最后一个记录R[n]交换，由此得到新的无序区R[1..n-1]和有序区R[n]，且满足R[1..n-1].keys≤R[n].key<br>③由于交换后新的根R[1]可能违反堆性质，故应将当前无序区R[1..n-1]调整为堆。然后再次将R[1..n-1]中关键字最大的记录R[1]和该区间的最后一个记录R[n-1]交换，由此得到新的无序区R[1..n-2]和有序区R[n-1..n]，且仍满足关系R[1..n-2].keys≤R[n-1..n].keys，同样要将R[1..n-2]调整为堆。<br>……<br>直到无序区只有一个元素为止。<br>（2）大根堆排序算法的基本操作：<br>①建堆，建堆是不断调整堆的过程，从len/2处开始调整，一直到第一个节点，此处len是堆中元素的个数。建堆的过程是线性的过程，从len/2到0处一直调用调整堆的过程，相当于o(h1)+o(h2)…+o(hlen/2) 其中h表示节点的深度，len/2表示节点的个数，这是一个求和的过程，结果是线性的O(n)。<br>②调整堆：调整堆在构建堆的过程中会用到，而且在堆排序过程中也会用到。利用的思想是比较节点i和它的孩子节点left(i),right(i)，选出三者最大(或者最小)者，如果最大（小）值不是节点i而是它的一个孩子节点，那边交互节点i和该节点，然后再调用调整堆过程，这是一个递归的过程。调整堆的过程时间复杂度与堆的深度有关系，是lgn的操作，因为是沿着深度方向进行调整的。<br>③堆排序：堆排序是利用上面的两个过程来进行的。首先是根据元素构建堆。然后将堆的根节点取出(一般是与最后一个节点进行交换)，将前面len-1个节点继续进行堆调整的过程，然后再将根节点取出，这样一直到所有节点都取出。堆排序过程的时间复杂度是O(nlgn)。因为建堆的时间复杂度是O(n)（调用一次）；调整堆的时间复杂度是lgn，调用了n-1次，所以堆排序的时间复杂度是O(nlgn)[2]<br>注意<br>①只需做n-1趟排序，选出较大的n-1个关键字即可以使得文件递增有序。<br>②用小根堆排序与利用大根堆类似，只不过其排序结果是递减有序的。堆排序和直接选择排序相反：在任何时刻堆排序中无序区总是在有序区之前，且有序区是在原向量的尾部由后往前逐步扩大至整个向量为止<br>特点<br>堆排序（HeapSort）是一树形选择排序。堆排序的特点是：在排序过程中，将R[l..n]看成是一棵完全二叉树的顺序存储结构，利用完全二叉树中双亲结点和孩子结点之间的内在关系（参见二叉树的顺序存储结构），在当前无序区中选择关键字最大（或最小）的记录。</p>
<h2 id="算法分析"><a href="#算法分析" class="headerlink" title="算法分析"></a>算法分析</h2><p>堆排序的时间，主要由建立初始堆和反复重建堆这两部分的时间开销构成，它们均是通过调用Heapify实现的。<br>平均性能<br>O(N*logN)。</p>
<p><strong> 其他性能</strong><br>由于建初始堆所需的比较次数较多，所以堆排序不适宜于记录数较少的文件。<br>堆排序是就地排序，辅助空间为O(1）.<br>它是不稳定的排序方法。（排序的稳定性是指如果在排序的序列中，存在前后相同的两个元素的话，排序前 和排序后他们的相对位置不发生变化）</p>
<h2 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div></pre></td><td class="code"><pre><div class="line">public class HeapSort&#123;</div><div class="line">    private static int[] sort=new int[]&#123;1,0,10,20,3,5,6,4,9,8,12,</div><div class="line">            17,34,11&#125;;</div><div class="line"></div><div class="line">    public static void main(String[] args)&#123;</div><div class="line">        buildMaxHeapify(sort);</div><div class="line">        heapSort(sort);</div><div class="line">        print(sort);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static void buildMaxHeapify(int[] data)&#123;</div><div class="line">//没有子节点的才需要创建最大堆，从最后一个的父节点开始</div><div class="line">        int startIndex=getParentIndex(data.length-1);</div><div class="line">//从尾端开始创建最大堆，每次都是正确的堆</div><div class="line">        for(int i=startIndex;i&gt;=0;i--)&#123;</div><div class="line">            maxHeapify(data,data.length,i);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     *创建最大堆</div><div class="line">     *</div><div class="line">     *@paramdata</div><div class="line">     *@paramheapSize需要创建最大堆的大小，一般在sort的时候用到，因为最多值放在末尾，末尾就不再归入最大堆了</div><div class="line">     *@paramindex当前需要创建最大堆的位置</div><div class="line">     */</div><div class="line">    private static void maxHeapify(int[] data,int heapSize,int index)&#123;</div><div class="line">//当前点与左右子节点比较</div><div class="line">        int left=getChildLeftIndex(index);</div><div class="line">        int right=getChildRightIndex(index);</div><div class="line"></div><div class="line">        int largest=index;</div><div class="line">        if(left&lt;heapSize&amp;&amp;data[index]&lt;data[left])&#123;</div><div class="line">            largest=left;</div><div class="line">        &#125;</div><div class="line">        if(right&lt;heapSize&amp;&amp;data[largest]&lt;data[right])&#123;</div><div class="line">            largest=right;</div><div class="line">        &#125;</div><div class="line">//得到最大值后可能需要交换，如果交换了，其子节点可能就不是最大堆了，需要重新调整</div><div class="line">        if(largest!=index)&#123;</div><div class="line">            int temp=data[index];</div><div class="line">            data[index]=data[largest];</div><div class="line">            data[largest]=temp;</div><div class="line">            maxHeapify(data,heapSize,largest);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     *排序，最大值放在末尾，data虽然是最大堆，在排序后就成了递增的</div><div class="line">     *</div><div class="line">     *@paramdata</div><div class="line">     */</div><div class="line">    private static void heapSort(int[] data)&#123;</div><div class="line">//末尾与头交换，交换后调整最大堆</div><div class="line">        for(int i=data.length-1;i&gt;0;i--)&#123;</div><div class="line">            int temp=data[0];</div><div class="line">            data[0]=data[i];</div><div class="line">            data[i]=temp;</div><div class="line">            maxHeapify(data,i,0);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     *父节点位置</div><div class="line">     *</div><div class="line">     *@paramcurrent</div><div class="line">     *@return</div><div class="line">     */</div><div class="line">    private static int getParentIndex(int current)&#123;</div><div class="line">        return(current-1)&gt;&gt;1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     *左子节点position注意括号，加法优先级更高</div><div class="line">     *</div><div class="line">     *@paramcurrent</div><div class="line">     *@return</div><div class="line">     */</div><div class="line">    private static int getChildLeftIndex(int current)&#123;</div><div class="line">        return(current&lt;&lt;1)+1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     *右子节点position</div><div class="line">     *</div><div class="line">     *@paramcurrent</div><div class="line">     *@return</div><div class="line">     */</div><div class="line">    private static int getChildRightIndex(int current)&#123;</div><div class="line">        return(current&lt;&lt;1)+2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private static void print(int[] data)&#123;</div><div class="line">        int pre=-2;</div><div class="line">        for(int i=0;i&lt;data.length;i++)&#123;</div><div class="line">            if(pre&lt;(int)getLog(i+1))&#123;</div><div class="line">                pre=(int)getLog(i+1);</div><div class="line">                System.out.println();</div><div class="line">            &#125;</div><div class="line">            System.out.print(data[i]+&quot;|&quot;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    /**</div><div class="line">     *以2为底的对数</div><div class="line">     *</div><div class="line">     *@paramparam</div><div class="line">     *@return</div><div class="line">     */</div><div class="line">    private static double getLog(double param)&#123;</div><div class="line">        return Math.log(param)/Math.log(2);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>演示：<br><img src="https://upload.wikimedia.org/wikipedia/commons/1/1b/Sorting_heapsort_anim.gif" alt=""><br>首先，将元素进行重排，以符合堆的条件。图中排序过程之前简单的绘出了堆树的结构。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="http://baike.baidu.com/link?url=TAmDWj4EUeqkrvql8wCotntQNZ7UPlqsQx7X8mcz9F_LftIVHuZdQbNgLh5ajmZUwJRex1iSB1I-aggvYgKjrK" target="_blank" rel="external">百度百科:堆排序</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E5%A0%86%E6%8E%92%E5%BA%8F" target="_blank" rel="external">维基百科:堆排序</a></li>
<li><a href="http://blog.csdn.net/morewindows/article/details/6709644" target="_blank" rel="external">白话经典算法系列之七:堆与堆排序</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/02/19/algorithm_sort_heap/" data-id="cj4zvsg9t00250gnh94maabrb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sort/">sort</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-reading_book_list1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/27/reading_book_list1/" class="article-date">
  <time datetime="2016-01-27T01:05:29.000Z" itemprop="datePublished">2016-01-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/reading/">reading</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/27/reading_book_list1/">201601书单整理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong> 尹吉男：艺术史学者，当代艺术评论家，中央美术学院人文学院院长，中国美术史教授。推荐书单如下</strong></p>
<h2 id="中国近现代"><a href="#中国近现代" class="headerlink" title="中国近现代"></a>中国近现代</h2><p>1、费孝通《乡土中国》三联书店、北京大学出版社／《学术自述与反思》三联书店<br>2、毛泽东《中国社会各阶级分析》、《矛盾论》<br>3、孙中山《三民主义》、《建国方略》、《孙中山选集》人民出版社<br>4、俞伟超《考古学是什么》中国社会科学出版社<br>5、张光直《中国青铜时代》三联书店<br>6、黄仁宇《万历十五年》三联书店／中华书局<br>7、李零《中国方术考》今日中国出版社／《中国方术续考》东方出版社<br>8、林梅村《古道西风》三联书店／《西域文明》东方出版社<br>9、向达《唐代长安与西域文明》三联书店<br>10、阎步克《士大夫演生史稿》北京大学出版社／《乐师与史官》三联书店<br>11、刘禾《语际书写》上海三联出版社／《跨语际实践》三联书店<br>12、李欧梵《徘徊在现代和后现代之间》上海三联出版社<br>13、章太炎《国学概论》上海古籍出版社<br>14、陈垣《史讳举例》上海古籍出版社／《励耘书室丛刻》北京师范大学出版社<br>15、陈寅恪《隋唐制度渊源略论稿》、《金明馆丛稿初编》中华书局／三联书店<br>16、杜维明《现代精神与儒家传统》三联书店／《东亚价值与多元现代性》中国社科<br>17、荣新江《敦煌学十八讲》北京大学出版社<br>18、唐德刚《李宗仁回忆录》多家出版社／《胡适口述自传》华东师范大学出版社<br>19、李泽厚《华夏美学》中国文联出版公司／《美的历程》文物出版社<br>20、冯友兰《中国哲学简史》北京大学出版社<br>21、夏鼐《考古学论集》河北教育出版社／《考古学与科技史》科学出版社<br>22、宗白华《艺境》北京大学出版社／《美学散步》人民文学出版社<br>23、梁启超《中国近三百年学术史》华东师范大学出版社<br>24、陈东原《中国妇女生活史》商务印书馆<br>25、王国维《人间词话》／《观堂集林》中华书局<br>26、李学勤《简帛佚籍与学术史》江西教育出版社<br>27、王力《汉语史稿》中华书局<br>28、宿白《中国石窟寺研究》文物出版社<br>29、朱光潜《西方美学史》人民出版社<br>30、季羡林《中国蔗糖史》东方出版社<br>31、钱钟书《七缀集》上海古籍出版<br>32、庞朴《一分为三》海天出版社<br>33、李景汉《定县社会概况调查》人民大学出版社<br>34、金岳霖《形式逻辑》人民出版社<br>35、潘光旦《明清两代嘉兴的望族》上海书店／《性心理学》（注释部分）三联书店<br>36、顾颉刚《秦汉的方士与儒生》上海古籍出版社<br>37、瞿同祖《中国法律与中国社会》中华书局<br>38、孙机《中国圣火》辽宁教育出版社／《寻常的精致》辽宁教育出版社<br>39、杨联升《中国制度史研究》江苏人民出版社<br>40、陈星灿《中国史前考古学史研究》三联书店<br>41、徐复观《中国艺术精神》华东师范大学出版社／春风文艺出版社</p>
<h2 id="外国推荐书目"><a href="#外国推荐书目" class="headerlink" title="外国推荐书目"></a>外国推荐书目</h2><p>1、杰姆逊《后现代主义与文化理论》北京大学出版社<br>2、马克思《1844年经济学哲学手稿》人民出版社／《马克思恩格斯全集》<br>3、福柯《知识考古学》三联书店／《词与物》上海三联书店<br>4、萨伊德《东方学》三联书店／《赛义德自选集》中国社会科学出版社<br>5、德里达《书写与差异》三联书店<br>6、本雅明《发达资本主义时代的抒情诗人》三联书店／《机械复制时代的艺术作品》浙江摄影出版社<br>7、孔飞力《叫魂》上海三联出版社<br>8、福山《历史的终结》远方出版社<br>9、亨廷顿《文明的冲突与世界秩序的重建》新华出版社<br>10、丹尼尔·贝尔《资本主义文化矛盾》三联书店<br>11、利奥塔尔《后现代状况》三联书店<br>12、福泽谕吉《福泽谕吉自传》商务印书馆／《劝学篇》商务印书馆<br>13、韦伯《新教伦理与资本主义精神》三联书店<br>14、罗素《西方哲学史》（上、下）商务印书馆<br>15、列文森《儒教中国及其现代命运》中国社会科学出版社<br>16、佛洛伊德《摩西与一神教》三联书店／《梦的释义》辽宁人民出版社<br>17、波普尔《开放社会及其敌人》<br>18、马斯洛《自我实现的人》三联书店<br>19、波伏瓦《第二性》中国书籍出版社／湖南文艺出版社<br>20、凯特·米利特《性的政治》社会文献出版社<br>21、列维—斯特劳斯《野性的思维》商务印书馆<br>22、哈贝马斯《重建历史唯物主义》社会文献出版社<br>23、沟口雄三《中国前近代思想的演变》中华书局<br>24、《日本人视野中的中国学》中国人民大学出版社<br>25、格雷马斯《结构语义学》三联书店<br>26、马林诺夫斯基《文化论》、《两性社会学》中国民间文艺出版社<br>27、皮亚杰《发生认识论原理》商务印书馆<br>28、赫胥黎《人类在自然界的位置》科学出版社<br>29、布罗代尔《15至18世纪的物质文明、经济和资本主义》三联书店<br>30、李约瑟《中国科学技术史》科学出版社<br>31、费正清《中国：传统与变迁》、《美国与中国》世界知识出版社<br>32、荣格《心理学与文学》三联书店<br>33、斯文·赫定《亚洲腹地探险八年》新疆人民出版社<br>34、汤因比《历史研究》上海人民出版社<br>35、包桑葵《美学史》商务印书馆<br>36、阿诺德·豪塞尔《艺术史的哲学》中国社会科学出版社<br>37、贡布里希《艺术与错觉》<br>38、阿恩海姆《艺术与视知觉》中国社会科学出版社<br>39、弗雷泽《金枝》中国民间文艺出版社<br>40、罗兰·巴特《符号学原理》三联书店<br>41、摩尔根《古代社会》商务印书馆<br>42、迪尔凯姆《自杀论》商务印书馆<br>43、本尼迪克特《菊与刀》商务印书馆<br>44、《后工业社会的来临》商务印书馆</p>
<h2 id="中国古典著作"><a href="#中国古典著作" class="headerlink" title="中国古典著作"></a>中国古典著作</h2><p>1、刘向《列女传》辽宁教育出版社<br>2、杨衒之《洛阳伽蓝记》上海古籍出版社<br>3、郦道元《水经注》<br>4、慧皎《高僧传》中华书局<br>5、慧能《坛经》中华书局<br>6、徐天麟《西汉会要》中华书局<br>7、孟元老《东京梦华录》书目文献出版社／浙江古籍出版社<br>8、马端临《文献通考》中华书局<br>9、高棅《唐诗品汇》上海古籍出版社<br>10、陶宗仪《南村辍耕录》中华书局<br>11、安岐《墨缘汇观》天津古籍出版社／江苏古籍出版社<br>12、《佩文斋书画谱》中国书店<br>13、赵翼《廿二史札记》中华书局／辽宁教育出版社<br>14、钱大昕《十驾斋养新录》江苏古籍出版社<br>15、王鸣盛《十七史商榷》中国书店<br>16、萧统《昭明文选》中华书局<br>17、李贽《焚书》、《续焚书》、《史纲评要》中华书局<br>18、王夫之《读通鉴论》、《宋论》中华书局<br>19、黄宗羲《明夷待访录》、《黄宗羲全集》浙江古籍出版社<br>20、厉鹗《宋诗纪事》（上、下）上海古籍出版社<br>21、计成《园冶》中国建筑出版社<br>22、李渔《闲情偶记》、《李渔全集》浙江古籍出版社<br>23、张潮《幽梦影》黄山书社<br>24、叶德辉《书林清话》中华书局／岳麓书社<br>25、刘勰《文心雕龙》人民文学出版社<br>26、钟嵘《诗品》人民文学出版社<br>27、《读史方舆纪要》中华书局<br>28、段玉裁《说文解字注》中华书局<br>29、金圣叹《金圣叹全集》江苏古籍出版社</p>
<h2 id="其他参考书"><a href="#其他参考书" class="headerlink" title="其他参考书"></a>其他参考书</h2><p>1、张京媛主编《后殖民理论与文化批评》北京大学出版社<br>2、张京媛主编《新历史主义与文学批评》北京大学出版社<br>3、张京媛主编《女性主义文学批评》北京大学出版社<br>4、侯外庐主编《中国思想通史》人民出版社<br>5、翦伯赞主编《中国史纲要》人民出版社<br>6、任继愈主编《中国佛教史》人民出版社<br>7、郭绍虞《中国文学批评史》上海古籍出版社<br>8、斯塔夫里阿诺斯《全球通史》上海社会科学院出版<br>9、汪晖、陈燕谷主编《文化与公共性》三联书店<br>10、潘吉星《中国造纸技术史稿》文物出版社<br>11、《中国陶瓷史》文物出版社<br>12、谭其骧主编《中国历史地图集》上海古籍出版社<br>13、《泰晤士世界历史地图》三联书店<br>14、沈从文《中国历代服饰研究》<br>15、王世襄《明式家具研究》文物出版社／《锦灰堆》三联书店<br>16、陈从周《说园》中国建筑出版社<br>17、《中国大百科全书》（考古卷）中国大百科全书出版社<br>18、张正烺《中西交通史资料汇编》<br>19、冯时《中国天文考古学》社会文献出版社<br>20、于安澜编《画品丛书》上海人民美术出版社<br>21、于安澜编《画史丛书》（五册）上海人民美术出版社/<br>22、俞剑华编著《中国画论类编》（上、下）人民美术出版社<br>23、卢辅圣主编《中国书画全书》（1—14册）上海书画出版社<br>24、《道藏要籍选刊》上海古籍出版社<br>25、《中国美学史资料选辑》（上、下）人民出版社<br>26、《中国哲学史资料选辑》（14册）中华书局<br>27、《中国哲学史教学资料选辑》（上、下）中华书局<br>28、《西方哲学原著选读》（上、下）商务印书馆<br>29、《二十世纪西方美学名著选》（上、下）复旦大学出版社<br>30、《中国古代文论选》（一、二、三、四）上海古籍出版社<br>31、《中国佛教思想资料选编》（三卷）中华书局<br>32、《中国现代思想史资料简编》（五卷）浙江人民出版社<br>33、《中国现代史资料选辑》（五册）中国人民大学出版社<br>34、《中共党史参考资料》（8册）人民出版社<br>35、《唐代墓志汇编》上海古籍出版社<br>36、《太平广记》中华书局<br>37、《太平御览》中华书局<br>38、《全上古三代秦汉三国六朝文》（4册）中华书局<br>39、《全唐文》（5册）上海古籍出版社<br>40、《全宋文》巴蜀书社<br>41、《全辽文》中华书局<br>42、《全唐诗》中华书局<br>43、《全宋词》中华书局<br>44、《元诗选》中华书局</p>
<p><strong> 易英：中央美术学院教授、博士生导师，中央美术学院《美术研究》杂志社社长、《世界美术》主编。，易英推荐的艺术类书目</strong></p>
<h2 id="西方美术史与批评方法"><a href="#西方美术史与批评方法" class="headerlink" title="西方美术史与批评方法"></a>西方美术史与批评方法</h2><p>《历史哲学》黑格尔（王造时／译）上海世纪出版集团<br>《历史哲学批判文集》康德（何兆武 译）商务印书馆<br>《人文科学导论》狄尔泰（赵稀方译）华夏出版社<br>《精神科学引论》狄尔泰（童奇志等译）中国城市出版社<br>《艺术哲学》丹纳（傅雷译）人民文学出版社<br>《巨人的时代》（大艺术家传）瓦萨里（刘耀春等译）湖北美术出版社<br>《意大利文艺复兴时期的文化》布克哈特（何新译）商务印书馆<br>《风格问题》（风格论）李格尔（刘景联等译）湖南科技出版社<br>《罗马晚期的工艺美术》李格尔（陈平译）湖南科技出版社<br>《论古代艺术》温克尔曼（邵大箴译）人民大学出版社<br>《造型艺术中的形式问题》阿道夫·希尔德布兰特（潘耀昌译）中国人民大学出版社<br>《西方美术批评史》文杜里（迟轲译）海南人民出版社<br>《艺术风格学》（艺术史原理）沃尔夫林（潘耀昌译）辽宁人民出版社<br>《古典艺术》沃尔夫林（潘耀昌、陈平译）浙江美院出版社<br>《视觉艺术的含义》帕诺夫斯基（傅志强译）辽宁人民出版社<br>《帕诺夫斯基与美术史基础》迈·霍丽（易英译）湖南美术出版社<br>《艺术》克莱夫·贝尔（周金环译）中国社科出版社<br>《视觉与设计》罗杰·弗莱（易英译）江苏教育出版社<br>《艺术史的哲学》豪塞尔（陈超南、刘天华译）中国社科出版社<br>《艺术与错觉》贡布里希（范景中译）浙江摄影出版社<br>《艺术与人文科学》贡布里希（范景中主编）浙江摄影出版社<br>《象征的图像》贡布里希（范景中译）上海书画出版社<br>《西方现代艺术美学文选》（造型艺术美学卷）佟景韩、易英编／春风文艺出版社<br>《艺术史终结了吗》（文集） 常宁生译 湖南美术出版社<br>《意图的模式》巴克森德尔（曹意强等译）中国美院出版社<br>《艺术的终结》丹托（欧阳英译）江苏人民出版社<br>《机器复制时代的艺术作品》本雅明（王才勇译）中国城市出版社<br>《20世纪艺术批评》沈语冰／中国美院出版社<br>《当代西方艺术哲学》朱狄／人民出版社<br>《艺术与精神分析》福勒（段炼译）四川美术出版社<br>《艺术史写作原理》卡里尔（吴啸雷等译）人民大学出版社<br>《传统与欲望》布列逊（丁宁译）河北美术出版社<br>《词语与图像》布列逊（王之光译）浙江摄影出版社<br>《世界美术》文选（四卷）易英／主编 河北美术出版社<br>《艺术与历史》曹意强／中国美院出版社<br>《艺术与文明》克拉克（易英／译）上海东方出版集团<br>《美术史的观念》邵宏／中国美院出版社<br>《西方美术史方法论文选》易英主编／中央美术学院美术研究杂志社<br>《艺术史的语言》萨林、伊万·卡斯克尔（王春辰、李笑男、杨扬／译）江苏美术出版社</p>
<h2 id="原文转自"><a href="#原文转自" class="headerlink" title="原文转自"></a>原文转自</h2><p>中央美院两位教授推荐的“书单”</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/27/reading_book_list1/" data-id="cj4zvsgcl00670gnh056t34a3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/书单/">书单</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_project_build" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/13/android_project_build/" class="article-date">
  <time datetime="2016-01-13T10:54:29.000Z" itemprop="datePublished">2016-01-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/android/">android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/13/android_project_build/">从零开始搭建架构实施Android项目</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>我们先假设一个场景需求：刚有孩子的爸爸妈妈对用照片、视频记录宝宝成长有强烈的意愿，但苦于目前没有一款专门的手机APP做这件事。A公司洞察到市场需求，要求开发团队尽快完成Android客户端的开发。以下模拟团队和工作开展。</p>
<ul>
<li>团队情况：产品经理1人，Android开发2人，服务端开发2人，UI设计1人。</li>
<li>开发周期：两个月。</li>
<li>工作量：大约50个界面。</li>
<li>隐含需求：考虑到用户群体有可能激增的情况，服务端需要有一定的并发能力。</li>
<li>前提：原型已设计完成。</li>
</ul>
<h2 id="1-服务端概要设计"><a href="#1-服务端概要设计" class="headerlink" title="1 服务端概要设计"></a>1 服务端概要设计</h2><p><strong> 1.1 系统架构</strong><br>先给出服务端的架构图。<br><img src="http://images2015.cnblogs.com/blog/316892/201601/316892-20160111201359960-1995072843.png" alt=""></p>
<p>由于服务端开发有Java、PHP背景，为了快速完成开发任务，我们选择PHP作为服务端开发语言，顺便也把数据库定为MySQL。考虑后期扩展和数据库访问性能，拟引入Redis非关系型数据库。同时为了提高数据读的性能，在云服务器和数据库之间用上缓存，并为数据库主从备份、读写分离。服务器就不搭建在本地了，管理是一大问题。现在云服务器一大把，七牛、阿里云、腾讯云、百度云、金山云等等，技术成熟，而且价格还算公道。在此我们选择阿里云。为了应对可能面临的并发问题，云服务器要考虑负载均衡。项目中可能存在大量的需要上传和下载照片和视频，我们选择阿里云的开放存储服务，同时为了提升各个地区的下载体验，我们引入CDN。客户端通过API Service和服务端交换数据，图片和视频的下载直接通过CDN。</p>
<p><strong> 1.2 模块划分</strong></p>
<p>根据需求和原型设计，可能的模块划分如下：</p>
<ul>
<li>注册登录模块</li>
<li>用户模块</li>
<li>小孩模块</li>
<li>媒体（图片+视频）模块</li>
<li>相册模块</li>
<li>……</li>
</ul>
<p><strong> 1.3 数据交换和API接口</strong></p>
<p>服务端与客户端使用JSON交换数据，使用自定义JSON格式，约定返回code、message，实体封装在result中，支持单个实体、实体列表、多个实体列表，定义如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;code&quot;:500,</div><div class="line">    &quot;message&quot;:&quot;系统异常，请稍后重试&quot;,</div><div class="line">    &quot;result&quot;:&quot;&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;code&quot;:200,</div><div class="line">    &quot;message&quot;:&quot;登录成功&quot;,</div><div class="line">    &quot;result&quot;:&#123;</div><div class="line">        &quot;user&quot;:&#123;</div><div class="line">            &quot;userId&quot;:1,</div><div class="line">            &quot;nickName&quot;:&quot;Leo&quot;,</div><div class="line">            &quot;email&quot;:&quot;Leo@xxx.com&quot;,</div><div class="line">            &quot;gender&quot;:0</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;code&quot;:200,</div><div class="line">    &quot;message&quot;:&quot;SUCCESS&quot;,</div><div class="line">    &quot;result&quot;:&#123;</div><div class="line">        &quot;album&quot;:&#123;</div><div class="line"> 　　        &quot;kid&quot;:&#123;</div><div class="line">                 &quot;kidId&quot;:1,</div><div class="line">                 &quot;nickName&quot;:&quot;LEE&quot;,</div><div class="line">                 &quot;gender&quot;:1,</div><div class="line">                 &quot;birthday&quot;:&quot;2014-3-6&quot;,</div><div class="line">                 ......</div><div class="line">        　　  &#125;,</div><div class="line">        　   &quot;media&quot;:&#123;</div><div class="line">                 &quot;mediaId&quot;:123,</div><div class="line">                 &quot;mediaType&quot;:1,</div><div class="line">                 &quot;createdTime&quot;:193743546746,</div><div class="line">                 &quot;mediaDescription&quot;:&quot;这是小孩第一次出去春游&quot;,</div><div class="line">                 ......</div><div class="line">       　　  &#125;</div><div class="line">　　     &#125;　</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>主要API接口设计如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">http://api.xxx.com/service/v1.0/user/login</div><div class="line">http://api.xxx.com/service/v1.0/user/third-login</div><div class="line">http://api.xxx.com/service/v1.0/user/register</div><div class="line">http://api.xxx.com/service/v1.0/user/logout</div><div class="line">http://api.xxx.com/service/v1.0/user/info/update</div><div class="line">http://api.xxx.com/service/v1.0/album/upload</div><div class="line">http://api.xxx.com/service/v1.0/album/update</div><div class="line">http://api.xxx.com/service/v1.0/album/delete</div><div class="line">......</div></pre></td></tr></table></figure>
<p>也许你看到了，API做了二级域名映射，同时为了服务端后期API版本的升级管理，在URL中加上了版本标识V1.0。命名方面我尽量做到restful的风格。对了，此处没有使用Https。为了解决数据传输的安全，我做了点特别的处理：对请求体和响应结果进行RSA加密（如果服务端返回的数据稍稍过大，这个RSA严重影响客户端解密，后来我换成了AES），所有请求为POST请求，所以API URL后面没有带参数，你也看不到任何请求相关的信息。</p>
<p><strong> 1.4 数据库设计</strong><br>根据需求和原型设计，数据库的设计大概需要两周时间。其实一周基本搞定了，但为了考虑充分，留出一周时间来检验和调整。数据库E-R图略。</p>
<h2 id="2-Android客户端"><a href="#2-Android客户端" class="headerlink" title="2 Android客户端"></a>2 Android客户端</h2><p><strong> 2.1 基本结构</strong><br>Android本身就是MVC，所以我不打算引入MVP或MVVM。我的理念是职责分层，快速推出Android 1.0。主要的包结构如下：<br><img src="http://images2015.cnblogs.com/blog/316892/201601/316892-20160111231126053-1862756669.png" alt=""><br>工程的搭建和包的划分有各种各样的，适合自己的就行了。想讨论或想看别人怎么做的，点击这里：<a href="http://mobile.51cto.com/abased-386212.htm" target="_blank" rel="external">App工程结构搭建：几种常见Android代码架构分析</a></p>
<p><strong> 2.2 功能划分</strong><br>注册登录，个人信息，我的小孩，相册管理，消息通知，系统设置等等。</p>
<p><strong> 2.3 引入的第三方技术</strong><br>重复发明轮子是不可取的。有些模块根本没必要自己写。以下是引入的第三方库，以及优势说明。</p>
<p>2.3.1 网络请求库android-async-http</p>
<ul>
<li>在匿名回调中处理请求结果</li>
<li>在UI线程外进行http请求</li>
<li>文件断点上传</li>
<li>智能重试</li>
<li>默认gzip压缩</li>
<li>支持解析成Json格式</li>
<li>可将Cookies持久化到SharedPreferences</li>
</ul>
<p>2.3.2 云巴推送</p>
<ul>
<li>专注于为需要实时数据交换的产品提供完美解决方案</li>
<li>基于发布者/订阅者(publisher/subscriber)模式，集成简单</li>
<li>对比了百度云推送、腾讯信鸽推送，云巴效果更好</li>
<li>原极光推送CTO创办的</li>
</ul>
<p>2.3.3 xUtils（只使用其中的DbUtils和ViewUtils）</p>
<ul>
<li>Android中的ORM框架，一行代码就可以进行增删改查</li>
<li>支持事务，默认关闭</li>
<li>可通过注解自定义表名、列名、外键、唯一性约束、NOT NULL约束、CHECK约束等（需要混淆的时候请注解表名和列名）</li>
<li>Android中的IOC框架，完全注解方式就可以进行UI，资源和事件绑定</li>
<li>新的事件绑定方式，使用混淆工具混淆后仍可正常工作</li>
</ul>
<p>2.3.4 友盟统计</p>
<ul>
<li>国内专业的移动应用统计分析平台</li>
<li>统计和分析流量来源、内容使用、用户属性和行为数据</li>
<li>Crash log跟踪</li>
</ul>
<p>2.3.5 云通讯验证码</p>
<ul>
<li>解决方案成熟，众多公司使用</li>
</ul>
<p>2.3.6 高德地图定位</p>
<ul>
<li>GPS+基站+wifi的混合定位方式</li>
<li>接入简单</li>
</ul>
<p>2.3.7 异步图片加载库Android-Universal-Image-Loader</p>
<ul>
<li>多线程下载图片，图片可以来源于网络，文件系统，项目文件夹assets中以及drawable中等</li>
<li>支持随意的配置ImageLoader，例如线程池，图片下载器，内存缓存策略，硬盘缓存策略，图片显示选项以及其他的一些配置</li>
<li>支持图片的内存缓存，文件系统缓存或者SD卡缓存</li>
<li>支持图片下载过程的监听</li>
<li>根据控件(ImageView)的大小对Bitmap进行裁剪，减少Bitmap占用过多的内存</li>
<li>较好的控制图片的加载过程，例如暂停图片加载，重新开始加载图片，一般使用在ListView,GridView中，滑动过程中暂停加载图片，停止滑动的时候去加载图片</li>
<li>提供在较慢的网络下对图片进行加载</li>
</ul>
<p>2.3.8 阿里云OSS Android客户端SDK</p>
<ul>
<li>提供文件（图片、视频等等）上传</li>
<li>大文件分块上传</li>
<li>删除操作（不推荐在客户端使用）</li>
</ul>
<p>2.3.9 组件内通讯EventBus</p>
<ul>
<li>基于发布者/订阅者(publisher/subscriber)模式</li>
<li>简化了应用程序内各组件间、组件与后台线程间的通信</li>
</ul>
<p>2.3.10 Android本地数据库加密库SQLCipher</p>
<ul>
<li>基于SQLite扩展的开源数据库，在SQLite的基础之上增加了数据加密功能</li>
<li>SQLCipher对Android SDK中所有与数据库相关的API都制作了一份镜像，使得开发者可以像操作普遍的数据库文件一样来操作SQLCipher</li>
</ul>
<p><strong> 2.4 基础组件封装</strong><br>2.4.1 基础回调接口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public interface DataCallback &#123;</div><div class="line">    </div><div class="line">    void onSuccess(Object result);</div><div class="line">    </div><div class="line">    void onFailure(Object result);</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>2.4.2 网络访问</p>
<p>先看一下登录的序列图：<br><img src="http://images2015.cnblogs.com/blog/316892/201601/316892-20160111225510741-595470259.png" alt=""><br>HttpManager类负责调用AsyncHttpWrapper中的post方法，和对服务端返回的数据解密、JSON转对象、回调上层；AsyncHttpWrapper则负责请求体的封装加密和其它的校验参数封装。看一下HttpManager类的post方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">public void post(Context context, String url, RequestParams params, final String modelName,</div><div class="line">                     final DataCallback callback) &#123;</div><div class="line">        AsyncHttpWrapper.post(context, url, params, new AsyncHttpResponseHandler() &#123;</div><div class="line">            @Override</div><div class="line">            public void onSuccess(int statusCode, Header[] headers, byte[] responseBody) &#123;</div><div class="line">                try &#123;</div><div class="line">                    if (modelName != null) &#123;</div><div class="line">                        handleResponse(responseBody, callback, modelName);</div><div class="line">                    &#125; else &#123;</div><div class="line">                        String response = new String(responseBody);</div><div class="line">                        // 解密</div><div class="line">                        response = AES128.getInstance().decrypt(AppUtil.decodeReplace(response));</div><div class="line">                        </div><div class="line">                        // JSON转对象</div><div class="line">                        BaseMessage message = AppUtil.getMessage(response);</div><div class="line">                        if (callback != null) &#123;</div><div class="line">                            // 如果自定义code是200</div><div class="line">                            if (Coder.CODE_200.equals(message.getCode())) &#123;</div><div class="line">                                callback.onSuccess(message.getMessage());</div><div class="line">                            &#125; else &#123;</div><div class="line">                                callback.onFailure(new ServerError(message.getCode()));</div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125; catch (JSONException e) &#123;</div><div class="line">                    LogUtil.e(e);</div><div class="line">                    callback.onFailure(&quot;服务端返回的数据不能解析成JSON&quot;);</div><div class="line">                &#125; catch (Exception e) &#123;</div><div class="line">                    LogUtil.e(e);</div><div class="line">                    callback.onFailure(e);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            @Override</div><div class="line">            public void onFailure(int statusCode, Header[] headers, byte[] responseBody, Throwable error) &#123;</div><div class="line">                if (callback != null) &#123;</div><div class="line">                    callback.onFailure(error);</div><div class="line">                    if (responseBody != null) &#123;</div><div class="line">                        String s = new String(responseBody);</div><div class="line">                        LogUtil.e(s);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>AsyncHttpWrapper中的post方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public static void post(Context context, String url, RequestParams params, AsyncHttpResponseHandler responseHandler) &#123;</div><div class="line">        // 设置请求头部信息</div><div class="line">        generateHeader(context);</div><div class="line">        </div><div class="line">        // 加密请求参数</div><div class="line">        String encryParams = AES128.getInstance().encrypt(params.toString());</div><div class="line">        </div><div class="line">        RequestParams requestParams = new RequestParams();</div><div class="line">        requestParams.put(&quot;param&quot;, AppUtil.encodeReplace(encryParams));</div><div class="line">        </div><div class="line">        client.post(context, url, requestParams, responseHandler);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">private static AsyncHttpClient client = new AsyncHttpClient();</div></pre></td></tr></table></figure>
<p>2.4.3 Adapter封装<br>为了加快开发速度，重用代码，Adapter的使用有技巧。每次在getView中查找控件id、利用ViewHolder、赋值，最后返回convertView，看着都是差不多的代码。是时候脱离这个苦海了。先看怎么解决共用的ViewHolder问题。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public static &lt;T extends View&gt; T get(View view, int id) &#123;</div><div class="line">        SparseArrayCompat&lt;View&gt; viewHolder = (SparseArrayCompat&lt;View&gt;) view.getTag();</div><div class="line">        if (viewHolder == null) &#123;</div><div class="line">            viewHolder = new SparseArrayCompat&lt;&gt;();</div><div class="line">            view.setTag(viewHolder);</div><div class="line">        &#125;</div><div class="line">        View childView = viewHolder.get(id);</div><div class="line">        if (childView == null) &#123;</div><div class="line">            childView = view.findViewById(id);</div><div class="line">            viewHolder.put(id, childView);</div><div class="line">        &#125;</div><div class="line">        return (T) childView;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>ViewHolder的作用，就是通过convertView.setTag与convertView进行绑定。当convertView复用时，直接从与之对应的ViewHolder(getTag)中拿到convertView布局中的控件，省去了findViewById的时间。上面的代码就是这样的原理。</p>
<p>然后就是CommonAdapter了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">public abstract class CommonAdapter&lt;T&gt; extends BaseAdapter &#123;</div><div class="line">    </div><div class="line">    protected LayoutInflater inflater;</div><div class="line">    protected Context context;</div><div class="line">    protected List&lt;T&gt; datas;</div><div class="line">    protected final int itemLayoutId;</div><div class="line">    </div><div class="line">    public CommonAdapter(Context context, List&lt;T&gt; datas, int itemLayoutId) &#123;</div><div class="line">        this.context = context;</div><div class="line">        this.inflater = LayoutInflater.from(context);</div><div class="line">        this.datas = datas;</div><div class="line">        this.itemLayoutId = itemLayoutId;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    @Override</div><div class="line">    public int getCount() &#123;</div><div class="line">        return datas != null ? datas.size() : 0;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    @Override</div><div class="line">    public T getItem(int position) &#123;</div><div class="line">        return datas.get(position);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    @Override</div><div class="line">    public long getItemId(int position) &#123;</div><div class="line">        return position;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    @Override</div><div class="line">    public View getView(int position, View convertView, ViewGroup parent) &#123;</div><div class="line">        final CommonViewHolder viewHolder = getViewHolder(position, convertView, parent);</div><div class="line">        convert(viewHolder, getItem(position), position);</div><div class="line">        return viewHolder.getConvertView();</div><div class="line">        </div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public abstract void convert(CommonViewHolder viewHolder, T item, int position);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>好了，不贴代码了。看不明白了请点击这里：Android 快速开发系列 打造万能的ListView GridView 适配器<br>2.4.5 其它Utils封装<br>如AES128加密类、BitmapUtils、SecurePreferences、StringUtil、ToastUtil、IOUtil等等。</p>
<p><strong> 2.5 接口测试</strong><br>为了保证数据交换、加解密正常，首先对某一个接口进行测试，以验证API Service能正常跑通。比如可以先对登录进行模拟测试，看是否成功，同时包括异常的测试，服务端是不是处理了边界异常，返回给客户端的都是封装过的异常信息，而不是抛一个敏感信息给客户端。提前进行接口测试有助于我们的基础组件运行没问题，方便后期其它模块的快速集成。</p>
<p><strong> 2.6 快速开发</strong><br>基础组件封装好后，除了少量的从网络获取数据逻辑和本地数据库的增删改查，客户端基本上就是界面的布局工作了。界面开发基本看熟练程度和自定义View的重用。</p>
<p>好了，基本就这些。两个Android开发人员两个月内完成肯定是可以的，前提是至少有一个熟手。为了便于后期维护开发，可以参考文章:<a href="http://aresxiong.com/2015/12/02/android_design_model_mvp/" target="_blank" rel="external">Android设计模式之MVP </a>。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="http://www.cnblogs.com/lao-liang/p/5122425.html?plg_nld=1&amp;plg_uin=1&amp;plg_auth=1&amp;plg_nld=1&amp;plg_usr=1&amp;plg_vkey=1&amp;plg_dev=1&amp;from=singlemessage&amp;isappinstalled=1" target="_blank" rel="external">从零开始搭建架构实施Android项目</a></li>
<li><a href="http://aresxiong.com/2015/12/02/android_design_model_mvp/" target="_blank" rel="external">Android设计模式之MVP</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/13/android_project_build/" data-id="cj4zvsgba003r0gnhiw1i7w52" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/project-build/">project_build</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_webview" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/13/android_webview/" class="article-date">
  <time datetime="2016-01-13T03:20:29.000Z" itemprop="datePublished">2016-01-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/android/">android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/13/android_webview/">android之WebView使用详解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在智能移动设备上打开浏览器浏览网页是移动用户很经常的操作。本文就来讲解Android中一个可以进行网页显示的控件WebView。同Chrome和Safari一样，WebView的网页渲染引擎也是Webkit。</p>
<p>使用WebView控件进行Android互联网程序开发又如下优势： </p>
<ul>
<li>1、可以打开远程网址、也可以加载本地Html数据。</li>
<li>2、可以搭建Java和Javascript交互桥梁。</li>
<li>3、WebView控件可以高度定制。</li>
</ul>
<p>下面我们通过几个例子来学习WebView的使用方法。</p>
<h2 id="WebView访问一个网站"><a href="#WebView访问一个网站" class="headerlink" title="WebView访问一个网站"></a>WebView访问一个网站</h2><p> 1、先来一个简单的例子，新建一个项目Lesson29_WebView。<br> 2、因为要访问互联网所以先在AndroidManifest.xml中设定权限：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;uses -permission=&quot;&quot; android:name=&quot;android.permission.INTERNET&quot;&gt;</div></pre></td></tr></table></figure></p>
<p>3、在res/layout/main.xml中放置一个输入框，一个按钮和一个WebView：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;  </div><div class="line">    &lt;linearlayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; </div><div class="line">    android:orientation=&quot;vertical&quot; </div><div class="line">    android:layout_width=&quot;fill_parent&quot; </div><div class="line">    android:layout_height=&quot;fill_parent&quot; </div><div class="line">    android:background=&quot;#fff&quot;&gt;  </div><div class="line">    &lt;/linearlayout&gt;  </div><div class="line"></div><div class="line">    &lt;linearlayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; </div><div class="line">    android:orientation=&quot;horizontal&quot; </div><div class="line">    android:layout_width=&quot;fill_parent&quot; </div><div class="line">    android:layout_height=&quot;wrap_content&quot;&gt;  </div><div class="line">        &lt;edittext </div><div class="line">            android:layout_width=&quot;fill_parent&quot; </div><div class="line">            android:layout_height=&quot;wrap_content&quot; </div><div class="line">            android:text=&quot;http://android.yaohuiji.com&quot; </div><div class="line">            android:id=&quot;@+id/EditText01&quot; </div><div class="line">            android:layout_weight=&quot;1&quot;&gt;  </div><div class="line">        &lt;/edittext&gt;  </div><div class="line">        &lt;button </div><div class="line">            android:layout_width=&quot;wrap_content&quot; </div><div class="line">            android:layout_height=&quot;wrap_content&quot; </div><div class="line">            android:text=&quot;Go&quot; </div><div class="line">            android:id=&quot;@+id/Button01&quot; </div><div class="line">            android:layout_weight=&quot;0&quot;&gt;  </div><div class="line">        &lt;/button&gt;  </div><div class="line">    &lt;/linearlayout&gt;  </div><div class="line">      </div><div class="line">    &lt;Webview </div><div class="line">        android:layout_width=&quot;wrap_content&quot; </div><div class="line">        android:layout_height=&quot;wrap_content&quot; </div><div class="line">        android:background=&quot;#fff&quot; </div><div class="line">        android:id=&quot;@+id/WebView01&quot;&gt;  </div><div class="line">    &lt;/Webview&gt;</div></pre></td></tr></table></figure></p>
<p>4、在Activity文件的OnCreate方法中默认载入一个百度页面，点击按钮时载入预设的网址:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">//定义UI组件   </div><div class="line"> mWebView = (WebView) findViewById(R.id.WebView01);   </div><div class="line"> Button b1 = (Button) findViewById(R.id.Button01);   </div><div class="line"> final EditText et = (EditText) findViewById(R.id.EditText01);   </div><div class="line">  </div><div class="line"> //得到WebSetting对象，设置支持Javascript的参数   </div><div class="line"> mWebView.getSettings().setJavaScriptEnabled(true);   </div><div class="line"> //载入URL   </div><div class="line"> mWebView.loadUrl(&quot;http://www.baidu.com&quot;);   </div><div class="line"> //使页面获得焦点   </div><div class="line"> mWebView.requestFocus();   </div><div class="line">  </div><div class="line"> //给按钮绑定单击监听器   </div><div class="line"> b1.setOnClickListener(new View.OnClickListener() &#123;   </div><div class="line">  </div><div class="line">     @Override  </div><div class="line">     public void onClick(View v) &#123;   </div><div class="line">         //访问编辑框中的网址   </div><div class="line">         mWebView.loadUrl(et.getText().toString());   </div><div class="line">     &#125;   </div><div class="line"> &#125;);</div></pre></td></tr></table></figure></p>
<p>运行程序，在编辑框中输入一个网址，点击Go按钮，就可以看到该网页显示，不过没有经过任何缩放处理，在接下里的例子我们继续研究，如何做更多的控制。</p>
<h2 id="WebSettings基础知识"><a href="#WebSettings基础知识" class="headerlink" title="WebSettings基础知识"></a>WebSettings基础知识</h2><p>1、先看一下WebView的继承关系，可以看到它不是在android.widget包中，而是在android.webkit包中。<br><img src="http://www.jizhuomi.com/android/upload/android-guide-29-1.gif" alt=""><br> 2、WebSettings ：WebView组件有一个辅助类叫WebSettings，它管理WebView的设置状态。该对象可以通过WebView.getSettings()方法获得。下面举几个例子来说明WebSettings的用法：<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"> //得到WebSettings对象，设置支持Javascript的参数   </div><div class="line">mWebView.getSettings().setJavaScriptEnabled(true);   </div><div class="line">  </div><div class="line">//设置可以支持缩放   </div><div class="line">mWebView.getSettings().setSupportZoom(true);   </div><div class="line">  </div><div class="line">//设置默认缩放方式尺寸是far   </div><div class="line">mWebView.getSettings().setDefaultZoom(WebSettings.ZoomDensity.FAR);   </div><div class="line">  </div><div class="line">//设置出现缩放工具   </div><div class="line">mWebView.getSettings().setBuiltInZoomControls(true);</div></pre></td></tr></table></figure></p>
<h2 id="加载assets目录下的本地网页"><a href="#加载assets目录下的本地网页" class="headerlink" title="加载assets目录下的本地网页"></a>加载assets目录下的本地网页</h2><p>WebView调用assets目录下的本地网页和图片等资源非常方便，使用形如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wv.loadUrl(&quot;file:///android_asset/html/test1.html&quot;);</div></pre></td></tr></table></figure></p>
<p>在test1中点击链接也可以跳转到test2。<br><img src="http://www.jizhuomi.com/android/upload/android-guide-29-3.gif" alt=""></p>
<h2 id="使用LoadData方法加载内容"><a href="#使用LoadData方法加载内容" class="headerlink" title="使用LoadData方法加载内容"></a>使用LoadData方法加载内容</h2><p>可以在Java文件中或者XML文件中定义HTML的片段，也可以在assets目录中存放HTML文件，然后使用LoadData加载其中的内容，展示出来。下面我们使用第三部分的网页来演示一下如何使用LoadData方法，并且看看他们之间的区别。<br>1、新建项目Lesson29_WebView2<br>2、新建2个Html文件在assets/html下，内容略去，res/layout/main.xml的内容也略去了，相信对你来说已经不成问题。<br>3、MainWebView2.java 的内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">package android.basic.lesson29;   </div><div class="line">import java.io.IOException;   </div><div class="line">import java.io.InputStream;   </div><div class="line">import org.apache.http.util.ByteArrayBuffer;   </div><div class="line">import org.apache.http.util.EncodingUtils;   </div><div class="line">import android.app.Activity;   </div><div class="line">import android.os.Bundle;   </div><div class="line">import android.view.View;   </div><div class="line">import android.webkit.WebView;   </div><div class="line">import android.widget.Button;   </div><div class="line">  </div><div class="line">public class MainWebView2 extends Activity &#123;   </div><div class="line">    /** Called when the activity is first created. */  </div><div class="line">    @Override  </div><div class="line">    public void onCreate(Bundle savedInstanceState) &#123;   </div><div class="line">        super.onCreate(savedInstanceState);   </div><div class="line">        setContentView(R.layout.main);   </div><div class="line">  </div><div class="line">        //定义UI组件   </div><div class="line">        Button b1 = (Button) findViewById(R.id.Button01);   </div><div class="line">        Button b2 = (Button) findViewById(R.id.Button02);   </div><div class="line">  </div><div class="line">        final WebView wv = (WebView) findViewById(R.id.WebView01);   </div><div class="line">  </div><div class="line">        //定义并绑定按钮单击监听器   </div><div class="line">        b1.setOnClickListener(new View.OnClickListener() &#123;   </div><div class="line">            @Override  </div><div class="line">            public void onClick(View v) &#123;   </div><div class="line">                //加载URL assets目录下的内容可以用 &quot;file:///android_asset&quot; 前缀   </div><div class="line">                wv.loadUrl(&quot;file:///android_asset/html/test1.html&quot;);   </div><div class="line">            &#125;   </div><div class="line">        &#125;);   </div><div class="line">  </div><div class="line">        //定义并绑定按钮单击监听器   </div><div class="line">        b2.setOnClickListener(new View.OnClickListener() &#123;   </div><div class="line">            @Override  </div><div class="line">            public void onClick(View v) &#123;   </div><div class="line">                String data = &quot;&quot;;   </div><div class="line">                try &#123;   </div><div class="line">                    // 读取assets目录下的文件需要用到AssetManager对象的Open方法打开文件   </div><div class="line">                    InputStream is = getAssets().open(&quot;html/test2.html&quot;);   </div><div class="line">                    // loadData()方法需要的是一个字符串数据所以我们需要把文件转成字符串   </div><div class="line">                    ByteArrayBuffer baf = new ByteArrayBuffer(500);   </div><div class="line">                    int count = 0;   </div><div class="line">                    while ((count = is.read()) != -1) &#123;   </div><div class="line">                        baf.append(count);   </div><div class="line">                    &#125;   </div><div class="line">                    data = EncodingUtils.getString(baf.toByteArray(), &quot;utf-8&quot;);   </div><div class="line">                &#125; catch (IOException e) &#123;   </div><div class="line">                    e.printStackTrace();   </div><div class="line">                &#125;   </div><div class="line">                // 下面两种方法都可以加载成功   </div><div class="line">                wv.loadData(data, &quot;text/html&quot;, &quot;utf-8&quot;);   </div><div class="line">                // wv.loadDataWithBaseURL(&quot;&quot;, data, &quot;text/html&quot;, &quot;utf-8&quot;, &quot;&quot;);   </div><div class="line">            &#125;   </div><div class="line">        &#125;);   </div><div class="line">  </div><div class="line">    &#125;   </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>4、运行程序单击第二个按钮，效果如下：<br><img src="http://www.jizhuomi.com/android/upload/android-guide-29-4.gif" alt=""><br>对比上面的例子，我们可以看到两个明显的区别，其一，图片没加载出来，其二链接失效，点击后无法加载test1.html 。</p>
<h2 id="WebChromeClient和WebViewClient"><a href="#WebChromeClient和WebViewClient" class="headerlink" title="WebChromeClient和WebViewClient"></a>WebChromeClient和WebViewClient</h2><p>和WebView相关的辅助对象，除了WebSettings以外还有WebChromeClient和WebViewClient。<br>接下来的这个例子内容比较丰富，虽然注释比较清晰，但是您一次消化起来还是比较困难的，因此您需要的是一点点耐心，多看几遍，最重要的是自己至少敲代码敲一遍。</p>
<p>1、在上面的例子中继续增加内容，增加test3.html的内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;script type=&quot;text/JavaScript&quot;&gt;        </div><div class="line">     function alertFuction()&#123;    </div><div class="line">       var a=1;   </div><div class="line">       var b=2    </div><div class="line">       alert(a+b);         </div><div class="line">     &#125;     </div><div class="line">     function confirmFuction()&#123;     </div><div class="line">        confirm(&quot;你确定要删除吗?&quot;)     </div><div class="line">     &#125;     </div><div class="line">  </div><div class="line">     &lt;/script&gt;      </div><div class="line">  </div><div class="line">//对话框测试   </div><div class="line">&lt;input onclick=&quot;alertFuction()&quot; value=&quot;提醒对话框&quot; type=&quot;button&quot;&gt;  </div><div class="line">&lt;input onclick=&quot;confirmFuction()&quot; value=&quot;选择对话框&quot; type=&quot;button&quot;&gt;  </div><div class="line">  </div><div class="line">&lt;a href=&quot;test1.html&quot;&gt;上一页&lt;/a&gt;</div></pre></td></tr></table></figure></p>
<p>2、MainWebView3.java的内容，请注意注释内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div></pre></td><td class="code"><pre><div class="line">package android.basic.lesson29;   </div><div class="line">import java.io.FileOutputStream;   </div><div class="line">import android.app.Activity;   </div><div class="line">import android.app.AlertDialog;   </div><div class="line">import android.app.AlertDialog.Builder;   </div><div class="line">import android.content.DialogInterface;   </div><div class="line">import android.graphics.Bitmap;   </div><div class="line">import android.graphics.Canvas;   </div><div class="line">import android.graphics.Picture;   </div><div class="line">import android.os.Bundle;   </div><div class="line">import android.view.KeyEvent;   </div><div class="line">import android.view.View;   </div><div class="line">import android.webkit.JsPromptResult;   </div><div class="line">import android.webkit.JsResult;   </div><div class="line">import android.webkit.WebChromeClient;   </div><div class="line">import android.webkit.WebView;   </div><div class="line">import android.webkit.WebViewClient;   </div><div class="line">import android.widget.Button;   </div><div class="line">import android.widget.Toast;   </div><div class="line">  </div><div class="line">public class MainWebView3 extends Activity &#123;   </div><div class="line">  </div><div class="line">    /** Called when the activity is first created. */  </div><div class="line">    @Override  </div><div class="line">    public void onCreate(Bundle savedInstanceState) &#123;   </div><div class="line">        super.onCreate(savedInstanceState);   </div><div class="line">        setContentView(R.layout.main);   </div><div class="line">  </div><div class="line">        // 定义UI组件   </div><div class="line">        Button b1 = (Button) findViewById(R.id.Button01);   </div><div class="line">        Button b2 = (Button) findViewById(R.id.Button02);   </div><div class="line">        Button b3 = (Button) findViewById(R.id.Button03);   </div><div class="line">  </div><div class="line">        final WebView wv = (WebView) findViewById(R.id.WebView01);   </div><div class="line">  </div><div class="line">        // 覆盖默认后退按钮的作用，替换成WebView里的查看历史页面   </div><div class="line">        wv.setOnKeyListener(new View.OnKeyListener() &#123;   </div><div class="line">  </div><div class="line">            @Override  </div><div class="line">            public boolean onKey(View v, int keyCode, KeyEvent event) &#123;   </div><div class="line">                if (event.getAction() == KeyEvent.ACTION_DOWN) &#123;   </div><div class="line">                    if ((keyCode == KeyEvent.KEYCODE_BACK) &amp;&amp; wv.canGoBack()) &#123;   </div><div class="line">                        wv.goBack();   </div><div class="line">                        return true;   </div><div class="line">                    &#125;   </div><div class="line">                &#125;   </div><div class="line">                return false;   </div><div class="line">            &#125;   </div><div class="line">        &#125;);   </div><div class="line">  </div><div class="line">        // 设置支持Javascript   </div><div class="line">        wv.getSettings().setJavaScriptEnabled(true);   </div><div class="line">  </div><div class="line">        // 定义并绑定按钮单击监听器   </div><div class="line">        b1.setOnClickListener(new View.OnClickListener() &#123;   </div><div class="line">            @Override  </div><div class="line">            public void onClick(View v) &#123;   </div><div class="line">                // 加载URL assets目录下的内容可以用 &quot;file:///android_asset&quot; 前缀   </div><div class="line">                wv.loadUrl(&quot;file:///android_asset/html/test1.html&quot;);   </div><div class="line">            &#125;   </div><div class="line">        &#125;);   </div><div class="line">  </div><div class="line">        // 定义并绑定按钮单击监听器   </div><div class="line">        b2.setOnClickListener(new View.OnClickListener() &#123;   </div><div class="line">            @Override  </div><div class="line">            public void onClick(View v) &#123;   </div><div class="line">                // 加载URL assets目录下的内容可以用 &quot;file:///android_asset&quot; 前缀   </div><div class="line">                wv.loadUrl(&quot;file:///android_asset/html/test3.html&quot;);   </div><div class="line">            &#125;   </div><div class="line">        &#125;);   </div><div class="line">  </div><div class="line">        // 定义并绑定按钮单击监听器   </div><div class="line">        b3.setOnClickListener(new View.OnClickListener() &#123;   </div><div class="line">            @Override  </div><div class="line">            public void onClick(View v) &#123;   </div><div class="line">                Picture pic = wv.capturePicture();   </div><div class="line">                int width = pic.getWidth();   </div><div class="line">                int height = pic.getHeight();   </div><div class="line">                if (width &gt; 0 &amp;&amp; height &gt; 0) &#123;   </div><div class="line">                    Bitmap bmp = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888);   </div><div class="line">                    Canvas canvas = new Canvas(bmp);   </div><div class="line">                    pic.draw(canvas);   </div><div class="line">                    try &#123;   </div><div class="line">                        String fileName = &quot;sdcard/&quot; + System.currentTimeMillis() + &quot;.png&quot;;   </div><div class="line">                        FileOutputStream fos = new FileOutputStream(fileName);   </div><div class="line">  </div><div class="line">                        if (fos != null) &#123;   </div><div class="line">                            bmp.compress(Bitmap.CompressFormat.PNG, 90, fos);   </div><div class="line">                            fos.close();   </div><div class="line">                        &#125;   </div><div class="line">                        Toast.makeText(getApplicationContext(), &quot;截图成功，文件名是：&quot; + fileName, Toast.LENGTH_SHORT).show();   </div><div class="line">                    &#125; catch (Exception e) &#123;   </div><div class="line">                        e.printStackTrace();   </div><div class="line">                    &#125;   </div><div class="line">                &#125;   </div><div class="line">            &#125;   </div><div class="line">        &#125;);   </div><div class="line">  </div><div class="line">        // 创建WebViewClient对象   </div><div class="line">        WebViewClient wvc = new WebViewClient() &#123;   </div><div class="line">  </div><div class="line">            @Override  </div><div class="line">            public boolean shouldOverrideUrlLoading(WebView view, String url) &#123;   </div><div class="line">                Toast.makeText(getApplicationContext(), &quot;WebViewClient.shouldOverrideUrlLoading&quot;, Toast.LENGTH_SHORT)   </div><div class="line">                        .show();   </div><div class="line">                // 使用自己的WebView组件来响应Url加载事件，而不是使用默认浏览器器加载页面   </div><div class="line">                wv.loadUrl(url);   </div><div class="line">                // 记得消耗掉这个事件。给不知道的朋友再解释一下，Android中返回True的意思就是到此为止吧,事件就会不会冒泡传递了，我们称之为消耗掉   </div><div class="line">                return true;   </div><div class="line">            &#125;   </div><div class="line">  </div><div class="line">            @Override  </div><div class="line">            public void onPageStarted(WebView view, String url, Bitmap favicon) &#123;   </div><div class="line">                Toast.makeText(getApplicationContext(), &quot;WebViewClient.onPageStarted&quot;, Toast.LENGTH_SHORT).show();   </div><div class="line">                super.onPageStarted(view, url, favicon);   </div><div class="line">            &#125;   </div><div class="line">  </div><div class="line">            @Override  </div><div class="line">            public void onPageFinished(WebView view, String url) &#123;   </div><div class="line">                Toast.makeText(getApplicationContext(), &quot;WebViewClient.onPageFinished&quot;, Toast.LENGTH_SHORT).show();   </div><div class="line">                super.onPageFinished(view, url);   </div><div class="line">            &#125;   </div><div class="line">  </div><div class="line">            @Override  </div><div class="line">            public void onLoadResource(WebView view, String url) &#123;   </div><div class="line">                Toast.makeText(getApplicationContext(), &quot;WebViewClient.onLoadResource&quot;, Toast.LENGTH_SHORT).show();   </div><div class="line">                super.onLoadResource(view, url);   </div><div class="line">            &#125;   </div><div class="line">  </div><div class="line">        &#125;;   </div><div class="line">  </div><div class="line">        // 设置WebViewClient对象   </div><div class="line">        wv.setWebViewClient(wvc);   </div><div class="line">  </div><div class="line">        // 创建WebViewChromeClient   </div><div class="line">        WebChromeClient wvcc = new WebChromeClient() &#123;   </div><div class="line">  </div><div class="line">            // 处理Alert事件   </div><div class="line">            @Override  </div><div class="line">            public boolean onJsAlert(WebView view, String url, String message, final JsResult result) &#123;   </div><div class="line">                // 构建一个Builder来显示网页中的alert对话框   </div><div class="line">                Builder builder = new Builder(MainWebView3.this);   </div><div class="line">                builder.setTitle(&quot;计算1+2的值&quot;);   </div><div class="line">                builder.setMessage(message);   </div><div class="line">                builder.setPositiveButton(android.R.string.ok, new AlertDialog.OnClickListener() &#123;   </div><div class="line">                    @Override  </div><div class="line">                    public void onClick(DialogInterface dialog, int which) &#123;   </div><div class="line">                        result.confirm();   </div><div class="line">                    &#125;   </div><div class="line">                &#125;);   </div><div class="line">                builder.setCancelable(false);   </div><div class="line">                builder.create();   </div><div class="line">                builder.show();   </div><div class="line">                return true;   </div><div class="line">            &#125;   </div><div class="line">  </div><div class="line">            @Override  </div><div class="line">            public void onReceivedTitle(WebView view, String title) &#123;   </div><div class="line">                MainWebView3.this.setTitle(&quot;可以用onReceivedTitle()方法修改网页标题&quot;);   </div><div class="line">                super.onReceivedTitle(view, title);   </div><div class="line">            &#125;   </div><div class="line">  </div><div class="line">            // 处理Confirm事件   </div><div class="line">            @Override  </div><div class="line">            public boolean onJsConfirm(WebView view, String url, String message, final JsResult result) &#123;   </div><div class="line">                Builder builder = new Builder(MainWebView3.this);   </div><div class="line">                builder.setTitle(&quot;删除确认&quot;);   </div><div class="line">                builder.setMessage(message);   </div><div class="line">                builder.setPositiveButton(android.R.string.ok, new AlertDialog.OnClickListener() &#123;   </div><div class="line">  </div><div class="line">                    @Override  </div><div class="line">                    public void onClick(DialogInterface dialog, int which) &#123;   </div><div class="line">                        result.confirm();   </div><div class="line">                    &#125;   </div><div class="line">  </div><div class="line">                &#125;);   </div><div class="line">                builder.setNeutralButton(android.R.string.cancel, new AlertDialog.OnClickListener() &#123;   </div><div class="line">  </div><div class="line">                    @Override  </div><div class="line">                    public void onClick(DialogInterface dialog, int which) &#123;   </div><div class="line">                        result.cancel();   </div><div class="line">                    &#125;   </div><div class="line">  </div><div class="line">                &#125;);   </div><div class="line">                builder.setCancelable(false);   </div><div class="line">                builder.create();   </div><div class="line">                builder.show();   </div><div class="line">                return true;   </div><div class="line">            &#125;   </div><div class="line">  </div><div class="line">            // 处理提示事件   </div><div class="line">            @Override  </div><div class="line">            public boolean onJsPrompt(WebView view, String url, String message, String defaultValue,   </div><div class="line">                    JsPromptResult result) &#123;   </div><div class="line">                // 看看默认的效果   </div><div class="line">                return super.onJsPrompt(view, url, message, defaultValue, result);   </div><div class="line">            &#125;   </div><div class="line">        &#125;;   </div><div class="line">  </div><div class="line">        // 设置setWebChromeClient对象   </div><div class="line">        wv.setWebChromeClient(wvcc);   </div><div class="line">    &#125;   </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>3、运行程序，查看结果：<br><img src="http://www.jizhuomi.com/android/upload/android-guide-29-5.gif" alt=""><br>启动起来时的画面：<br><img src="http://www.jizhuomi.com/android/upload/android-guide-29-6.gif" alt=""><br>点击第一个按钮，我们可以看到WebViewClient对象中定义的方法的确被调用了。<br><img src="http://www.jizhuomi.com/android/upload/android-guide-29-7.gif" alt=""><br>点击第二个按钮，我们看到加载的网页中有两个按钮，我们知道默认情况下Android会直接忽略掉由javascript弄出来的alert等弹出信息，除非我们在WebChromeClient中覆盖onJsAlert()方法和onJsConfirm()方法，让我们分别点击它们看看效果。<br><img src="http://www.jizhuomi.com/android/upload/android-guide-29-8.gif" alt=""><br><img src="http://www.jizhuomi.com/android/upload/android-guide-29-9.gif" alt=""><br>接下来我们在页面中跳转几次后，使用后退按钮，查看我们是否屏蔽了Activity默认的行为，结果当然是屏蔽了，接下来我们把页面切换到这一个网页：<br><img src="http://www.jizhuomi.com/android/upload/android-guide-29-10.gif" alt=""><br>然后我们按下第三个保存图片的按钮，不出意外的话我们截取到了该页的完整图片，并把它保存到了sdcard中了。</p>
<h2 id="WebView出现的乱码问题"><a href="#WebView出现的乱码问题" class="headerlink" title="WebView出现的乱码问题"></a>WebView出现的乱码问题</h2><p>webview加载网页<html>源码乱码问题<br>一、webView.loadUrl()；<br>直接显示网页内容(单独显示网络图片)，一般不会出现乱码。</html></p>
<p>二、webView.loadData(data, “text/html”, “UTF-8”);<br>loadData主要被设计用来装载URI格式的数据，它不能通过网络来加载内容。网上流传的webview加载中文出现乱码，多数是使用此方法。使用过程中主要有两个问题：<br>(1)loadData不能加载图片内容，如果想加载图片内容或者获得更强大的Web支持建议使用更强大的loadDataWithBaseURL.<br>(2)许多实用loadData方法的朋友都遇到显示乱码的问题，那是因为编码器设置错误导致的。我们知道String类型的数据主要是unicode编码，而WebView一般为了节省资源使用的是UTF-8编码，所以我们在loadData的时候要告诉方法怎样转码。即要告诉它要将unicode编码的内容转成UTF-8编码的内容。有些朋友虽然在loadData的时候设置了编码方式，但是还是显示乱码，这是因为还需要为WebView的text编码指定编码方式。举例如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">WebView wv = (WebView)findViewById(R.id.webview) ;</div><div class="line">wv.getSettings().setDefaultTextEncodingName(“UTF -8”) ;</div><div class="line">wv.loadData(content, “text/html”, “UTF-8”) ;</div></pre></td></tr></table></figure></p>
<p>(3)网页说明编码格式<br>以上两种方法是网上给的比较好的方法，但是我都试了下都没有解决我的乱码问题。 原来我是用LoadData方法来解析html的，但是据说这是官方的一个BUG，不能用来解析中文。所以绕其道而行之，采用loadDataWithBaseURL的方法，其中codeingType设置为utf-8就OK了。3、loadDataWithBaseURL如果单纯显示文字的话可以写:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">webView.loadDataWithBaseURL(null, string, &quot;text/html&quot;, &quot;utf-8&quot;, null);</div></pre></td></tr></table></figure></p>
<p>如果要显示图片可以写:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">webView.loadDataWithBaseURL(baseUrl, string, &quot;text/html&quot;, &quot;utf-8&quot;, null);</div></pre></td></tr></table></figure></p>
<p>其中baseUrl为你存储照片的路径。</p>
<h2 id="自定义webview组件"><a href="#自定义webview组件" class="headerlink" title="自定义webview组件"></a>自定义webview组件</h2><pre><code>package com.xp.lvbh.others.widget.h5;
import android.annotation.SuppressLint;
import android.content.Context;
import android.graphics.Color;
import android.os.Build;
import android.util.AttributeSet;
import android.webkit.CookieManager;
import android.webkit.CookieSyncManager;
import android.webkit.WebSettings;
import android.webkit.WebView;
import com.xp.lvbh.system.LApplication;

/**
 * 自定义webview
 * @author ares
 */
@SuppressLint(&quot;SetJavaScriptEnabled&quot;)
public class MyWebView extends WebView {
    private Context context;

    public MyWebView(Context context) {
        super(context);
        this.context = context;
        init();
    }

    public MyWebView(Context context, AttributeSet attrs) {
        super(context, attrs);
        this.context = context;
        init();
    }

    // public MyWebView(Context context, AttributeSet attrs, int defStyle) {
    // super(context, attrs, defStyle);
    // this.context = context;
    // init();
    // }

    @SuppressLint({&quot;NewApi&quot;, &quot;JavascriptInterface&quot;})
    public void init() {
        WebSettings settings = this.getSettings();
        // 开启javascript设置
        settings.setJavaScriptEnabled(true);
        // 设置可以使用localStorage
        settings.setDomStorageEnabled(true);
        // 开启Application H5 Caches 功能
        settings.setAppCacheEnabled(true);
        // 编码格式
        settings.setDefaultTextEncodingName(&quot;utf-8&quot;);
        // 设置Application Caches 缓存目录
        settings.setAppCachePath(LApplication.H5_CACHE_PATH);
        // 默认使用缓存
        settings.setCacheMode(WebSettings.LOAD_DEFAULT);
        // 可以读取文件缓存(manifest生效)
        settings.setAllowFileAccess(true);
        // 滚动条风格，为0指滚动条不占用空间，直接覆盖在网页上
        this.setScrollBarStyle(SCROLLBARS_INSIDE_OVERLAY);
        // 加快HTML网页加载完成速度
        if (Build.VERSION.SDK_INT &gt;= 19) {
            settings.setLoadsImagesAutomatically(true);
        } else {
            settings.setLoadsImagesAutomatically(false);
        }
//      this.addJavascriptInterface(new Android(context), &quot;android&quot;);
        this.addJavascriptInterface(new Android(context), &quot;android&quot;);
        this.setBackgroundColor(Color.WHITE);
    }

    // WebView cookies清理
    public void clearCookies() {
        CookieSyncManager.createInstance(context);
        CookieSyncManager.getInstance().startSync();
        CookieManager.getInstance().removeSessionCookie();
    }

    // WebView cache清理
    public void clearCache() {
        this.clearCache(true);
        this.clearHistory();
    }

    // 判断WebView是否已经滚动到页面底端
    public boolean isScrollBottom() {
        // getScrollY()方法返回的是当前可见区域的顶端距整个页面顶端的距离,也就是当前内容滚动的距离.
        // getHeight()或者getBottom()方法都返回当前WebView 这个容器的高度
        // getContentHeight 返回的是整个html 的高度,但并不等同于当前整个页面的高度,因为WebView 有缩放功能,
        // 所以当前整个页面的高度实际上应该是原始html 的高度再乘上缩放比例
        return this.getContentHeight() * this.getScaleY() == (this.getHeight() + this.getScrollY());
    }
}
</code></pre><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="http://developer.android.com/intl/zh-cn/reference/android/webkit/WebView.html" target="_blank" rel="external">Developers–WebView</a></li>
<li><a href="http://www.jizhuomi.com/android/course/205.html" target="_blank" rel="external">WebView使用详解</a></li>
<li><a href="http://m.oschina.net/blog/363988" target="_blank" rel="external">Android WebView出现的乱码问题</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/13/android_webview/" data-id="cj4zvsgbq004u0gnh5qmjavv8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webview/">webview</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_bug_fix_solution2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/23/android_bug_fix_solution2/" class="article-date">
  <time datetime="2015-12-23T02:15:29.000Z" itemprop="datePublished">2015-12-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/android/">android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/23/android_bug_fix_solution2/">Custom Class Loading in Dalvik</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>The Dalvik VM provides facilities for developers to perform custom class loading. Instead of loading Dalvik executable (“dex”) files from the default location, an application can load them from alternative locations such as internal storage or over the network.</p>
<p>This technique is not for every application; In fact, most do just fine without it. However, there are situations where custom class loading can come in handy. Here are a couple of scenarios:</p>
<ul>
<li>Big apps can contain more than 64K method references, which is the maximum number of supported in a dex file. To get around this limitation, developers can partition part of the program into multiple secondary dex files, and load them at runtime.</li>
<li>Frameworks can be designed to make their execution logic extensible by dynamic code loading at runtime.</li>
</ul>
<p>We have created a sample app to demonstrate the partitioning of dex files and runtime class loading. (Note that for reasons discussed below, the app cannot be built with the ADT Eclipse plug-in. Instead, use the included Ant build script. See Readme.txt for detail.)</p>
<p>The app has a simple Activity that invokes a library component to display a Toast. The Activity and its resources are kept in the default dex, whereas the library code is stored in a secondary dex bundled in the APK. This requires a modified build process, which is shown below in detail.</p>
<p>Before the library method can be invoked, the app has to first explicitly load the secondary dex file. Let’s take a look at the relevant moving parts.</p>
<h2 id="Code-Organization"><a href="#Code-Organization" class="headerlink" title="Code Organization"></a>Code Organization</h2><p>The application consists of 3 classes.</p>
<ul>
<li>com.example.dex.MainActivity: UI component from which the library is invoked</li>
<li>com.example.dex.LibraryInterface: Interface definition for the library</li>
<li>com.example.dex.lib.LibraryProvider: Implementation of the library</li>
</ul>
<p>The library is packaged in a secondary dex, while the rest of the classes are included in the default (primary) dex file. The “Build process” section below illustrates how to accomplish this. Of course, the packaging decision is dependent on the particular scenario a developer is dealing with.<br>Class loading and method invocation</p>
<p>The secondary dex file, containing LibraryProvider, is stored as an application asset. First, it has to be copied to a storage location whose path can be supplied to the class loader. The sample app uses the app’s private internal storage area for this purpose. (Technically, external storage would also work, but one has to consider the security implications of keeping application binaries there.)</p>
<p>Below is a snippet from MainActivity where standard file I/O is used to accomplish the copying.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">// Before the secondary dex file can be processed by the DexClassLoader,</div><div class="line">// it has to be first copied from asset resource to a storage location.</div><div class="line">File dexInternalStoragePath = new File(getDir(&quot;dex&quot;, Context.MODE_PRIVATE),</div><div class="line">        SECONDARY_DEX_NAME);</div><div class="line">...</div><div class="line">BufferedInputStream bis = null;</div><div class="line">OutputStream dexWriter = null;</div><div class="line"></div><div class="line">static final int BUF_SIZE = 8 * 1024;</div><div class="line">try &#123;</div><div class="line">    bis = new BufferedInputStream(getAssets().open(SECONDARY_DEX_NAME));</div><div class="line">    dexWriter = new BufferedOutputStream(</div><div class="line">        new FileOutputStream(dexInternalStoragePath));</div><div class="line">    byte[] buf = new byte[BUF_SIZE];</div><div class="line">    int len;</div><div class="line">    while((len = bis.read(buf, 0, BUF_SIZE)) &gt; 0) &#123;</div><div class="line">        dexWriter.write(buf, 0, len);</div><div class="line">    &#125;</div><div class="line">    dexWriter.close();</div><div class="line">    bis.close();</div><div class="line">    </div><div class="line">&#125; catch (. . .) &#123;...&#125;</div></pre></td></tr></table></figure></p>
<p>Next, a <a href="http://developer.android.com/reference/dalvik/system/DexClassLoader.html" target="_blank" rel="external">DexClassLoader</a> is instantiated to load the library from the extracted secondary dex file. There are a couple of ways to invoke methods on classes loaded in this manner. In this sample, the class instance is cast to an interface through which the method is called directly.</p>
<p>Another approach is to invoke methods using the reflection API. The advantage of using reflection is that it doesn’t require the secondary dex file to implement any particular interfaces. However, one should be aware that reflection is verbose and slow.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">// Internal storage where the DexClassLoader writes the optimized dex file to</div><div class="line">final File optimizedDexOutputPath = getDir(&quot;outdex&quot;, Context.MODE_PRIVATE);</div><div class="line"></div><div class="line">DexClassLoader cl = new DexClassLoader(dexInternalStoragePath.getAbsolutePath(),</div><div class="line">                                       optimizedDexOutputPath.getAbsolutePath(),</div><div class="line">                                       null,</div><div class="line">                                       getClassLoader());</div><div class="line">Class libProviderClazz = null;</div><div class="line">try &#123;</div><div class="line">    // Load the library.</div><div class="line">    libProviderClazz =</div><div class="line">        cl.loadClass(&quot;com.example.dex.lib.LibraryProvider&quot;);</div><div class="line">    // Cast the return object to the library interface so that the</div><div class="line">    // caller can directly invoke methods in the interface.</div><div class="line">    // Alternatively, the caller can invoke methods through reflection,</div><div class="line">    // which is more verbose. </div><div class="line">    LibraryInterface lib = (LibraryInterface) libProviderClazz.newInstance();</div><div class="line">    lib.showAwesomeToast(this, &quot;hello&quot;);</div><div class="line">&#125; catch (Exception e) &#123; ... &#125;</div></pre></td></tr></table></figure></p>
<h2 id="Build-Process"><a href="#Build-Process" class="headerlink" title="Build Process"></a>Build Process</h2><p>In order to churn out two separate dex files, we need to tweak the standard build process. To do the trick, we simply modify the “-dex” target in the project’s Ant <a href="http://code.google.com/p/android-custom-class-loading-sample/source/browse/trunk/android-custom-class-loading-sample/build.xml" target="_blank" rel="external">build.xml</a>.</p>
<p>The modified “-dex” target performs the following operations:</p>
<p>1.Create two staging directories to store .class files to be converted to the default dex and the secondary dex.</p>
<p>2.Selectively copy .class files from PROJECT_ROOT/bin/classes to the two staging directories.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;!-- Primary dex to include everything but the concrete library</div><div class="line">           implementation. --&gt;</div><div class="line">      &lt;copy todir=&quot;$&#123;out.classes.absolute.dir&#125;.1&quot; &gt;</div><div class="line">          &lt;fileset dir=&quot;$&#123;out.classes.absolute.dir&#125;&quot; &gt;</div><div class="line">                  &lt;exclude name=&quot;com/example/dex/lib/**&quot; /&gt;</div><div class="line">          &lt;/fileset&gt;</div><div class="line">      &lt;/copy&gt;</div><div class="line">      &lt;!-- Secondary dex to include the concrete library implementation. --&gt;</div><div class="line">      &lt;copy todir=&quot;$&#123;out.classes.absolute.dir&#125;.2&quot; &gt;</div><div class="line">          &lt;fileset dir=&quot;$&#123;out.classes.absolute.dir&#125;&quot; &gt;</div><div class="line">                  &lt;include name=&quot;com/example/dex/lib/**&quot; /&gt;</div><div class="line">          &lt;/fileset&gt;</div><div class="line">      &lt;/copy&gt;</div></pre></td></tr></table></figure></p>
<p>3.Convert .class files from the two staging directories into two separate dex files.</p>
<p>4.Add the secondary dex file to a jar file, which is the expected input format for the DexClassLoader. Lastly, store the jar file in the “assets” directory of the project.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;!-- Package the output in the assets directory of the apk. --&gt;</div><div class="line">        &lt;jar destfile=&quot;$&#123;asset.absolute.dir&#125;/secondary_dex.jar&quot;</div><div class="line">               basedir=&quot;$&#123;out.absolute.dir&#125;/secondary_dex_dir&quot;</div><div class="line">               includes=&quot;classes.dex&quot; /&gt;</div></pre></td></tr></table></figure>
<p>To kick-off the build, you execute ant debug (or release) from the project root directory.</p>
<p>That’s it! In the right situations, dynamic class loading can be quite useful.</p>
<h2 id="Link"><a href="#Link" class="headerlink" title="Link"></a>Link</h2><ul>
<li><a href="http://android-developers.blogspot.jp/2011/07/custom-class-loading-in-dalvik.html" target="_blank" rel="external">Custom Class Loading in Dalvik</a></li>
<li><a href="https://www.facebook.com/notes/facebook-engineering/under-the-hood-dalvik-patch-for-facebook-for-android/10151345597798920" target="_blank" rel="external">Under the Hood: Dalvik patch for Facebook for Android</a></li>
<li><a href="http://developer.android.com/intl/zh-cn/tools/building/multidex.html" target="_blank" rel="external">Building Apps with Over 65K Methods</a></li>
<li><a href="https://github.com/XIONGDEYI/android-custom-class-loading-sample" target="_blank" rel="external">DEMO in GitHub</a></li>
<li><a href="http://aresxiong.com/2015/12/07/android_bug_fix_solution/" target="_blank" rel="external">安卓应用的热补丁动态修复技术</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/12/23/android_bug_fix_solution2/" data-id="cj4zvsg9d001n0gnhu9pqcnt2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bugfix/">bugfix</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_intent" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/22/android_intent/" class="article-date">
  <time datetime="2015-12-22T02:29:29.000Z" itemprop="datePublished">2015-12-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/android/">android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/22/android_intent/">关于Intent的七大属性</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>原谅我愚昧，Intent七大属性这个概念我也是昨天才接触到，看了一下，都是一些常用的东西，就是没有总结过，那么今天就来简单总结一下。</p>
<p>Intent七大属性是指Intent的ComponentName、Action、Category、Data、Type、Extra以及Flag，七个属性，总体上可以分为3类：</p>
<ul>
<li>第一类：启动，有ComponentName（显式）,Action（隐式），Category（隐式）。</li>
<li>第二类：传值，有Data（隐式），Type（隐式），Extra（隐式、显式）。</li>
<li>第三类：启动模式，有Flag。</li>
</ul>
<p>下面我们逐一来说。</p>
<h2 id="ComponentName"><a href="#ComponentName" class="headerlink" title="ComponentName"></a>ComponentName</h2><p>Component本身有组件的意思，我们通过设置Component可以启动其他的Activity或者其他应用中的Activity，来看一个简单的实例：</p>
<p>启动同一个App中另外一个Activity：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">intent =  new Intent(); </div><div class="line">intent.setComponent( new ComponentName( this , SecondActivity. class )); </div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure></p>
<p>这中启动方式等同于以下两种启动方式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//第一种</div><div class="line">intent =  new Intent( this ,SecondActivity. class ); </div><div class="line">startActivity(intent); </div><div class="line"></div><div class="line">//第二种</div><div class="line">intent =  new Intent(); </div><div class="line">intent.setClass( this , SecondActivity. class ); </div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure></p>
<p>当然，通过设置ComponentName属性我们也可以启动其他App中的Activity，关于这一块的内容大家可以参考关于ComponentName的使用。下面我们看看隐式启动。</p>
<h2 id="Action和Category"><a href="#Action和Category" class="headerlink" title="Action和Category"></a>Action和Category</h2><p>因为在实际开发中，Action大多时候都是和Category一起使用的，所以这里我们将这两个放在一起来讲解。Intent中的Action我们在使用广播的时候用的比较多，在Activity中，我们可以通过设置Action来隐式的启动一个Activity，比如我们有一个ThirdActivity，我们在清单文件中做如下配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt; activity </div><div class="line">  android:name = &quot;.ThirdActivity&quot; </div><div class="line">  android:label = &quot;@string/title_activity_third&quot; &gt; </div><div class="line">  &lt; intent-filter &gt; </div><div class="line">  &lt; category android:name = &quot;android.intent.category.DEFAULT&quot; /&gt; </div><div class="line">  &lt; action android:name = &quot;com.qf.ThirdActivity&quot; /&gt; </div><div class="line">  &lt;/ intent-filter &gt; </div><div class="line">&lt;/ activity &gt;</div></pre></td></tr></table></figure></p>
<p>当我们在清单文件中做了这样的配置之后，我们的ThirdActivity会就会响应这个动作，怎么那么怎么响应呢？看下面：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">intent =  new Intent(); </div><div class="line">intent.setAction( &quot;com.qf.ThirdActivity&quot; ); </div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure></p>
<p>当然，我们也可以写的更简单一些，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">intent =  new Intent( &quot;com.qf.ThirdActivity&quot; ); </div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure></p>
<p>通过这中方式我们也可以启动一个Activity，那么大家可能也注意到了，我们的清单文件中有一个category的节点，那么没有这个节点可以吗？不可以！！当我们使用这种隐式启动的方式来启动一个Activity的时候，必须要action和category都匹配上了，该Activity才会成功启动。如果我们没有定义category，那么可以暂时先使用系统默认的category，总之，category不能没有。这个时候我们可能会有疑问了，如果我有多个Activity都配置了相同的action，那么会启动哪个？看看下面这个熟悉的图片：<br><img src="http://img.blog.csdn.net/20151204193813007?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
<p>当我们有多个Activity配置了相同的action的时候，那么系统会弹出来一个选择框，让我们自己选择要启动那个Activity。</p>
<p>action我们只能添加一个，但是category却可以添加多个（至少有一个，没有就要设置为DEFAULT），如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt; activity </div><div class="line">  android:name = &quot;.ThirdActivity&quot; </div><div class="line">  android:label = &quot;@string/title_activity_third&quot; &gt; </div><div class="line">  &lt; intent-filter &gt; </div><div class="line">  &lt; category android:name = &quot;android.intent.category.DEFAULT&quot; /&gt; </div><div class="line">  &lt; category android:name = &quot;mycategory&quot; /&gt; </div><div class="line">  &lt; action android:name = &quot;com.qf.ThirdActivity&quot; /&gt; </div><div class="line">  &lt;/ intent-filter &gt; </div><div class="line">&lt;/ activity &gt;</div></pre></td></tr></table></figure></p>
<p>相应的我们的启动方式也可以修改，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">intent =  new Intent( &quot;com.qf.ThirdActivity&quot; ); </div><div class="line">intent.addCategory( &quot;mycategory&quot; ); </div><div class="line"></div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure></p>
<h2 id="Data"><a href="#Data" class="headerlink" title="Data"></a>Data</h2><p>通过设置data，我们可以执行打电话，发短信，开发网页等等操作。究竟做哪种操作，要看我们的数据格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// 打开网页 </div><div class="line">intent =  new Intent(Intent.ACTION_VIEW); </div><div class="line">intent.setData(Uri.parse( &quot;http://www.baidu.com&quot; )); </div><div class="line">startActivity(intent); </div><div class="line">// 打电话 </div><div class="line">intent =  new Intent(Intent.ACTION_VIEW); </div><div class="line">intent.setData(Uri.parse( &quot;tel:18565554482&quot; )); </div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure>
<p>当我们的data是一个http协议的时候，系统会自动去查找可以打开http协议的Activity，这个时候如果手机安装了多个浏览器，那么系统会弹出多个浏览器供我们选择。这是我们通过设置Data来启动一个Activity，同时，我们也可以通过设置一个Data属性来将我们的Activity发布出去供别人调用，怎么发布呢？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt; activity </div><div class="line">  android:name = &quot;.HttpActivity&quot; </div><div class="line">  android:label = &quot;@string/title_activity_http&quot; &gt; </div><div class="line">  &lt; intent-filter &gt; </div><div class="line">  &lt; action android:name = &quot;android.intent.action.VIEW&quot; /&gt; </div><div class="line">  &lt; category android:name = &quot;android.intent.category.DEFAULT&quot; /&gt; </div><div class="line">  &lt; data </div><div class="line">  android:scheme = &quot;http&quot; /&gt; </div><div class="line">  &lt;/ intent-filter &gt; </div><div class="line">&lt;/ activity &gt;</div></pre></td></tr></table></figure></p>
<p>在data节点中我们设置我们这个Activity可以打开的协议，我们这里设置为http协议，那么以后要打开一个http请求的时候，系统都会让我们选择是否用这个Activity打开。当然，我们也可以自己定义一个协议（自己定义的协议，由于别人不知道，所以只能由我们自己的程序打开）。比如下面这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt; activity </div><div class="line">  android:name = &quot;.HttpActivity&quot; </div><div class="line">  android:label = &quot;@string/title_activity_http&quot; &gt; </div><div class="line">  &lt; intent-filter &gt; </div><div class="line">  &lt; action android:name = &quot;android.intent.action.VIEW&quot; /&gt; </div><div class="line">  &lt; category android:name = &quot;android.intent.category.DEFAULT&quot; /&gt; </div><div class="line">  &lt; data </div><div class="line">  android:scheme = &quot;myhttp&quot; /&gt; </div><div class="line">  &lt;/ intent-filter &gt; </div><div class="line">&lt;/ activity &gt;</div></pre></td></tr></table></figure></p>
<p>那么我们怎么打开自己的Activity呢？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">intent =  new Intent(); </div><div class="line">intent.setData(Uri.parse( &quot;myhttp://www.baidu.com&quot; )); </div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure></p>
<p>这个例子没有什么实际意义，我只是举一个自定义协议的栗子。</p>
<p>其实，说到这里，大家应该明白了为什么我们说data是隐式传值，比如我们打开一个网页，http协议后面跟的就是网页地址，我们不用再单独指定要打开哪个网页。</p>
<h2 id="Type"><a href="#Type" class="headerlink" title="Type"></a>Type</h2><p>type的存在，主要是为了对data的类型做进一步的说明，但是一般情况下，只有data属性为null的时候，type属性才有效，如果data属性不为null，系统会自动根据data中的协议来分析data的数据类型，而不会去管type，我们先来看看下面一段源码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">/** </div><div class="line">* Set the data this intent is operating on. This method automatically </div><div class="line">* clears any type that was previously set by &#123;@link #setType&#125; or </div><div class="line">* &#123;@link #setTypeAndNormalize&#125;. </div><div class="line">* </div><div class="line">* &lt;p&gt;&lt;em&gt;Note: scheme matching in the Android framework is </div><div class="line">* case-sensitive, unlike the formal RFC. As a result, </div><div class="line">* you should always write your Uri with a lower case scheme, </div><div class="line">* or use &#123;@link Uri#normalizeScheme&#125; or </div><div class="line">* &#123;@link #setDataAndNormalize&#125; </div><div class="line">* to ensure that the scheme is converted to lower case.&lt;/em&gt; </div><div class="line">* </div><div class="line">* @param data The Uri of the data this intent is now targeting. </div><div class="line">* </div><div class="line">* @return Returns the same Intent object, for chaining multiple calls </div><div class="line">* into a single statement. </div><div class="line">* </div><div class="line">* @see #getData </div><div class="line">* @see #setDataAndNormalize </div><div class="line">* @see android.net.Uri#normalizeScheme() </div><div class="line">*/ </div><div class="line">public Intent setData(Uri data) &#123; </div><div class="line">  mData = data; </div><div class="line">  mType =  null ; </div><div class="line">  return this ; </div><div class="line">&#125; </div><div class="line">/** </div><div class="line">* Set an explicit MIME data type. </div><div class="line">* </div><div class="line">* &lt;p&gt;This is used to create intents that only specify a type and not data, </div><div class="line">* for example to indicate the type of data to return. </div><div class="line">* </div><div class="line">* &lt;p&gt;This method automatically clears any data that was </div><div class="line">* previously set (for example by &#123;@link #setData&#125;). </div><div class="line">* </div><div class="line">* &lt;p&gt;&lt;em&gt;Note: MIME type matching in the Android framework is </div><div class="line">* case-sensitive, unlike formal RFC MIME types. As a result, </div><div class="line">* you should always write your MIME types with lower case letters, </div><div class="line">* or use &#123;@link #normalizeMimeType&#125; or &#123;@link #setTypeAndNormalize&#125; </div><div class="line">* to ensure that it is converted to lower case.&lt;/em&gt; </div><div class="line">* </div><div class="line">* @param type The MIME type of the data being handled by this intent. </div><div class="line">* </div><div class="line">* @return Returns the same Intent object, for chaining multiple calls </div><div class="line">* into a single statement. </div><div class="line">* </div><div class="line">* @see #getType </div><div class="line">* @see #setTypeAndNormalize </div><div class="line">* @see #setDataAndType </div><div class="line">* @see #normalizeMimeType </div><div class="line">*/ </div><div class="line">public Intent setType(String type) &#123; </div><div class="line">  mData =  null ; </div><div class="line">  mType = type; </div><div class="line">  return this ; </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当我们设置data的时候，系统会默认将type设置为null，当我们设置type的时候，系统会默认将data设置为null.也就是说，一般情况下，data和type我们只需要设置一个就行了，如果我们既想要设置data又想要设置type，那么可以使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">setDataAndType(Uri data, String type)</div></pre></td></tr></table></figure></p>
<p>这个方法来完成。下面我们来看看通过给Intent设置type来打开一个音乐播放器。代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">intent =  new Intent(); </div><div class="line">intent.setAction(Intent.ACTION_VIEW); </div><div class="line">Uri data = Uri.parse( &quot;file:///storage/emulated/0/xiami/audios/被动.mp3&quot; ); </div><div class="line">intent.setDataAndType(data,  &quot;audio/mp3&quot; ); </div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure></p>
<p>如果我们要打开的是视频文件，那么type就要设置为”video/<em>”，其中</em>表示支持所有的视频文件。</p>
<h2 id="Extra"><a href="#Extra" class="headerlink" title="Extra"></a>Extra</h2><p>Extra就比较好理解了，我们经常使用它来在Activity之间传递数据，Extra可以传递基本类型，String类型以及实现了Serializable或者Parcelable接口的类，具体用法不多说。</p>
<h2 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h2><p>通过设置Flag，我们可以设定一个Activity的启动模式，这个和launchMode基本上是一样的，所以我也不再细说，关于launchMode的使用参见<a href="http://blog.csdn.net/u012702547/article/details/49529825" target="_blank" rel="external">launchMode使用详解</a></p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="http://developer.android.com/reference/android/content/Intent.html" target="_blank" rel="external">Android Developers-Intent</a></li>
<li><a href="http://blog.csdn.net/u012702547/article/details/50178429" target="_blank" rel="external">关于Intent的七大属性</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/12/22/android_intent/" data-id="cj4zvsgas00300gnhve519nai" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/intent/">intent</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-android_material_design_snack" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/21/android_material_design_snack/" class="article-date">
  <time datetime="2015-12-21T06:54:29.000Z" itemprop="datePublished">2015-12-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/android/">android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/21/android_material_design_snack/">Snackbar使用详解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在谷歌提出 material design 之后，终于推出了 android.support.design 这个官方的material design库，这几天我也简单浏览了下这个库，基本上我们常用的组件都有了，从今天开始，就可以一步步替换掉<br>以前使用的github上的那些开源控件了，毕竟谷歌出品才属精品~~另外分析这个design库的源码我认为是非常有意义的，android上的app 在以前各家都有各家的风格，但是在谷歌出了material design这门新的<br>设计语言以及官方的库以后，相信越来越多的app 会逐步优化自己的ui 来符合官方的标准，学习这个design库的源码可以让我们以后改写自定义控件的时候更加柔韧有余。</p>
<p>首先，来看一下这个官方的介绍:<a href="http://www.google.com/design/spec/components/snackbars-toasts.html#" target="_blank" rel="external">SnackBars&amp;Toasts</a><br>这个文章系统的阐述了snackbar和toast的区别和正确使用snackbar的方式。</p>
<p>我简单归纳如下：</p>
<ul>
<li>1.比toast更加好，毕竟snackbar 可以响应点击事件。</li>
<li>2.snackbar 同一时间有且只有一个在显示。</li>
<li>3.snackbar 上不要有图标。</li>
<li>4.snackbar上action 只能有一个。</li>
<li>5.如果有悬浮按钮 floating action button的话，snackbar 在弹出的时候不要覆盖这个button。</li>
</ul>
<p>Snackbar 在一定程度上可以替代dialog的某些应用场景。比如以前网络不通的情况下登陆失败，会给一个dialog提示，现在就可以用snackbar 来做这个有action的提示，更加方便快捷。</p>
<h2 id="使用snackbar"><a href="#使用snackbar" class="headerlink" title="使用snackbar"></a>使用snackbar</h2><p>1.导入support design 库 (这一步在以后的design库的 控件文章里都会舍去)<br>首先找到你app的build gradle文件。然后增加一个compile语句即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">compile &apos;com.android.support:design:22.2.0&apos;</div></pre></td></tr></table></figure></p>
<p>2.编写xml文件以及java文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    android:paddingBottom=&quot;@dimen/activity_vertical_margin&quot;</div><div class="line">    android:paddingLeft=&quot;@dimen/activity_horizontal_margin&quot;</div><div class="line">    android:paddingRight=&quot;@dimen/activity_horizontal_margin&quot;</div><div class="line">    android:paddingTop=&quot;@dimen/activity_vertical_margin&quot;</div><div class="line">    tools:context=&quot;.MainActivity&quot;</div><div class="line">    android:id=&quot;@+id/layout&quot;&gt;</div><div class="line"></div><div class="line"></div><div class="line">    &lt;!-- 因为snackbar 需要有一个父控件所以 我们暂时就用snackbar 来做他的父控件--&gt;</div><div class="line">    &lt;TextView</div><div class="line">        android:id=&quot;@+id/snackbar&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;30dp&quot;</div><div class="line">        android:layout_centerVertical=&quot;true&quot;</div><div class="line">        android:gravity=&quot;center&quot;</div><div class="line">        android:text=&quot;Bottom layout&quot; /&gt;</div><div class="line"></div><div class="line">&lt;/RelativeLayout&gt;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">package com.example.burning.myapplication;</div><div class="line"></div><div class="line">import android.os.Bundle;</div><div class="line">import android.support.design.widget.Snackbar;</div><div class="line">import android.support.v7.app.ActionBarActivity;</div><div class="line">import android.view.Menu;</div><div class="line">import android.view.MenuItem;</div><div class="line">import android.view.View;</div><div class="line">import android.widget.TextView;</div><div class="line"></div><div class="line"></div><div class="line">public class MainActivity extends ActionBarActivity &#123;</div><div class="line"></div><div class="line">    private TextView tv;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        tv = (TextView) this.findViewById(R.id.tv);</div><div class="line">        tv.setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                //这个地方第一个参数　传进去的是tv　但是实际上你无论传进去什么值 snackbar都一定是从屏幕的最底端出现的　原因在源码</div><div class="line">                //分析那边可以看到</div><div class="line">                Snackbar.make(tv, &quot;connection error&quot;, Snackbar.LENGTH_LONG).setAction(&quot;retry&quot;, new View.OnClickListener() &#123;</div><div class="line">                    @Override</div><div class="line">                    public void onClick(View v) &#123;</div><div class="line">                        tv.setText(&quot;aleady click snackbar&quot;);</div><div class="line">                    &#125;</div><div class="line">                &#125;).show();</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean onCreateOptionsMenu(Menu menu) &#123;</div><div class="line">        // Inflate the menu; this adds items to the action bar if it is present.</div><div class="line">        getMenuInflater().inflate(R.menu.menu_main, menu);</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean onOptionsItemSelected(MenuItem item) &#123;</div><div class="line">        // Handle action bar item clicks here. The action bar will</div><div class="line">        // automatically handle clicks on the Home/Up button, so long</div><div class="line">        // as you specify a parent activity in AndroidManifest.xml.</div><div class="line">        int id = item.getItemId();</div><div class="line"></div><div class="line">        //noinspection SimplifiableIfStatement</div><div class="line">        if (id == R.id.action_settings) &#123;</div><div class="line">            return true;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        return super.onOptionsItemSelected(item);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>效果如下：<br><img src="http://images0.cnblogs.com/blog2015/365799/201507/201654085514852.gif" alt=""></p>
<h2 id="FAB遮挡问题"><a href="#FAB遮挡问题" class="headerlink" title="FAB遮挡问题"></a>FAB遮挡问题</h2><p>然后我们来看一下,如果和正常的FAB（悬浮按钮）在一起会有什么效果（注意这里的悬浮按钮我们也使用design库里的并不使用github上开源的）<br>先看一下xml文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</div><div class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    android:paddingBottom=&quot;@dimen/activity_vertical_margin&quot;</div><div class="line">    android:paddingLeft=&quot;@dimen/activity_horizontal_margin&quot;</div><div class="line">    android:paddingRight=&quot;@dimen/activity_horizontal_margin&quot;</div><div class="line">    android:paddingTop=&quot;@dimen/activity_vertical_margin&quot;</div><div class="line">    tools:context=&quot;.MainActivity&quot;&gt;</div><div class="line"></div><div class="line"></div><div class="line">    &lt;FrameLayout</div><div class="line">        android:id=&quot;@+id/layout&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;match_parent&quot;&gt;</div><div class="line"></div><div class="line">        &lt;android.support.design.widget.FloatingActionButton</div><div class="line">            android:id=&quot;@+id/btnFloatingAction&quot;</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:layout_gravity=&quot;bottom|right&quot;</div><div class="line">            android:src=&quot;@drawable/ic_plus&quot;</div><div class="line">            app:borderWidth=&quot;0dp&quot;</div><div class="line">            app:fabSize=&quot;normal&quot; /&gt;</div><div class="line">    &lt;/FrameLayout&gt;</div><div class="line">&lt;/RelativeLayout&gt;</div></pre></td></tr></table></figure></p>
<p>activity代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">package com.example.burning.myapplication;</div><div class="line"></div><div class="line">import android.os.Bundle;</div><div class="line">import android.support.design.widget.Snackbar;</div><div class="line">import android.support.v7.app.ActionBarActivity;</div><div class="line">import android.view.Menu;</div><div class="line">import android.view.MenuItem;</div><div class="line">import android.view.View;</div><div class="line">import android.view.ViewGroup;</div><div class="line"></div><div class="line"></div><div class="line">public class MainActivity extends ActionBarActivity &#123;</div><div class="line"></div><div class="line">    private ViewGroup layout;</div><div class="line"></div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        layout = (ViewGroup) this.findViewById(R.id.layout);</div><div class="line">        layout.setOnClickListener(new View.OnClickListener() &#123;</div><div class="line">            @Override</div><div class="line">            public void onClick(View v) &#123;</div><div class="line">                Snackbar.make(layout, &quot;connection error&quot;, Snackbar.LENGTH_LONG).setAction(&quot;retry&quot;, new View.OnClickListener() &#123;</div><div class="line">                    @Override</div><div class="line">                    public void onClick(View v) &#123;</div><div class="line">                    &#125;</div><div class="line">                &#125;).show();</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean onCreateOptionsMenu(Menu menu) &#123;</div><div class="line">        // Inflate the menu; this adds items to the action bar if it is present.</div><div class="line">        getMenuInflater().inflate(R.menu.menu_main, menu);</div><div class="line">        return true;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public boolean onOptionsItemSelected(MenuItem item) &#123;</div><div class="line">        // Handle action bar item clicks here. The action bar will</div><div class="line">        // automatically handle clicks on the Home/Up button, so long</div><div class="line">        // as you specify a parent activity in AndroidManifest.xml.</div><div class="line">        int id = item.getItemId();</div><div class="line"></div><div class="line">        //noinspection SimplifiableIfStatement</div><div class="line">        if (id == R.id.action_settings) &#123;</div><div class="line">            return true;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        return super.onOptionsItemSelected(item);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行效果:<br><img src="http://images0.cnblogs.com/blog2015/365799/201507/211017171765575.gif" alt=""><br>大家可以看到当我们的snackbar在弹出的时候,会覆盖到我们的FAB，那这体验是非常糟糕的，这里也给出一个完美的解决方案,其实也很简单用一下design库里的layout即可,java代码不需要改变,只要稍微改一下布局文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</div><div class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</div><div class="line">    android:layout_width=&quot;match_parent&quot;</div><div class="line">    android:layout_height=&quot;match_parent&quot;</div><div class="line">    android:paddingBottom=&quot;@dimen/activity_vertical_margin&quot;</div><div class="line">    android:paddingLeft=&quot;@dimen/activity_horizontal_margin&quot;</div><div class="line">    android:paddingRight=&quot;@dimen/activity_horizontal_margin&quot;</div><div class="line">    android:paddingTop=&quot;@dimen/activity_vertical_margin&quot;</div><div class="line">    tools:context=&quot;.MainActivity&quot;&gt;</div><div class="line"></div><div class="line"></div><div class="line">    &lt;android.support.design.widget.CoordinatorLayout</div><div class="line">        android:id=&quot;@+id/layout&quot;</div><div class="line">        android:layout_width=&quot;match_parent&quot;</div><div class="line">        android:layout_height=&quot;match_parent&quot;&gt;</div><div class="line"></div><div class="line">        &lt;android.support.design.widget.FloatingActionButton</div><div class="line">            android:id=&quot;@+id/btnFloatingAction&quot;</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:layout_gravity=&quot;bottom|right&quot;</div><div class="line">            android:src=&quot;@drawable/ic_plus&quot;</div><div class="line">            app:borderWidth=&quot;0dp&quot;</div><div class="line">            app:fabSize=&quot;normal&quot; /&gt;</div><div class="line">    &lt;/android.support.design.widget.CoordinatorLayout&gt;</div><div class="line">&lt;/RelativeLayout&gt;</div></pre></td></tr></table></figure></p>
<p>运行效果:<br><img src="http://images0.cnblogs.com/blog2015/365799/201507/211025445986455.gif" alt=""></p>
<p>改变这个snackbar的背景色:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Snackbar sb=Snackbar.make(layout, &quot;connection error&quot;, Snackbar.LENGTH_LONG).setAction(&quot;retry&quot;, new View.OnClickListener() &#123;</div><div class="line">                    @Override</div><div class="line">                    public void onClick(View v) &#123;</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">                //红色</div><div class="line">                sb.getView().setBackgroundColor(0xfff44336);</div><div class="line">                sb.show();</div></pre></td></tr></table></figure></p>
<h2 id="源码解析"><a href="#源码解析" class="headerlink" title="源码解析"></a>源码解析</h2><p>基本的用法要点就是这些，我们来看一下这个snackbar的源码，看看谷歌官方是如何编写 material design 风格控件的。<br>这里我无法贴上全部源码，因为太多，只挑重要的流程说 可以从make开始。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">//这个地方就是构造函数</div><div class="line">    Snackbar(ViewGroup parent) &#123;</div><div class="line">        this.mParent = parent;</div><div class="line">        this.mContext = parent.getContext();</div><div class="line">        LayoutInflater inflater = LayoutInflater.from(this.mContext);</div><div class="line">        this.mView = (Snackbar.SnackbarLayout)inflater.inflate(layout.layout_snackbar, this.mParent, false);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //这个地方就是我们调用的make函数 也就是整个类的一个入口 在这里可以看到 我们的代码转入了snackbar的构造函数</div><div class="line">    public static Snackbar make(View view, CharSequence text, int duration) &#123;</div><div class="line">        //注意看这个地方调用了 findsuitableparent这个函数</div><div class="line">        Snackbar snackbar = new Snackbar(findSuitableParent(view));</div><div class="line">        snackbar.setText(text);</div><div class="line">        snackbar.setDuration(duration);</div><div class="line">        return snackbar;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static Snackbar make(View view, int resId, int duration) &#123;</div><div class="line">        return make(view, view.getResources().getText(resId), duration);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //这个函数其实作用就是无论你传进去的是什么view 我最终都会遍历到framlayout为止，因为activity的最外层实际上就是一个framlayout</div><div class="line">    //所以你在调用make函数的时候无论传什么值进去 snackabr都会从最底部弹出来 就是因为这个函数做了这样的工作 但是！！！！</div><div class="line">　　　　//如果在遍历到最顶部的framlayout之前 遇到了一个framelayout 那么就会从这个framlayout的底部弹出，而不会从屏幕的最下方弹出了。</div><div class="line">    //这个地方CoordinatorLayout的优先级比framlayout还要高 所以你如果穿进去的view是CoordinatorLayout的话 这个snackbar 就一定会从</div><div class="line">    //CoordinatorLayout 底部弹出了。如果你CoordinatorLayout的最底部恰好在屏幕中间 那么snackbar 就会从屏幕中间弹出  而不会从底部弹出 这一点一定要注意</div><div class="line">    @Nullable</div><div class="line">    private static ViewGroup findSuitableParent(View view) &#123;</div><div class="line">        ViewGroup fallback = null;</div><div class="line"></div><div class="line">        do &#123;</div><div class="line">            if(view instanceof CoordinatorLayout) &#123;</div><div class="line">                return (ViewGroup)view;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            if(view instanceof FrameLayout) &#123;</div><div class="line">                if(view.getId() == 16908290) &#123;</div><div class="line">                    return (ViewGroup)view;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                fallback = (ViewGroup)view;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            if(view != null) &#123;</div><div class="line">                ViewParent parent = view.getParent();</div><div class="line">                view = parent instanceof View?(View)parent:null;</div><div class="line">            &#125;</div><div class="line">        &#125; while(view != null);</div><div class="line"></div><div class="line">        return fallback;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>大家可以看一下第六行。实际上这个mView就是一个内部类的对象。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">private final Snackbar.SnackbarLayout mView;</div></pre></td></tr></table></figure></p>
<p><img src="http://images0.cnblogs.com/blog2015/365799/201507/211102138161270.png" alt=""></p>
<p>然后接着看第六行的xml文件（到这里其实我们也能猜到了 真正自定义view的snackbar是由snackbar的内部类snackbarlayout来完成的）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;!--</div><div class="line">  ~ Copyright (C) 2015 The Android Open Source Project</div><div class="line">  ~</div><div class="line">  ~ Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</div><div class="line">  ~ you may not use this file except in compliance with the License.</div><div class="line">  ~ You may obtain a copy of the License at</div><div class="line">  ~</div><div class="line">  ~      http://www.apache.org/licenses/LICENSE-2.0</div><div class="line">  ~</div><div class="line">  ~ Unless required by applicable law or agreed to in writing, software</div><div class="line">  ~ distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</div><div class="line">  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</div><div class="line">  ~ See the License for the specific language governing permissions and</div><div class="line">  ~ limitations under the License.</div><div class="line">--&gt;</div><div class="line"></div><div class="line">&lt;!--注意看class那边的写法  那个$就是代表内部类的一个符号 这个技巧 以后我们自己自定义控件的时候也可以学习--&gt;</div><div class="line">&lt;view xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</div><div class="line">      class=&quot;android.support.design.widget.Snackbar$SnackbarLayout&quot;</div><div class="line">      android:layout_width=&quot;match_parent&quot;</div><div class="line">      android:layout_height=&quot;wrap_content&quot;</div><div class="line">      android:layout_gravity=&quot;bottom&quot;</div><div class="line">      style=&quot;@style/Widget.Design.Snackbar&quot; /&gt;&lt;!-- From: file:/usr/local/google/buildbot/repo_clients/https___googleplex-android.googlesource.com_a_platform_manifest.git/lmp-mr1-supportlib-release/frameworks/support/design/res/layout/layout_snackbar.xml --&gt;</div></pre></td></tr></table></figure></p>
<p>继续看下内部类<br><img src="http://images0.cnblogs.com/blog2015/365799/201507/211112346918622.png" alt=""><br>找到我们真正的snackbar的布局文件 注意这个地方讨巧的使用了merge标签 这是一个比较好的优化xml的写法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</div><div class="line">&lt;!--</div><div class="line">  ~ Copyright (C) 2015 The Android Open Source Project</div><div class="line">  ~</div><div class="line">  ~ Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</div><div class="line">  ~ you may not use this file except in compliance with the License.</div><div class="line">  ~ You may obtain a copy of the License at</div><div class="line">  ~</div><div class="line">  ~      http://www.apache.org/licenses/LICENSE-2.0</div><div class="line">  ~</div><div class="line">  ~ Unless required by applicable law or agreed to in writing, software</div><div class="line">  ~ distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</div><div class="line">  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</div><div class="line">  ~ See the License for the specific language governing permissions and</div><div class="line">  ~ limitations under the License.</div><div class="line">--&gt;</div><div class="line"></div><div class="line">&lt;merge xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;</div><div class="line"></div><div class="line">    &lt;TextView</div><div class="line">            android:id=&quot;@+id/snackbar_text&quot;</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:layout_weight=&quot;1&quot;</div><div class="line">            android:paddingTop=&quot;@dimen/snackbar_padding_vertical&quot;</div><div class="line">            android:paddingBottom=&quot;@dimen/snackbar_padding_vertical&quot;</div><div class="line">            android:paddingLeft=&quot;@dimen/snackbar_padding_horizontal&quot;</div><div class="line">            android:paddingRight=&quot;@dimen/snackbar_padding_horizontal&quot;</div><div class="line">            android:textAppearance=&quot;@style/TextAppearance.Design.Snackbar.Message&quot;</div><div class="line">            android:maxLines=&quot;@integer/snackbar_text_max_lines&quot;</div><div class="line">            android:layout_gravity=&quot;center_vertical|left|start&quot;</div><div class="line">            android:ellipsize=&quot;end&quot;/&gt;</div><div class="line"></div><div class="line">    &lt;TextView</div><div class="line">            android:id=&quot;@+id/snackbar_action&quot;</div><div class="line">            android:layout_width=&quot;wrap_content&quot;</div><div class="line">            android:layout_height=&quot;wrap_content&quot;</div><div class="line">            android:layout_marginLeft=&quot;@dimen/snackbar_extra_spacing_horizontal&quot;</div><div class="line">            android:layout_marginStart=&quot;@dimen/snackbar_extra_spacing_horizontal&quot;</div><div class="line">            android:layout_gravity=&quot;center_vertical|right|end&quot;</div><div class="line">            android:background=&quot;?attr/selectableItemBackground&quot;</div><div class="line">            android:paddingTop=&quot;@dimen/snackbar_padding_vertical&quot;</div><div class="line">            android:paddingBottom=&quot;@dimen/snackbar_padding_vertical&quot;</div><div class="line">            android:paddingLeft=&quot;@dimen/snackbar_padding_horizontal&quot;</div><div class="line">            android:paddingRight=&quot;@dimen/snackbar_padding_horizontal&quot;</div><div class="line">            android:visibility=&quot;gone&quot;</div><div class="line">            android:textAppearance=&quot;@style/TextAppearance.Design.Snackbar.Action&quot;/&gt;</div><div class="line"></div><div class="line">&lt;/merge&gt;&lt;!-- From: file:/usr/local/google/buildbot/repo_clients/https___googleplex-android.googlesource.com_a_platform_manifest.git/lmp-mr1-supportlib-release/frameworks/support/design/res/layout/layout_snackbar_include.xml --&gt;</div></pre></td></tr></table></figure></p>
<h2 id="Snackbar-样式"><a href="#Snackbar-样式" class="headerlink" title="Snackbar 样式"></a>Snackbar 样式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Snackbar sBar = Snackbar.make(vw, &quot;UV&quot;, Snackbar.LENGTH_SHORT);</div><div class="line">Snackbar.SnackbarLayout ve = (Snackbar.SnackbarLayout)sBar.getView();</div></pre></td></tr></table></figure>
<p>Snackbar 背景色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ve.setBackgroundColor(0xfff44336);</div></pre></td></tr></table></figure></p>
<p>Snackbar 透明度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ve.setAlpha(0.5f);</div></pre></td></tr></table></figure></p>
<p>Snackbar 文字颜色<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">((TextView) ve.findViewById(R.id.snackbar_text)).setTextColor(Color.parseColor(&quot;#FFFFFF&quot;));</div></pre></td></tr></table></figure></p>
<p>Snackbar 位置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ViewGroup.LayoutParams vl = ve.getLayoutParams();</div><div class="line">LinearLayout.LayoutParams ll = new LinearLayout.LayoutParams(vl.width,vl.height);</div><div class="line">ll.gravity = Gravity.TOP;</div><div class="line">ve.setLayoutParams(ll);</div></pre></td></tr></table></figure></p>
<p>Snackbar 位置设置需要配合<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ve.setAnimation();</div></pre></td></tr></table></figure></p>
<p>渐入渐出动画配合使用，Snackbar 动画设置可以参考 Snackbar 源码进行设置。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="http://developer.android.com/intl/zh-cn/reference/android/support/design/widget/Snackbar.html#" target="_blank" rel="external">Android Developer-Snackbar</a></li>
<li><a href="http://www.google.com/design/spec/components/snackbars-toasts.html#" target="_blank" rel="external">SnackBars&amp;Toasts</a></li>
<li><a href="http://www.cnblogs.com/punkisnotdead/p/4663885.html" target="_blank" rel="external">AndroidSupportDesign库之Snackbar使用及源码分析</a></li>
<li><a href="http://blog.163.com/china_uv/blog/static/1171372672015856212986/" target="_blank" rel="external">Material Design 的 Snackbar 样式</a></li>
<li><a href="https://github.com/MrEngineer13/SnackBar" target="_blank" rel="external">DEMO1</a></li>
<li><a href="https://github.com/nispok/snackbar" target="_blank" rel="external">DEMO2</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/12/21/android_material_design_snack/" data-id="cj4zvsgau00360gnhgkiam7yl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/material-design/">material_design</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/snack/">snack</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/3/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/article/">article</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/coding/">coding</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/">database</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/framework/">framework</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/humanism/">humanism</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/message-push/">message_push</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/music/">music</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ndk/">ndk</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/note/">note</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/protocol/">protocol</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/reading/">reading</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/springmvc/">springmvc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/string/">string</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/study/">study</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/versioncontroll/">versioncontroll</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/好文/">好文</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/电影/">电影</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AliPay/">AliPay</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Einstein/">Einstein</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GreenDao/">GreenDao</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ORMLite/">ORMLite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WXPay/">WXPay</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/activity/">activity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-studio/">android_studio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-ui/">android_ui</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/androidstudio/">androidstudio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/animation/">animation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/application/">application</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/book/">book</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/broadcast/">broadcast</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bugfix/">bugfix</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chinese-weman/">chinese_weman</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/code-collection/">code_collection</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/context/">context</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/database/">database</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/decomplication/">decomplication</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/design-model/">design model</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eclipse/">eclipse</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eventbus/">eventbus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/feminism/">feminism</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/fullstack/">fullstack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google/">google</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gradle/">gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/handle/">handle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/handler/">handler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/https/">https</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/humanism/">humanism</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iframe/">iframe</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/image/">image</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/imageloader/">imageloader</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/intent/">intent</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/intentflag/">intentflag</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iphone/">iphone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jni/">jni</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/listview/">listview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/material-design/">material_design</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maven/">maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/music/">music</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mvp/">mvp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nd/">nd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/notification/">notification</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/obfuscation/">obfuscation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/observer/">observer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/opensource/">opensource</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/otto/">otto</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pageradapter/">pageradapter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pay/">pay</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/placeholder/">placeholder</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/project-build/">project_build</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pulltorefresh/">pulltorefresh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pulltorefreshlistview/">pulltorefreshlistview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/saxophone/">saxophone</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/screen-record/">screen-record</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shortkey/">shortkey</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/snack/">snack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/socket/">socket</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sort/">sort</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spannable/">spannable</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/speech/">speech</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springmvc/">springmvc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlite/">sqlite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssl/">ssl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sublime/">sublime</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svg/">svg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svn/">svn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/templates/">templates</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/textview/">textview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tomcat/">tomcat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/translate/">translate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/viewpager/">viewpager</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/volley/">volley</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/website/">website</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webview/">webview</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xpnet/">xpnet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/书单/">书单</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/史玉柱/">史玉柱</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/感悟/">感悟</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/电影/">电影</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/贾樟柯/">贾樟柯</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/AliPay/" style="font-size: 10px;">AliPay</a> <a href="/tags/Einstein/" style="font-size: 10px;">Einstein</a> <a href="/tags/GreenDao/" style="font-size: 10px;">GreenDao</a> <a href="/tags/ORMLite/" style="font-size: 10px;">ORMLite</a> <a href="/tags/WXPay/" style="font-size: 10px;">WXPay</a> <a href="/tags/activity/" style="font-size: 10px;">activity</a> <a href="/tags/android-studio/" style="font-size: 10px;">android_studio</a> <a href="/tags/android-ui/" style="font-size: 10px;">android_ui</a> <a href="/tags/androidstudio/" style="font-size: 20px;">androidstudio</a> <a href="/tags/animation/" style="font-size: 20px;">animation</a> <a href="/tags/application/" style="font-size: 10px;">application</a> <a href="/tags/book/" style="font-size: 10px;">book</a> <a href="/tags/broadcast/" style="font-size: 10px;">broadcast</a> <a href="/tags/bugfix/" style="font-size: 13.33px;">bugfix</a> <a href="/tags/chinese-weman/" style="font-size: 10px;">chinese_weman</a> <a href="/tags/code-collection/" style="font-size: 10px;">code_collection</a> <a href="/tags/context/" style="font-size: 10px;">context</a> <a href="/tags/database/" style="font-size: 10px;">database</a> <a href="/tags/decomplication/" style="font-size: 10px;">decomplication</a> <a href="/tags/design-model/" style="font-size: 13.33px;">design model</a> <a href="/tags/eclipse/" style="font-size: 10px;">eclipse</a> <a href="/tags/eventbus/" style="font-size: 10px;">eventbus</a> <a href="/tags/feminism/" style="font-size: 10px;">feminism</a> <a href="/tags/fullstack/" style="font-size: 10px;">fullstack</a> <a href="/tags/github/" style="font-size: 13.33px;">github</a> <a href="/tags/google/" style="font-size: 10px;">google</a> <a href="/tags/gradle/" style="font-size: 16.67px;">gradle</a> <a href="/tags/handle/" style="font-size: 10px;">handle</a> <a href="/tags/handler/" style="font-size: 10px;">handler</a> <a href="/tags/hexo/" style="font-size: 16.67px;">hexo</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/https/" style="font-size: 10px;">https</a> <a href="/tags/humanism/" style="font-size: 10px;">humanism</a> <a href="/tags/iframe/" style="font-size: 10px;">iframe</a> <a href="/tags/image/" style="font-size: 10px;">image</a> <a href="/tags/imageloader/" style="font-size: 20px;">imageloader</a> <a href="/tags/intent/" style="font-size: 10px;">intent</a> <a href="/tags/intentflag/" style="font-size: 13.33px;">intentflag</a> <a href="/tags/iphone/" style="font-size: 10px;">iphone</a> <a href="/tags/jni/" style="font-size: 10px;">jni</a> <a href="/tags/listview/" style="font-size: 10px;">listview</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/material-design/" style="font-size: 10px;">material_design</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/music/" style="font-size: 13.33px;">music</a> <a href="/tags/mvp/" style="font-size: 10px;">mvp</a> <a href="/tags/mysql/" style="font-size: 16.67px;">mysql</a> <a href="/tags/nd/" style="font-size: 10px;">nd</a> <a href="/tags/notification/" style="font-size: 10px;">notification</a> <a href="/tags/obfuscation/" style="font-size: 10px;">obfuscation</a> <a href="/tags/observer/" style="font-size: 10px;">observer</a> <a href="/tags/opensource/" style="font-size: 13.33px;">opensource</a> <a href="/tags/otto/" style="font-size: 10px;">otto</a> <a href="/tags/pageradapter/" style="font-size: 10px;">pageradapter</a> <a href="/tags/pay/" style="font-size: 13.33px;">pay</a> <a href="/tags/placeholder/" style="font-size: 10px;">placeholder</a> <a href="/tags/project-build/" style="font-size: 10px;">project_build</a> <a href="/tags/pulltorefresh/" style="font-size: 10px;">pulltorefresh</a> <a href="/tags/pulltorefreshlistview/" style="font-size: 13.33px;">pulltorefreshlistview</a> <a href="/tags/saxophone/" style="font-size: 10px;">saxophone</a> <a href="/tags/screen-record/" style="font-size: 10px;">screen-record</a> <a href="/tags/shortkey/" style="font-size: 10px;">shortkey</a> <a href="/tags/snack/" style="font-size: 10px;">snack</a> <a href="/tags/socket/" style="font-size: 10px;">socket</a> <a href="/tags/sort/" style="font-size: 13.33px;">sort</a> <a href="/tags/spannable/" style="font-size: 10px;">spannable</a> <a href="/tags/speech/" style="font-size: 10px;">speech</a> <a href="/tags/springmvc/" style="font-size: 10px;">springmvc</a> <a href="/tags/sqlite/" style="font-size: 10px;">sqlite</a> <a href="/tags/ssl/" style="font-size: 13.33px;">ssl</a> <a href="/tags/sublime/" style="font-size: 10px;">sublime</a> <a href="/tags/svg/" style="font-size: 13.33px;">svg</a> <a href="/tags/svn/" style="font-size: 13.33px;">svn</a> <a href="/tags/templates/" style="font-size: 10px;">templates</a> <a href="/tags/textview/" style="font-size: 10px;">textview</a> <a href="/tags/tomcat/" style="font-size: 16.67px;">tomcat</a> <a href="/tags/translate/" style="font-size: 10px;">translate</a> <a href="/tags/viewpager/" style="font-size: 13.33px;">viewpager</a> <a href="/tags/volley/" style="font-size: 10px;">volley</a> <a href="/tags/website/" style="font-size: 13.33px;">website</a> <a href="/tags/webview/" style="font-size: 10px;">webview</a> <a href="/tags/xpnet/" style="font-size: 13.33px;">xpnet</a> <a href="/tags/书单/" style="font-size: 10px;">书单</a> <a href="/tags/史玉柱/" style="font-size: 10px;">史玉柱</a> <a href="/tags/感悟/" style="font-size: 10px;">感悟</a> <a href="/tags/电影/" style="font-size: 10px;">电影</a> <a href="/tags/贾樟柯/" style="font-size: 10px;">贾樟柯</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/11/11/study_my_website_collection/">常用网站收集</a>
          </li>
        
          <li>
            <a href="/2016/05/04/web_develop_config/">WEB开发之环境配置</a>
          </li>
        
          <li>
            <a href="/2016/05/04/web_springmvc1/">Spring MVC入门(一)</a>
          </li>
        
          <li>
            <a href="/2016/04/07/android_network_ssl/">为你的Android App实现自签名的SSL证书</a>
          </li>
        
          <li>
            <a href="/2016/03/28/android_notification_push/">Android实现推送方式解决方案</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>